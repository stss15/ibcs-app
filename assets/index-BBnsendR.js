var Li=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);import{j as e,S as Oi}from"./sandpack-CqnKOLhG.js";import{b as Ri,r as h,a as Bi}from"./react-BKU87Gzz.js";import{u as mt,L as be,a as fn,b as Ct,c as Di,R as Fi,d as Te,N as Vt,B as Ui}from"./router-BIFgro97.js";import{S as Gt}from"./skulpt-DqQqHTE9.js";import{D as $i,c as Wi,S as Gi,v as Hi,a as qi,b as Vi,u as Yi,C as zi}from"./dndkit-DNSEsy4_.js";import{m as gs,A as Ji}from"./motion-Z5z6rLzg.js";var Cu=Li((Lu,Qt)=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Vs={},Bn=Ri;Vs.createRoot=Bn.createRoot,Vs.hydrateRoot=Bn.hydrateRoot;const Zi="/ibcs-app/app-config.json";let Cs;async function Qi(){const t="".trim();return t?{apiBase:t.replace(/\/$/,"")}:(Cs||(Cs=fetch(Zi,{mode:"cors"}).then(s=>{if(!s.ok)throw new Error("Failed to load app configuration");return s.json()}).then(s=>{if(!(s!=null&&s.API_BASE))throw new Error("Configuration missing API_BASE");return{apiBase:s.API_BASE.replace(/\/$/,"")}})),Cs)}async function ke(t,{method:s="GET",token:n,body:r,headers:i}={}){const{apiBase:a}=await Qi(),o=`${a}${t}`,l={method:s,headers:{"content-type":"application/json",...n?{authorization:`Bearer ${n}`}:{},...i||{}},body:r!==void 0?JSON.stringify(r):void 0},d=await fetch(o,l),c=await d.text();if(!d.ok){let u=`Request failed (${d.status})`;try{const g=c?JSON.parse(c):null;g!=null&&g.error&&(u=g.error)}catch{}const b=new Error(u);throw b.status=d.status,b}if(!c)return null;try{return JSON.parse(c)}catch{return c}}async function Ki({role:t,username:s,password:n}){return ke("/auth/login",{method:"POST",body:{role:t,username:s,password:n}})}async function Xi(t){return ke("/auth/verify",{method:"POST",body:{token:t}})}async function gn(t){return ke("/teacher/dashboard",{method:"GET",token:t})}async function ea(t,{className:s,description:n,yearGroup:r}){return ke("/teacher/classes",{method:"POST",token:t,body:{className:s,description:n,yearGroup:r}})}async function ta(t,s){return ke("/teacher/students",{method:"POST",token:t,body:s})}async function sa(t,s){return ke("/teacher/students/bulk",{method:"POST",token:t,body:s})}async function na(t,s){return ke("/teacher/students/archive",{method:"POST",token:t,body:s})}async function bn(t,s){return ke(`/teacher/classes/${encodeURIComponent(s)}/pacing`,{method:"GET",token:t})}async function ds(t,s){return ke(`/student/classes/${encodeURIComponent(s)}/pacing`,{method:"GET",token:t})}async function ra(t,s){return ke("/student/live-sessions/join",{method:"POST",token:t,body:{joinCode:s}})}async function ia(t,s,n={}){const r={};return Array.isArray(n.studentIds)&&n.studentIds.length>0&&(r.studentIds=n.studentIds),ke(`/teacher/classes/${encodeURIComponent(s)}/credentials`,{method:"POST",token:t,body:r})}async function aa(t,s){return ke(`/teacher/students/${encodeURIComponent(s)}/dashboard`,{method:"GET",token:t})}async function Ke(t,s,n){return ke(`/teacher/classes/${encodeURIComponent(s)}/pacing`,{method:"POST",token:t,body:n})}async function yn(t){return ke("/student/dashboard",{method:"GET",token:t})}async function oa(t,s){return ke("/student/gamification",{method:"POST",token:t,body:s})}async function la(t,s){return ke("/student/progress",{method:"POST",token:t,body:s})}async function Or(t,s){return ke("/student/live-assessment-status",{method:"POST",token:t,body:s})}async function Rr(t,s,{unitId:n,segmentId:r}){if(!s)throw new Error("classId is required to fetch live assessment status");const i=new URLSearchParams;n&&i.append("unitId",n),r&&i.append("segmentId",r);const a=i.toString()?`?${i.toString()}`:"";return ke(`/teacher/classes/${encodeURIComponent(s)}/live-assessment-status${a}`,{method:"GET",token:t})}async function ca(t){return ke("/admin/dashboard",{method:"GET",token:t})}async function da(t,s){return ke("/admin/teachers",{method:"POST",token:t,body:s})}async function ua(t,s){return ke(`/admin/teachers/${encodeURIComponent(s)}`,{method:"DELETE",token:t})}const Ys="ibcs.session",Br=h.createContext(null);function ha(){try{const t=window.localStorage.getItem(Ys);if(!t)return null;const s=JSON.parse(t);if(s&&typeof s=="object"&&s.token&&s.user)return s}catch(t){console.warn("Failed to read session",t)}return null}function Rt(t){try{t?window.localStorage.setItem(Ys,JSON.stringify(t)):window.localStorage.removeItem(Ys)}catch(s){console.warn("Failed to persist session",s)}}function pa({children:t}){const[s,n]=h.useState(()=>ha()),[r,i]=h.useState(!1),a=h.useCallback((c={},u={})=>({...c,...u}),[]);h.useEffect(()=>{let c=!1;async function u(){if(!(s!=null&&s.token)){c||i(!0);return}try{const b=await Xi(s.token);if(c)return;b!=null&&b.valid&&b.user?n(g=>{if(!g)return g;const S=a(g.user,b.user),x={token:g.token,user:S};return Rt(x),x}):(Rt(null),n(null))}catch(b){console.warn("Session verification failed",b),c||(Rt(null),n(null))}finally{c||i(!0)}}return u(),()=>{c=!0}},[a,s==null?void 0:s.token]);const o=h.useCallback(c=>{c&&c.user&&(c={token:c.token,user:{...c.user}}),Rt(c),n(c)},[n]),l=h.useCallback(()=>{Rt(null),n(null)},[n]),d=h.useMemo(()=>({session:s,setSession:o,clear:l,ready:r}),[s,o,l,r]);return h.createElement(Br.Provider,{value:d},t)}function Pe(){const t=h.useContext(Br);if(!t)throw new Error("useSession must be used within a SessionProvider");return t}function Le({tone:t="info",children:s,animated:n=!0,className:r=""}){const i=h.useRef(null);if(h.useEffect(()=>{if(n&&i.current){i.current.classList.add("feedback-panel--animate");const o=setTimeout(()=>{i.current&&i.current.classList.remove("feedback-panel--animate")},300);return()=>clearTimeout(o)}},[n]),!s)return null;const a=["feedback-panel",`feedback-panel--${t}`,r].filter(Boolean).join(" ");return e.jsx("div",{ref:i,className:a,role:"status","aria-live":"polite",children:s})}const zs="/ibcs-app/assets/logo-U6WRSyen.svg",Xt={status:"idle",message:""};function ma(){const[t,s]=h.useState("teacher"),[n,r]=h.useState(Xt),{setSession:i}=Pe(),a=mt(),o=t==="teacher"?"Teacher":t==="student"?"Student":"Admin",l=async d=>{d.preventDefault();const c=d.currentTarget,u=c.username.value.trim(),b=c.password.value;if(!u||!b){r({status:"error",message:"Enter username and password."});return}r({status:"loading",message:`Signing in as ${o}â€¦`});try{const g=await Ki({role:t,username:u,password:b});if(!(g!=null&&g.token)||!(g!=null&&g.user))throw new Error("Unexpected login response");i({token:g.token,user:g.user}),r({status:"success",message:"Signed in."}),g.user.role==="admin"?a("/admin",{replace:!0}):g.user.role==="teacher"?a("/dashboard",{replace:!0}):a("/student",{replace:!0})}catch(g){r({status:"error",message:g.message||"Login failed"})}};return e.jsx("div",{className:"login-container",children:e.jsxs("section",{className:"login-card",children:[e.jsxs("header",{className:"login-card__header",children:[e.jsx("img",{src:zs,alt:"School crest",className:"login-card__logo"}),e.jsxs("div",{children:[e.jsx("h1",{children:"Computer Science Department"}),e.jsx("p",{className:"muted",children:"Sign in to access the teaching dashboards and curriculum map."})]})]}),e.jsxs("div",{className:"login-role",children:[e.jsx("span",{children:"Sign in as"}),e.jsxs("div",{className:"login-role__toggle",role:"group","aria-label":"Choose account role",children:[e.jsx("button",{type:"button",className:t==="teacher"?"active":"",onClick:()=>{s("teacher"),r(Xt)},children:"Teacher"}),e.jsx("button",{type:"button",className:t==="student"?"active":"",onClick:()=>{s("student"),r(Xt)},children:"Student"}),e.jsx("button",{type:"button",className:t==="admin"?"active":"",onClick:()=>{s("admin"),r(Xt)},children:"Admin"})]})]}),e.jsxs("form",{onSubmit:l,className:"login-form",children:[e.jsxs("label",{children:[e.jsx("span",{children:"Username"}),e.jsx("input",{name:"username",required:!0,autoComplete:"username"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Password"}),e.jsx("input",{name:"password",type:"password",required:!0,autoComplete:"current-password"})]}),e.jsx("button",{type:"submit",className:"login-submit",disabled:n.status==="loading",children:n.status==="loading"?"Workingâ€¦":`Log in as ${o}`}),n.message&&e.jsx(Le,{tone:n.status==="error"?"error":n.status==="success"?"success":"info",children:n.message})]}),e.jsx("footer",{className:"login-footnote",children:e.jsx("p",{className:"muted",children:"Admins manage teacher accounts. Teachers manage classes and unlock curriculum. Students track their own journey. Choose the right role above so we can route you to the correct dashboard."})})]})})}const fa=["Aero","Blaze","Comet","Delta","Echo","Frost","Glimmer","Helio","Iris","Jade","Kite","Lumen","Nova","Orion","Pip","Quill","Rune","Sol","Terra","Vivid","Wisp","Xeno","Yarrow","Zephyr"],ga=["!","?","@","#","$"];function Dn(t,s=Math.random){if(!Array.isArray(t)||t.length===0)return"";const n=Math.floor(s()*t.length);return t[Math.max(0,Math.min(t.length-1,n))]}function Bt(t=Math.random){const s=Dn(fa,t),n=Math.floor(t()*90)+10,r=Dn(ga,t);return`${s}${n}${r}`}function rt(...t){const s=[],n=r=>{if(r){if(typeof r=="string"){s.push(r);return}if(Array.isArray(r)){r.forEach(n);return}if(typeof r=="object")for(const[i,a]of Object.entries(r))a&&s.push(i)}};return t.forEach(n),s.join(" ")}const Fn={default:null,compact:"content-container--compact",wide:"content-container--wide",fullWidth:"content-container--full"};function ut({variant:t="default",className:s,children:n,...r}){const i=Fn[t]??Fn.default;return e.jsx("div",{className:rt("content-container",i,s),...r,children:n})}function ba(t){if(t!=null)return typeof t=="number"?`${t}px`:t}function Un({columns:t,minColumnWidth:s=280,variant:n="grid",className:r,children:i,style:a,...o}){const l={...a};if(n!=="masonry"&&t){const c=t.base??t.xs??t.sm??t.md??t.lg??1;l["--columns-base"]=c,t.sm!=null&&(l["--columns-sm"]=t.sm),t.md!=null&&(l["--columns-md"]=t.md),t.lg!=null&&(l["--columns-lg"]=t.lg),t.xl!=null&&(l["--columns-xl"]=t.xl)}n==="autoFit"&&(l["--min-column-width"]=ba(s));const d=n==="masonry"?rt("responsive-grid--masonry",r):rt("responsive-grid",n==="autoFit"&&"responsive-grid--auto-fit",r);return e.jsx("div",{className:d,style:l,...o,children:i})}function ya(t){return typeof t!="number"||Number.isNaN(t)?null:Math.max(0,Math.min(t,1))}function $n(t,s){return t?typeof t=="string"?e.jsx("span",{className:s,children:t}):t:null}function Mt({label:t,value:s,description:n,badge:r,icon:i,meta:a,actions:o,progress:l,progressLabel:d,tone:c="default",compact:u=!1,className:b,children:g}){const S=ya(l),x=S===null?null:Math.round(S*100),A=$n(r,"stat-card__badge"),v=$n(a,"stat-card__meta-text");return e.jsxs("article",{className:rt("stat-card",c&&`stat-card--${c}`,u&&"stat-card--compact",b),children:[(A||t||o)&&e.jsxs("div",{className:"stat-card__top",children:[e.jsxs("div",{className:"stat-card__title",children:[A,t&&e.jsx("span",{className:"stat-card__label",children:t})]}),o?e.jsx("div",{className:"stat-card__actions",children:o}):null]}),(s||n||i||g)&&e.jsxs("div",{className:"stat-card__content",children:[i?e.jsx("span",{className:"stat-card__icon","aria-hidden":"true",children:i}):null,e.jsxs("div",{className:"stat-card__metrics",children:[s?e.jsx("span",{className:"stat-card__value",children:s}):null,n?e.jsx("p",{className:"stat-card__description",children:n}):null,g]})]}),v?e.jsx("div",{className:"stat-card__meta",children:v}):null,x!==null?e.jsx("div",{className:"stat-card__progress",style:{"--stat-card-progress":`${x}%`},children:e.jsx("div",{className:"stat-card__progress-bar",role:"progressbar","aria-valuenow":x,"aria-valuemin":"0","aria-valuemax":"100"})}):null,d?e.jsx("div",{className:"stat-card__progress-label",children:d}):null]})}const xa=new Set(["info","success","warning","danger","neutral"]);function Yt({tone:t="info",title:s,icon:n,children:r,actions:i,onDismiss:a,className:o,as:l="div",...d}){const c=xa.has(t)?t:"info";return e.jsxs(l,{className:rt("status-banner",`status-banner--${c}`,o),role:"status",...d,children:[n?e.jsx("span",{className:"status-banner__icon","aria-hidden":"true",children:n}):null,e.jsxs("div",{className:"status-banner__content",children:[s?e.jsx("strong",{children:s}):null,r?e.jsx("div",{className:"status-banner__body",children:r}):null]}),i?e.jsx("div",{className:"status-banner__actions",children:i}):null,a?e.jsx("button",{type:"button",className:"status-banner__dismiss",onClick:a,"aria-label":"Dismiss",children:"Ã—"}):null]})}function Js({isOpen:t,onClose:s,title:n,children:r,size:i="md",closeOnBackdropClick:a=!0,closeOnEscape:o=!0}){const l=h.useRef(null),d=h.useRef(null),c=h.useRef(null);if(h.useEffect(()=>{if(!t||!l.current)return;c.current=document.activeElement;const b=l.current.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');b?b.focus():d.current&&d.current.focus();const g=x=>{if(!l.current)return;const A=l.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),v=A[0],j=A[A.length-1];x.shiftKey?document.activeElement===v&&(x.preventDefault(),j==null||j.focus()):document.activeElement===j&&(x.preventDefault(),v==null||v.focus())},S=x=>{o&&x.key==="Escape"&&s()};return document.addEventListener("keydown",g),document.addEventListener("keydown",S),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",g),document.removeEventListener("keydown",S),document.body.style.overflow="",c.current&&c.current.focus()}},[t,s,o]),!t)return null;const u=n?`modal-title-${Math.random().toString(36).substr(2,9)}`:void 0;return e.jsxs("div",{className:"modal-overlay",role:"presentation",children:[e.jsx("button",{type:"button",className:"modal-overlay__backdrop","aria-label":"Close modal",tabIndex:-1,onClick:a?()=>{s==null||s()}:void 0,"aria-hidden":a?void 0:"true"}),e.jsxs("div",{ref:l,className:`modal-dialog modal-dialog--${i}`,role:"dialog","aria-modal":"true","aria-labelledby":u,children:[n&&e.jsxs("header",{className:"modal-header",children:[e.jsx("h2",{id:u,ref:d,className:"modal-title",children:n}),e.jsx("button",{type:"button",className:"modal-close",onClick:s,"aria-label":"Close modal",children:"Ã—"})]}),e.jsx("div",{className:"modal-content",children:r})]})]})}const Wn={id:"lesson_cs_intro_001",title:"Introduction to Computer Science",yearGroup:7,duration:50,objectives:["Understand what computer science is","Identify the key components of a computer system","Recognize the difference between hardware and software","Apply computational thinking to solve a simple problem"],slides:[{id:"slide_001",type:"content",index:0,content:{layout:"centered",blocks:[{type:"heading",level:1,text:"Welcome to Computer Science! ðŸš€"},{type:"interactive",component:"ThinkPairShare",prompt:"What do you think computer science is?",duration:120}]},teacherNotes:"Start with engagement. Let students discuss in pairs for 2 minutes.",minimumViewTime:30},{id:"slide_002",type:"content",index:1,content:{layout:"split",blocks:[{type:"objectives",objectives:["Computer Science is the study of computation","It focuses on problem solving with algorithms","We build digital solutions to real problems"]},{type:"paragraph",text:"Tap each pillar to reveal examples."}]},teacherNotes:"Click each pillar to reveal. Emphasize problem-solving aspect."},{id:"slide_003",type:"interactive",index:2,content:{layout:"full",blocks:[{type:"sortingActivity",title:"Hardware or Software?",instruction:"Drag each item to the correct category",items:[{id:"mouse",label:"Mouse",correct:"hardware"},{id:"windows",label:"Windows 11",correct:"software"},{id:"ram",label:"RAM Memory",correct:"hardware"},{id:"chrome",label:"Google Chrome",correct:"software"},{id:"keyboard",label:"Keyboard",correct:"hardware"},{id:"python",label:"Python",correct:"software"}],categories:["hardware","software"],feedback:{correct:"ðŸŽ‰ Excellent! You understand the difference!",incorrect:"Not quite. Remember: Hardware you can touch, Software you cannot."}}]},assessmentId:"assess_hardware_software"},{id:"slide_004",type:"content",index:3,content:{layout:"interactive",blocks:[{type:"heading",text:"How Computers Think: Binary! ðŸ’¡"},{type:"interactive",component:"BinaryLightBulbs",levels:[{target:5,bulbs:3},{target:10,bulbs:4},{target:21,bulbs:5}]}]},teacherNotes:"Let students experiment. Show binary patterns on board."},{id:"slide_005",type:"assessment",index:4,assessmentId:"assess_computational_thinking",content:{type:"multipart",title:"Computational Thinking Challenge",parts:[{type:"sequencing",prompt:"Put these steps in order to make a sandwich:",items:[{id:1,text:"Get two slices of bread"},{id:2,text:"Spread butter on bread"},{id:3,text:"Add filling"},{id:4,text:"Put slices together"},{id:5,text:"Cut sandwich in half"}],correctOrder:[1,2,3,4,5]},{type:"pattern-recognition",prompt:"What comes next in this pattern?",sequence:["2","4","8","16","?"],options:["20","24","32","64"],correct:"32"}],timeLimit:180,experienceReward:100}},{id:"slide_006",type:"content",index:5,content:{layout:"gallery",blocks:[{type:"gallery",items:[{title:"Gaming",image:"/images/gaming.jpg",description:"Game engines use physics algorithms",link:"explore_gaming_cs"},{title:"Social Media",image:"/images/social.jpg",description:"Recommendation algorithms decide what you see",link:"explore_social_cs"},{title:"Medicine",image:"/images/medicine.jpg",description:"AI helps doctors diagnose diseases",link:"explore_medical_cs"},{title:"Environment",image:"/images/environment.jpg",description:"Climate models predict weather patterns",link:"explore_climate_cs"}]}]},teacherNotes:"Click each card to reveal. Relate to student interests."},{id:"slide_007",type:"interactive",index:6,content:{layout:"collaborative",blocks:[{type:"heading",text:"Team Challenge: Program a Robot! ðŸ¤–"},{type:"interactive",component:"RobotMaze",config:{maze:[["S","0","0","W"],["W","W","0","0"],["0","0","0","W"],["W","0","G","0"]],commands:["MOVE_FORWARD","TURN_LEFT","TURN_RIGHT"],maxCommands:10,teamSize:2,shareResults:!0},experiencePoints:150}]},assessmentId:"assess_robot_programming"},{id:"slide_008",type:"content",index:7,content:{layout:"reflection",blocks:[{type:"heading",text:"What Did We Learn Today? ðŸŽ“"},{type:"reflectionPrompts",prompts:["One thing that surprised me about computer science was...","I think computer science is important because...","One question I still have is..."],submitTo:"teacherDashboard"},{type:"badgeAward",badge:{id:"badge_cs_intro",name:"CS Explorer",icon:"ðŸ†",description:"Completed Introduction to Computer Science",experiencePoints:200}}]},teacherNotes:"Allow 5 minutes for reflection. Celebrate achievements!"}],homework:{id:"hw_cs_intro_001",title:"CS in My World",tasks:[{type:"research",prompt:"Find 3 examples of computer science in your home",submission:"photo_upload"},{type:"creative",prompt:"Design your own simple algorithm for a daily task",submission:"text_diagram"}],dueInDays:7,experiencePoints:100}};function va(t){return t.teacherNotes?{headline:t.teacherNotes,script:Array.isArray(t.teacherScript)?t.teacherScript:null,prompts:t.teacherPrompts||null}:null}function ja(t){var s,n;return{headline:((s=t.content)==null?void 0:s.headline)||((n=t.content)==null?void 0:n.title)||null}}function wa(t,s){var r,i;const n=t.type==="assessment"?"assessment":t.type;return{id:t.id,order:t.order??s+1,index:s,type:n,title:t.title||`Slide ${s+1}`,layout:((r=t.content)==null?void 0:r.layout)??null,duration:t.duration??null,allowRetry:t.allowRetry!==!1,content:t.content,assessmentId:t.assessmentId??null,teacher:va(t),student:ja(t),checkpoint:((i=t.content)==null?void 0:i.checkpoint)??null}}const _a={id:"KS3-COMP-FOUNDATIONS",slug:"ks3-computing-foundations",title:"Computing Foundations (Teacher-Paced)",summary:"A teacher-led launch sequence for Year 7 computing. Slides mirror the teacher display, and the pacing pointer prevents students from racing ahead while keeping earlier material available for revision.",accent:"#2563eb",icon:"ðŸŽ¯",estimatedDuration:"90 min",defaultAudience:"ks3",lesson:Wn,slides:Wn.slides.map(wa)},bs=[_a],Dr=new Map,Fr=new Map;for(const t of bs)Dr.set(t.id,t),t.slides.forEach((s,n)=>{Fr.set(s.id,{deckId:t.id,deck:t,slide:s,index:n})});function Ur(){return bs[0]??null}function $r(t){return t?Dr.get(t)??null:null}function Ft(t){return t?Fr.get(t)??null:null}function xn(t){const s=$r(t)??Ur();return s?s.slides.map((n,r)=>({id:n.id,title:n.title,order:n.order??r+1,type:n.type,deckId:s.id,deckTitle:s.title,index:r,layout:n.layout??null,lockByDefault:!!n.lockByDefault})):[]}function ys(t){const s=Ft(t);if(!s)return null;const{deck:n,slide:r,index:i}=s;return{deckId:n.id,deckTitle:n.title,slideId:r.id,slideTitle:r.title,type:r.type,index:i,order:r.order??i+1,layout:r.layout??null}}function Na(t){const s=$r(t);return s?{id:s.id,title:s.title,summary:s.summary,accent:s.accent,icon:s.icon,estimatedDuration:s.estimatedDuration??null,slideCount:s.slides.length}:null}const Ss=Ur(),ka=(Ss==null?void 0:Ss.id)??null,Wr=bs.map(t=>({id:t.id,title:t.title,summary:t.summary,accent:t.accent,icon:t.icon,lessons:t.slides.map((s,n)=>({id:s.id,slug:s.id,order:s.order??n+1,title:s.title,duration:s.duration??null,type:s.type,mode:s.type}))}));xn(ka);function vn(t){if(!t)return null;const s=ys(t);return s?{id:s.slideId,title:s.slideTitle,unitId:s.deckId,unitTitle:s.deckTitle,mode:s.type,order:s.order,index:s.index}:null}function Gn(t){const s=ys(t);return(s==null?void 0:s.index)??-1}var Lr;const bt=[{id:"y7-unit-1",title:"Unit 1 Â· Introduction to Computing",summary:"Launch the course with live, teacher-paced slides that introduce digital systems, the IPO model, and collaborative routines.",focus:"Teacher-paced live deck",estimatedHours:"5â€“6 lessons",deckId:((Lr=bs[0])==null?void 0:Lr.id)??null,status:"available",icon:"ðŸ§­",colour:"#2563eb"},{id:"y7-unit-2",title:"Unit 2 Â· Digital Systems in Context",summary:"Investigate real-world systems, sensors, and control loops through guided case studies.",focus:"Project-based",estimatedHours:"6 lessons",deckId:null,status:"upcoming",icon:"ðŸ› ï¸",colour:"#0ea5e9"},{id:"y7-unit-3",title:"Unit 3 Â· Computational Thinking",summary:"Build decomposition, pattern recognition, abstraction, and algorithm skills with unplugged challenges.",focus:"Unplugged + micro-tasks",estimatedHours:"5 lessons",deckId:null,status:"upcoming",icon:"ðŸ§©",colour:"#6366f1"},{id:"y7-unit-4",title:"Unit 4 Â· Python Foundations",summary:"Move from blocks to Python with short, confidence-building coding sprints.",focus:"Coding labs",estimatedHours:"6 lessons",deckId:null,status:"upcoming",icon:"ðŸ",colour:"#22c55e"},{id:"y7-unit-5",title:"Unit 5 Â· Data, Media & Representation",summary:"Explore how computers store numbers, text, and media through interactive demos.",focus:"Interactive media",estimatedHours:"4 lessons",deckId:null,status:"upcoming",icon:"ðŸŽ¨",colour:"#f59e0b"},{id:"y7-unit-6",title:"Unit 6 Â· Create & Reflect",summary:"Wrap the year with a mini project that blends research, making, and reflection.",focus:"Capstone",estimatedHours:"5 lessons",deckId:null,status:"upcoming",icon:"ðŸš€",colour:"#ef4444"}],Ht=[{id:"year7",label:"Year 7",yearGroupLabel:"Year 7",cohortOffset:7,groups:["A","B","C","D"],programme:"ks3",buildCode:(t,s)=>`CsC/${t}F${s}`},{id:"year8",label:"Year 8",yearGroupLabel:"Year 8",cohortOffset:6,groups:["A","B","C","D"],programme:"ks3",buildCode:(t,s)=>`CsC/${t}F${s}`},{id:"year9",label:"Year 9",yearGroupLabel:"Year 9",cohortOffset:5,groups:["A","B","C","D"],programme:"ks3",buildCode:(t,s)=>`CsC/${t}F${s}`},{id:"igcse",label:"IGCSE",yearGroupLabel:"IGCSE",cohortOffset:4,groups:["G1","G2"],programme:"igcse",buildCode:(t,s)=>`CsC/${t}${s}`},{id:"ib",label:"IB",yearGroupLabel:"IB",cohortOffset:2,groups:["SL","HL"],programme:t=>t==="HL"?"ib-hl":"ib-sl",buildCode:(t,s)=>`CsC/${t}${s}`}],Ca=`firstName,lastName,username
`,Gr="ibcs.teacherPasswords";function Is(t=[],s){return s!=null&&s.classId?[...(t??[]).filter(r=>(r==null?void 0:r.classId)!==s.classId),s]:Array.isArray(t)?t:[]}function Sa(t){return((t==null?void 0:t.yearGroup)??"").toLowerCase().includes("year 7")}function Ia(){if(typeof window>"u")return{};try{const t=window.localStorage.getItem(Gr);if(!t)return{};const s=JSON.parse(t);return s&&typeof s=="object"?s:{}}catch{return{}}}function Aa(t){if(!(typeof window>"u"))try{window.localStorage.setItem(Gr,JSON.stringify(t))}catch{}}function Hr(t){return`username:${t.toLowerCase()}`}function es(t,s){const n={...t};for(const r of s)r!=null&&r.password&&(r.id&&(n[r.id]=r.password),r.username&&(n[Hr(r.username)]=r.password));return n}function Hn(t,s){const n=s!=null&&s.id?t[s.id]:void 0;if(n)return n;if(s!=null&&s.username)return t[Hr(s.username)]}function yt(t){return Ht.find(s=>s.id===t)??Ht[0]}function jn(t){const s=String(t).replace(/\D/g,"");return s?s.slice(-2).padStart(2,"0"):""}function At(t){const n=new Date().getFullYear()%100+t;return jn(n)}function vt(t,s,n){const r=yt(t),i=(n==null?void 0:n.toUpperCase())??"",a=jn(s||At(r.cohortOffset));return r.buildCode(a,i)}function Ta(t,s){const n=yt(t);return typeof n.programme=="function"?n.programme(s==null?void 0:s.toUpperCase()):n.programme}function qr(t,s){const n=yt(t);return t==="ib"?`IB ${(s==null?void 0:s.toUpperCase())==="HL"?"HL":"SL"}`:t==="igcse"?"IGCSE":n.yearGroupLabel}function As(t){const s=(t==null?void 0:t.className)??"",n=((t==null?void 0:t.yearGroup)??"").toLowerCase();let r=null;n.includes("year 7")?r="year7":n.includes("year 8")?r="year8":n.includes("year 9")?r="year9":n.includes("igcse")?r="igcse":(n.includes("hl")||n.includes("sl")||n.includes("ib"))&&(r="ib");const i=s.match(/^CsC\/(\d{2})([A-Za-z0-9]+)$/),a=i?i[1]:"";let o=i?i[2].toUpperCase():"";(r==="year7"||r==="year8"||r==="year9")&&(o=o.replace(/^F/,"")),r==="igcse"&&!o.startsWith("G")&&(o=`G${o}`),r==="ib"&&(o=o==="HL"?"HL":"SL");const l=Ta(r??"year7",o),d=qr(r??"year7",o);return{stageId:r??"year7",cohort:a||At(yt(r??"year7").cohortOffset),group:o||yt(r??"year7").groups[0],programme:l,yearGroupLabel:d}}function Ma(t){const s=[t==null?void 0:t.passwordPlain,t==null?void 0:t.initialPassword,t==null?void 0:t.passwordPreview,t==null?void 0:t.defaultPassword,t==null?void 0:t.password];for(const n of s){if(typeof n!="string")continue;const r=n.trim();if(r&&!/^\$2[aby]\$/.test(r))return r}return""}function Pa(t){const s=t.split(/\r?\n/).map(o=>o.trim()).filter(Boolean);if(s.length<=1)return[];const n=s[0].split(/\s*,\s*/).map(o=>o.toLowerCase()),r=n.indexOf("firstname"),i=n.indexOf("lastname"),a=n.indexOf("username");if(r===-1||i===-1)throw new Error("Template must include firstName and lastName columns.");return s.slice(1).map(o=>{const l=o.split(/\s*,\s*/);return{firstName:l[r]??"",lastName:l[i]??"",username:a===-1?"":l[a]??""}})}function Ea(){const t=new Blob([Ca],{type:"text/csv"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="ibcs-student-template.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}function La(){var de,je,ze,Ce,lt,et,Je,Ze,Qe;const{session:t,ready:s}=Pe(),n=mt(),r=(t==null?void 0:t.token)??null,i=((de=t==null?void 0:t.user)==null?void 0:de.role)==="teacher",[a,o]=h.useState(null),[l,d]=h.useState(!1),[c,u]=h.useState(null),[b,g]=h.useState(null),[S,x]=h.useState(!1),[A,v]=h.useState(null),[j,C]=h.useState({}),[k,R]=h.useState(()=>{const T=Ht[0],$=At(T.cohortOffset),W=T.groups[0];return{stageId:T.id,cohort:$,group:W,className:vt(T.id,$,W),description:""}}),[I,w]=h.useState({firstName:"",lastName:"",username:"",password:Bt()}),[N,m]=h.useState(null),[f,p]=h.useState(null),[_,O]=h.useState(()=>Ia()),[F,D]=h.useState({}),E=h.useCallback(T=>{O($=>{const W=typeof T=="function"?T($):T,K=W||{};return Aa(K),K})},[]);h.useEffect(()=>{s&&(i||(E({}),n("/",{replace:!0})))},[s,i,n,E]);const U=h.useCallback(async()=>{if(!(!r||!i)){d(!0);try{const T=await gn(r);if(o(T),Array.isArray(T==null?void 0:T.students)){const $=[];for(const W of T.students){const K=Ma(W);K&&$.push({id:W.id,username:W.username,password:K})}$.length>0&&E(W=>es(W,$))}}catch(T){u({tone:"error",message:T.message||"Failed to load dashboard."})}finally{d(!1)}}},[r,i,E]);h.useEffect(()=>{!s||!i||U()},[s,i,U]);const z=h.useMemo(()=>[...(a==null?void 0:a.classes)??[]].sort(($,W)=>$.className.localeCompare(W.className)),[a==null?void 0:a.classes]);h.useEffect(()=>{if(z.length===0){g(null);return}g(T=>T&&z.some($=>$.id===T)?T:z[0].id)},[z]);const ne=h.useMemo(()=>{const T=new Map;for(const $ of(a==null?void 0:a.students)??[])T.has($.classId)||T.set($.classId,[]),T.get($.classId).push($);for(const $ of T.values())$.sort((W,K)=>W.displayName.localeCompare(K.displayName));return T},[a==null?void 0:a.students]),Z=h.useMemo(()=>{const T=new Map;for(const $ of(a==null?void 0:a.classPacing)??[])$!=null&&$.classId&&T.set($.classId,$);return T},[a==null?void 0:a.classPacing]),P=h.useMemo(()=>z.find(T=>T.id===b)??null,[z,b]),L=h.useMemo(()=>P?ne.get(P.id)??[]:[],[P,ne]),Q=h.useMemo(()=>P?As(P):null,[P]),J=P?Z.get(P.id)??null:null,ie=J?vn(J.lessonId):null,G=h.useMemo(()=>new Intl.NumberFormat,[]),ee=h.useMemo(()=>{if(!P)return[];const T=le+ce,$=G.format(L.length),W=G.format(le),K=G.format(ce),ae=G.format(T);return[{key:"students",label:"Total students",value:$},{key:"available",label:"Lessons available",value:W,progress:T>0?le/T:null,progressLabel:T>0?`${W} of ${ae} open`:"No lessons unlocked yet"},{key:"locked",label:"Lessons locked",value:K,progress:T>0?ce/T:null,progressLabel:T>0?`${K} awaiting release`:"All lessons unlocked"}]},[le,ce,G,P,L.length]),te=P?j[P.id]:null,V=P?Sa(P):!1,y=h.useCallback(T=>{setTimeout(()=>{C($=>{const W=$[T];if(!W||W.busy)return $;const K={...$};return delete K[T],K})},4e3)},[]),M=h.useCallback(async T=>{var $;if(r){C(W=>({...W,[T]:{...W[T]??{},busy:!0,message:"Updating pointerâ€¦",tone:"info"}}));try{const W=await Ke(r,T,{command:"start"});W!=null&&W.pacing&&o(ae=>({...ae,classPacing:Is(ae==null?void 0:ae.classPacing,W.pacing)}));const K=(($=W==null?void 0:W.lesson)==null?void 0:$.title)??"Lesson 1";C(ae=>({...ae,[T]:{busy:!1,message:`Pointer set to ${K}`,tone:"success"}}))}catch(W){C(K=>({...K,[T]:{busy:!1,message:(W==null?void 0:W.message)||"Unable to update the teaching pointer.",tone:"error"}}))}finally{y(T)}}},[r,y]),B=h.useCallback(async T=>{var $;if(r){C(W=>({...W,[T]:{...W[T]??{},busy:!0,message:"Advancing pointerâ€¦",tone:"info"}}));try{const W=await Ke(r,T,{command:"advance"});W!=null&&W.pacing&&o(ae=>({...ae,classPacing:Is(ae==null?void 0:ae.classPacing,W.pacing)}));const K=(($=W==null?void 0:W.lesson)==null?void 0:$.title)??"the next lesson";C(ae=>({...ae,[T]:{busy:!1,message:`Advanced to ${K}`,tone:"success"}}))}catch(W){C(K=>({...K,[T]:{busy:!1,message:(W==null?void 0:W.message)||"Unable to advance the pointer.",tone:"error"}}))}finally{y(T)}}},[r,y]),H=h.useCallback(async T=>{var $;if(!(!r||!T)){C(W=>({...W,[T]:{...W[T]??{},busy:!0,message:"Saving pointerâ€¦",tone:"info"}}));try{const W=await Ke(r,T,{command:"stop"});W!=null&&W.pacing&&o(ae=>({...ae,classPacing:Is(ae==null?void 0:ae.classPacing,W.pacing)}));const K=(($=W==null?void 0:W.lesson)==null?void 0:$.title)??"current lesson";C(ae=>({...ae,[T]:{busy:!1,message:`Pointer saved at ${K}`,tone:"success"}}))}catch(W){C(K=>({...K,[T]:{busy:!1,message:(W==null?void 0:W.message)||"Unable to save the teaching pointer.",tone:"error"}}))}finally{y(T)}}},[r,y]),Y=h.useCallback(T=>{n(`/curriculum/year7?classId=${encodeURIComponent(T)}`)},[n]),q=((je=a==null?void 0:a.teacher)==null?void 0:je.displayName)??((ze=t==null?void 0:t.user)==null?void 0:ze.displayName)??((Ce=t==null?void 0:t.user)==null?void 0:Ce.username)??"Teacher",re=((lt=a==null?void 0:a.students)==null?void 0:lt.length)??0,ce=((et=a==null?void 0:a.lessonSummary)==null?void 0:et.locked)??0,le=((Je=a==null?void 0:a.lessonSummary)==null?void 0:Je.available)??0,fe=((Ze=a==null?void 0:a.lessonSummary)==null?void 0:Ze["formative-complete"])??0,he=((Qe=a==null?void 0:a.lessonSummary)==null?void 0:Qe["summative-complete"])??0,ue=h.useMemo(()=>[{label:"Active classes",value:G.format(z.length)},{label:"Active students",value:G.format(re)},{label:"Formative complete",value:G.format(fe)},{label:"Summative complete",value:G.format(he)}],[z.length,fe,G,re,he]),ve=h.useMemo(()=>{const T=new Map;for(const $ of(a==null?void 0:a.students)??[])T.set($.id,$);return T},[a==null?void 0:a.students]),ye=h.useMemo(()=>{const T=new Map;for(const $ of(a==null?void 0:a.progress)??[]){if(!($!=null&&$.studentId))continue;const W=ve.get($.studentId);if(!W)continue;let K=T.get($.studentId);K||(K={id:$.studentId,displayName:W.displayName??W.username??"Student",username:W.username??"",locked:0,available:0,formativeComplete:0,summativeComplete:0,lastUpdated:null},T.set($.studentId,K));const ae=($.status||"locked").toLowerCase();ae==="locked"?K.locked+=1:ae==="available"?K.available+=1:ae==="formative-complete"?K.formativeComplete+=1:ae==="summative-complete"&&(K.summativeComplete+=1);const ge=$.updatedAt?new Date($.updatedAt).getTime():null;ge&&(!K.lastUpdated||ge>K.lastUpdated)&&(K.lastUpdated=ge)}return Array.from(T.values()).sort(($,W)=>$.displayName.localeCompare(W.displayName))},[a==null?void 0:a.progress,ve]),Ee=h.useMemo(()=>ye.filter(T=>T.available>0&&T.formativeComplete===0).slice(0,6),[ye]),Ue=h.useMemo(()=>[...(a==null?void 0:a.progress)??[]].filter($=>$.updatedAt).sort(($,W)=>new Date(W.updatedAt).getTime()-new Date($.updatedAt).getTime()).slice(0,8).map($=>{const W=ve.get($.studentId);return{id:$.id??`${$.studentId}-${$.lessonSlug}`,lesson:$.lessonSlug,status:$.status,updatedAt:$.updatedAt,studentName:(W==null?void 0:W.displayName)??(W==null?void 0:W.username)??"Student"}}),[a==null?void 0:a.progress,ve]),it=(T,$)=>{R(W=>{if(T==="stageId"){const K=yt($),ae=At(K.cohortOffset),ge=K.groups[0];return{stageId:$,cohort:ae,group:ge,description:"",className:vt($,ae,ge)}}return T==="cohort"?{...W,cohort:$,className:vt(W.stageId,$,W.group)}:T==="group"?{...W,group:$,className:vt(W.stageId,W.cohort,$)}:{...W,[T]:$}})},at=()=>{const T=Ht[0],$=At(T.cohortOffset),W=T.groups[0];R({stageId:T.id,cohort:$,group:W,description:"",className:vt(T.id,$,W)}),u(null),x(!0)},ft=async T=>{if(T.preventDefault(),!r)return;const $=yt(k.stageId),W=jn(k.cohort)||At($.cohortOffset),K=k.group||$.groups[0],ae=vt(k.stageId,W,K),ge=qr(k.stageId,K);try{u({tone:"info",message:"Creating classâ€¦"});const we=await ea(r,{className:ae,description:k.description||void 0,yearGroup:ge});u({tone:"success",message:`Class ${ae} created.`}),x(!1),await U(),we!=null&&we.id&&g(we.id)}catch(we){u({tone:"error",message:we.message||"Unable to create class."})}},Ve=(T,$="single")=>{const W=As(T);w({firstName:"",lastName:"",username:"",password:Bt()}),m(null),p(null),v({classItem:T,meta:W,mode:$})},$e=(T,$)=>{w(W=>{const K={...W,[T]:$};if((T==="firstName"||T==="lastName")&&!W.username){const ae=(T==="firstName"?$:W.firstName).trim(),ge=(T==="lastName"?$:W.lastName).trim();ae&&ge&&(K.username=`${ae[0]??""}${ge}`.toLowerCase().replace(/[^a-z0-9]/g,""))}return K})},Xe=async T=>{if(T.preventDefault(),!r||!A)return;const $=A.meta,W=A.classItem.id,K=I.firstName.trim(),ae=I.lastName.trim(),ge=I.username.trim(),we=I.password||Bt();if(!K||!ae){u({tone:"error",message:"First name and surname are required."});return}if(!ge){u({tone:"error",message:"Username is required."});return}try{u({tone:"info",message:"Adding studentâ€¦"});const me=await ta(r,{classId:W,firstName:K,lastName:ae,username:ge,password:we,yearGroup:$.yearGroupLabel,programme:$.programme});E(pe=>es(pe,[{id:me.id,username:me.username,password:we}])),D(pe=>({...pe,[me.id]:!0})),v(null),await U(),u({tone:"success",message:`${K} ${ae} added to ${A.classItem.className}.`})}catch(me){u({tone:"error",message:me.message||"Unable to add student."})}},Ye=async T=>{if(T.preventDefault(),!r||!A||!N){p({tone:"error",message:"Attach a CSV file to import."});return}try{p({tone:"info",message:"Parsing CSVâ€¦"});const $=typeof N=="string"?N:await N.text(),W=Pa($);if(W.length===0)throw new Error("The CSV file did not contain any students.");const K=A.meta,ae=W.map(pe=>{const _e=pe.firstName.trim(),Ne=pe.lastName.trim(),We=pe.username.trim()||`${_e[0]??""}${Ne}`.toLowerCase(),Ot=Bt();return{firstName:_e,lastName:Ne,username:We,password:Ot,passwordPlain:Ot,programme:K.programme,yearGroup:K.yearGroupLabel}});p({tone:"info",message:"Uploading studentsâ€¦"});const ge=ae.map(pe=>{const _e={...pe};return delete _e.passwordPlain,_e}),we=await sa(r,{classId:A.classItem.id,students:ge}),me=we.map((pe,_e)=>{var Ne;return{id:pe.id,username:pe.username,password:((Ne=ae[_e])==null?void 0:Ne.passwordPlain)??""}}).filter(pe=>pe.password);me.length>0&&E(pe=>es(pe,me)),D(pe=>({...pe,...Object.fromEntries(we.map(_e=>[_e.id,!0]))})),p({tone:"success",message:`${we.length} students imported.`}),m(null),v(null),await U()}catch($){p({tone:"error",message:$.message||"Unable to import CSV."})}},ot=T=>{D($=>({...$,[T]:!$[T]}))},se=async T=>{if(!(!r||!T||!window.confirm("Archive this student? They can be restored later by an administrator.")))try{await na(r,{studentId:T}),u({tone:"success",message:"Student archived."}),await U()}catch(W){u({tone:"error",message:W.message||"Unable to archive student."})}},X=h.useCallback(async()=>{if(!P||L.length===0){u({tone:"error",message:"Select a class with students first."});return}const T=[],$=[];for(const me of L){const pe=Hn(_,me),_e=me.username??"â€”",Ne=`${me.firstName??""} ${me.lastName??""}`.trim(),We=me.displayName??(Ne||_e||"Student");pe&&!pe.startsWith("$2")?T.push({id:me.id,name:We,username:_e,password:pe}):$.push({id:me.id,name:We,username:_e})}let W=[...T],K=0;if($.length>0){if(!r){u({tone:"error",message:"Session expired. Sign in again to generate new passwords."});return}if(!window.confirm(`No stored passwords for ${$.length} student${$.length===1?"":"s"}. Generate new passwords now?`)){u({tone:"error",message:"Password copy cancelled."});return}u({tone:"info",message:"Generating fresh passwordsâ€¦"});try{const pe=await ia(r,P.id,{studentIds:$.map(Ne=>Ne.id)}),_e=((pe==null?void 0:pe.credentials)??[]).filter(Ne=>Ne==null?void 0:Ne.password).map(Ne=>{const We=`${Ne.firstName??""} ${Ne.lastName??""}`.trim(),Ot=Ne.username??"â€”",Ei=Ne.displayName??(We||Ot||"Student");return{id:Ne.id,name:Ei,username:Ot,password:Ne.password}});if(_e.length===0){u({tone:"error",message:"Unable to generate passwords for the selected students."});return}K=_e.length,W=[...W,..._e],E(Ne=>es(Ne,_e.map(We=>({id:We.id,username:We.username,password:We.password})))),D(Ne=>({...Ne,...Object.fromEntries(_e.map(We=>[We.id,!0]))}))}catch(pe){console.warn("Credential regeneration failed",pe),u({tone:"error",message:(pe==null?void 0:pe.message)||"Unable to generate new passwords."});return}}if(W.length===0){u({tone:"error",message:"No stored passwords available for this class."});return}W.sort((me,pe)=>me.name.localeCompare(pe.name));const ae="Name	Username	Password",ge=W.map(me=>`${me.name}	${me.username||"â€”"}	${me.password}`),we=[ae,...ge].join(`
`);try{await navigator.clipboard.writeText(we),u({tone:"success",message:K>0?`Credentials copied. ${K} password${K===1?"":"s"} refreshed.`:"Credentials copied to clipboard."})}catch(me){console.warn("Clipboard copy failed",me),u({tone:"error",message:"Unable to copy credentials. Try again."})}},[_,P,L,r,E]),oe=h.useCallback(T=>{T&&n(`/dashboard/student/${encodeURIComponent(T)}`)},[n]);return!s||!i?null:e.jsxs(ut,{variant:"fullWidth",className:"teacher-dashboard",children:[e.jsxs("section",{className:"teacher-dashboard__hero",children:[e.jsxs("div",{className:"teacher-dashboard__hero-left",children:[e.jsx("span",{className:"teacher-dashboard__eyebrow",children:"Teacher dashboard"}),e.jsxs("h1",{children:["Good day, ",q]}),e.jsx("p",{className:"muted",children:"Manage classes, enrol students, and monitor lesson unlocks. Everything updates in real time as your classes progress through the IB Computer Science curriculum."}),e.jsxs("div",{className:"teacher-dashboard__hero-actions",children:[e.jsx("button",{type:"button",className:"pill pill--action",onClick:at,children:"Add class"}),e.jsx("button",{type:"button",className:"pill",onClick:()=>P?Ve(P,"single"):z[0]&&Ve(z[0],"single"),disabled:z.length===0,children:"Add student"})]})]}),e.jsx(Un,{variant:"autoFit",minColumnWidth:200,className:"teacher-dashboard__summary-grid",children:ue.map(T=>e.jsx(Mt,{label:T.label,value:T.value,tone:"brand",compact:!0},T.label))})]}),c&&e.jsx(Yt,{tone:c.tone,children:c.message}),e.jsxs("section",{className:"teacher-dashboard__workspace",children:[e.jsxs("aside",{className:"teacher-dashboard__class-panel",children:[e.jsxs("header",{children:[e.jsx("h2",{children:"Your classes"}),e.jsx("p",{className:"muted",children:"Select a class to review students, pacing, and quick actions."})]}),e.jsxs("div",{className:"teacher-dashboard__class-list",children:[z.length===0&&!l&&e.jsx("p",{className:"muted",children:"Create your first class to get started."}),z.map(T=>{const $=ne.get(T.id)??[],W=As(T),K=b===T.id;return e.jsxs("button",{type:"button",className:`teacher-dashboard__class-button ${K?"is-active":""}`,onClick:()=>g(T.id),children:[e.jsxs("div",{children:[e.jsx("strong",{children:T.className}),e.jsx("span",{children:W.yearGroupLabel})]}),e.jsxs("div",{className:"teacher-dashboard__class-meta-chip",children:[e.jsxs("span",{children:[$.length," students"]}),e.jsx("span",{children:W.cohort})]})]},T.id)})]})]}),e.jsx("div",{className:"teacher-dashboard__class-detail",children:P?e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"teacher-dashboard__class-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"teacher-dashboard__eyebrow",children:"Selected class"}),e.jsx("h2",{children:P.className}),Q&&e.jsx("p",{className:"muted",children:Q.yearGroupLabel})]}),e.jsxs("div",{className:"teacher-dashboard__class-actions",children:[e.jsx("button",{type:"button",className:"pill",onClick:()=>n("/curriculum/ib",{state:{classId:P.id}}),children:"View IB Curriculum"}),e.jsx("button",{type:"button",className:"pill",onClick:()=>Ve(P,"single"),children:"Add student"}),e.jsx("button",{type:"button",className:"pill",onClick:()=>Ve(P,"bulk"),children:"Import CSV"}),e.jsx("button",{type:"button",className:"pill",onClick:X,children:"Copy credentials"})]})]}),ee.length>0&&e.jsx(Un,{variant:"autoFit",minColumnWidth:200,className:"teacher-dashboard__class-summary",children:ee.map((T,$)=>e.jsx(Mt,{label:T.label,value:T.value,compact:!0,tone:$===0?"brand":void 0,progress:T.progress,progressLabel:T.progressLabel},T.key))}),V&&e.jsx(Mt,{label:"Teacher-paced pointer",value:ie?ie.title:"Pointer not set",description:ie?ie.unitTitle:"Set the pointer to guide the Year 7 teaching sequence.",meta:J!=null&&J.updatedAt?`Updated ${new Date(J.updatedAt).toLocaleString()}`:null,tone:"brand",actions:e.jsxs("div",{className:"teacher-dashboard__pacing-actions",children:[e.jsx("button",{type:"button",className:"pill",onClick:()=>Y(P.id),children:"Open Year 7 map"}),e.jsx("button",{type:"button",className:"pill pill--action",onClick:()=>M(P.id),disabled:!!(te!=null&&te.busy),children:J?"Restart at lesson 1":"Start teaching"}),e.jsx("button",{type:"button",className:"pill",onClick:()=>B(P.id),disabled:!!(te!=null&&te.busy)||!J,children:"Advance lesson"}),e.jsx("button",{type:"button",className:"pill",onClick:()=>H(P.id),disabled:!!(te!=null&&te.busy)||!J,children:"Stop teaching"})]}),children:(te==null?void 0:te.message)&&e.jsx("p",{className:`teacher-dashboard__pacing-status teacher-dashboard__pacing-status--${te.tone??"info"}`,children:te.message})}),e.jsx("div",{className:"teacher-dashboard__table-wrapper",children:e.jsxs("table",{className:"teacher-dashboard__table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Student"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Password"}),e.jsx("th",{children:"Track"}),e.jsx("th",{children:"Stage"}),e.jsx("th",{"aria-label":"Actions"})]})}),e.jsxs("tbody",{children:[L.map(T=>{const $=Hn(_,T)??T.password??"",K=typeof $=="string"&&$.startsWith("$2")?"":$,ae=F[T.id];return e.jsxs("tr",{onClick:()=>oe(T.id),className:"teacher-dashboard__student-row",children:[e.jsxs("td",{children:[e.jsx("span",{className:"teacher-student-name",children:T.displayName}),e.jsxs("span",{className:"teacher-student-sub",children:["Joined ",new Date(T.createdAt).toLocaleDateString()]})]}),e.jsx("td",{children:T.username||"â€”"}),e.jsx("td",{children:K?e.jsx("button",{type:"button",className:"teacher-password",onClick:ge=>{ge.stopPropagation(),ot(T.id)},children:ae?K:"â€¢â€¢â€¢â€¢â€¢â€¢"}):e.jsx("span",{className:"muted",children:"Not available"})}),e.jsx("td",{children:T.curriculumTrack?T.curriculumTrack.toUpperCase():"â€”"}),e.jsx("td",{children:T.activeStage?T.activeStage.toUpperCase():"â€”"}),e.jsx("td",{className:"teacher-dashboard__table-actions",children:e.jsx("button",{type:"button",className:"button-outline button-outline--danger",onClick:ge=>{ge.stopPropagation(),se(T.id)},children:"Archive"})})]},T.id)}),L.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"muted",children:"No students yet. Use â€œAdd studentâ€ to enrol the first learner."})})]})]})})]}):e.jsxs("div",{className:"teacher-dashboard__empty-detail",children:[e.jsx("h2",{children:"Select a class to view its roster"}),e.jsx("p",{className:"muted",children:"Once you choose a class, you can copy credentials, manage pacing, and monitor progress."})]})})]}),e.jsxs("section",{className:"teacher-dashboard__insights",children:[e.jsxs("article",{className:"teacher-dashboard__card",children:[e.jsx("h3",{children:"Lesson progress snapshot"}),e.jsxs("div",{className:"teacher-dashboard__metrics",children:[e.jsxs("div",{children:[e.jsx("span",{children:he}),e.jsx("small",{children:"Summative complete"})]}),e.jsxs("div",{children:[e.jsx("span",{children:fe}),e.jsx("small",{children:"Formative complete"})]}),e.jsxs("div",{children:[e.jsx("span",{children:le}),e.jsx("small",{children:"Available lessons"})]}),e.jsxs("div",{children:[e.jsx("span",{children:ce}),e.jsx("small",{children:"Locked lessons"})]})]})]}),e.jsxs("article",{className:"teacher-dashboard__card",children:[e.jsx("h3",{children:"Learners needing a nudge"}),e.jsx("p",{className:"muted",children:"Students with unlocked lessons but no formative completions yet."}),e.jsxs("ul",{className:"teacher-dashboard__list",children:[Ee.length===0&&e.jsx("li",{className:"muted",children:"All caught up â€” no students flagged."}),Ee.map(T=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:T.displayName}),e.jsxs("span",{className:"muted",children:[T.available," unlocked Â· 0 cleared checkpoints"]})]}),e.jsx("span",{className:"teacher-dashboard__tag",children:"Follow up"})]},T.id))]})]}),e.jsxs("article",{className:"teacher-dashboard__card",children:[e.jsx("h3",{children:"Recent lesson updates"}),e.jsx("p",{className:"muted",children:"Latest activity across your classes (most recent first)."}),e.jsxs("ul",{className:"teacher-dashboard__list teacher-dashboard__list--compact",children:[Ue.length===0&&e.jsx("li",{className:"muted",children:"No lesson activity recorded yet."}),Ue.map(T=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:T.lesson}),e.jsx("span",{className:"muted",children:T.studentName})]}),e.jsxs("div",{className:"teacher-dashboard__list-meta",children:[e.jsx("span",{className:`teacher-dashboard__tag teacher-dashboard__tag--${(T.status||"locked").toLowerCase()}`,children:T.status??"locked"}),e.jsx("span",{className:"muted",children:T.updatedAt?new Date(T.updatedAt).toLocaleString():"recently"})]})]},T.id))]})]})]}),S&&e.jsx(Js,{isOpen:S,onClose:()=>x(!1),title:"Create class",size:"md",children:e.jsxs("form",{onSubmit:ft,className:"teacher-modal__content",children:[e.jsxs("label",{children:[e.jsx("span",{children:"Stage"}),e.jsx("select",{value:k.stageId,onChange:T=>it("stageId",T.target.value),required:!0,children:Ht.map(T=>e.jsx("option",{value:T.id,children:T.label},T.id))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Cohort (two digits)"}),e.jsx("input",{value:k.cohort,onChange:T=>it("cohort",T.target.value),placeholder:"32",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Group"}),e.jsx("select",{value:k.group,onChange:T=>it("group",T.target.value),required:!0,children:yt(k.stageId).groups.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Description (optional)"}),e.jsx("input",{value:k.description,onChange:T=>R($=>({...$,description:T.target.value})),placeholder:"Notes for this class"})]}),e.jsxs("div",{className:"teacher-modal__preview",children:[e.jsx("span",{children:"Generated code"}),e.jsx("strong",{children:vt(k.stageId,k.cohort,k.group)})]}),e.jsxs("footer",{children:[e.jsx("button",{type:"button",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"pill pill--action",children:"Create class"})]})]})}),A&&e.jsx(Js,{isOpen:!!A,onClose:()=>v(null),title:A.mode==="bulk"?`Import students Â· ${A.classItem.className}`:`Add student Â· ${A.classItem.className}`,size:"md",children:A.mode==="single"?e.jsxs("form",{onSubmit:Xe,className:"teacher-modal__content",children:[e.jsxs("label",{children:[e.jsx("span",{children:"First name"}),e.jsx("input",{value:I.firstName,onChange:T=>$e("firstName",T.target.value),required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Surname"}),e.jsx("input",{value:I.lastName,onChange:T=>$e("lastName",T.target.value),required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Username"}),e.jsx("input",{value:I.username,onChange:T=>$e("username",T.target.value),placeholder:"Enter unique username",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Generated password"}),e.jsx("input",{value:I.password,onChange:T=>$e("password",T.target.value),required:!0}),e.jsx("button",{type:"button",className:"teacher-modal__ghost",onClick:()=>w(T=>({...T,password:Bt()})),children:"Regenerate"})]}),e.jsxs("footer",{children:[e.jsx("button",{type:"button",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{type:"submit",className:"pill pill--action",children:"Add student"})]})]}):e.jsxs("form",{onSubmit:Ye,className:"teacher-modal__content",children:[e.jsxs("p",{className:"muted",children:["Upload a CSV with the columns ",e.jsx("code",{children:"firstName"}),", ",e.jsx("code",{children:"lastName"}),", and optional",e.jsx("code",{children:"username"}),". Passwords are auto-generated for each row."]}),e.jsx("button",{type:"button",className:"teacher-modal__ghost",onClick:Ea,children:"Download blank template"}),e.jsxs("label",{children:[e.jsx("span",{children:"CSV file"}),e.jsx("input",{type:"file",accept:".csv,text/csv",onChange:T=>{var $;return m((($=T.target.files)==null?void 0:$[0])??null)},required:!0})]}),f&&e.jsx("p",{className:`status status--${f.tone}`,children:f.message}),e.jsxs("footer",{children:[e.jsx("button",{type:"button",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{type:"submit",className:"pill pill--action",children:"Import students"})]})]})})]})}const Oa="/ibcs-app/assets/curriculumManifest-BqigQj0v.json",Ra=[{id:"A1",title:"Computer fundamentals",availableFor:["ks3","igcse","ib-sl","ib-hl"],subtopics:[{id:"A1.1",title:"Computer hardware and operation",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"A1.1.1",title:"Functions and interactions of the main CPU components"},{id:"A1.1.2",title:"Role of a GPU"},{id:"A1.1.3",title:"Differences between the CPU and GPU",hlOnly:!0},{id:"A1.1.4",title:"Purposes of different types of primary memory"},{id:"A1.1.5",title:"Fetch, decode, and execute cycle"},{id:"A1.1.6",title:"Process of pipelining in multi-core architectures",hlOnly:!0},{id:"A1.1.7",title:"Internal and external types of secondary memory storage"},{id:"A1.1.8",title:"Concept of compression"},{id:"A1.1.9",title:"Different types of services in cloud computing"}]},{id:"A1.2",title:"Data representation and computer logic",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"A1.2.1",title:"Principal methods of representing data"},{id:"A1.2.2",title:"How binary is used to store data"},{id:"A1.2.3",title:"Purpose and use of logic gates"},{id:"A1.2.4",title:"Construct and analyse truth tables"},{id:"A1.2.5",title:"Construct logic diagrams"}]},{id:"A1.3",title:"Operating systems and control systems",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A1.3.1",title:"Role of operating systems"},{id:"A1.3.2",title:"Functions of an operating system"},{id:"A1.3.3",title:"Compare scheduling approaches"},{id:"A1.3.4",title:"Polling and interrupt handling"},{id:"A1.3.5",title:"Multitasking and resource allocation",hlOnly:!0},{id:"A1.3.6",title:"Control system components",hlOnly:!0},{id:"A1.3.7",title:"Control systems in real-world applications",hlOnly:!0}]},{id:"A1.4",title:"Translation",availableFor:["ib-sl","ib-hl"],lessons:[{id:"A1.4.1",title:"Translation processes of interpreters and compilers"}]}]},{id:"A2",title:"Networks",availableFor:["ks3","igcse","ib-sl","ib-hl"],subtopics:[{id:"A2.1",title:"Network fundamentals",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"A2.1.1",title:"Purpose and characteristics of networks"},{id:"A2.1.2",title:"Modern digital infrastructures"},{id:"A2.1.3",title:"Network devices"},{id:"A2.1.4",title:"Transport and application layer protocols"},{id:"A2.1.5",title:"TCP/IP model",hlOnly:!0}]},{id:"A2.2",title:"Network architecture",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A2.2.1",title:"Functions and applications of network topologies"},{id:"A2.2.2",title:"Function of servers",hlOnly:!0},{id:"A2.2.3",title:"Client-server vs peer-to-peer"},{id:"A2.2.4",title:"Network segmentation"}]},{id:"A2.3",title:"Data transmissions",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A2.3.1",title:"Types of IP addressing"},{id:"A2.3.2",title:"Transmission media"},{id:"A2.3.3",title:"Packet switching"},{id:"A2.3.4",title:"Static vs dynamic routing",hlOnly:!0}]},{id:"A2.4",title:"Network security",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A2.4.1",title:"Effectiveness of firewalls"},{id:"A2.4.2",title:"Common network vulnerabilities",hlOnly:!0},{id:"A2.4.3",title:"Network countermeasures",hlOnly:!0},{id:"A2.4.4",title:"Encryption and digital certificates"}]}]},{id:"A3",title:"Databases",availableFor:["igcse","ib-sl","ib-hl"],subtopics:[{id:"A3.1",title:"Database fundamentals",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A3.1.1",title:"Features, benefits, and limitations of relational databases"}]},{id:"A3.2",title:"Database design",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"A3.2.1",title:"Database schemas"},{id:"A3.2.2",title:"Entity relationship diagrams"},{id:"A3.2.3",title:"Data types in relational databases"},{id:"A3.2.4",title:"Constructing tables"},{id:"A3.2.5",title:"Normal forms"},{id:"A3.2.6",title:"Normalise databases to 3NF"},{id:"A3.2.7",title:"Evaluate denormalisation"}]},{id:"A3.3",title:"Database programming",availableFor:["ib-sl","ib-hl"],lessons:[{id:"A3.3.1",title:"SQL language types"},{id:"A3.3.2",title:"SQL joins and queries"},{id:"A3.3.3",title:"SQL updates"},{id:"A3.3.4",title:"Aggregate functions",hlOnly:!0},{id:"A3.3.5",title:"Database views",hlOnly:!0},{id:"A3.3.6",title:"Transactions and ACID",hlOnly:!0}]},{id:"A3.4",title:"Alternative databases and data warehouses",availableFor:["ib-hl"],lessons:[{id:"A3.4.1",title:"Alternative database models"},{id:"A3.4.2",title:"Objectives of data warehouses"},{id:"A3.4.3",title:"OLAP and data mining"},{id:"A3.4.4",title:"Features of distributed databases"}]}]},{id:"A4",title:"Machine learning",availableFor:["ib-sl","ib-hl"],subtopics:[{id:"A4.1",title:"Machine learning fundamentals",availableFor:["ib-sl","ib-hl"],lessons:[{id:"A4.1.1",title:"Types of machine learning"},{id:"A4.1.2",title:"Hardware requirements"}]},{id:"A4.2",title:"Data preprocessing",availableFor:["ib-hl"],lessons:[{id:"A4.2.1",title:"Data cleaning"},{id:"A4.2.2",title:"Feature selection"},{id:"A4.2.3",title:"Dimensionality reduction"}]},{id:"A4.3",title:"Machine learning approaches",availableFor:["ib-hl"],lessons:[{id:"A4.3.1",title:"Linear regression"},{id:"A4.3.2",title:"Classification techniques"},{id:"A4.3.3",title:"Hyperparameter tuning"},{id:"A4.3.4",title:"Clustering techniques"},{id:"A4.3.5",title:"Association rule learning"},{id:"A4.3.6",title:"Reinforcement learning"},{id:"A4.3.7",title:"Genetic algorithms"},{id:"A4.3.8",title:"Artificial neural networks"},{id:"A4.3.9",title:"Convolutional neural networks"},{id:"A4.3.10",title:"Model selection and comparison"}]},{id:"A4.4",title:"Ethical considerations",availableFor:["ib-sl","ib-hl"],lessons:[{id:"A4.4.1",title:"Ethical implications of machine learning"},{id:"A4.4.2",title:"Ethics of pervasive technologies"}]}]},{id:"B1",title:"Computational thinking",availableFor:["ks3","igcse","ib-sl","ib-hl"],subtopics:[{id:"B1.1",title:"Approaches to computational thinking",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"B1.1.1",title:"Construct a problem specification"},{id:"B1.1.2",title:"Fundamental concepts of computational thinking"},{id:"B1.1.3",title:"Applying computational thinking"},{id:"B1.1.4",title:"Trace flowcharts"}]}]},{id:"B2",title:"Programming",availableFor:["ks3","igcse","ib-sl","ib-hl"],subtopics:[{id:"B2.1",title:"Programming fundamentals",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"B2.1.1",title:"Variables and data types"},{id:"B2.1.2",title:"Substring manipulation"},{id:"B2.1.3",title:"Exception handling"},{id:"B2.1.4",title:"Debugging techniques"}]},{id:"B2.2",title:"Data structures",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"B2.2.1",title:"Static vs dynamic data structures"},{id:"B2.2.2",title:"Arrays and lists"},{id:"B2.2.3",title:"Stacks"},{id:"B2.2.4",title:"Queues"}]},{id:"B2.3",title:"Programming constructs",availableFor:["ks3","igcse","ib-sl","ib-hl"],lessons:[{id:"B2.3.1",title:"Sequence"},{id:"B2.3.2",title:"Selection"},{id:"B2.3.3",title:"Iteration"},{id:"B2.3.4",title:"Functions and modularisation"}]},{id:"B2.4",title:"Programming algorithms",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"B2.4.1",title:"Algorithm efficiency"},{id:"B2.4.2",title:"Linear and binary search"},{id:"B2.4.3",title:"Bubble and selection sort"},{id:"B2.4.4",title:"Recursion fundamentals",hlOnly:!0},{id:"B2.4.5",title:"Implement recursive algorithms",hlOnly:!0}]},{id:"B2.5",title:"File processing",availableFor:["igcse","ib-sl","ib-hl"],lessons:[{id:"B2.5.1",title:"File processing operations"}]}]},{id:"B3",title:"Object-oriented programming",availableFor:["ib-sl","ib-hl"],subtopics:[{id:"B3.1",title:"Fundamentals of OOP for a single class",availableFor:["ib-sl","ib-hl"],lessons:[{id:"B3.1.1",title:"Evaluate OOP fundamentals"},{id:"B3.1.2",title:"Design classes, methods, behaviour"},{id:"B3.1.3",title:"Static vs non-static members"},{id:"B3.1.4",title:"Define classes and instantiate objects"},{id:"B3.1.5",title:"Encapsulation and information hiding"}]},{id:"B3.2",title:"Fundamentals of OOP for multiple classes",availableFor:["ib-hl"],lessons:[{id:"B3.2.1",title:"Inheritance"},{id:"B3.2.2",title:"Polymorphism"},{id:"B3.2.3",title:"Abstraction"},{id:"B3.2.4",title:"Composition and aggregation"},{id:"B3.2.5",title:"Design patterns"}]}]},{id:"B4",title:"Abstract data types",availableFor:["ib-hl"],subtopics:[{id:"B4.1",title:"Fundamentals of ADTs",availableFor:["ib-hl"],lessons:[{id:"B4.1.1",title:"Properties and purpose of ADTs"},{id:"B4.1.2",title:"Linked lists"},{id:"B4.1.3",title:"Construct linked lists"},{id:"B4.1.4",title:"Binary search trees"},{id:"B4.1.5",title:"Sets as an ADT"},{id:"B4.1.6",title:"Core principles of ADTs"}]}]}],Ba={ks3:{label:"Key Stage 3",defaultLessons:["A1.1.1","A2.1.1","B1.1.1","B2.1.1"]},igcse:{label:"IGCSE",defaultLessons:["A1.1.1","A2.1.1","A3.1.1","B1.1.1","B2.1.1"]},"ib-sl":{label:"IB Computer Science SL",defaultLessons:["A1.1.1","A2.1.1","A3.1.1","A4.1.1","B1.1.1","B2.1.1","B3.1.1"]},"ib-hl":{label:"IB Computer Science HL",defaultLessons:["A1.1.1","A2.1.1","A3.1.1","A4.1.1","B1.1.1","B2.1.1","B3.1.1","B4.1.1"]}},Vr={units:Ra,tracks:Ba};let gt=null,Ut=null;function Yr(t){return JSON.parse(JSON.stringify(t))}async function Da(){return gt||(Ut||(Ut=fetch(Oa,{cache:"no-cache"}).then(t=>{if(!t.ok)throw new Error("Failed to load curriculum manifest");return t.json()}).then(t=>(gt=t,t)).catch(t=>(console.warn("Falling back to bundled curriculum manifest:",t),gt=Yr(Vr),gt)).finally(()=>{Ut=null})),Ut)}function Zt(){const[t,s]=h.useState(()=>({status:gt?"ready":"loading",manifest:gt,error:null}));return h.useEffect(()=>{let n=!1;return Da().then(r=>{n||s({status:"ready",manifest:r,error:null})}).catch(r=>{n||s({status:"ready",manifest:Yr(Vr),error:r})}),()=>{n=!0}},[]),t}function Fa(){gt=null,Ut=null}function wn(t,s){var r;return((r=((t==null?void 0:t.tracks)??{})[s])==null?void 0:r.label)??s??"Unknown"}const $t="ibcs.gamification",Ua=2e3;function zr(t){return t&&String(t).toLowerCase().replace(/[^a-z0-9.-]/g,"-")||"anonymous"}function Ts(t){const s=zr(t);return`${$t}.${s}`}function ts(t){if(typeof window>"u")return null;try{const s=window.localStorage.getItem(t);if(!s)return null;const n=JSON.parse(s);if(n&&typeof n=="object")return n}catch(s){console.warn("Failed to read gamification state",t,s)}return null}const Zs={xp:0,level:1,streak:0,spritesUnlocked:[],totalCorrect:0,totalAttempts:0,lastUpdated:null},Jr=h.createContext({state:Zs,awardXp:()=>{},resetStreak:()=>{},updateFromRemote:()=>{}});function qn(t){return Number.isFinite(t)?Math.max(1,Math.floor(t/150)+1):1}function Ms(t,s){switch(s.type){case"hydrate":{const n={...t,...s.payload||{}};return{...n,level:qn(n.xp??0)}}case"award":{const{xpGained:n,correct:r,attempts:i,spriteUnlocks:a=[]}=s.payload,o=(t.totalCorrect??0)+(r??0),l=(t.totalAttempts??0)+(i??0),d=(t.xp??0)+n,c=qn(d),u=n>0&&r===i?(t.streak??0)+1:0,b=Array.from(new Set([...t.spritesUnlocked??[],...a.filter(Boolean)]));return{xp:d,level:c,streak:u,spritesUnlocked:b,totalCorrect:o,totalAttempts:l,lastUpdated:Date.now()}}case"reset-streak":return{...t,streak:0,lastUpdated:Date.now()};default:return t}}function _n({children:t,initialState:s,profileKey:n="anonymous",syncToken:r=null,isStudent:i=!1}){const a=zr(n),o=h.useRef(null),[l,d]=h.useReducer(Ms,Zs,x=>{if(s)return Ms(x,{type:"hydrate",payload:s});const A=ts(Ts(a))??ts($t);return A?Ms(x,{type:"hydrate",payload:A}):x}),c=h.useRef(a);h.useEffect(()=>{if(c.current===a)return;const x=ts(Ts(a))??ts($t);d(x?{type:"hydrate",payload:x}:{type:"hydrate",payload:Zs}),c.current=a},[a]),h.useEffect(()=>{if(!(!i||!r||n==="anonymous"||n==="guest"))return o.current&&clearTimeout(o.current),o.current=setTimeout(async()=>{try{await oa(r,{xp:l.xp??0,level:l.level??1,streak:l.streak??0,totalCorrect:l.totalCorrect??0,totalAttempts:l.totalAttempts??0})}catch(x){console.warn("Failed to sync gamification to backend",x)}},Ua),()=>{o.current&&clearTimeout(o.current)}},[l.xp,l.level,l.streak,l.totalCorrect,l.totalAttempts,r,i,n]),h.useEffect(()=>{const x=Ts(a);if(c.current=a,typeof window<"u")try{window.localStorage.setItem(x,JSON.stringify(l)),x!==$t&&window.localStorage.removeItem($t)}catch(A){console.warn("Failed to persist gamification state",A)}},[l,a]);const u=h.useCallback(x=>{d({type:"award",payload:x})},[]),b=h.useCallback(()=>{d({type:"reset-streak"})},[]),g=h.useCallback(x=>{d({type:"hydrate",payload:x})},[]),S=h.useMemo(()=>({state:l,awardXp:u,resetStreak:b,updateFromRemote:g}),[l,u,b,g]);return e.jsx(Jr.Provider,{value:S,children:t})}function xs(){return h.useContext(Jr)}const Zr=".progress";function Qs(t,s){return t&&String(t).toLowerCase().replace(/[^a-z0-9.-]/g,"-")||s}function Qr(t,s){const n=Qs(t,"unit"),r=Qs(s,"guest");return`ibcs.${n}.${r}${Zr}`}function $a(t){return`ibcs.${Qs(t,"unit")}${Zr}`}function Kr(t,s){if(typeof window>"u")return{data:null,key:null,migrated:!1};const n=Qr(t,s);try{const i=window.localStorage.getItem(n);if(i)return{data:JSON.parse(i),key:n,migrated:!0}}catch(i){console.warn("Unable to parse scoped progress",n,i)}const r=$a(t);try{const i=window.localStorage.getItem(r);if(i)return{data:JSON.parse(i),key:r,migrated:!1}}catch(i){console.warn("Unable to parse legacy progress",r,i)}return{data:null,key:n,migrated:!0}}function Ks(t,s,n){if(typeof window>"u")return;const r=Qr(t,s);try{window.localStorage.setItem(r,JSON.stringify(n))}catch(i){console.warn("Unable to persist progress",r,i)}}function Wa({term:t,definition:s,icon:n="â—"}){return e.jsxs("div",{className:"keyword-card",children:[e.jsxs("div",{className:"keyword-card__header",children:[e.jsx("span",{className:"keyword-card__icon",children:n}),e.jsx("h4",{className:"keyword-card__term",children:t})]}),e.jsx("p",{className:"keyword-card__definition",children:s})]})}function tt({type:t="info",title:s,children:n,icon:r}){const i={info:"â„¹ï¸",tip:"ðŸ’¡",warning:"âš ï¸",success:"âœ“",error:"âš ï¸"};return e.jsxs("div",{className:`callout callout--${t}`,children:[e.jsxs("div",{className:"callout__header",children:[e.jsx("span",{className:"callout__icon",children:r||i[t]}),s&&e.jsx("strong",{className:"callout__title",children:s})]}),e.jsx("div",{className:"callout__body",children:n})]})}function Vn({columns:t,rows:s,caption:n}){return e.jsxs("div",{className:"enhanced-table-wrapper",children:[n&&e.jsx("div",{className:"enhanced-table__caption",children:n}),e.jsx("div",{className:"enhanced-table__scroll",children:e.jsxs("table",{className:"enhanced-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.map((r,i)=>e.jsx("th",{children:r},i))})}),e.jsx("tbody",{children:s.map((r,i)=>e.jsx("tr",{children:r.map((a,o)=>e.jsx("td",{children:a},o))},i))})]})})]})}const Yn=[{term:"Computational Thinking",definition:"A problem-solving approach that involves abstraction, decomposition, pattern recognition, and algorithmic design to create solutions that can be executed by a computer.",icon:"ðŸ§ "},{term:"Problem Specification",definition:"A detailed document outlining a problem, including the problem statement, constraints, objectives, goals, input/output requirements, and evaluation criteria.",icon:"ðŸ“"},{term:"Abstraction",definition:"The process of filtering out unnecessary details to focus on the essential elements of a problem or system.",icon:"ðŸŒ¬ï¸"},{term:"Decomposition",definition:"Breaking down a complex problem into smaller, more manageable sub-problems that are easier to solve.",icon:"ðŸ§©"},{term:"Pattern Recognition",definition:"Identifying recurring similarities, trends, or regularities within problems or data. Recognizing patterns allows you to reuse solutions and make predictions.",icon:"ðŸŽ¨"},{term:"Algorithmic Design",definition:"Creating a clear, step-by-step set of instructions to solve a problem. The algorithm is the roadmap that a computer (or a person) follows to reach the solution.",icon:"âš™ï¸"},{term:"Flowchart",definition:"A diagram that visually represents a process, workflow, or algorithm using standardized symbols (ISO 5807).",icon:"ðŸ“Š"},{term:"Constraint",definition:"A restriction or boundary that impacts the solution, such as time, budget, technology, or regulations.",icon:"ðŸ”’"},{term:"Stakeholder",definition:"An individual or group affected by or having an interest in a project or its outcome.",icon:"ðŸ‘¥"}],zn=e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"This unit will equip you with a powerful mental toolkit for solving problems like a computer scientist. You will learn to break down complex challenges, identify patterns, focus on what truly matters, and design clear, logical solutions."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Construct"})," a formal problem specification to guide a project."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Describe and apply"})," the four cornerstones of computational thinking."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Explain"})," how these concepts are used across different areas of computer science."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Trace and interpret"})," flowcharts that represent algorithms."]})]})]}),_t={id:"B1",title:"Computational Thinking",hours:{sl:"SL Â· 5 hours",hl:"HL Â· 5 hours"},guidingQuestion:"How can we apply a computational solution to a real-world problem?",overview:{aim:zn,vocabulary:Yn},stages:[{id:"B1-orientation",title:"Unit Orientation",duration:"15 min",description:"Get familiar with the unit&apos;s guiding question, learning objectives, and key vocabulary.",segments:[{type:"content",id:"orientation-aim",heading:"Unit Aims and Objectives",body:zn},{type:"content",id:"orientation-vocab",heading:"Key Vocabulary",body:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Yn.map(t=>e.jsx(Wa,{term:t.term,definition:t.definition,icon:t.icon},t.term))})}]},{id:"B1.1.1",title:"Constructing a Problem Specification",duration:"60 min",description:"Learn to define problems with clarity and precision by constructing a formal problem specification.",segments:[{type:"content",id:"spec-intro",heading:"The Blueprint for Success",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Before writing a single line of code, a computer scientist must deeply understand the problem. A Problem Specification is the formal document that ensures everyone involvedâ€”clients, developers, and usersâ€”shares the same understanding. It acts as a blueprint and a contract, defining what success looks like."}),e.jsx(tt,{type:"info",title:"Core Components",children:"A thorough problem specification consists of six key parts: the problem statement, constraints, objectives and goals, input specifications, output specifications, and evaluation criteria."})]})},{type:"accordion",id:"spec-components-deep-dive",heading:"Deep Dive into Specification Components",items:[{title:"1. The Problem Statement",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"This is a concise, clear definition of the problem. It focuses on the â€˜whatâ€™ and the â€˜whyâ€™."}),e.jsx(tt,{type:"error",title:"Poor Example",children:'â€œOur customer service processes are inefficient.â€ (This is too broad and vague. What does "inefficient" mean?)'}),e.jsx(tt,{type:"success",title:"Strong Example",children:"â€œCustomers wait an average of 25 minutes on hold before reaching a representative, leading to a 15% increase in abandoned calls over the past quarter.â€ (This is focused, measurable, and highlights the negative impact.)"})]})},{title:"2. Constraints and Limitations",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"These are restrictions or boundaries that impact the solution. They can be technical, financial, or even legal."}),e.jsx(tt,{type:"error",title:"Poor Example",children:"â€œWe don't have many resources.â€ (Vague. Does this refer to money, people, or time?)"}),e.jsx(tt,{type:"success",title:"Strong Example",children:"â€œThe project budget is limited to $10,000 and the solution must be deployed within three months.â€ (Specific, measurable, and provides clear boundaries.)"})]})},{title:"3. Objectives and Goals",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Objectives are the broad, high-level desired outcomes. Goals are the specific, measurable, time-constrained milestones to achieve those objectives."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Objective:"}),' "Increase customer satisfaction with service interactions."']}),e.jsx("p",{children:e.jsx("strong",{children:"Specific Goals:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achieve an average customer satisfaction rating of 4 out of 5 stars on post-service surveys over the next six months."}),e.jsx("li",{children:"Reduce the number of â€˜highly dissatisfiedâ€™ customer ratings by 30% within the next quarter."})]})]})},{title:"4. Input and Output Specifications",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"These define the format, type, and expected characteristics of any data entering or leaving the system. This ensures compatibility and proper processing."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Input Example (Chatbot):"})," Text-based input via a chat interface; voice-to-text input. Should handle diverse phrasing for the same intent."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Output Example (Chatbot):"})," Direct text responses; links to knowledge base articles; escalation to a live agent with a chat transcript."]})]})},{title:"5. Evaluation Criteria",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"These are the benchmarks used to measure the success of the solution. They should be directly linked to the objectives and goals."}),e.jsx("p",{children:"Consider factors like:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Effectiveness:"})," Does it solve the problem? (e.g., task completion rate of 90% for a chatbot)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Efficiency:"})," Does it save time or resources? (e.g., faster issue resolution time)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Usability:"})," Is it easy for people to use? (e.g., intuitive interface requiring minimal training)."]})]})]})}]},{type:"activity",id:"spec-classification",activityType:"classification",heading:"Classify the Specification Components",instructions:"Drag each example into the correct component category.",categories:[{id:"cat-problem",title:"Problem Statement"},{id:"cat-constraint",title:"Constraint"},{id:"cat-goal",title:"Specific Goal"},{id:"cat-eval",title:"Evaluation Criterion"}],tokens:[{id:"tok-1",label:"The new mobile app must be available on both iOS and Android.",answer:"cat-constraint"},{id:"tok-2",label:"Increase daily active users by 25% in the next quarter.",answer:"cat-goal"},{id:"tok-3",label:"Our current inventory system leads to a 5% error rate in stock levels, causing shipping delays.",answer:"cat-problem"},{id:"tok-4",label:"The system must process 99.9% of transactions accurately under peak load.",answer:"cat-eval"}]}]},{id:"B1.1.2",title:"Fundamental Concepts of CT",duration:"60 min",description:"Master the four core techniques of computational thinking: decomposition, pattern recognition, abstraction, and algorithmic design.",segments:[{type:"content",id:"ct-intro-main",heading:"The Four Pillars of Computational Thinking",body:e.jsx("p",{children:"Computational thinking provides a structured way to approach complex problems. By mastering these four concepts, you can develop robust and efficient solutions."})},{type:"accordion",id:"ct-concepts-deep-dive",heading:"Exploring the Concepts",items:[{title:"Decomposition ðŸ§©",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Breaking down a large, complex problem into smaller, more manageable sub-problems. This makes the problem easier to understand and solve."}),e.jsxs(tt,{type:"tip",title:"Example: Designing an NPC",children:['Instead of tackling "realistic AI behavior" all at once, you decompose it into:',e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Sensing:"})," How does it see or hear the player?"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Decision-making:"})," How does it choose an action (flee, attack)?"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pathfinding:"})," How does it navigate the world?"]})]})]})]})},{title:"Pattern Recognition ðŸŽ¨",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Identifying recurring similarities, trends, or regularities within problems or data. Recognizing patterns allows you to reuse solutions and make predictions."}),e.jsx(tt,{type:"tip",title:"Example: Handwritten Digits",children:"To recognize a handwritten â€˜8â€™, a machine learning model doesn't memorize every possible â€˜8â€™. It learns the underlying pattern: two connected loops. This allows it to recognize any â€˜8â€™, even ones it has never seen before."})]})},{title:"Abstraction ðŸŒ¬ï¸",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Filtering out unnecessary details to focus on the essential elements. Abstraction simplifies complexity by creating a model of the problem that is easier to work with."}),e.jsx(tt,{type:"tip",title:"Example: Predicting a Race Winner",children:"What factors are essential? Engine horsepower, driver experience, weather. What's irrelevant? The car's color, the driver's favorite snack. Abstraction means you build your predictive model using only the essential factors."})]})},{title:"Algorithmic Design âš™ï¸",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Developing a step-by-step, unambiguous set of instructions to solve a problem. The algorithm is the roadmap that a computer (or a person) follows to reach the solution."}),e.jsxs(tt,{type:"tip",title:"Example: Number Sequence",children:["To find the next number in the sequence 2, 4, 6, 8... the algorithm is simple:",e.jsxs("ol",{children:[e.jsx("li",{children:"Get the current number."}),e.jsx("li",{children:"Add 2 to the current number."}),e.jsx("li",{children:"Output the result."})]})]})]})}]},{type:"activity",id:"ct-matching-scenarios",activityType:"matching",heading:"Match Concepts to Scenarios",instructions:"Match each computational thinking concept to the scenario that best illustrates it.",pairs:[{term:"Decomposition",example:"Planning a large software project by breaking it into modules: user authentication, data processing, and user interface."},{term:"Pattern Recognition",example:"Analyzing sales data and noticing that a certain product sells best on weekends, then creating a general rule for weekend promotions."},{term:"Abstraction",example:"Creating a subway map that shows the order of stations and connections, but ignores the exact geographical distances and street layouts."},{term:"Algorithmic Design",example:"Writing a detailed recipe for baking a cake, with precise measurements and steps that must be followed in order."}]}]},{id:"B1.1.3",title:"Applying CT in Computer Science",duration:"45 min",description:"See how the core CT concepts are applied in real-world computer science domains.",segments:[{type:"content",id:"ct-app-intro",heading:"Computational Thinking in Action",body:e.jsx("p",{children:"Computational thinking isn't just a theoretical framework; it's the practical foundation for many fields within computer science. Let's explore how the four concepts are applied in different areas."})},{type:"list",id:"ct-app-examples",heading:"Domain Examples",items:[{title:"Software Development",body:"A large Customer Relationship Management (CRM) system is decomposed into modules (lead tracking, customer management). Developers recognize common bug patterns to speed up debugging. They use Object-Oriented Programming to abstract complex operations into reusable objects."},{title:"Data Analysis",body:"An analyst decomposes the process of analyzing sales data into tasks like data cleaning and normalization. They use pattern recognition to spot seasonal trends. Abstraction is used to focus on Key Performance Indicators (KPIs) like monthly sales growth."},{title:"Machine Learning",body:"A project is decomposed into data collection, model training, and deployment. Pattern recognition is key to identifying features in image data (e.g., using convolutional neural networks). Data is abstracted into feature sets and labels for the model."},{title:"Network Security",body:"Security challenges are decomposed into categories like physical and application security. Pattern recognition identifies typical attack patterns (like DDoS or phishing). Abstraction is used to create generic security models and protocols (like SSL/TLS)."}]},{type:"activity",id:"ct-app-spot-error",activityType:"spot-error",heading:"Which Statement is Incorrect?",instructions:"Read the statements about applying CT and identify the one that is logically flawed.",items:[{id:"err-1",text:"In database design, abstraction helps represent real-world entities as tables while ignoring irrelevant details.",isError:!1},{id:"err-2",text:"When developing software, decomposition is only useful for single developers, not for teams.",isError:!0,explanation:"Decomposition is especially powerful for teams, as it allows different team members to work on separate modules concurrently."},{id:"err-3",text:"A data analyst uses pattern recognition to predict future demand based on historical sales data.",isError:!1}]}]},{id:"B1.1.4",title:"Tracing Flowcharts and Algorithms",duration:"45 min",description:"Learn to read, interpret, and trace visual representations of algorithms using standardized flowchart symbols.",segments:[{type:"content",id:"flow-intro",heading:"Visualizing Logic",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Flowcharts are diagrams that use standardized symbols (defined by ISO 5807) to visually depict processes, decisions, and the flow of control in an algorithm. They are an essential tool for designing, documenting, and debugging logic before and after coding."})})},{type:"content",id:"flow-symbols-table",heading:"Standard Flowchart Symbols (ISO 5807)",body:e.jsx(Vn,{columns:["Symbol","Name","Definition and Notes"],rows:[["Oval","Terminator (Start/End)","Indicates the beginning and ending of a program or sub-process."],["Parallelogram","Input / Output","Represents a process of inputting data (e.g., from a user) or outputting data (e.g., to a screen)."],["Rectangle","Process / Operation","Represents a set of operations that changes the value, form, or location of data."],["Diamond","Decision","Indicates a point where a decision must be made. The question inside should have only two possible answers (e.g., Yes/No or True/False), leading to different paths."],["Arrow","Flowline","Shows the order of operations by connecting the other symbols."]]})},{type:"activity",id:"flow-gap-fill",activityType:"gap-fill",heading:"Build a Flowchart Explanation",instructions:"Drag the words into the correct blanks to complete the sentence.",interaction:"drag",text:"In a flowchart, a [[diamond]] symbol is used for a decision, a [[rectangle]] is used for a process, and a [[parallelogram]] is used for input or output.",tokens:[{id:"tok-diamond",label:"diamond"},{id:"tok-para",label:"parallelogram"},{id:"tok-rect",label:"rectangle"}],blanks:[{id:"diamond",answer:"tok-diamond"},{id:"rectangle",answer:"tok-rect"},{id:"parallelogram",answer:"tok-para"}]},{type:"content",id:"flow-tracing",heading:"Trace Tables: Testing the Logic",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"How do you know if your algorithm is correct? You trace it. A trace table is a technique used to test an algorithm by tracking the values of variables at each step. This helps you identify logic errors."}),e.jsx(tt,{type:"tip",title:"Worked Example",children:"Consider an algorithm where A starts at 10 and B starts at 100. In a loop, B decreases by 10 and A increases by 10 until A is greater than or equal to B."}),e.jsx(Vn,{columns:["Iteration","A","B","Condition (A >= B)"],rows:[["Start","10","100","False"],["1","20","90","False"],["2","30","80","False"],["3","40","70","False"],["4","50","60","False"],["5","60","50","True -> Program Ends"]]})]})}]}],assessment:{duration:"45 min",totalMarks:31,questions:[{id:"as-q1",prompt:"Describe what a problem statement is and why it is critical in the problem specification process.",marks:2},{id:"as-q2",prompt:"Explain the difference between a poor and a strong problem statement, giving an example of each.",marks:4},{id:"as-q3",prompt:"Define the role of constraints in a problem specification and provide an example of a well-defined constraint.",marks:3},{id:"as-q4",prompt:"Compare high-level objectives and specific goals in the context of computational problem-solving.",marks:3},{id:"as-q5",prompt:"Describe the process of decomposition in computational thinking and explain how it can be applied to a real-life problem.",marks:4},{id:"as-q6",prompt:"Explain the importance of pattern recognition in computational thinking, using a relevant example.",marks:2},{id:"as-q7",prompt:"Describe how abstraction simplifies problem-solving in computational thinking.",marks:2},{id:"as-q8",prompt:"Describe the process of algorithmic design, including the steps typically followed.",marks:4},{id:"as-q9",prompt:"Explain how the four fundamental concepts of computational thinking work together to solve problems in computer science.",marks:4}]}},Ga="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDAiIGhlaWdodD0iMzYwIiB2aWV3Qm94PSIwIDAgNjQwIDM2MCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InN5c3RlbUJnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2Y4ZmJmZiIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWYyZmYiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bWFya2VyIGlkPSJhcnJvdyIgbWFya2VyV2lkdGg9IjEyIiBtYXJrZXJIZWlnaHQ9IjEyIiByZWZYPSI2IiByZWZZPSI2IiBvcmllbnQ9ImF1dG8tc3RhcnQtcmV2ZXJzZSI+CiAgICAgIDxwYXRoIGQ9Ik0yIDIgTDEwIDYgTDIgMTAgeiIgZmlsbD0iIzBmMmY3NSIvPgogICAgPC9tYXJrZXI+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSI2NDAiIGhlaWdodD0iMzYwIiBmaWxsPSJ1cmwoI3N5c3RlbUJnKSIvPgoKICA8ZyBmb250LWZhbWlseT0iSW50ZXIsICdTZWdvZSBVSScsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiMwZjJmNzUiIHN0cm9rZT0iIzBmMmY3NSIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgIDxyZWN0IHg9IjcwIiB5PSIxNTAiIHdpZHRoPSIxMjAiIGhlaWdodD0iODAiIHJ4PSIxOCIgZmlsbD0iI2ZmZiIvPgogICAgPHRleHQgeD0iMTMwIiB5PSIxOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPklucHV0PC90ZXh0PgoKICAgIDxyZWN0IHg9IjI2MCIgeT0iOTAiIHdpZHRoPSIxMjAiIGhlaWdodD0iODAiIHJ4PSIxOCIgZmlsbD0iI2ZmZiIvPgogICAgPHRleHQgeD0iMzIwIiB5PSIxMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkNQVTwvdGV4dD4KCiAgICA8cmVjdCB4PSIyNjAiIHk9IjIxMCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI4MCIgcng9IjE4IiBmaWxsPSIjZmZmIi8+CiAgICA8dGV4dCB4PSIzMjAiIHk9IjI1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+Q2FjaGU8L3RleHQ+CgogICAgPHJlY3QgeD0iNDMwIiB5PSIxNTAiIHdpZHRoPSIxNDAiIGhlaWdodD0iODAiIHJ4PSIxOCIgZmlsbD0iI2ZmZiIvPgogICAgPHRleHQgeD0iNTAwIiB5PSIxOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPk91dHB1dDwvdGV4dD4KCiAgICA8bGluZSB4MT0iMTkwIiB5MT0iMTkwIiB4Mj0iMjYwIiB5Mj0iMTMwIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93KSIvPgogICAgPGxpbmUgeDE9IjE5MCIgeTE9IjE5MCIgeDI9IjI2MCIgeTI9IjI1MCIgbWFya2VyLWVuZD0idXJsKCNhcnJvdykiLz4KICAgIDxsaW5lIHgxPSIzODAiIHkxPSIxMzAiIHgyPSI0MzAiIHkyPSIxOTAiIG1hcmtlci1lbmQ9InVybCgjYXJyb3cpIi8+CiAgICA8bGluZSB4MT0iMzgwIiB5MT0iMjUwIiB4Mj0iNDMwIiB5Mj0iMTkwIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93KSIvPgogIDwvZz4KCiAgPGcgZmlsbD0iIzJmNTRlYiIgc3Ryb2tlPSIjMmY1NGViIiBzdHJva2Utd2lkdGg9IjIiIGZvbnQtZmFtaWx5PSJJbnRlciwgJ1NlZ29lIFVJJywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyI+CiAgICA8Y2lyY2xlIGN4PSIyMDAiIGN5PSIxNTAiIHI9IjE0IiBmaWxsPSIjZmZmIi8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+MTwvdGV4dD4KCiAgICA8Y2lyY2xlIGN4PSIzMjAiIGN5PSI3MCIgcj0iMTQiIGZpbGw9IiNmZmYiLz4KICAgIDx0ZXh0IHg9IjMyMCIgeT0iNzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPjI8L3RleHQ+CgogICAgPGNpcmNsZSBjeD0iMzIwIiBjeT0iMzIwIiByPSIxNCIgZmlsbD0iI2ZmZiIvPgogICAgPHRleHQgeD0iMzIwIiB5PSIzMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPjM8L3RleHQ+CgogICAgPGNpcmNsZSBjeD0iNTQwIiBjeT0iMTQwIiByPSIxNCIgZmlsbD0iI2ZmZiIvPgogICAgPHRleHQgeD0iNTQwIiB5PSIxNDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPjQ8L3RleHQ+CiAgPC9nPgo8L3N2Zz4K",Xr=[{term:"Variable",definition:"Named reference to a value stored in memory."},{term:"Data type",definition:"Describes the kind of value a variable may store and which operations are valid."},{term:"Boolean",definition:"True or False value used in decision making."},{term:"Integer",definition:"Whole number without a fractional component."},{term:"Float",definition:"Number with a fractional component; supports decimal precision."},{term:"String",definition:"Ordered, immutable sequence of characters."},{term:"Character",definition:'Single-character string such as "A".'},{term:"List",definition:"Ordered, mutable collection of values."},{term:"Dictionary",definition:"Mapping of keys to values for structured records."},{term:"Operator",definition:"Symbol performing arithmetic, comparison, or logical work."},{term:"Assignment",definition:"Evaluates the right-hand expression and stores the result in a variable."},{term:"Slice",definition:"Portion of a sequence selected using start:stop indexes."},{term:"Concatenation",definition:"Combining sequences end-to-end."},{term:"Escape character",definition:"Backslash (\\) used to insert quotes, newlines, or tabs into strings."},{term:"Exception",definition:"Runtime error that can be intercepted with try/except blocks."},{term:"Debugging",definition:"Structured process of locating and fixing errors."},{term:"Trace table",definition:"Table logging variable values across steps to verify logic."}],Ha=Xr.map(({term:t,definition:s})=>({title:t,body:s})),Jn=e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Build fluency writing, tracing, and debugging Python programs. You will evaluate data types, practise string manipulation, defend against runtime errors, and apply deliberate debugging workflows."}),e.jsxs("ul",{children:[e.jsx("li",{children:"Choose appropriate data types and reason about scope and assignment."}),e.jsx("li",{children:"Slice, search, and format strings defensively while reusing the Python standard library."}),e.jsx("li",{children:"Handle exceptions gracefully and document debugging evidence."})]})]}),qa=e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"After completing this pathway you will be able to:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"B2.1.1"})," Construct and trace programs that use global and local variables of multiple data types."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"B2.1.2"})," Extract, reformat, and validate substrings using language-standard operations."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"B2.1.3"})," Describe and implement common exception handling strategies."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"B2.1.4"})," Apply structured debugging techniques including trace tables, breakpoints, and logging."]})]})]}),Va=[["Boolean","flag = True","Booleans control decision branches and loop flow."],["Integer","attempts = 3","Whole numbers; combine with // for floor division."],["Float","price = 19.95","Store decimal values; use round() or format() for display."],["String",'name = "Ibcs"',"Immutable sequences; slicing returns new strings."],["List","scores = [88, 76, 93]","Ordered, mutable collection suited to loops and aggregations."],["Dictionary",'{"username": "ada", "role": "student"}',"Key/value pairs for structured records."],["Set",'{"python", "scratch"}',"Unique items with fast membership tests."],["Operators","+ - * / // % **, comparisons < <= > >= == !=, logic and or not","Pick the operator that matches the required behaviour."],["Assignment","score = base + bonus","Right side evaluates first; previous value is overwritten."]],Ya=[["Indexing","greeting[2]","Returns character at index 2; check len(greeting) first."],["Slice","phrase[0:8]","Start index inclusive, end exclusive; supports negative indexes."],["find",'phrase.find("Sci")',"Returns index or -1 if not found; test before slicing."],["replace",'phrase.replace("is", "will be")',"Creates a new string with replacements."],["split","sentence.split()","Breaks a string into a list of tokens on whitespace by default."],["strip","raw.strip()","Removes leading and trailing whitespace."],["formatting",'f"{item} costs {price:.2f}"',"Use f-strings for readable output with controlled precision."]],za=[{title:"Unexpected input",body:e.jsx(h.Fragment,{children:e.jsxs("p",{children:["Users may enter empty strings, negative numbers, or malformed data. Validate ranges and wrap conversions in",e.jsx("code",{children:"try/except"})," to present a helpful message instead of letting the program crash."]})})},{title:"Missing resources",body:e.jsx(h.Fragment,{children:e.jsxs("p",{children:["Files, databases, or network resources might not exist or might be unavailable. Handle exceptions like"," ",e.jsx("code",{children:"FileNotFoundError"})," and close resources in a ",e.jsx("code",{children:"finally"})," block."]})})},{title:"Logic errors at runtime",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Off-by-one indexes or division by zero can surface after deployment. Defensive checks and descriptive error messages make debugging faster for future maintainers."})})}],Ja=[{title:"Trace tables",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Track variable values per iteration to reveal where logic diverges. Perfect for validating loop boundaries or conditional branches."})})},{title:"Breakpoints",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Pause program execution at a line to inspect state. Use when a branch or loop appears to skip expected code."})})},{title:"Print logging",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Insert temporary print statements to confirm control flow and data values. Combine with labels so output stays clear during debugging."})})},{title:"Step execution",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Use your IDE to run code line-by-line. Ideal when you suspect an off-by-one error or incorrect function call order."})})}],Nt={id:"B2",title:"Programming Fundamentals",hours:{sl:"SL Â· 40 hours",hl:"HL Â· 42 hours"},guidingQuestion:"How can we apply programming to solve problems?",overview:{aim:Jn,vocabulary:Xr},stages:[{id:"B2-overview",title:"Unit Orientation",duration:"20 min",description:"Orient yourself to the learning outcomes, vocabulary, and assessment flow for programming fundamentals.",segments:[{type:"content",id:"b2-overview-aim",heading:"Aim of the Unit",body:Jn},{type:"content",id:"b2-overview-outcomes",heading:"Learning Outcomes",body:qa},{type:"list",id:"b2-overview-vocab",heading:"Key Vocabulary",items:Ha},{type:"micro-quiz",id:"b2-overview-check",heading:"Ready to Start?",questions:[{id:"b2-overview-q1",type:"mcq",prompt:"Which statement best describes a programming variable?",options:[{id:"b2-overview-q1-a",label:"Static storage that cannot change after initial assignment."},{id:"b2-overview-q1-b",label:"Named memory location whose stored value can update during execution."},{id:"b2-overview-q1-c",label:"Collection of operations that run only once."}],answer:"b2-overview-q1-b",rationale:"Variables are storage locations that can change while a program runs."},{id:"b2-overview-q2",type:"true-false",prompt:"Exception handling exists to hide bugs rather than improve user experience.",answer:!1,rationale:"Exception handling catches predictable failures and offers recovery paths for users."}]}]},{id:"B2.1.1",title:"Variables and Data Types",duration:"55 min",description:"Choose appropriate data types, reason about scope, and trace how assignments update program state.",segments:[{type:"content",id:"b2-211-why",heading:"Why Variables and Types Matter",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Correct types unlock valid operations and prevent precision loss. When you choose the wrong type, simple calculations can overflow, string conversions become awkward, and comparisons fail silently."}),e.jsx("p",{children:"Understanding scope also prevents accidental reuse of values and makes debugging faster because you know where each variable lives."})]})},{type:"table",id:"b2-211-types",heading:"Type Cheat Sheet",columns:["Concept","Python example","Why it matters"],rows:Va},{type:"list",id:"b2-211-rules",heading:"Essential Rules",items:[{title:"Declaration vs inference",body:"Python infers type from the assigned value. Keep readability high by naming variables descriptively and documenting expected types when needed."},{title:"Scope",body:"Global variables persist for the program lifetime; local variables disappear when a function or block ends. Minimise global state to avoid surprise mutations."},{title:"Assignments overwrite",body:"When you assign a new value, the prior contents are gone. Copy values you still need before overwriting."},{title:"Type conversions",body:"Use constructors like int(), float(), str(), or bool() to convert values explicitly and capture ValueError when inputs are invalid."}]},{type:"activity",id:"b2-211-diagram",activityType:"diagram-label",heading:"Label the System Components",instructions:"Drag each label onto the numbered hotspot to identify how data flows through a simple computer system.",image:{src:Ga,alt:"Diagram showing input, CPU, cache and output blocks."},tokens:[{id:"sys-input",label:"Input devices"},{id:"sys-cpu",label:"CPU"},{id:"sys-cache",label:"Cache / RAM"},{id:"sys-output",label:"Output devices"}],targets:[{id:"spot-input",x:31,y:42,answer:"sys-input"},{id:"spot-cpu",x:50,y:20,answer:"sys-cpu"},{id:"spot-cache",x:50,y:89,answer:"sys-cache"},{id:"spot-output",x:84,y:39,answer:"sys-output"}]},{type:"activity",id:"b2-211-matching",activityType:"matching",heading:"Match the Data Type to the Scenario",instructions:"Match each scenario to the most appropriate data type choice.",pairs:[{term:"Boolean",example:"Store whether a customer opted in to marketing emails."},{term:"float",example:"Track the price of a flight ticket with cents precision."},{term:"String",example:"Record a phone number that preserves leading zeroes and punctuation."},{term:"int",example:"Count how many login attempts remain before lockout."},{term:"list",example:"Maintain the quiz scores for a single student."}]},{type:"activity",id:"b2-211-swap",activityType:"ordering",heading:"Ordering: Safe Variable Swap",instructions:"Arrange the steps to safely swap two variable values using a temporary placeholder.",items:["Store the value of variable A in temp.","Assign the value of variable B to variable A.","Assign temp to variable B.","Declare the temporary variable temp."]},{type:"activity",id:"b2-211-spot",activityType:"spot-error",heading:"Spot the Type Errors",instructions:"Select every line that would raise a type or casting issue.",items:[{id:"b2-211-spot-1",text:'price = float("9.99")',isError:!1,explanation:"Converting the string to a float succeeds when the input is numeric."},{id:"b2-211-spot-2",text:"tickets = int(user_input)",isError:!0,explanation:"If user_input is not numeric this raises ValueError unless wrapped in try/except."},{id:"b2-211-spot-3",text:'total = 42 + " students"',isError:!0,explanation:"Python cannot add an int and a string without explicit conversion."},{id:"b2-211-spot-4",text:"done = bool(1)",isError:!1,explanation:"bool(1) evaluates to True, which is valid when you intend to cast integers to boolean."},{id:"b2-211-spot-5",text:'stock = list({"apples": 3})',isError:!0,explanation:"Casting a dict to list drops keys unexpectedly; use list(dictionary.items()) or keep the dict type."}]},{type:"python-playground",id:"b2-211-playground",heading:"Try It: Inspecting Types and Swapping",prompt:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Run the starter to inspect variable types, then experiment with your own assignments."}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Observe how Python infers types and how ",e.jsx("code",{children:"type()"})," reports them."]}),e.jsx("li",{children:"Practise swapping values without losing the original data."})]})]}),starterCode:`user_name = "Ada"
age_years = 19
ticket_price = 19.95
is_student = True

print("Values:", user_name, age_years, ticket_price, is_student)
print("Types:", type(user_name), type(age_years), type(ticket_price), type(is_student))

# TODO: swap the values of a and b without losing data
a = 7
b = 3
print("Before swap:", a, b)

temp = a
a = b
b = temp

print("After swap:", a, b)
`,snippets:[{id:"b2-211-cast",label:"Cast user input",code:'raw_age = "17"\\nage = int(raw_age)\\nprint("Age as int:", age, type(age))'},{id:"b2-211-format",label:"Format receipt line",code:'item = "Notebook"\\nprice = 4.5\\nprint(f"{item} ... ${price:.2f}")'}]},{type:"micro-quiz",id:"b2-211-quiz",heading:"Mini Checkpoint",questions:[{id:"b2-211-q1",type:"mcq",prompt:"What does 7 // 2 evaluate to in Python?",options:[{id:"b2-211-q1-a",label:"3.5"},{id:"b2-211-q1-b",label:"3"},{id:"b2-211-q1-c",label:"4"}],answer:"b2-211-q1-b",rationale:"// performs floor division, returning the integer 3 for 7 // 2."},{id:"b2-211-q2",type:"true-false",prompt:"Python floor division uses the operator //.",answer:!0,rationale:"`//` performs floor division in Python, returning an integer result."},{id:"b2-211-q3",type:"mcq",prompt:"Why do we need a temporary variable when swapping values?",options:[{id:"b2-211-q3-a",label:"Without it the interpreter refuses to reassign values."},{id:"b2-211-q3-b",label:"Reassignment overwrites values; a temporary variable preserves one value until the swap finishes."},{id:"b2-211-q3-c",label:"It makes the code compile faster."}],answer:"b2-211-q3-b",rationale:"Assignments overwrite values, so a temporary placeholder preserves one of them during the swap."},{id:"b2-211-q4",type:"true-false",prompt:"bool(0) evaluates to False in Python.",answer:!0,rationale:"Non-zero numbers cast to True; zero casts to False."}]},{type:"reflection",id:"b2-211-reflection",heading:"Reflection",prompt:"When would you store age as a float instead of an int in a Python application? Justify the choice."}]},{id:"B2.1.2",title:"Strings: Extraction and Manipulation",duration:"55 min",description:"Practise slicing, searching, and formatting text while guarding against index errors and inconsistent casing.",segments:[{type:"content",id:"b2-212-why",heading:"Why String Skills Matter",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"User-facing programs rely on text: usernames, passwords, log entries, IoT messages. Clean string handling makes it possible to validate input and prepare meaningful outputs."}),e.jsx("p",{children:"Index errors and inconsistent casing are common failure pointsâ€”defensive slicing and checks keep strings safe before you manipulate them."})]})},{type:"accordion",id:"b2-212-techniques",heading:"Technique Highlights",items:[{title:"Indexing",body:e.jsx(h.Fragment,{children:e.jsxs("p",{children:["Python indexing requires ",e.jsx("code",{children:"0 â‰¤ index < len(sequence)"}),". Check the length first to avoid",e.jsx("code",{children:"IndexError"}),"."]})})},{title:"Finding substrings",body:e.jsx(h.Fragment,{children:e.jsxs("p",{children:["Use ",e.jsx("code",{children:"find"})," to locate substrings. A result of ",e.jsx("code",{children:"-1"})," means the target was not foundâ€”handle that before slicing."]})})},{title:"Formatting output",body:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Python f-strings produce readable output with explicit formatting. Prefer them over manual concatenation when combining multiple values."})})}]},{type:"table",id:"b2-212-methods",heading:"Common String Operations",columns:["Operation","Python example","Why use it?"],rows:Ya},{type:"activity",id:"b2-212-matching",activityType:"matching",heading:"Match Method to Outcome",instructions:"Pair each operation with the result it produces for the sample string.",pairs:[{term:'s = "Old Town"; s[4]',example:'"T"'},{term:'s = "Computer Science is fun"; s[9:16]',example:'"Science"'},{term:'s = "Computer Science is fun"; s.replace("is", "will be")',example:'"Computer Science will be fun"'},{term:'words = "Hello world".split()',example:'["Hello", "world"]'}]},{type:"activity",id:"b2-212-gap",activityType:"gap-fill",heading:"Fill the String Toolkit",instructions:"Drag the correct method into each blank to complete the description.",interaction:"drag",text:"Use [[b2-212-gap-find]] to locate a substring, [[b2-212-gap-slice]] to extract it, and [[b2-212-gap-format]] to output a tidy message.",tokens:[{id:"token-find",label:"find"},{id:"token-slice",label:"slice"},{id:"token-format",label:"f-string"}],blanks:[{id:"b2-212-gap-find",answer:"token-find"},{id:"b2-212-gap-slice",answer:"token-slice"},{id:"b2-212-gap-format",answer:"token-format"}]},{type:"python-playground",id:"b2-212-playground",heading:"Try It: Build a Password Tag",prompt:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Generate a simple password suggestion using slices and formatting. Modify indices or methods to see how the output changes."}),e.jsx("p",{className:"muted",children:"Tip: Re-run the code each time you tweak the slicing range."})]}),starterCode:`surname = "Stewart"
special = "#42"
base = surname.lower()

first_four = base[:4]
password = f"{first_four}{special}"

print(password)

# Challenge: ensure surname is at least 4 characters before slicing.
if len(base) < 4:
    print("Surname too short for default slice.")
`,snippets:[{id:"b2-212-strip",label:"Strip whitespace",code:'raw = "  Computer Science  "\\nprint(raw.strip())'},{id:"b2-212-format",label:"Format sentence",code:'course = "IBCS"\\nscore = 87.456\\nprint(f"{course} score: {score:.1f}")'}]},{type:"micro-quiz",id:"b2-212-quiz",heading:"String Skills Pulse Check",questions:[{id:"b2-212-q1",type:"mcq",prompt:'What does Python return for "Science"[2:6]?',options:[{id:"b2-212-q1-a",label:'"ienc"'},{id:"b2-212-q1-b",label:'"ien"'},{id:"b2-212-q1-c",label:'"ence"'}],answer:"b2-212-q1-a",rationale:"Start index inclusive (2) and end exclusive (6) yields the characters i, e, n, c."},{id:"b2-212-q2",type:"true-false",prompt:"Python strings are immutable.",answer:!0,rationale:"All string operations return new strings instead of modifying the original."},{id:"b2-212-q3",type:"mcq",prompt:"Which approach most clearly concatenates numbers into a string?",options:[{id:"b2-212-q3-a",label:"Use the + operator repeatedly with raw integers."},{id:"b2-212-q3-b",label:"Use formatting, e.g., f-strings or String.format, to control layout explicitly."},{id:"b2-212-q3-c",label:"Convert numbers to binary strings first."}],answer:"b2-212-q3-b",rationale:"Formatting keeps intent clear and avoids implicit conversions."}]},{type:"reflection",id:"b2-212-reflection",heading:"Reflection",prompt:"When concatenating numbers into strings, which Python formatting approach keeps your intent clearest?"}]},{id:"B2.1.3",title:"Exception Handling",duration:"45 min",description:"Plan for runtime failures and design error messages that guide users instead of crashing the app.",segments:[{type:"content",id:"b2-213-why",heading:"Why Exceptions Happen",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Unchecked input, missing files, and timing issues cause runtime failures. Exception handling lets you respond predictably, log useful diagnostics, and keep programs stable."}),e.jsx("p",{children:"The goal is not to hide bugsâ€”it is to surface helpful information while preserving control over the app."})]})},{type:"list",id:"b2-213-failures",heading:"Typical Failure Points",items:[{title:"Bad or missing input",body:"Empty strings, unexpected characters, or numbers outside an allowed range."},{title:"Unavailable resources",body:"Files, networks, or sensors that fail to respond when needed."},{title:"Logic defects",body:"Dividing by zero, out-of-range indexes, or null dereferences triggered by logic mistakes."}]},{type:"accordion",id:"b2-213-accordion",heading:"Handling Patterns",items:za},{type:"activity",id:"b2-213-classify",activityType:"classification",heading:"Classify the Exception Strategy",instructions:"Drag each scenario to the way you would respond to it.",categories:[{id:"prevent",title:"Prevent",description:"Validate or constrain inputs before they fail."},{id:"handle",title:"Handle",description:"Catch the error and present a friendly message."},{id:"recover",title:"Recover",description:"Retry or fallback to keep the program running."}],tokens:[{id:"b2-213-token-1",label:"Ensure age is 0-120 before converting user input.",answer:"prevent"},{id:"b2-213-token-2",label:"Wrap file access in try/except and show a missing-file notice.",answer:"handle"},{id:"b2-213-token-3",label:"Retry a network request with exponential back-off.",answer:"recover"},{id:"b2-213-token-4",label:"Validate dropdown selections so invalid IDs never hit the server.",answer:"prevent"}]},{type:"activity",id:"b2-213-ordering",activityType:"ordering",heading:"Ordering: Handle Input Safely",instructions:"Place the steps in order to validate age input and handle failures.",items:["Prompt the user for age input.","Attempt to convert the input to an integer inside a try block.","Check that the age is between 0 and 120 inclusive.","Raise or report an error if conversion fails or the range check fails.","Proceed with the program when conversion and range checks succeed."]},{type:"micro-quiz",id:"b2-213-quiz",heading:"Exception Handling Pulse Check",questions:[{id:"b2-213-q1",type:"true-false",prompt:"A finally block only runs when an exception occurs.",answer:!1,rationale:"Finally runs regardless of whether an exception was raised."},{id:"b2-213-q2",type:"mcq",prompt:"Which Python exception best matches a missing file scenario?",options:[{id:"b2-213-q2-a",label:"FileNotFoundError"},{id:"b2-213-q2-b",label:"IndexError"},{id:"b2-213-q2-c",label:"ValueError"}],answer:"b2-213-q2-a",rationale:"Missing resources trigger file-related exceptions that must be handled."},{id:"b2-213-q3",type:"mcq",prompt:"How does 'garbage in, garbage out' influence validation?",options:[{id:"b2-213-q3-a",label:"It suggests skipping validation to avoid upsetting users."},{id:"b2-213-q3-b",label:"It emphasises preventing bad input early to avoid cascading failures."},{id:"b2-213-q3-c",label:"It means errors are always the user's fault."}],answer:"b2-213-q3-b",rationale:"Defensive validation stops bad input before it propagates through the system."}]},{type:"reflection",id:"b2-213-reflection",heading:"Reflection",prompt:"How does â€œgarbage in, garbage outâ€ influence your validation strategy for user forms?"}]},{id:"B2.1.4",title:"Debugging Techniques",duration:"50 min",description:"Diagnose faults with trace tables, breakpoints, print logging, and step execution, then apply them to a sample program.",segments:[{type:"content",id:"b2-214-why",heading:"Debugging without Guesswork",body:e.jsxs(h.Fragment,{children:[e.jsx("p",{children:"Bugs lurk in correct-looking code. A deliberate debugging workflow saves hours compared with random tweaksâ€”especially when the bug refuses to reproduce on command."}),e.jsx("p",{children:"Pick tools based on symptoms, capture evidence, and share it with teammates for faster fixes."})]})},{type:"accordion",id:"b2-214-techniques",heading:"Technique Toolkit",items:Ja},{type:"activity",id:"b2-214-matching",activityType:"matching",heading:"Match Bug Symptom to Technique",instructions:"Choose the debugging technique that best fits each scenario.",pairs:[{term:"Loop skips the final element",example:"Complete a trace table to inspect index and length per iteration."},{term:"Branch never triggers even with matching conditions",example:"Set a breakpoint on the branch and inspect variable values at runtime."},{term:"API call fails midway through execution",example:"Add labelled print statements before and after the call to confirm parameters and response."},{term:"Suspect off-by-one error in nested loop",example:"Use step execution to watch the loop counters progress together."}]},{type:"activity",id:"b2-214-completion",activityType:"code-completion",heading:"Code Completion: Debug Logger",instructions:"Fill in the missing expressions to finish the debugging helper.",prompt:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Use deliberate logging to capture what your loop is doing at runtime."})}),code:`for index, value in enumerate(numbers):
    [[b2-214-gap-log]]
    if [[b2-214-gap-condition]]:
        print("Found the value", value)
`,placeholders:[{id:"b2-214-gap-log",answer:'print(f"Checking index {index}: {value}")',label:"Log statement",hint:"Print both the index and current value."},{id:"b2-214-gap-condition",answer:"value == target",label:"Condition",hint:"Compare the current value to the target before printing."}]},{type:"python-playground",id:"b2-214-playground",heading:"Try It: Debug Selection Sort",prompt:e.jsx(h.Fragment,{children:e.jsx("p",{children:"Run the selection sort sample with logging enabled. Modify the logging to capture more detail or fix the bug that misplaces the final element."})}),starterCode:`numbers = [7, 2, 9, 4, 3]

def selection_sort(values):
    items = values[:]
    for i in range(len(items) - 1):
        lowest_index = i
        print(f"Outer loop i={i}, start list: {items}")
        for j in range(i + 1, len(items)):
            print(f"  Compare items[{j}]={items[j]} with items[{lowest_index}]={items[lowest_index]}")
            if items[j] < items[lowest_index]:
                lowest_index = j
        # BUG: swap missing when lowest_index equals i
        if lowest_index != i:
            items[i], items[lowest_index] = items[lowest_index], items[i]
        print(f"After pass {i}: {items}")
    return items

print("Original:", numbers)
sorted_values = selection_sort(numbers)
print("Sorted:", sorted_values)
`,snippets:[{id:"b2-214-trace",label:"Trace with enumerate",code:"for index, value in enumerate(numbers):\\n    print(index, value)"},{id:"b2-214-todo",label:"Add TODO marker",code:'print("TODO: inspect lowest_index when equal to i")'}]},{type:"micro-quiz",id:"b2-214-quiz",heading:"Debugging Pulse Check",questions:[{id:"b2-214-q1",type:"mcq",prompt:"Which technique best surfaces an off-by-one error in a loop?",options:[{id:"b2-214-q1-a",label:"Trace table covering each iteration."},{id:"b2-214-q1-b",label:"Only re-running the program repeatedly."},{id:"b2-214-q1-c",label:"Adding more features to the code."}],answer:"b2-214-q1-a",rationale:"Trace tables expose iteration-by-iteration variable states."},{id:"b2-214-q2",type:"true-false",prompt:"Breakpoints let you pause execution to inspect values mid-run.",answer:!0,rationale:"Breakpoints intentionally halt execution so you can inspect the stack and variables."},{id:"b2-214-q3",type:"mcq",prompt:"When do you prefer a breakpoint over print statements?",options:[{id:"b2-214-q3-a",label:"When you need to inspect variable state inside a complex branch without altering code output."},{id:"b2-214-q3-b",label:"When print statements crash the program."},{id:"b2-214-q3-c",label:"Prints are always better than breakpoints."}],answer:"b2-214-q3-a",rationale:"Breakpoints expose state without adding new output to the console."}]},{type:"reflection",id:"b2-214-reflection",heading:"Reflection",prompt:"Which bug did you last fix? Which technique helped you pinpoint it fastest?"}]},{id:"B2.1.summary",title:"Consolidation Task",duration:"50 min",description:"Plan and implement a username utility with validation, exceptions, and debugging evidence.",segments:[{type:"content",id:"b2-summary-brief",heading:"Project Brief",body:e.jsxs("ol",{children:[e.jsx("li",{children:"Ask for first and last names; create a username from the last two letters of the first name and the first three of the last."}),e.jsx("li",{children:"Lower-case the result and validate minimum lengths before slicing."}),e.jsx("li",{children:"Raise exceptions for short names or non-alphabetic characters."}),e.jsx("li",{children:"Capture debug prints or trace-table notes for at least two test cases."})]})},{type:"activity",id:"b2-summary-planner",activityType:"planner",heading:"Username Utility Planner",instructions:"Complete each panel to outline your solution. Save the notes before you move on.",panels:[{id:"b2-summary-input",label:"Inputs & validation rules"},{id:"b2-summary-exceptions",label:"Exceptions to handle and messages to show"},{id:"b2-summary-tests",label:"Test cases and expected outputs"},{id:"b2-summary-debug",label:"Debugging evidence you will capture"}]},{type:"micro-quiz",id:"b2-summary-exit",heading:"Exit Ticket",questions:[{id:"b2-summary-q1",type:"mcq",prompt:"Which step should run first when validating username inputs?",options:[{id:"b2-summary-q1-a",label:"Slice the names immediately."},{id:"b2-summary-q1-b",label:"Check the length and character rules before slicing."},{id:"b2-summary-q1-c",label:"Print the username before validation."}],answer:"b2-summary-q1-b",rationale:"Validate before slicing to avoid runtime errors and produce helpful messages."},{id:"b2-summary-q2",type:"true-false",prompt:"Planner notes are only useful for teachers, not students.",answer:!1,rationale:"Planner notes help you implement and debug your own work."}]}]}],assessment:{duration:"45 min",totalMarks:25,questions:[{id:"b2-assessment-q1",prompt:"Define variable and data type. Explain why type choice affects what operations are valid.",marks:3},{id:"b2-assessment-q2",prompt:"Given short snippets, identify bugs caused by integer versus floating-point division and correct them.",marks:4},{id:"b2-assessment-q3",prompt:'For input text "Computer Science is fun", extract "Science", replace "is" with "will be", and output the final string using Python string operations.',marks:5},{id:"b2-assessment-q4",prompt:"Describe two distinct exception scenarios and outline appropriate try/catch or try/except blocks with finally for each.",marks:5},{id:"b2-assessment-q5a",prompt:"Complete a trace table for a loop that counts values > 20 and provide the final count.",marks:4},{id:"b2-assessment-q5b",prompt:"Justify when to use breakpoints versus print statements when debugging the same task.",marks:4}]}};function Za(t=0,s=100){const n=Number.isFinite(s)&&s>0?s:100,i=(Number.isFinite(t)?t/n:0)*100;return Number.isFinite(i)?Math.max(0,Math.min(i,100)):0}function ei({value:t=0,max:s=100,tone:n="brand",size:r="md",showValue:i=!1,label:a,className:o,children:l,ariaLabel:d,...c}){const u=Za(t,s),b=Math.round(u),g=rt("progress-bar",n&&`progress-bar--${n}`,r&&`progress-bar--${r}`,o);return e.jsxs("div",{className:g,style:{"--progress-percent":`${u}%`},...c,children:[e.jsx("div",{className:"progress-bar__track",children:e.jsx("div",{className:"progress-bar__fill",role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":b,"aria-label":d,children:i?e.jsxs("span",{className:"progress-bar__value",children:[b,"%"]}):null})}),(a||l)&&e.jsx("div",{className:"progress-bar__footer",children:a||l})]})}const Qa=new Set(["info","success","warning","danger","neutral","muted"]),Ka=new Set(["soft","solid","outline"]),Xa=new Set(["sm","md","lg"]);function Se({tone:t="info",variant:s="soft",size:n="sm",icon:r,className:i,children:a,as:o="span",...l}){const d=Qa.has(t)?t:"info",c=Ka.has(s)?s:"soft",u=Xa.has(n)?n:"sm";return e.jsxs(o,{className:rt("status-pill",`status-pill--${d}`,`status-pill--variant-${c}`,`status-pill--size-${u}`,r?"status-pill--with-icon":null,i),...l,children:[r?e.jsx("span",{className:"status-pill__icon","aria-hidden":"true",children:r}):null,e.jsx("span",{className:"status-pill__label",children:a})]})}function vs(t){return t?t.toLowerCase():"locked"}function Xs(t){const s=vs(t);return s==="formative-complete"||s==="summative-complete"}function Zn(t){switch(vs(t)){case"summative-complete":return"Summative complete";case"formative-complete":return"Formative complete";case"available":return"Ready to start";default:return"Locked"}}function Qn(t){switch(vs(t)){case"summative-complete":case"formative-complete":return"success";case"available":return"info";case"locked":return"muted";default:return"neutral"}}function eo(t,s){if(!(s!=null&&s.attempts))return[];const n=[],r=s.attempts;return t.stages.forEach(i=>{(i.segments??[]).forEach(a=>{if(["activity","micro-quiz","python-playground"].includes(a.type)){const o=r==null?void 0:r[a.id];if(!o)return;const l=o.count??0,d=o.correct??0;n.push({stage:i.title,segment:a.heading??a.title??a.id,attempts:l,correct:d,successRate:l>0?Math.round(d/l*100):null})}})}),n.sort((i,a)=>a.attempts-i.attempts),n}function ti(t){const s=(t||"").toLowerCase();return s.startsWith("ib")?"IB Computer Science":s==="igcse"?"IGCSE Computer Science":s.startsWith("ks3")?"Key Stage 3 Computer Science":"Curriculum"}function si(t,s,n){return t?(t.units??[]).filter(i=>!i.availableFor||i.availableFor.includes(n)).map(i=>{const a=i.subtopics??[],o=[];a.forEach(x=>{(x.lessons??[]).filter(A=>!A.availableFor||A.availableFor.includes(n)).forEach(A=>{o.push({id:A.id,title:A.title,unitId:i.id,chapterTitle:x.title,status:s.get(A.id)??"locked"})})});const l=o.length||1,d=o.filter(x=>Xs(x.status)).length,c=o.filter(x=>x.status!=="locked").length,u=Math.max(c-d,0),b=Math.max(l-c,0),g=Math.round(d/l*100),S=o.find(x=>!Xs(x.status));return{id:i.id,title:i.title,description:i.summary,completedCount:d,unlockedCount:c,inProgressCount:u,lockedCount:b,totalCount:l,percentage:g,lessons:o,nextLesson:S}}):[]}function ni(t){return[...t].sort((n,r)=>{const i=n!=null&&n.updatedAt?new Date(n.updatedAt).getTime():0;return(r!=null&&r.updatedAt?new Date(r.updatedAt).getTime():0)-i}).slice(0,6).map((n,r)=>({...n,id:n.id??`${n.lessonSlug??"lesson"}-${r}`}))}function ri({studentName:t,track:s,trackDisplayName:n,curriculumLink:r,curriculumCtaLabel:i,overallPercentage:a,totalCompleted:o,totalLessons:l,classInfo:d,activeStage:c,pointerLesson:u,pointerUpdatedAt:b,pointerHeadline:g,pointerCta:S,gamification:x,unitSummaries:A,interactiveAttemptSections:v,recentUpdates:j,status:C,isIBTrack:k}){const[R,I]=h.useState(()=>{var G;return((G=A[0])==null?void 0:G.id)??null}),[w,N]=h.useState(()=>{var G;return((G=v[0])==null?void 0:G.id)??null});h.useEffect(()=>{if(A.length===0){I(null);return}I(G=>G&&A.some(ee=>ee.id===G)?G:A[0].id)},[A]),h.useEffect(()=>{if(v.length===0){N(null);return}N(G=>G&&v.some(ee=>ee.id===G)?G:v[0].id)},[v]);const m=h.useMemo(()=>A.length===0?null:A.find(G=>G.id===R)??A[0],[A,R]),f=h.useMemo(()=>m?[{id:"complete",label:"Complete",value:m.completedCount},{id:"progress",label:"In progress",value:m.inProgressCount},{id:"locked",label:"Locked",value:m.lockedCount}]:[],[m]),p=f.reduce((G,ee)=>G+ee.value,0),_=h.useMemo(()=>v.length===0?null:v.find(G=>G.id===w)??v[0],[v,w]),O=h.useMemo(()=>{var ee;return(ee=_==null?void 0:_.rows)!=null&&ee.length?[..._.rows].sort((te,V)=>{const y=te.successRate??0,M=V.successRate??0;return y-M}).slice(0,3):[]},[_]),F=(m==null?void 0:m.nextLesson)??null,D=F&&F.status!=="locked",E=typeof(x==null?void 0:x.level)=="number"?x.level:null,U=typeof(x==null?void 0:x.xp)=="number"?x.xp:null,z=typeof(x==null?void 0:x.streak)=="number"?x.streak:null,ne=h.useMemo(()=>{if(!Number.isFinite(U))return null;const te=Math.floor(U/150)*150+150-U;return Math.max(te,0)},[U]),Z=h.useMemo(()=>typeof(x==null?void 0:x.accuracy)=="number"?x.accuracy:typeof(x==null?void 0:x.totalAttempts)=="number"&&x.totalAttempts>0&&typeof(x==null?void 0:x.totalCorrect)=="number"?Math.round(x.totalCorrect/x.totalAttempts*100):null,[x==null?void 0:x.accuracy,x==null?void 0:x.totalAttempts,x==null?void 0:x.totalCorrect]),P=E!=null?`Lv ${E+1} unlocks new rewards`:"Clear your first activity to begin levelling",L=U!=null?`${ne??150} XP until the next rank`:"Complete activities to earn XP",Q=z!=null&&z>0?`${z} in a rowâ€”keep it going!`:"Pass activities on the first try to build a streak",J=(x==null?void 0:x.totalAttempts)??0,ie=Z!=null?`${J} attempts logged`:"Your accuracy will appear once you start practicing";return e.jsxs(ut,{variant:"fullWidth",className:"student-dashboard",children:[e.jsxs("section",{className:"student-dashboard__hero",children:[e.jsxs("div",{className:"student-dashboard__hero-left",children:[e.jsx("span",{className:"student-dashboard__eyebrow",children:"Student dashboard"}),e.jsxs("h1",{children:["Hi ",t]}),e.jsxs("p",{className:"muted",children:["Your progress through the ",n," pathway lives here. Lessons unlock as your teacher enables themâ€”use this page to see what to tackle next."]}),e.jsxs("div",{className:"student-dashboard__meta-grid",children:[e.jsxs("div",{className:"student-dashboard__meta-card",children:[e.jsx("span",{children:"Track"}),e.jsx("strong",{children:s.toUpperCase()})]}),e.jsxs("div",{className:"student-dashboard__meta-card",children:[e.jsx("span",{children:"Active stage"}),e.jsx("strong",{children:c??"Pending"})]}),e.jsxs("div",{className:"student-dashboard__meta-card",children:[e.jsx("span",{children:"Overall progress"}),e.jsxs("strong",{children:[a,"%"]})]})]}),e.jsxs("div",{className:"student-dashboard__class-card",children:[e.jsxs("div",{children:[e.jsx("span",{className:"student-dashboard__class-eyebrow",children:"Your class"}),e.jsx("strong",{children:d?d.className:"Awaiting placement"}),e.jsx("p",{className:"muted",children:d?d.description||d.yearGroup||"Connected to your class":"Your teacher will place you into a class soon."}),(u||S)&&e.jsxs("div",{className:"student-dashboard__pointer",children:[e.jsx("span",{children:"Live lesson"}),e.jsx("strong",{children:g??"Your teacher will start the next lesson soon"}),b&&e.jsxs("small",{children:["Updated ",b]})]})]}),d&&e.jsxs("div",{className:"student-dashboard__class-meta",children:[e.jsxs("span",{children:["Teacher Â· ",d.teacherUsername??"Assigned"]}),d.yearGroup&&e.jsxs("span",{children:["Year group Â· ",d.yearGroup]}),e.jsxs("span",{children:["Class code Â· ",d.id]})]})]}),e.jsxs("div",{className:"student-dashboard__hero-actions",children:[e.jsx(be,{to:r,className:"pill",children:i}),S&&e.jsx(be,{to:S.link,className:"pill pill--action pill--live",children:S.label})]})]}),e.jsxs("div",{className:"student-dashboard__summary",children:[e.jsx(to,{value:a,label:"overall progress",caption:`${o}/${l} lessons`}),e.jsxs("div",{className:"student-dashboard__stat-grid",children:[e.jsxs("div",{className:"student-dashboard__stat-card student-dashboard__stat-card--level",children:[e.jsx("span",{children:"Level"}),e.jsx("strong",{children:E!=null?`Lv ${E}`:"â€”"}),e.jsx("small",{children:P})]}),e.jsxs("div",{className:"student-dashboard__stat-card student-dashboard__stat-card--xp",children:[e.jsx("span",{children:"XP"}),e.jsx("strong",{children:U??"â€”"}),e.jsx("small",{children:L})]}),e.jsxs("div",{className:"student-dashboard__stat-card student-dashboard__stat-card--streak",children:[e.jsx("span",{children:"Streak"}),e.jsx("strong",{children:z??"â€”"}),e.jsx("small",{children:Q})]}),e.jsxs("div",{className:"student-dashboard__stat-card student-dashboard__stat-card--accuracy",children:[e.jsx("span",{children:"Accuracy"}),e.jsx("strong",{children:Z!=null?`${Z}%`:"â€”"}),e.jsx("small",{children:ie})]})]})]})]}),e.jsxs("section",{className:"student-dashboard__view",children:[e.jsxs("div",{className:"student-dashboard__unit-column",children:[e.jsxs("header",{children:[e.jsxs("h2",{children:[n," units"]}),e.jsx("p",{className:"muted",children:"Select a unit to explore detailed progress."})]}),e.jsxs("div",{className:"student-dashboard__unit-list",children:[A.map(G=>e.jsxs("button",{type:"button",className:`student-dashboard__unit-button ${(m==null?void 0:m.id)===G.id?"is-active":""}`,onClick:()=>I(G.id),children:[e.jsxs("div",{children:[e.jsx("strong",{children:G.title}),G.description&&e.jsx("span",{children:G.description})]}),e.jsxs("div",{className:"student-dashboard__mini-summary",children:[e.jsxs("span",{children:[G.percentage,"%"]}),e.jsx(ei,{className:"student-dashboard__mini-bar",value:Math.max(0,G.percentage),max:100,tone:"brand",size:"xs",ariaLabel:`${G.title} completion`}),e.jsxs("small",{children:[G.completedCount," / ",G.totalCount," lessons"]})]})]},G.id)),A.length===0&&e.jsx("p",{className:"student-dashboard__empty muted",children:"Units will appear once your teacher shares the curriculum with your class."})]})]}),e.jsx("div",{className:"student-dashboard__detail-panel",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"student-dashboard__unit-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"student-dashboard__eyebrow",children:"Selected unit"}),e.jsx("h2",{children:m.title}),m.description&&e.jsx("p",{className:"muted",children:m.description})]}),e.jsxs("div",{className:"student-dashboard__unit-score",children:[e.jsxs("strong",{children:[m.percentage,"%"]}),e.jsx("span",{children:"complete"}),e.jsxs("small",{children:[m.completedCount," of ",m.totalCount," lessons"]})]})]}),e.jsxs("div",{className:"student-dashboard__unit-breakdown",children:[e.jsx("div",{className:"student-dashboard__stack-bar",role:"presentation",children:f.filter(G=>G.value>0&&p>0).map(G=>e.jsx("div",{className:`student-dashboard__stack-bar-segment student-dashboard__stack-bar-segment--${G.id}`,style:{"--segment-percent":`${Math.max(0,Math.min(100,G.value/p*100))}%`},"aria-label":`${G.label}: ${G.value}`},G.id))}),e.jsxs("div",{className:"student-dashboard__unit-counters",children:[e.jsxs("span",{children:[m.completedCount," complete"]}),e.jsxs("span",{children:[m.inProgressCount," in progress"]}),e.jsxs("span",{children:[m.lockedCount," locked"]})]})]}),e.jsxs("div",{className:"student-dashboard__unit-actions",children:[e.jsx(be,{to:k?{pathname:"/curriculum/ib",state:{focusUnit:m.id}}:r,className:"pill",children:"View unit map"}),F&&(D?e.jsxs(be,{to:`/lesson/${F.id}`,className:"pill pill--action",children:["Resume ",F.title]}):e.jsxs("span",{className:"student-dashboard__hint",children:["Next lesson (",F.title,") unlocks soon."]}))]}),e.jsxs("div",{className:"student-dashboard__lesson-list",children:[e.jsxs("div",{className:"student-dashboard__list-header",children:[e.jsx("h3",{children:"Lesson timeline"}),e.jsxs("span",{className:"muted",children:["Ordered sequence Â· first ",Math.min(m.lessons.length,6)," shown"]})]}),e.jsxs("ul",{className:"student-dashboard__lesson-items",children:[m.lessons.slice(0,6).map(G=>{const ee=uo(s,m,G,d),te=G.status==="formative-complete"?"Review":"Open lesson";return e.jsxs("li",{children:[e.jsxs("div",{className:"student-dashboard__lesson-info",children:[e.jsx("strong",{children:G.title}),G.chapterTitle&&e.jsx("span",{className:"muted",children:G.chapterTitle})]}),e.jsxs("div",{className:"student-dashboard__lesson-actions",children:[e.jsx(Se,{tone:Qn(G.status),size:"sm",children:Zn(G.status)}),ee&&G.status!=="locked"&&e.jsx(be,{to:ee,className:"pill pill--ghost",children:te})]})]},G.id)}),m.lessons.length===0&&e.jsx("li",{className:"muted",children:"Lessons will appear once unlocked."})]})]}),e.jsxs("div",{className:"student-dashboard__insights",children:[e.jsxs("div",{className:"student-dashboard__insight-panel",children:[e.jsxs("div",{className:"student-dashboard__insight-header",children:[e.jsx("h3",{children:"Checkpoint insights"}),e.jsx("div",{className:"student-dashboard__tabs",role:"tablist",children:v.map(G=>e.jsx("button",{type:"button",role:"tab","aria-selected":(_==null?void 0:_.id)===G.id,className:`student-dashboard__tab ${(_==null?void 0:_.id)===G.id?"is-active":""}`,onClick:()=>N(G.id),children:G.id},G.id))})]}),_&&_.rows.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"student-dashboard__focus",children:[e.jsx("span",{className:"muted",children:"Segments to revisit"}),e.jsx("ul",{children:O.map((G,ee)=>e.jsxs("li",{children:[e.jsx("strong",{children:G.segment}),e.jsxs("span",{children:[G.successRate!=null?`${G.successRate}%`:"â€”"," success"]})]},`${G.segment}-${ee}`))})]}),e.jsx("div",{className:"student-dashboard__insight-scroll",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Activity"}),e.jsx("th",{children:"Attempts"}),e.jsx("th",{children:"Correct"}),e.jsx("th",{children:"Success"})]})}),e.jsx("tbody",{children:_.rows.slice(0,12).map((G,ee)=>e.jsxs("tr",{children:[e.jsx("td",{children:G.stage}),e.jsx("td",{children:G.segment}),e.jsx("td",{children:G.attempts}),e.jsx("td",{children:G.correct}),e.jsx("td",{children:G.successRate!=null?`${G.successRate}%`:"â€”"})]},`${_.id}-${G.segment}-${ee}`))})]})})]}):e.jsx("p",{className:"student-dashboard__empty muted",children:"Complete interactive checkpoints to unlock insights."})]}),e.jsxs("div",{className:"student-dashboard__timeline",children:[e.jsxs("div",{className:"student-dashboard__list-header",children:[e.jsx("h3",{children:"Recent updates"}),e.jsx("span",{className:"muted",children:"Latest lessons Â· most recent first"})]}),e.jsxs("ul",{children:[j.length===0&&e.jsx("li",{className:"muted",children:"No lessons tracked yet â€” start with your first unlocked topic."}),j.map(G=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:G.lessonSlug}),e.jsx(Se,{tone:Qn(G.status),size:"sm",children:Zn(G.status)})]}),e.jsxs("span",{className:"muted",children:["Updated ",G.updatedAt?new Date(G.updatedAt).toLocaleString():"recently"]})]},G.id))]})]})]})]}):e.jsxs("div",{className:"student-dashboard__empty-panel",children:[e.jsx("h2",{children:"No unit selected yet"}),e.jsx("p",{className:"muted",children:"Once your teacher unlocks lessons, you will see progress here."})]})})]}),C&&e.jsx(Yt,{tone:"info",children:C})]})}function to({value:t,size:s=148,strokeWidth:n=12,label:r,caption:i}){const a=Number.isFinite(t)?t:0,o=Math.max(0,Math.min(100,Math.round(a))),l=(s-n)/2,d=2*Math.PI*l,c=d-o/100*d;return e.jsxs("div",{className:"circular-progress",style:{"--progress-size":`${s}px`,"--progress-stroke":n},children:[e.jsxs("svg",{className:"circular-progress__svg",width:s,height:s,viewBox:`0 0 ${s} ${s}`,children:[e.jsx("circle",{className:"circular-progress__track",cx:s/2,cy:s/2,r:l,strokeWidth:n,fill:"none"}),e.jsx("circle",{className:"circular-progress__indicator",cx:s/2,cy:s/2,r:l,strokeWidth:n,strokeDasharray:d,strokeDashoffset:c,fill:"none",stroke:"var(--color-primary-800)",strokeLinecap:"round"})]}),e.jsxs("div",{className:"circular-progress__label",children:[e.jsxs("strong",{children:[o,"%"]}),r&&e.jsx("span",{children:r}),i&&e.jsx("small",{children:i})]})]})}function so(){var g;const{session:t,ready:s}=Pe(),n=mt(),r=(t==null?void 0:t.token)??null,i=((g=t==null?void 0:t.user)==null?void 0:g.role)==="student"?t.user:null,{updateFromRemote:a}=xs(),[o,l]=h.useState(null),[d,c]=h.useState({}),[u,b]=h.useState(null);return h.useEffect(()=>{if(!s)return;if(!i){n("/",{replace:!0});return}if(!r)return;let S=!0,x;const A=async()=>{var C;try{const k=await yn(r);if(!S)return;l(k);const R=k==null?void 0:k.gamification;R&&a(R);const I=(k==null?void 0:k.progress)??[],w=new Map;I.forEach(m=>{m.unitId&&m.progress&&w.set(m.unitId,m.progress)});const N=((C=i==null?void 0:i.username)==null?void 0:C.toLowerCase())||"guest";w.has(_t.id)&&Ks(_t.id,N,w.get(_t.id)),w.has(Nt.id)&&Ks(Nt.id,N,w.get(Nt.id)),b(null)}catch(k){if(!S)return;b(k.message||"Unable to load dashboard")}};b(null),A();const v=typeof window<"u"?window.setInterval:setInterval,j=typeof window<"u"?window.clearInterval:clearInterval;return x=v(A,5e3),()=>{S=!1,x&&j(x)}},[s,i,r,n,a]),h.useEffect(()=>{if(!(i!=null&&i.username)||typeof window>"u")return;const S=i.username.toLowerCase(),x={};[_t,Nt].forEach(A=>{if(!(A!=null&&A.id))return;const{data:v}=Kr(A.id,S);v&&typeof v=="object"&&(x[A.id]=v)}),c(x)},[i==null?void 0:i.username]),u&&!o?e.jsx(ut,{variant:"fullWidth",className:"student-dashboard",children:e.jsx(Yt,{tone:"danger",children:u})}):o?e.jsx(no,{data:o,localProgress:d}):e.jsx(ut,{variant:"fullWidth",className:"student-dashboard",children:"Loading..."})}function no({data:t,localProgress:s}){const{state:n}=xs(),{manifest:r}=Zt(),i=(t==null?void 0:t.student)??{},a=(t==null?void 0:t.class)??null,o=(t==null?void 0:t.classPacing)??null,l=i.curriculumTrack??"ib-sl",d=l.toLowerCase(),c=h.useMemo(()=>ro((t==null?void 0:t.unlocks)??[],(t==null?void 0:t.progress)??[]),[t==null?void 0:t.unlocks,t==null?void 0:t.progress]),u=h.useMemo(()=>{if(d.startsWith("ks3")){const I=(o==null?void 0:o.lessonId)??null;return io(I)}return si(r,c,d)},[d,o==null?void 0:o.lessonId,r,c]),b=h.useMemo(()=>ao(u),[u]),g=h.useMemo(()=>!d.startsWith("ks3")||!(o!=null&&o.lessonId)?null:vn(o.lessonId),[d,o==null?void 0:o.lessonId]),S=h.useMemo(()=>d.startsWith("ks3")?oo(o==null?void 0:o.updatedAt):null,[d,o==null?void 0:o.updatedAt]),x=h.useMemo(()=>g?`${g.unitTitle}: ${g.title}`:o!=null&&o.lessonId?o.lessonId:o!=null&&o.unitId?o.unitId:null,[g,o==null?void 0:o.lessonId,o==null?void 0:o.unitId]),A=h.useMemo(()=>co(d,g,o,a),[d,g,o,a]),v=h.useMemo(()=>lo(d,a),[d,a]),j=h.useMemo(()=>ho(d,s),[d,s]),C=h.useMemo(()=>ni((t==null?void 0:t.progress)??[]),[t==null?void 0:t.progress]),k=h.useMemo(()=>({...n,...(t==null?void 0:t.gamification)??{}}),[n,t==null?void 0:t.gamification]),R=h.useMemo(()=>{if(i.displayName)return i.displayName;const I=[i.firstName,i.lastName].filter(Boolean).join(" ");return I.trim()?I.trim():i.username?i.username:"Student"},[i.displayName,i.firstName,i.lastName,i.username]);return e.jsx(ri,{studentName:R,track:d,trackDisplayName:ti(l),curriculumLink:v.link,curriculumCtaLabel:v.label,overallPercentage:b.overallPercentage,totalCompleted:b.totalCompleted,totalLessons:b.totalLessons,classInfo:a,activeStage:i.activeStage??null,pointerLesson:g,pointerUpdatedAt:S,pointerHeadline:x,pointerCta:A,gamification:k,unitSummaries:u,interactiveAttemptSections:j,recentUpdates:C,status:(t==null?void 0:t.status)??null,isIBTrack:d.startsWith("ib")})}function ro(t=[],s=[]){const n=new Map;return(s??[]).forEach(r=>{r!=null&&r.lessonSlug&&n.set(r.lessonSlug,r.status??"locked")}),(t??[]).forEach(r=>{if((r==null?void 0:r.scope)!=="lesson"||!(r!=null&&r.stageKey))return;const i=n.get(r.stageKey);(!i||i==="locked")&&n.set(r.stageKey,"available")}),n}function io(t){const s=t?Gn(t):-1;return Wr.map(n=>{const r=n.lessons.map(b=>{const g=Gn(b.id);let S="locked";return s===-1?S=g===0?"available":"locked":g<s?S="formative-complete":g===s&&(S="available"),{...b,unitId:n.id,chapterTitle:null,status:S}}),i=r.length,a=r.filter(b=>Xs(b.status)).length,o=r.filter(b=>b.status!=="locked").length,l=Math.max(o-a,0),d=Math.max(i-o,0),c=i>0?Math.round(a/i*100):0,u=r.find(b=>b.status==="available")??r.find(b=>b.status==="formative-complete")??r[0]??null;return{id:n.id,title:n.title,description:n.summary,lessons:r,completedCount:a,unlockedCount:o,inProgressCount:l,lockedCount:d,totalCount:i,percentage:c,nextLesson:u}})}function ao(t=[]){const s=t.reduce((r,i)=>{var l;const a=i.totalCount??((l=i.lessons)==null?void 0:l.length)??0,o=i.completedCount??0;return{totalLessons:r.totalLessons+a,totalCompleted:r.totalCompleted+o}},{totalLessons:0,totalCompleted:0}),n=s.totalLessons>0?Math.round(s.totalCompleted/s.totalLessons*100):0;return{...s,overallPercentage:n}}function oo(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s.toLocaleString()}function lo(t,s){return t.startsWith("ks3")?s!=null&&s.id?{link:{pathname:"/curriculum/year7",state:{classId:s.id}},label:"Open Year 7 map"}:{link:"/curriculum/year7",label:"Explore Year 7 map"}:t==="igcse"?s!=null&&s.id?{link:{pathname:"/curriculum/igcse",state:{classId:s.id}},label:"Open IGCSE map"}:{link:"/curriculum/igcse",label:"Explore IGCSE map"}:{link:"/curriculum/ib",label:"Browse IB curriculum"}}function co(t,s,n,r){if(t.startsWith("ks3")){if(!s)return null;const i={};r!=null&&r.id&&(i.classId=r.id);const a={...i,...s.unitId?{focusUnit:s.unitId}:{}};return{link:{pathname:"/curriculum/year7",...Object.keys(a).length>0?{state:a}:{}},label:`View ${s.title}`}}if(t.startsWith("ib")){if(!(n!=null&&n.unitId))return null;const a={pathname:`/curriculum/ib/${String(n.unitId).toLowerCase()}`};return n.lessonId&&(a.state={focusStage:n.lessonId}),{link:a,label:"Join live lesson"}}return t==="igcse"?{link:{pathname:"/curriculum/igcse"},label:"View IGCSE roadmap"}:null}function uo(t,s,n,r){if(!n||n.status==="locked")return null;if(t.startsWith("ks3")){const i={};r!=null&&r.id&&(i.classId=r.id);const a={...i,...n.unitId?{focusUnit:n.unitId}:{}};return!a.focusUnit&&(s!=null&&s.id)&&(a.focusUnit=s.id),{pathname:"/curriculum/year7",...Object.keys(a).length>0?{state:a}:{}}}return n.id?`/lesson/${n.id}`:null}function ho(t,s){const n=[];t.startsWith("ks3"),n.push(_t,Nt);const r=new Set;return n.filter(i=>i&&!r.has(i.id)&&r.add(i.id)).map(i=>{const a=(s==null?void 0:s[i.id])??null;return{id:i.title,rows:eo(i,a)}}).filter(i=>i.rows.length>0)}function po(){var F;const{session:t,ready:s}=Pe(),n=mt(),{studentId:r}=fn(),i=(t==null?void 0:t.token)??null,a=((F=t==null?void 0:t.user)==null?void 0:F.role)==="teacher",[o,l]=h.useState(null),[d,c]=h.useState(null),{manifest:u}=Zt();h.useEffect(()=>{if(!s)return;if(!a){n("/",{replace:!0});return}if(!r||!i){c({tone:"error",message:"Student identifier missing."});return}let D=!0;return c({tone:"info",message:"Loading student dashboardâ€¦"}),(async()=>{try{const E=await aa(i,r);if(!D)return;l(E),c(null)}catch(E){if(!D)return;c({tone:"error",message:E.message||"Unable to load student dashboard."})}})(),()=>{D=!1}},[s,a,r,i,n]);const b=(o==null?void 0:o.student)??null,g=(o==null?void 0:o.class)??null,S=(o==null?void 0:o.classPacing)??null,x=h.useMemo(()=>(o==null?void 0:o.progress)??[],[o==null?void 0:o.progress]),A=h.useMemo(()=>S!=null&&S.lessonId?vn(S.lessonId):null,[S]),v=h.useMemo(()=>{if(!(S!=null&&S.updatedAt))return null;const D=new Date(S.updatedAt);return Number.isNaN(D.getTime())?null:D.toLocaleString()},[S==null?void 0:S.updatedAt]),j=h.useMemo(()=>{const D=new Map;for(const E of x)D.set(E.lessonSlug,vs(E.status));return D},[x]),C=((b==null?void 0:b.curriculumTrack)??"ib-sl").toLowerCase(),k=C.startsWith("ib"),R=ti(C),I=k?"/curriculum/ib":"/curriculum",w=k?"View curriculum map":"Open curriculum overview",N=h.useMemo(()=>u?si(u,j,C):[],[u,j,C]),m=N.reduce((D,E)=>D+E.totalCount,0),f=N.reduce((D,E)=>D+E.completedCount,0),p=m>0?Math.round(f/m*100):0,_=h.useMemo(()=>ni(x),[x]),O={level:null,xp:null,streak:null,totalAttempts:null,totalCorrect:null,accuracy:null};return!s||!a?null:(d==null?void 0:d.tone)==="error"&&!o?e.jsx("div",{className:"page-shell page-shell--fluid student-dashboard",children:e.jsx(Yt,{tone:"danger",children:d.message})}):(d==null?void 0:d.tone)==="info"&&!o?e.jsx("div",{className:"page-shell page-shell--fluid student-dashboard",children:e.jsx(Yt,{tone:"info",children:d.message})}):!u||!b?null:e.jsx(ri,{studentName:b.displayName??b.username??"Student",track:C,trackDisplayName:R,curriculumLink:I,curriculumCtaLabel:w,overallPercentage:p,totalCompleted:f,totalLessons:m,classInfo:g,activeStage:b.activeStage??null,pointerLesson:A,pointerUpdatedAt:v,gamification:O,unitSummaries:N,interactiveAttemptSections:[],recentUpdates:_,status:d,isIBTrack:k})}const Kn={ks3:[{label:"Year 7",state:"live",href:"/curriculum/year7"},{label:"Year 8",state:"preview"},{label:"Year 9",state:"preview"}],igcse:[{label:"IGCSE Computer Science",state:"live",href:"/curriculum/igcse"}]};function mo(){return e.jsxs(ut,{variant:"fullWidth",className:"curriculum-page",children:[e.jsxs("section",{className:"page-hero",children:[e.jsxs("div",{className:"page-hero__content",children:[e.jsx("span",{className:"page-hero__eyebrow",children:"Curriculum pathway"}),e.jsx("h1",{className:"page-hero__title",children:"Computer Science journey"}),e.jsx("p",{className:"muted",children:"A single place to preview the strands we are sequencing from Key Stage 3 through IB Computer Science. Track what is live today and what is in production for the next cohort."})]}),e.jsx("div",{className:"page-hero__actions",children:e.jsx(be,{to:"/curriculum/ib",className:"pill pill--action",children:"Explore IB curriculum map"})})]}),e.jsxs("div",{className:"curriculum-panels page-panels",children:[e.jsxs("article",{className:"curriculum-panel",children:[e.jsxs("header",{className:"curriculum-panel__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Key Stage 3"}),e.jsx("p",{className:"muted",children:"Start with the Year 7 Computing Adventure. Years 8 & 9 unlock as the sequence ships."})]}),e.jsx(Se,{tone:"info",size:"sm",children:"Rolling release"})]}),e.jsxs("div",{className:"curriculum-panel__body",children:[e.jsx("p",{children:"Our middle years pathway is being rebuilt to mirror the IB learning experience. Year 7 is ready to run today with live pacing pointers. Subsequent years follow later in the academic year."}),e.jsx("div",{className:"curriculum-buttons",children:Kn.ks3.map(t=>t.state==="live"&&t.href?e.jsxs(be,{to:t.href,className:"pill pill--live",children:[t.label,e.jsx("small",{children:"Available now"})]},t.label):e.jsxs("button",{type:"button",disabled:!0,className:"pill pill--locked",children:[t.label,e.jsx("small",{children:"Preview coming soon"})]},t.label))})]})]}),e.jsxs("article",{className:"curriculum-panel",children:[e.jsxs("header",{className:"curriculum-panel__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"IGCSE Computer Science"}),e.jsx("p",{className:"muted",children:"Content sequencing to bridge from Key Stage 4 to DP readiness."})]}),e.jsx(Se,{tone:"info",size:"sm",children:"Beta map"})]}),e.jsxs("div",{className:"curriculum-panel__body",children:[e.jsx("p",{children:"Topics 1 10 are now scaffolded into two streams so you can plan assessment pacing, live unlocks, and content authoring."}),e.jsx("div",{className:"curriculum-buttons",children:Kn.igcse.map(t=>t.state==="live"&&t.href?e.jsxs(be,{to:t.href,className:"pill pill--action",children:[t.label,e.jsx("small",{children:"Open roadmap"})]},t.label):e.jsxs("button",{type:"button",disabled:!0,className:"pill pill--locked",children:[t.label,e.jsx("small",{children:"Launch soon"})]},t.label))})]})]}),e.jsxs("article",{className:"curriculum-panel curriculum-panel--highlight",children:[e.jsxs("header",{className:"curriculum-panel__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"IB Computer Science"}),e.jsx("p",{className:"muted",children:"Full Standard and Higher Level strands with lesson unlock logic."})]}),e.jsx(Se,{tone:"success",size:"sm",children:"Live"})]}),e.jsxs("div",{className:"curriculum-panel__body",children:[e.jsx("p",{children:"Dive into the RevisionDojo-inspired experience with structured units, chapter dashboards, and lesson unlocks ready for classroom delivery."}),e.jsx("div",{className:"curriculum-buttons",children:e.jsx(be,{to:"/curriculum/ib",className:"pill pill--action",children:"Open IB curriculum map"})})]})]})]})]})}const Xn={A1:{theme:"Theme A Â· Concepts of computer science",summary:"Computer fundamentals",guidingQuestion:"What principles underpin the operation of a computer, from low-level hardware functionality to operating system interactions?",hours:{sl:"SL Â· 11 hours",hl:"HL Â· 18 hours"}},A2:{theme:"Theme A Â· Concepts of computer science",summary:"Networks",guidingQuestion:"What are the principles and concepts that underpin how networks operate?",hours:{sl:"SL Â· 11 hours",hl:"HL Â· 18 hours"}},A3:{theme:"Theme A Â· Concepts of computer science",summary:"Databases",guidingQuestion:"What are the principles, structures, and operations that form the basis of database systems?",hours:{sl:"SL Â· 11 hours",hl:"HL Â· 18 hours"}},A4:{theme:"Theme A Â· Concepts of computer science",summary:"Machine learning",guidingQuestion:"What principles and approaches should be considered to ensure machine learning models produce accurate results ethically?",hours:{sl:"SL Â· 5 hours",hl:"HL Â· 18 hours"}},B1:{theme:"Theme B Â· Computational thinking and problem-solving",summary:"Computational thinking",guidingQuestion:"How can we apply a computational solution to a real-world problem?",hours:{sl:"SL Â· 5 hours",hl:"HL Â· 5 hours"}},B2:{theme:"Theme B Â· Computational thinking and problem-solving",summary:"Programming",guidingQuestion:"How can we apply computer programming to solve problems?",hours:{sl:"SL Â· 40 hours",hl:"HL Â· 42 hours"}},B3:{theme:"Theme B Â· Computational thinking and problem-solving",summary:"Object-oriented programming",guidingQuestion:"Is object-oriented programming an appropriate paradigm for solving complex problems?",hours:{sl:"SL Â· 7 hours",hl:"HL Â· 23 hours"}},B4:{theme:"Theme B Â· Computational thinking and problem-solving",summary:"Abstract data types",guidingQuestion:"Which abstract data types are most appropriate for different situations?",hours:{hl:"HL Â· 23 hours"}}},fo={"A1.1":"Computer hardware and operation","A1.2":"Data representation and computer logic","A1.3":"Operating systems and control systems","A1.4":"Translation","A2.1":"Network fundamentals","A2.2":"Network architecture","A2.3":"Data transmissions","A2.4":"Network security","A3.1":"Database fundamentals","A3.2":"Database design","A3.3":"Database programming","A3.4":"Alternative databases and data warehouses","A4.1":"Machine learning fundamentals","A4.2":"Data preprocessing","A4.3":"Machine learning approaches","A4.4":"Ethical considerations","B1.1":"Approaches to computational thinking","B2.1":"Programming fundamentals","B2.2":"Data structures","B2.3":"Programming constructs","B2.4":"Programming algorithms","B2.5":"File processing","B3.1":"Fundamentals of OOP for a single class","B3.2":"Fundamentals of OOP for multiple classes","B4.1":"Fundamentals of ADTs"};function go(t){return t!=null&&t.tracks?Object.entries(t.tracks).filter(([s])=>s.startsWith("ib")).map(([s,n])=>({id:s,label:n.label??s,defaultLessons:n.defaultLessons??[]})):[]}function er(t,s){var r;const n=typeof t=="string"?t.toLowerCase():"";return n&&s.some(i=>i.id===n)?n:((r=s[0])==null?void 0:r.id)??"ib-sl"}function bo({lesson:t,lessonIndex:s,unit:n,subtopic:r,track:i,canViewAll:a}){if(a)return"unlocked";const o=Array.isArray(n.availableFor)?n.availableFor.includes(i):!0,l=Array.isArray(r.availableFor)?r.availableFor.includes(i):!0,d=!!t.hlOnly;return o&&l&&(!d||i==="ib-hl")?s===0?"unlocked":"locked":d?"hl-only":"locked"}function yo(){var j,C,k,R,I,w;const{session:t}=Pe(),s=Ct(),{manifest:n,status:r,error:i}=Zt(),a=((j=t==null?void 0:t.user)==null?void 0:j.role)??null,o=a==="teacher",l=a==="teacher"||a==="admin",d=o?"Teacher view":"Staff view",[c,u]=h.useState(null),b=h.useMemo(()=>go(n),[n]),g=h.useMemo(()=>{var N,m,f;return b.length?l?((m=b.find(p=>p.id==="ib-hl"))==null?void 0:m.id)??b[0].id:er((f=t==null?void 0:t.user)==null?void 0:f.curriculumTrack,b):l?"ib-hl":er((N=t==null?void 0:t.user)==null?void 0:N.curriculumTrack,[{id:"ib-sl"},{id:"ib-hl"}])},[b,l,(C=t==null?void 0:t.user)==null?void 0:C.curriculumTrack]);h.useEffect(()=>{if(!n)return;const N=n.units??[],m=()=>l||!g?N.find(f=>f.id==="A1")??N[0]:N.find(f=>f.id==="A1"?!f.availableFor||f.availableFor.includes(g):!1)??N.find(f=>!f.availableFor||f.availableFor.includes(g))??N[0];if(!c){const f=m();f&&u(f.id);return}if(!l&&g){const f=N.find(_=>_.id===c);if(!(f?!f.availableFor||f.availableFor.includes(g):!1)){const _=m();_&&u(_.id)}}},[n,c,g,l]),h.useEffect(()=>{var m;if(!n)return;const N=(m=s.state)==null?void 0:m.focusUnit;N&&u(N)},[s.state,n]);const S=h.useMemo(()=>{var N;return!n||!c?null:((N=n.units)==null?void 0:N.find(m=>m.id===c))??null},[n,c]);if(r==="loading")return e.jsx("section",{className:"ib-loading card",children:e.jsx("p",{className:"muted",children:"Loading IB curriculumâ€¦"})});if(i)return e.jsxs("section",{className:"ib-loading card",children:[e.jsx("h2",{children:"Unable to load curriculum"}),e.jsx("p",{className:"muted",children:i.message??"Please try again later."}),e.jsx("button",{type:"button",onClick:()=>{Fa(),window.location.reload()},className:"pill pill--action",children:"Try again"})]});if(!n)return null;const x=wn(n,g),A=l?`${d} Â· All content`:x?`${a==="student"?"Your track":"Viewing"}: ${x}`:null,v=S?Xn[S.id]??{}:{};return e.jsxs("div",{className:"ib-layout",children:[e.jsxs("aside",{className:"ib-sidebar",children:[e.jsxs("div",{className:"ib-sidebar__intro",children:[e.jsx("h1",{children:"IB Computer Science"}),e.jsx("p",{className:"muted",children:"Explore the structured map for Standard and Higher level learners. Select a unit to view its chapters and lesson pages."}),e.jsx(be,{to:"/curriculum",className:"ib-sidebar__back",children:"âŸµ Back to curriculum overview"})]}),e.jsx("nav",{className:"ib-sidebar__nav","aria-label":"IB units",children:(k=n.units)==null?void 0:k.map(N=>{const m=Xn[N.id]??{},f=N.id===c,p=l||!N.availableFor||N.availableFor.includes(g);return e.jsxs("button",{type:"button",className:`ib-sidebar__unit ${f?"is-active":""}`,onClick:()=>u(N.id),"aria-current":f?"true":"false",children:[e.jsx("span",{className:"ib-sidebar__unit-code",children:N.id}),e.jsx("span",{className:"ib-sidebar__unit-title",children:m.summary??N.title}),!p&&e.jsx(Se,{tone:"warning",size:"sm",children:"HL only"})]},N.id)})})]}),e.jsx("section",{className:"ib-content","aria-live":"polite",children:S?e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"ib-content__header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"ib-content__theme",children:v.theme??"IB Computer Science"}),e.jsxs("h2",{children:[S.id," Â· ",v.summary??S.title]}),v.guidingQuestion&&e.jsx("p",{className:"ib-content__guiding",children:v.guidingQuestion})]}),e.jsxs("div",{className:"ib-content__meta",children:[((R=v.hours)==null?void 0:R.sl)&&e.jsx(Se,{tone:"neutral",variant:"outline",size:"sm",children:v.hours.sl}),((I=v.hours)==null?void 0:I.hl)&&e.jsx(Se,{tone:"neutral",variant:"outline",size:"sm",children:v.hours.hl}),A&&e.jsx(Se,{tone:"info",variant:"outline",size:"sm",children:A})]})]}),S.id==="B1"?e.jsx(xo,{}):S.id==="B2"?e.jsx(vo,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ib-chapters",children:(w=S.subtopics)==null?void 0:w.map(N=>{var O;const m=fo[N.id]??N.title,f=!N.availableFor||N.availableFor.includes(g),p=!S.availableFor||S.availableFor.includes(g),_=f&&p;return e.jsxs("article",{className:"ib-chapter",children:[e.jsxs("header",{className:"ib-chapter__header",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:[N.id," Â· ",m]}),N.availableFor&&!N.availableFor.includes("ib-sl")&&e.jsx("span",{className:"ib-chapter__tag",children:"HL focus"}),e.jsx("p",{className:"muted",children:N.title})]}),e.jsxs("div",{className:"ib-chapter__actions",children:[e.jsx(Se,{as:be,to:l||_?`/topic/${encodeURIComponent(N.id)}`:"#",className:"ib-chapter__link",tone:l||_?"info":"neutral",variant:l||_?"outline":"soft",size:"sm","aria-disabled":!l&&!_,tabIndex:!l&&!_?-1:void 0,onClick:F=>{!l&&!_&&F.preventDefault()},children:"View chapter"}),!l&&!_&&e.jsx(Se,{tone:"muted",size:"sm",children:"Locked"}),l&&e.jsx(Se,{tone:"neutral",variant:"outline",size:"sm",children:d}),!l&&_&&e.jsx(Se,{tone:"info",variant:"outline",size:"sm",children:"First page unlocked"})]})]}),e.jsx("ul",{className:"ib-lessons",children:(O=N.lessons)==null?void 0:O.map((F,D)=>{const E=bo({lesson:F,lessonIndex:D,unit:S,subtopic:N,track:g,canViewAll:l}),U=E==="unlocked",z=E==="hl-only",ne=`/lesson/${encodeURIComponent(F.id)}`,Z=l||U;return e.jsxs("li",{className:`ib-lesson ib-lesson--${E}`,children:[e.jsx("span",{className:"ib-lesson__code",children:F.id}),e.jsx("span",{className:"ib-lesson__title",children:F.title}),e.jsxs("span",{className:"ib-lesson__status",children:[Z&&e.jsx(Se,{as:be,to:ne,tone:U?"success":"info",variant:"outline",size:"sm","aria-label":`Open ${F.title}`,children:l?"Open lesson":"Start lesson"}),l&&e.jsx(Se,{tone:"info",variant:"outline",size:"sm",children:d}),!l&&z&&e.jsx(Se,{tone:"warning",size:"sm",children:"HL only"}),!l&&!U&&!z&&e.jsx(Se,{tone:"muted",size:"sm",children:"Locked"})]})]},F.id)})})]},N.id)})}),e.jsxs("footer",{className:"ib-unit-assessment",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"End of unit assessment"}),e.jsxs("p",{className:"muted",children:["Finish every chapter in ",S.id," to unlock the full unit assessment and check mastery."]})]}),e.jsx("button",{type:"button",className:"pill pill--action",disabled:!0,children:"Unit assessment locked"})]})]})]}):e.jsx("div",{className:"ib-placeholder",children:e.jsx("p",{className:"muted",children:"Select a unit to explore its chapters."})})})]})}function xo(){var n;const s=(n=Ct().state)==null?void 0:n.classId;return e.jsxs("section",{className:"ib-b1-preview",children:[e.jsxs("div",{className:"ib-b1-preview__intro",children:[e.jsx("h3",{children:"Interactive pathway available"}),e.jsx("p",{className:"muted",children:"Work through staged content, formative checkpoints, and the end-of-unit assessment inside the B1 learning path. Progress and attempts save automatically on this device."})]}),e.jsx("div",{className:"ib-b1-preview__stages",children:_t.stages.map(r=>e.jsxs("article",{children:[e.jsx("h4",{children:r.title}),e.jsx("span",{children:r.duration}),e.jsx("p",{children:r.description})]},r.id))}),e.jsxs("div",{className:"ib-b1-preview__actions",children:[e.jsx(be,{to:"/curriculum/ib/b1",state:{classId:s},className:"pill pill--action",children:"Open B1 learning path"}),e.jsx("p",{className:"muted",children:"Formative assessments unlock sequentiallyâ€”teachers can track attempts from the dashboard."})]})]})}function vo(){var n;const s=(n=Ct().state)==null?void 0:n.classId;return e.jsxs("section",{className:"ib-b2-preview",children:[e.jsxs("div",{className:"ib-b2-preview__intro",children:[e.jsx("h3",{children:"Interactive pathway available"}),e.jsx("p",{className:"muted",children:"Explore staged lessons on variables, strings, exceptions, and debugging. Includes an in-browser Python playground for safe practiceâ€”progress saves locally on this device."})]}),e.jsx("div",{className:"ib-b2-preview__stages",children:Nt.stages.map(r=>e.jsxs("article",{children:[e.jsx("h4",{children:r.title}),e.jsx("span",{children:r.duration}),e.jsx("p",{children:r.description})]},r.id))}),e.jsxs("div",{className:"ib-b2-preview__actions",children:[e.jsx(be,{to:"/curriculum/ib/b2",state:{classId:s},className:"pill pill--action",children:"Open B2 learning path"}),e.jsx("span",{className:"muted",children:"Python runs in-browser using Skulptâ€”no installation required."})]})]})}const ii=[{id:"IGCSE-COMPUTER-SYSTEMS",title:"Computer Systems",summary:"Topics 1â€“6 Â· Core theory across data, hardware, software, and emerging technology.",accent:"#1d4ed8",icon:"ðŸ–¥ï¸",lessons:[{id:"IGCSE-T1",order:1,slug:"topic-1-data-representation",title:"Topic 1 Â· Data representation"},{id:"IGCSE-T2",order:2,slug:"topic-2-data-transmission",title:"Topic 2 Â· Data transmission"},{id:"IGCSE-T3",order:3,slug:"topic-3-hardware",title:"Topic 3 Â· Hardware"},{id:"IGCSE-T4",order:4,slug:"topic-4-software",title:"Topic 4 Â· Software"},{id:"IGCSE-T5",order:5,slug:"topic-5-internet-and-uses",title:"Topic 5 Â· The internet and its uses"},{id:"IGCSE-T6",order:6,slug:"topic-6-automated-and-emerging-tech",title:"Topic 6 Â· Automated and emerging technologies"}]},{id:"IGCSE-ALGORITHMS",title:"Algorithms, Programming & Logic",summary:"Topics 7â€“10 Â· Problem solving, coding practice, databases, and Boolean logic.",accent:"#0ea5e9",icon:"ðŸ§ ",lessons:[{id:"IGCSE-T7",order:7,slug:"topic-7-algorithm-design",title:"Topic 7 Â· Algorithm design and problem-solving"},{id:"IGCSE-T8",order:8,slug:"topic-8-programming",title:"Topic 8 Â· Programming"},{id:"IGCSE-T9",order:9,slug:"topic-9-databases",title:"Topic 9 Â· Databases"},{id:"IGCSE-T10",order:10,slug:"topic-10-boolean-logic",title:"Topic 10 Â· Boolean logic"}]}];ii.flatMap(t=>t.lessons.map((s,n)=>({...s,unitId:t.id,unitTitle:t.title,unitSummary:t.summary,position:n})));function jo({lessons:t}){return e.jsx("ol",{className:"igcse-unit__list",children:t.map(s=>e.jsxs("li",{className:"igcse-lesson",children:[e.jsx("span",{className:"igcse-lesson__order",children:s.order.toString().padStart(2,"0")}),e.jsxs("div",{className:"igcse-lesson__meta",children:[e.jsx("strong",{children:s.title}),e.jsx("small",{className:"muted",children:"Content coming soon"})]})]},s.id))})}function wo(){const t=h.useMemo(()=>ii,[]);return e.jsxs("div",{className:"page-shell igcse-map",children:[e.jsxs("section",{className:"igcse-hero card",children:[e.jsxs("div",{className:"igcse-hero__text",children:[e.jsx("span",{className:"igcse-hero__eyebrow",children:"Cambridge IGCSE Â· Syllabus 0478 (20260)"}),e.jsx("h1",{children:"IGCSE Computer Science roadmap"}),e.jsx("p",{className:"muted",children:"Two strands mirror the official syllabus: Computer Systems (topics 16) and Algorithms, Programming & Logic (topics 710). Use this map to plan releases, teacher pacing, and future student unlocks."})]}),e.jsxs("div",{className:"igcse-hero__status",children:[e.jsx(Se,{tone:"info",size:"sm",children:"Beta map"}),e.jsx("p",{className:"muted",children:"Lesson content placeholders are ready for authoring."})]})]}),e.jsx("div",{className:"igcse-grid",children:t.map(s=>e.jsxs("article",{className:"igcse-unit card",style:{borderTopColor:s.accent},children:[e.jsxs("header",{className:"igcse-unit__header",children:[e.jsx("div",{className:"igcse-unit__icon","aria-hidden":"true",children:s.icon}),e.jsxs("div",{className:"igcse-unit__meta",children:[e.jsx("h2",{children:s.title}),e.jsx("p",{className:"muted",children:s.summary})]})]}),e.jsx(jo,{lessons:s.lessons})]},s.id))})]})}function _o(){var A,v;const{id:t}=fn(),{session:s,ready:n}=Pe(),r=mt(),{manifest:i,loading:a}=Zt(),[o,l]=h.useState("Loading topic detailsâ€¦"),d=h.useMemo(()=>{if(!i||!t)return null;for(const j of i.units)for(const C of j.subtopics)if(C.id===t)return{...C,unitId:j.id,unitTitle:j.title,unitAvailableFor:j.availableFor??null};return null},[i,t]),u=(((A=s==null?void 0:s.user)==null?void 0:A.role)??null)==="teacher",b=h.useMemo(()=>{var C;if(u)return"ib-hl";const j=(C=s==null?void 0:s.user)==null?void 0:C.curriculumTrack;return typeof j=="string"&&j.toLowerCase().startsWith("ib")?j:"ib-sl"},[(v=s==null?void 0:s.user)==null?void 0:v.curriculumTrack,u]),g=h.useMemo(()=>{const j=wn(i,b);return u?`${j} Â· Teacher view`:j},[i,b,u]),S=h.useMemo(()=>{if(!d)return!1;if(u)return!0;const j=!d.unitAvailableFor||d.unitAvailableFor.includes(b),C=!d.availableFor||d.availableFor.includes(b);return j&&C},[d,b,u]),x=h.useMemo(()=>d?(d.lessons??[]).map((C,k)=>u?{...C,status:"unlocked",teacherUnlocked:!0}:S?C.hlOnly&&b!=="ib-hl"?{...C,status:"hl-only",teacherUnlocked:!1}:{...C,status:k===0?"unlocked":"locked",teacherUnlocked:!1}:{...C,status:"hl-only",teacherUnlocked:!1}):[],[d,S,b,u]);return h.useEffect(()=>{n&&(s?!a&&!d?l("Subtopic not found."):d&&l(""):(l("Authenticate to view topic content."),r("/",{replace:!0})))},[s,r,n,a,d]),a||!n?e.jsx("section",{className:"card topic-page",children:e.jsx("p",{className:"muted",children:"Loading topic detailsâ€¦"})}):d?e.jsxs("div",{className:"topic-page",children:[e.jsxs("nav",{className:"topic-breadcrumb",children:[e.jsx(be,{to:"/curriculum",children:"Curriculum"}),e.jsx("span",{children:"/"}),e.jsxs("span",{children:[d.unitId," ",d.unitTitle]}),e.jsx("span",{children:"/"}),e.jsx("span",{children:d.title})]}),e.jsxs("section",{className:"topic-content",children:[e.jsxs("header",{className:"topic-header",children:[e.jsxs("h1",{children:[d.id,": ",d.title]}),e.jsxs("p",{className:"muted",children:["Part of ",d.unitId,": ",d.unitTitle," Â· Viewing as ",g]}),!u&&!S&&e.jsx("p",{className:"topic-alert",children:"This chapter is part of the Higher Level pathway. Ask your teacher to unlock it."})]}),e.jsxs("div",{className:"topic-lessons",children:[e.jsx("h2",{children:"Lessons in this chapter"}),e.jsx("p",{className:"muted topic-lessons__intro",children:"First lesson is unlocked by default. Additional lessons and assessments will unlock as you progress."}),e.jsx("div",{className:"lesson-grid",children:x.map(j=>{const C=j.status==="unlocked",k=j.status==="locked",R=j.status==="hl-only",I=!!j.teacherUnlocked,w=I||C,N=m=>{w||(m.preventDefault(),alert(R?"This lesson is only available to Higher Level students.":"Complete the unlocked lesson first to continue the chapter."))};return e.jsxs(be,{to:w?`/lesson/${j.id}`:"#",className:`lesson-card ${C||I?"unlocked":""} ${!I&&(k||R)?"locked":""}`,onClick:N,"aria-disabled":!w,children:[e.jsxs("div",{className:"lesson-card__header",children:[e.jsx("span",{className:"lesson-card__number",children:j.id.split(".").pop()}),I&&e.jsx("span",{className:"badge badge--teacher",children:"Teacher view"}),!I&&R&&e.jsx("span",{className:"badge badge--hl",children:"HL only"}),C&&e.jsx("span",{className:"badge badge--unlocked",children:"Unlocked"})]}),e.jsx("h3",{className:"lesson-card__title",children:j.title}),!w&&e.jsx("div",{className:"lesson-card__lock","aria-hidden":"true",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"})})})]},j.id)})})]})]})]}):e.jsxs("section",{className:"card topic-page",children:[e.jsxs("h2",{children:["Topic ",t]}),e.jsx("p",{className:"muted",children:o}),e.jsx(be,{to:"/curriculum",children:"â† Back to Curriculum Map"})]})}const No={B1:{to:"/curriculum/ib/b1",label:"Open B1 interactive pathway"},B2:{to:"/curriculum/ib/b2",label:"Open B2 interactive pathway"}};function ko(){var w,N,m;const{lessonId:t}=fn(),{session:s}=Pe(),{manifest:n,status:r,error:i}=Zt(),a=((w=s==null?void 0:s.user)==null?void 0:w.role)??null,o=a==="teacher"||a==="admin",l=h.useMemo(()=>{if(!n||!t)return null;for(const f of n.units??[])for(const p of f.subtopics??[]){const _=p.lessons??[],O=_.findIndex(F=>F.id===t);if(O!==-1)return{unit:f,subtopic:p,lessons:_,lesson:_[O],lessonIndex:O}}return null},[n,t]),d=h.useMemo(()=>{var p;if(o)return"ib-hl";const f=(p=s==null?void 0:s.user)==null?void 0:p.curriculumTrack;return typeof f=="string"&&f.toLowerCase().startsWith("ib")?f.toLowerCase():"ib-sl"},[(N=s==null?void 0:s.user)==null?void 0:N.curriculumTrack,o]),c=h.useMemo(()=>n?wn(n,d):null,[n,d]),u=l&&l.unit?!Array.isArray(l.unit.availableFor)||l.unit.availableFor.includes(d):!1,b=l&&l.subtopic?!Array.isArray(l.subtopic.availableFor)||l.subtopic.availableFor.includes(d):!1,g=!!((m=l==null?void 0:l.lesson)!=null&&m.hlOnly),S=l?l.lessonIndex===0:!1,A=o||!!l&&u&&b&&(!g||d==="ib-hl")&&S,v=h.useMemo(()=>l?l.lessons.map((f,p)=>{const _=!!f.hlOnly,F=o||(!_||d==="ib-hl")&&u&&b&&p===0;return{...f,index:p,isCurrent:f.id===l.lesson.id,hlOnly:_,accessible:F}}):[],[l,o,u,b,d]);if(r==="loading")return e.jsx(ut,{variant:"fullWidth",className:"lesson-page",children:e.jsx("section",{className:"lesson-content",children:e.jsx("p",{className:"muted",children:"Loading lesson detailsâ€¦"})})});if(i)return e.jsx(ut,{variant:"fullWidth",className:"lesson-page",children:e.jsxs("section",{className:"lesson-content",children:[e.jsx("h2",{children:"Unable to load lesson"}),e.jsx("p",{className:"muted",children:i.message??"Please try again later."}),e.jsx(be,{to:"/curriculum/ib",className:"pill pill--action",children:"Back to IB curriculum"})]})});if(!l)return e.jsx(ut,{variant:"fullWidth",className:"lesson-page",children:e.jsxs("section",{className:"lesson-content",children:[e.jsx("h2",{children:"Lesson not found"}),e.jsxs("p",{className:"muted",children:["We could not locate lesson ",t,". Choose another chapter from the curriculum map."]}),e.jsx(be,{to:"/curriculum/ib",className:"pill pill--action",children:"Back to IB curriculum"})]})});const{unit:j,subtopic:C,lesson:k}=l,R=No[j.id]??null;let I="";return o?I="Staff view shows the full sequence regardless of unlock status.":!u||!b?I="This chapter is locked for your programme. Ask your teacher to unlock it.":g&&d!=="ib-hl"?I="This lesson is part of the Higher Level pathway.":S?I="Interactive lesson content is currently being migrated into the new gamified modules.":I="Complete the first lesson in this chapter to unlock the remaining sequence.",e.jsxs(ut,{variant:"fullWidth",className:"lesson-page",children:[e.jsxs("nav",{className:"lesson-breadcrumb","aria-label":"Breadcrumb",children:[e.jsx(be,{to:"/curriculum/ib",children:"IB curriculum"}),e.jsx("span",{children:"/"}),e.jsx(be,{to:`/topic/${encodeURIComponent(C.id)}`,children:C.id}),e.jsx("span",{children:"/"}),e.jsx("span",{children:k.id})]}),e.jsxs("div",{className:"lesson-container",children:[e.jsxs("aside",{className:"lesson-sidebar",children:[e.jsxs("div",{className:"lesson-sidebar__header",children:[e.jsxs("h3",{children:[k.id," Â· ",k.title]}),e.jsxs("p",{className:"muted",children:[j.id,": ",j.title]}),e.jsxs("p",{className:"muted",children:["Viewing as ",o?"staff":c??d.toUpperCase(),"."]}),!A&&e.jsx("span",{className:"lesson-sidebar__alert",children:"Locked for this track"}),g&&!o&&e.jsx("span",{className:"lesson-sidebar__alert",children:"Higher Level only"})]}),e.jsx("div",{className:"lesson-nav",role:"navigation","aria-label":"Lesson sequence",children:v.map(f=>{const p=["lesson-nav__item"];return f.isCurrent&&p.push("active"),f.accessible||p.push("locked"),e.jsxs(be,{to:`/lesson/${encodeURIComponent(f.id)}`,className:p.join(" "),children:[e.jsx("span",{className:"lesson-nav__number",children:f.id.split(".").pop()}),e.jsx("span",{className:"lesson-nav__title",children:f.title}),f.hlOnly&&e.jsx("span",{className:"badge badge--hl",children:"HL"})]},f.id)})}),e.jsx("div",{className:"lesson-sidebar__footer",children:e.jsx("p",{className:"small muted",children:I})})]}),e.jsxs("section",{className:"lesson-content",children:[e.jsxs("header",{className:"lesson-header",children:[e.jsx("h1",{children:k.title}),e.jsxs("div",{className:"lesson-header__meta",children:[e.jsxs("span",{className:"badge badge--primary",children:[j.id," Â· ",C.id]}),o&&e.jsx("span",{className:"badge badge--teacher",children:"Staff view"}),!o&&e.jsx("span",{className:"badge badge--muted",children:c??d.toUpperCase()}),g&&e.jsx("span",{className:"badge badge--hl",children:"Higher Level"})]})]}),e.jsxs("div",{className:"lesson-sections",children:[e.jsxs("article",{className:"lesson-section",children:[e.jsx("h2",{className:"lesson-section__title",children:"Digital lesson coming soon"}),e.jsxs("div",{className:"lesson-section__content",children:[e.jsxs("p",{children:["We are migrating lesson ",k.id," into the new gamified learning experience."," ",A?"Until the migration completes, use the unit overview or interactive module links below to cover this content.":"Ask your teacher to unlock the chapter when you are ready to continue."]}),R&&e.jsx("p",{children:e.jsx(be,{to:R.to,className:"pill pill--action",children:R.label})})]})]}),e.jsxs("article",{className:"lesson-section",children:[e.jsx("h2",{className:"lesson-section__title",children:"What you can do now"}),e.jsx("div",{className:"lesson-section__content",children:e.jsxs("ul",{children:[e.jsx("li",{children:"Review the chapter outline to keep track of the learning sequence."}),e.jsx("li",{children:"Use the interactive module previews for B1 and B2 while we migrate lessons."}),e.jsx("li",{children:"Teachers can unlock additional lessons to stage student access."})]})})]})]}),e.jsxs("div",{className:"lesson-actions",children:[e.jsx(be,{to:`/topic/${encodeURIComponent(C.id)}`,className:"btn btn--secondary",children:"â† Back to chapter"}),e.jsx(be,{to:"/curriculum/ib",className:"btn btn--primary",children:"Explore curriculum map"})]})]})]})]})}function Co(){var A,v,j,C,k,R,I;const{session:t,ready:s}=Pe(),n=mt(),r=(t==null?void 0:t.token)??null,i=((A=t==null?void 0:t.user)==null?void 0:A.role)==="admin",a=((v=t==null?void 0:t.user)==null?void 0:v.displayName)??((j=t==null?void 0:t.user)==null?void 0:j.username)??"Admin",[o,l]=h.useState(null),[d,c]=h.useState(null),[u,b]=h.useState(!1);h.useEffect(()=>{s&&(i||n("/",{replace:!0}))},[s,i,n]);const g=h.useCallback(async()=>{if(!(!r||!i)){b(!0);try{const w=await ca(r);l(w),c(null)}catch(w){c({tone:"error",message:w.message||"Failed to load admin dashboard."})}finally{b(!1)}}},[i,r]);h.useEffect(()=>{!s||!i||g()},[s,i,g]);const S=async w=>{if(w.preventDefault(),!r)return;const N=w.currentTarget,m=N.firstName.value.trim(),f=N.lastName.value.trim(),p=N.username.value.trim(),_=N.password.value;if(!m||!f||!p||!_){c({tone:"error",message:"All fields are required to create a teacher account."});return}try{c({tone:"info",message:"Creating teacherâ€¦"}),await da(r,{firstName:m,lastName:f,username:p,password:_}),N.reset(),c({tone:"success",message:`Teacher "${p}" created.`}),await g()}catch(O){c({tone:"error",message:O.message||"Failed to create teacher."})}},x=async w=>{if(!(!r||!w||!window.confirm(`Archive teacher "${w}" and their classes?`)))try{c({tone:"info",message:"Archiving teacherâ€¦"}),await ua(r,w),c({tone:"success",message:`Teacher "${w}" archived.`}),await g()}catch(m){c({tone:"error",message:m.message||"Failed to archive teacher."})}};return!s||!i?e.jsx("div",{className:"admin-grid",children:e.jsx("section",{className:"card",children:e.jsx("p",{className:"muted",children:"Preparing admin toolsâ€¦"})})}):e.jsxs("div",{className:"admin-grid",children:[e.jsxs("section",{className:"card",children:[e.jsx("header",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Admin control centre"}),e.jsx("p",{children:"Manage teacher accounts so the platform can run smoothly even if you are away."})]})}),e.jsxs("div",{className:"admin-summary",children:[e.jsxs("div",{children:[e.jsx("span",{className:"muted",children:"Signed in as"}),e.jsx("strong",{children:a})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted",children:"Active teachers"}),e.jsx("strong",{children:((C=o==null?void 0:o.teachers)==null?void 0:C.filter(w=>!w.archivedAt).length)??0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted",children:"Archived teachers"}),e.jsx("strong",{children:((k=o==null?void 0:o.teachers)==null?void 0:k.filter(w=>w.archivedAt).length)??0})]})]}),d&&e.jsx(Le,{tone:d.tone==="error"?"error":d.tone==="success"?"success":"info",children:d.message}),u&&e.jsx("p",{className:"muted",children:"Loading dataâ€¦"})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{children:"Create teacher account"}),e.jsxs("form",{onSubmit:S,className:"admin-form",children:[e.jsxs("label",{children:[e.jsx("span",{children:"First name"}),e.jsx("input",{name:"firstName",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Last name"}),e.jsx("input",{name:"lastName",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Username"}),e.jsx("input",{name:"username",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Temporary password"}),e.jsx("input",{name:"password",type:"password",required:!0})]}),e.jsx("button",{type:"submit",className:"dashboard-submit",children:"Create teacher"})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{children:"Teacher roster"}),e.jsxs("div",{className:"teacher-table",children:[e.jsxs("div",{className:"teacher-table__head",children:[e.jsx("span",{children:"Name"}),e.jsx("span",{children:"Username"}),e.jsx("span",{children:"Classes"}),e.jsx("span",{children:"Active students"}),e.jsx("span",{children:"Status"}),e.jsx("span",{})]}),e.jsxs("div",{className:"teacher-table__body",children:[((R=o==null?void 0:o.teachers)==null?void 0:R.length)===0&&e.jsx("p",{className:"muted",children:"No teacher records yet."}),(I=o==null?void 0:o.teachers)==null?void 0:I.map(w=>{var N,m;return e.jsxs("div",{className:"teacher-row",children:[e.jsx("span",{children:e.jsx("strong",{children:w.displayName})}),e.jsx("span",{children:w.username}),e.jsx("span",{children:((N=w.totals)==null?void 0:N.classes)??0}),e.jsx("span",{children:((m=w.totals)==null?void 0:m.activeStudents)??0}),e.jsx("span",{className:w.archivedAt?"muted":"badge",children:w.archivedAt?`Archived ${new Date(w.archivedAt).toLocaleDateString()}`:"Active"}),e.jsx("span",{children:e.jsx("button",{type:"button",className:"button-outline button-outline--danger",onClick:()=>x(w.username),disabled:!!w.archivedAt,children:"Archive"})})]},w.id)})]})]})]})]})}function Ps(t){return t?t.split(/[-_]/).filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function So(){const{session:t,clear:s}=Pe(),n=mt(),r=(t==null?void 0:t.user)??null,i=h.useMemo(()=>{if(!r)return[];const a=[{label:"Username",value:r.username||"â€”"},{label:"Role",value:Ps(r.role)||"â€”"},{label:"First name",value:r.firstName||"â€”"},{label:"Last name",value:r.lastName||"â€”"},{label:"Display name",value:r.displayName||"â€”"}];return r.role==="student"&&(a.push({label:"Year group",value:r.yearGroup||"â€”"}),a.push({label:"Learning track",value:Ps(r.curriculumTrack)||"â€”"}),a.push({label:"Active stage",value:Ps(r.activeStage)||"â€”"})),r.role==="teacher"&&a.push({label:"Status",value:r.archivedAt?`Archived on ${new Date(r.archivedAt).toLocaleDateString()}`:"Active"}),a},[r]);return r?e.jsx("div",{className:"page-shell",children:e.jsx("div",{className:"account-grid",children:e.jsxs("section",{className:"card",children:[e.jsxs("header",{className:"card-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Account overview"}),e.jsx("p",{children:"Personal details and role-specific permissions for your profile."})]}),e.jsx("button",{type:"button",className:"button-outline button-outline--danger",onClick:()=>{s(),n("/",{replace:!0})},children:"Sign out"})]}),e.jsx("dl",{className:"account-detail",children:i.map(a=>e.jsxs("div",{children:[e.jsx("dt",{children:a.label}),e.jsx("dd",{children:a.value})]},a.label))})]})})}):e.jsx("div",{className:"page-shell",children:e.jsx("div",{className:"account-grid",children:e.jsxs("section",{className:"card",children:[e.jsx("h2",{children:"No session found"}),e.jsxs("p",{className:"muted",children:["Please ",e.jsx(be,{to:"/",children:"return to the login screen"})," to sign in."]})]})})})}function Io({children:t}){var m,f,p,_,O,F;const{session:s,clear:n,ready:r}=Pe(),i=mt(),a=Ct(),[o,l]=h.useState(!1),[d,c]=h.useState(!1),[u,b]=h.useState(!1),g=((m=s==null?void 0:s.user)==null?void 0:m.role)??null,S=(((f=s==null?void 0:s.user)==null?void 0:f.firstName)||"").trim(),x=(((p=s==null?void 0:s.user)==null?void 0:p.displayName)||((_=s==null?void 0:s.user)==null?void 0:_.username)||"").trim(),A=S||x.split(" ")[0]||"",v=h.useMemo(()=>{if(!x)return"CS";const D=x.split(/\s+/).filter(Boolean);return D.length===0?x.slice(0,2).toUpperCase():D.length===1?D[0].slice(0,2).toUpperCase():(D[0][0]+D[D.length-1][0]).toUpperCase()},[x]),j=h.useMemo(()=>g==="teacher"?"/dashboard":g==="student"?"/student":g==="admin"?"/admin":null,[g]),C=g==="student"?(((O=s==null?void 0:s.user)==null?void 0:O.curriculumTrack)||"").toLowerCase():"",k=h.useMemo(()=>{var Z;if(!g)return[];const D=new Map,E=(P,L)=>(D.has(P)||D.set(P,{id:P,title:L,items:[]}),D.get(P)),U=E("overview","Curriculum");return U.items.push({id:"curriculum-overview",to:"/curriculum",label:"Curriculum overview",match:P=>P==="/curriculum"}),(g==="teacher"||g==="admin"||C.startsWith("ks3")||(((Z=s==null?void 0:s.user)==null?void 0:Z.yearGroup)??"").toLowerCase().includes("year 7"))&&U.items.push({id:"year7-map",to:"/curriculum/year7",label:"Year 7 map",match:P=>P.startsWith("/curriculum/year7")}),(g==="teacher"||g==="admin"||C.startsWith("ib"))&&U.items.push({id:"ib-map",to:"/curriculum/ib",label:"IB curriculum map",match:P=>P.startsWith("/curriculum/ib")||P.startsWith("/topic")||P.startsWith("/lesson")}),(g==="teacher"||g==="admin")&&E("dashboards","Dashboards").items.push({id:"teacher-dashboard",to:"/dashboard",label:"Teacher dashboard",match:L=>L.startsWith("/dashboard")}),g==="student"&&E("student","My learning").items.push({id:"student-space",to:"/student",label:"Student space",match:L=>L.startsWith("/student")}),g==="admin"&&E("admin","Admin").items.push({id:"admin-panel",to:"/admin",label:"Admin panel",match:L=>L.startsWith("/admin")}),Array.from(D.values()).filter(P=>P.items.length>0)},[g,C,(F=s==null?void 0:s.user)==null?void 0:F.yearGroup]),R=h.useCallback(()=>{n(),l(!1),b(!1),a.pathname!=="/"&&i("/",{replace:!0})},[n,i,a.pathname]);h.useEffect(()=>{l(!1),b(!1)},[a.pathname]);const I=h.useMemo(()=>{if(!g)return[];const D=[];return j&&D.push({type:"link",to:j,label:"My dashboard"}),D.push({type:"link",to:"/account",label:"My account"}),D.push({type:"action",label:"Log out",onClick:R}),D},[g,j,R]),w=D=>{D.currentTarget.contains(D.relatedTarget)||l(!1)},N=r&&!!g;return e.jsxs("div",{className:`layout-root${d?" layout-root--collapsed":""}${u?" layout-root--nav-open":""}`,children:[N&&e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"layout-sidebar","aria-label":"Primary navigation",children:[e.jsxs("div",{className:"layout-sidebar__header",children:[e.jsxs(be,{to:"/curriculum",className:"layout-brand","aria-label":"Computer Science Department home",children:[e.jsx("img",{src:zs,alt:"School crest",className:"layout-brand__mark"}),e.jsxs("div",{className:"layout-brand__text",children:[e.jsx("span",{className:"layout-brand__title",children:"Computer Science Department"}),e.jsx("small",{className:"layout-brand__subtitle",children:"St Georges British International Schools Group Germany"})]})]}),e.jsx("button",{type:"button",className:"layout-sidebar__collapse",onClick:()=>c(D=>!D),"aria-pressed":d,"aria-label":d?"Expand navigation":"Collapse navigation",children:e.jsx("span",{"aria-hidden":"true"})})]}),e.jsx("div",{className:"layout-sidebar__sections",children:k.map(D=>e.jsxs("div",{className:"layout-sidebar__section",children:[e.jsx("p",{className:"layout-sidebar__section-title",children:D.title}),e.jsx("nav",{children:D.items.map(E=>{const U=E.match?E.match(a.pathname):a.pathname===E.to;return e.jsxs(be,{to:E.to,className:`layout-sidebar__nav-item ${U?"is-active":""}`,"aria-current":U?"page":void 0,onClick:()=>b(!1),children:[e.jsx("span",{className:"layout-sidebar__nav-bullet","aria-hidden":"true",children:E.label.charAt(0)}),e.jsx("span",{className:"layout-sidebar__nav-text",children:E.label})]},E.id)})})]},D.id))}),e.jsxs("div",{className:"layout-sidebar__footer",children:[e.jsxs("div",{className:"layout-sidebar__user",children:[e.jsx("span",{className:"layout-sidebar__avatar","aria-hidden":"true",children:v}),e.jsxs("div",{className:"layout-sidebar__user-meta",children:[e.jsx("strong",{children:x||"Account"}),e.jsx("span",{className:"text-muted",children:g??""})]})]}),e.jsx("button",{type:"button",className:"layout-sidebar__signout",onClick:R,children:"Log out"})]})]}),e.jsx("button",{type:"button",className:"layout-sidebar__scrim","aria-hidden":!u,onClick:()=>b(!1)})]}),e.jsxs("div",{className:"layout-scaffold",children:[e.jsxs("header",{className:"layout-topbar",children:[e.jsx("div",{className:"layout-topbar__left",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"layout-topbar__nav-toggle show-mobile",onClick:()=>b(D=>!D),"aria-label":u?"Close navigation":"Open navigation","aria-pressed":u,children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx("span",{className:"layout-topbar__title",children:"Computer Science Department"})]}):e.jsxs(be,{to:"/",className:"layout-brand layout-brand--inline","aria-label":"Computer Science Department home",children:[e.jsx("img",{src:zs,alt:"School crest",className:"layout-brand__mark"}),e.jsxs("div",{className:"layout-brand__text",children:[e.jsx("span",{className:"layout-brand__title",children:"Computer Science Department"}),e.jsx("small",{className:"layout-brand__subtitle",children:"St Georges British International Schools Group Germany"})]})]})}),e.jsxs("div",{className:"layout-topbar__actions",children:[r&&!N&&e.jsx(be,{to:"/",className:"layout-login-link",children:"Log in"}),r&&N&&e.jsxs("div",{className:"layout-account",onBlur:w,children:[e.jsxs("button",{type:"button",className:"layout-account__button",onClick:()=>l(D=>!D),"aria-haspopup":"menu","aria-expanded":o,children:[e.jsx("span",{className:"layout-account__avatar","aria-hidden":"true",children:v}),e.jsx("span",{className:"layout-account__greeting",children:A?`Hi, ${A}`:"Account"}),e.jsx("svg",{className:"layout-account__chevron",viewBox:"0 0 12 8","aria-hidden":"true",children:e.jsx("path",{d:"M1 1.5 6 6.5 11 1.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})]}),o&&e.jsx("div",{className:"layout-account__menu",role:"menu",children:I.map(D=>D.type==="link"?e.jsx(be,{to:D.to,role:"menuitem",children:D.label},D.label):e.jsx("button",{type:"button",onClick:D.onClick,role:"menuitem",children:D.label},D.label))})]})]})]}),e.jsx("main",{className:"layout-main",children:t}),e.jsx("footer",{className:"layout-footer",children:e.jsxs("small",{children:["Â© ",new Date().getFullYear()," Computer Science Department Â· All curriculum in progress."]})})]})]})}function qe({attemptStats:t}){if(!t)return null;const s=t.count??0,n=t.correct??0,r=t.last??{},i=Number.isFinite(r.correct)?r.correct:null,a=Number.isFinite(r.total)&&r.total>0?r.total:null,o=r.success;return e.jsxs("span",{className:"gamified-attempt-badge",children:["Attempts: ",s,e.jsx("span",{"aria-hidden":"true",children:" Â· "}),"Cleared: ",n,a!==null&&a>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{"aria-hidden":"true",children:" Â· "}),"Last score: ",i??0,"/",a]}),o===!1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{"aria-hidden":"true",children:" Â· "}),"Try again"]})]})}function Ao(t,s){switch(t.type){case"true-false":return{correct:!!s==!!t.answer,details:{selected:s}};case"mcq":return{correct:s===t.answer,details:{selected:s,correctAnswer:t.answer}};case"multi-select":{const n=Array.isArray(t.answers)?t.answers:[],r=Array.isArray(s)?s:[],i=[...n].sort(),a=[...r].sort();return{correct:i.length===a.length&&i.every((l,d)=>l===a[d]),details:{selected:r,correctAnswers:n}}}default:return{correct:!1,details:{}}}}function Es(t,s,n){if(!n)return"idle";if(t.type==="true-false"){const r=s;return r===n.details.selected?n.correct?"correct":"incorrect":n.correct&&r===t.answer?"correct":"idle"}if(t.type==="mcq")return s===n.details.selected?s===t.answer?"correct":"incorrect":s===t.answer?"correct":"idle";if(t.type==="multi-select"){const r=n.details.selected??[],i=n.details.correctAnswers??[];return r.includes(s)&&i.includes(s)?"correct":r.includes(s)&&!i.includes(s)?"incorrect":!r.includes(s)&&i.includes(s)?"missed":"idle"}return"idle"}function To({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){var j,C;const[o,l]=h.useState({}),[d,c]=h.useState(!1),[u,b]=h.useState({}),[g,S]=h.useState(null),x=((j=t.questions)==null?void 0:j.length)??0,A=h.useMemo(()=>{var k;return(k=t.questions)==null?void 0:k.some(R=>{const I=o[R.id];return R.type==="multi-select"?!Array.isArray(I)||I.length===0:I==null||I===""})},[o,t.questions]),v=k=>{if(k.preventDefault(),d)return;if(A){S({tone:"error",message:"Answer every question before checking."});return}const R={};let I=0;t.questions.forEach(N=>{const m=Ao(N,o[N.id]);R[N.id]=m,m.correct&&(I+=1)}),b(R);const w=I===x;S({tone:w?"success":"error",message:w?"Perfect! XP incoming.":"Review the highlights and try again."}),r(t.id,{success:w,correctCount:I,totalCount:x,onAdvance:w?()=>{c(!0),n()}:null}),w&&c(!0)};return e.jsxs("article",{className:`gamified-card ${(g==null?void 0:g.tone)==="success"?"is-success":""}`,children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("form",{className:"gamified-micro-quiz",onSubmit:v,children:[(C=t.questions)==null?void 0:C.map(k=>{var I,w;const R=u[k.id];return e.jsxs("fieldset",{className:`gamified-micro-question ${R?R.correct?"is-correct":"is-incorrect":""}`,disabled:d&&!a,children:[e.jsx("legend",{children:k.prompt}),k.type==="true-false"&&e.jsx("div",{className:"gamified-micro-options",children:[!0,!1].map(N=>e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Es(k,N,R)}`,children:[e.jsx("input",{type:"radio",name:k.id,value:String(N),checked:o[k.id]===N,onChange:()=>{l(m=>({...m,[k.id]:N})),S(null),c(!1)}}),e.jsx("span",{children:N?"True":"False"})]},String(N)))}),k.type==="mcq"&&e.jsx("div",{className:"gamified-micro-options",children:(I=k.options)==null?void 0:I.map(N=>e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Es(k,N.id,R)}`,children:[e.jsx("input",{type:"radio",name:k.id,value:N.id,checked:o[k.id]===N.id,onChange:()=>{l(m=>({...m,[k.id]:N.id})),S(null),c(!1)}}),e.jsx("span",{children:N.label})]},N.id))}),k.type==="multi-select"&&e.jsx("div",{className:"gamified-micro-options",children:(w=k.options)==null?void 0:w.map(N=>{const m=Array.isArray(o[k.id])?o[k.id].includes(N.id):!1;return e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Es(k,N.id,R)}`,children:[e.jsx("input",{type:"checkbox",value:N.id,checked:m,onChange:f=>{const p=f.target.checked;l(_=>{let F=[...Array.isArray(_[k.id])?_[k.id]:[]];return p?F.includes(N.id)||F.push(N.id):F=F.filter(D=>D!==N.id),{..._,[k.id]:F}}),S(null),c(!1)}}),e.jsx("span",{children:N.label})]},N.id)})}),R&&!R.correct&&k.rationale&&e.jsx("p",{className:"gamified-feedback",children:k.rationale})]},k.id)}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx("div",{className:"gamified-segment-actions",children:e.jsx("button",{type:"submit",className:"btn btn--primary",disabled:d&&!a,children:"Check answers"})})]})]}),g&&e.jsx("p",{className:`gamified-feedback ${g.tone==="error"?"is-error":"is-success"}`,children:g.message})]})}function en(t){const s=Array.isArray(t)?[...t]:[];for(let n=s.length-1;n>0;n-=1){const r=Math.floor(Math.random()*(n+1));[s[n],s[r]]=[s[r],s[n]]}return s}function De({children:t,layout:s="horizontal",align:n="start",className:r=""}){const i=["button-group",`button-group--${s}`,`button-group--align-${n}`,r].filter(Boolean).join(" ");return e.jsx("div",{className:i,role:"group",children:t})}function Mo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const o=h.useMemo(()=>en(t.pairs.map(x=>x.example)),[t.pairs]),[l,d]=h.useState(()=>t.pairs.map(()=>({selection:""}))),[c,u]=h.useState(null),[b,g]=h.useState(!1),S=()=>{if(b)return;if(!l.every(j=>j.selection)){u({tone:"error",message:"Select an example for each term."});return}const A=l.filter((j,C)=>j.selection===t.pairs[C].example).length,v=A===t.pairs.length;u({tone:v?"success":"error",message:v?"Perfect match!":"Something is mismatchedâ€”check the hints."}),r(t.id,{success:v,correctCount:A,totalCount:t.pairs.length,onAdvance:v?()=>{g(!0),n()}:null}),v&&g(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsx("div",{className:"activity-matching",children:t.pairs.map((x,A)=>e.jsxs("label",{className:"activity-matching__row",children:[e.jsx("span",{className:"activity-matching__term",children:x.term}),e.jsxs("select",{value:l[A].selection,disabled:b&&!a,onChange:v=>{const j=v.target.value;d(C=>{const k=[...C];return k[A]={selection:j},k}),u(null)},children:[e.jsx("option",{value:"",children:"Select exampleâ€¦"}),o.map(v=>e.jsx("option",{value:v,children:v},v))]})]},x.term))}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:S,disabled:b&&!a,children:"Check answers"})})]}),c&&e.jsx(Le,{tone:c.tone==="error"?"error":"success",children:c.message})]})}function Po({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const o=h.useMemo(()=>(t.items??[]).map((I,w)=>({id:`${t.id}-${w}`,text:I,correctIndex:w})),[t.id,t.items]),[l,d]=h.useState(()=>en(o)),[c,u]=h.useState(null),[b,g]=h.useState(null),[S,x]=h.useState(!1),[A,v]=h.useState(null);h.useEffect(()=>{d(en(o)),x(!1),v(null)},[o]);const j=(I,w)=>{I!==w&&(d(N=>{const m=[...N],f=m.findIndex(O=>O.id===I),p=m.findIndex(O=>O.id===w);if(f===-1||p===-1)return N;const[_]=m.splice(f,1);return m.splice(p,0,_),m}),v(null))},C=I=>{d(w=>{const N=[...w],m=N.findIndex(p=>p.id===I);if(m===-1)return w;const[f]=N.splice(m,1);return N.push(f),N}),v(null)},k=(I,w)=>{const N=I+w;N<0||N>=l.length||(d(m=>{const f=[...m],[p]=f.splice(I,1);return f.splice(N,0,p),f}),v(null))},R=()=>{if(S)return;const I=l.filter((N,m)=>N.correctIndex===m).length,w=I===l.length;v({tone:w?"success":"error",message:w?"Sequence locked in!":"Some steps are out of order."}),r(t.id,{success:w,correctCount:I,totalCount:l.length,onAdvance:w?()=>{x(!0),n()}:null}),w&&x(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:"activity-ordering",children:[e.jsx("p",{className:"activity-ordering__hint",children:"Drag and drop each card into the correct sequence. Use the arrow buttons if you prefer keyboard controls."}),e.jsxs("ul",{className:"activity-ordering__list",children:[l.map((I,w)=>{const N=I.correctIndex===w,m=b===I.id&&c!==I.id,f=!S||a;return e.jsxs("li",{className:`activity-ordering__card${S?N?" is-correct":" is-incorrect":""}${m?" is-drop-target":""}`,draggable:f,onDragStart:()=>f&&u(I.id),onDragEnter:()=>f&&c&&g(I.id),onDragOver:p=>{f&&(p.preventDefault(),c&&I.id!==c&&g(I.id))},onDragEnd:()=>{u(null),g(null)},onDrop:p=>{f&&(p.preventDefault(),c&&j(c,I.id),u(null),g(null))},children:[e.jsx("span",{className:"activity-ordering__index",children:w+1}),e.jsx("span",{className:"activity-ordering__text",children:I.text}),e.jsxs("div",{className:"activity-ordering__actions",children:[e.jsx("button",{type:"button",className:"activity-ordering__action",onClick:()=>k(w,-1),disabled:!f||w===0,"aria-label":`Move "${I.text}" up`,children:"â†‘"}),e.jsx("button",{type:"button",className:"activity-ordering__action",onClick:()=>k(w,1),disabled:!f||w===l.length-1,"aria-label":`Move "${I.text}" down`,children:"â†“"})]})]},I.id)}),c&&e.jsx("li",{className:`activity-ordering__dropzone${b==="end"?" is-drop-target":""}`,onDragOver:I=>{I.preventDefault(),c&&g("end")},onDragEnter:()=>g("end"),onDrop:I=>{I.preventDefault(),c&&C(c),u(null),g(null)},children:"Drop here to move to the end"})]})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:R,disabled:S&&!a,children:"Check order"})})]}),A&&e.jsx(Le,{tone:A.tone==="error"?"error":"success",children:A.message})]})}function Eo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const[o,l]=h.useState(()=>t.targets.map(j=>({targetId:j.id,tokenId:null}))),[d,c]=h.useState(null),[u,b]=h.useState(!1),[g,S]=h.useState(null),x=o.map(j=>j.tokenId).filter(Boolean),A=j=>{d&&(l(C=>C.map(k=>k.targetId===j?{...k,tokenId:d}:k.tokenId===d?{...k,tokenId:null}:k)),c(null),S(null))},v=()=>{if(u)return;if(o.some(I=>!I.tokenId)){S({tone:"error",message:"Place every token on a target."});return}let C=0;const k=new Map(o.map(I=>[I.targetId,I.tokenId]));t.targets.forEach(I=>{I.answer===k.get(I.id)&&(C+=1)});const R=C===t.targets.length;S({tone:R?"success":"error",message:R?"All targets matched!":"Check the highlighted tokens and retry."}),r(t.id,{success:R,correctCount:C,totalCount:t.targets.length,onAdvance:R?()=>{b(!0),n()}:null}),R&&b(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:"activity-dragdrop",children:[e.jsx("div",{className:"activity-dragdrop__bank","aria-label":"Token bank",children:t.tokens.map(j=>{const C=x.includes(j.id);return e.jsx("button",{type:"button",className:`activity-dragdrop__token${C?" is-picked":""}${d===j.id?" is-selected":""}`,onClick:()=>{if(C){l(k=>k.map(R=>R.tokenId===j.id?{...R,tokenId:null}:R)),S(null);return}c(k=>k===j.id?null:j.id)},children:j.label},j.id)})}),e.jsx("div",{className:"activity-dragdrop__targets",children:t.targets.map(j=>{const C=o.find(I=>I.targetId===j.id),k=t.tokens.find(I=>I.id===(C==null?void 0:C.tokenId)),R=(k==null?void 0:k.id)===j.answer;return e.jsx("button",{type:"button",className:`activity-dragdrop__target${C!=null&&C.tokenId?" is-filled":""}${u?R?" is-correct":" is-incorrect":""}`,onClick:()=>A(j.id),disabled:u&&!a,children:e.jsxs("div",{children:[e.jsx("strong",{children:j.prompt}),e.jsx("div",{children:k?k.label:"Tap to assign"})]})},j.id)})})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:v,disabled:u&&!a,children:"Check matches"})})]}),g&&e.jsx(Le,{tone:g.tone==="error"?"error":"success",children:g.message})]})}const Lo=/\[\[([^[\]]+)\]\]/g;function Oo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const o=h.useMemo(()=>t.blanks??[],[t.blanks]),[l,d]=h.useState({}),[c,u]=h.useState(()=>o.reduce((F,D)=>(F[D.id]=null,F),{})),[b,g]=h.useState(null),[S,x]=h.useState(null),[A,v]=h.useState(!1),[j,C]=h.useState(null),k=h.useMemo(()=>{const F=[];let D=0;const E=t.text??"";return E.replace(Lo,(U,z,ne)=>(ne>D&&F.push({type:"text",value:E.slice(D,ne)}),F.push({type:"blank",id:z}),D=ne+U.length,U)),D<E.length&&F.push({type:"text",value:E.slice(D)}),F},[t.text]),R=t.interaction??t.mode??"select",I=R==="drag"||R==="tokens",w=h.useMemo(()=>{if(!I)return[];if(Array.isArray(t.tokens)&&t.tokens.length>0)return t.tokens;const F=new Map;return o.forEach(D=>{(D.options??[]).forEach(E=>{const U=typeof E=="string"?E:E.id,z=typeof E=="string"?E:E.label;U&&!F.has(U)&&F.set(U,z??U)})}),Array.from(F.entries()).map(([D,E])=>({id:D,label:E}))},[o,t.tokens,I]),N=h.useMemo(()=>new Set(Object.values(c||{}).filter(Boolean)),[c]),m=!A||a;h.useEffect(()=>{d({}),u(o.reduce((F,D)=>(F[D.id]=null,F),{})),g(null),x(null),v(!1),C(null)},[o,I,t.text]);const f=F=>{if(m){if(N.has(F)){u(D=>{const E={...D};return Object.keys(E).forEach(U=>{E[U]===F&&(E[U]=null)}),E}),g(null),C(null);return}g(D=>D===F?null:F),C(null)}},p=(F,D)=>{!m||!D||(u(E=>{const U={...E};return Object.keys(U).forEach(z=>{U[z]===D&&(U[z]=null)}),U[F]=D,U}),g(null),C(null))},_=F=>{u(D=>{const E={...D};return E[F]=null,E}),C(null)},O=()=>{if(A)return;let F=0;if(I){if(o.some(U=>!c[U.id])){C({tone:"error",message:"Place every token before checking."});return}o.forEach(U=>{c[U.id]===U.answer&&(F+=1)})}else{if(o.some(U=>!l[U.id])){C({tone:"error",message:"Fill every blank before checking."});return}o.forEach(U=>{l[U.id]===U.answer&&(F+=1)})}const D=F===o.length;C({tone:D?"success":"error",message:D?"Sentence complete!":"Check the highlighted blanks and try again."}),r(t.id,{success:D,correctCount:F,totalCount:o.length,onAdvance:D?()=>{v(!0),n()}:null}),D&&v(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:`activity-gapfill${I?" activity-gapfill--tokens":""}`,children:[I&&e.jsx("div",{className:"activity-gapfill__bank","aria-label":"Word bank",children:w.map(F=>{const D=N.has(F.id),E=b===F.id||S===F.id;return e.jsx("button",{type:"button",className:`activity-gapfill__token${D?" is-assigned":""}${E?" is-selected":""}`,disabled:A&&!a,onClick:()=>f(F.id),draggable:m&&!D,onDragStart:U=>{!m||D||(U.dataTransfer.setData("text/plain",F.id),U.dataTransfer.effectAllowed="move",g(F.id),x(F.id))},onDragEnd:()=>{x(null),g(null)},children:F.label},F.id)})}),e.jsx("p",{className:"activity-gapfill__text",children:k.map((F,D)=>{if(F.type==="text")return e.jsx(h.Fragment,{children:F.value},`text-${D}`);const E=o.find(Z=>Z.id===F.id)??{id:F.id,options:[]};if(!E)return null;if(I){const Z=c[E.id],P=w.find(J=>J.id===Z),L=A&&(P==null?void 0:P.id)===E.answer,Q=A&&P&&P.id!==E.answer;return e.jsx("span",{className:`activity-gapfill__blank activity-gapfill__blank--drop${L?" is-correct":""}${Q?" is-incorrect":""}`,children:e.jsx("button",{type:"button",className:"activity-gapfill__drop",disabled:A&&!a,onClick:()=>{b?p(E.id,b):Z&&_(E.id)},onDragOver:J=>{m&&J.preventDefault()},onDrop:J=>{if(!m)return;J.preventDefault();const ie=J.dataTransfer.getData("text/plain")||b;p(E.id,ie),x(null)},children:P?P.label:"Drop word"})},E.id)}const U=l[E.id]??"",z=A&&U===E.answer,ne=A&&U&&U!==E.answer;return e.jsx("span",{className:`activity-gapfill__blank${z?" is-correct":""}${ne?" is-incorrect":""}`,children:e.jsxs("select",{value:U,disabled:A&&!a,onChange:Z=>{d(P=>({...P,[E.id]:Z.target.value})),C(null)},children:[e.jsx("option",{value:"",children:"Selectâ€¦"}),(E.options??[]).map(Z=>e.jsx("option",{value:Z.id,children:Z.label},Z.id))]})},E.id)})})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:O,disabled:A&&!a,children:"Check sentence"})})]}),j&&e.jsx(Le,{tone:j.tone==="error"?"error":"success",children:j.message})]})}function Ro({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){var x,A;const[o,l]=h.useState([]),[d,c]=h.useState(!1),[u,b]=h.useState(null),g=v=>{d&&!a||(l(j=>j.includes(v)?j.filter(C=>C!==v):[...j,v]),b(null))},S=()=>{const v=new Set(t.correctHotspots??[]),j=new Set(o);let C=0;t.hotspots.forEach(R=>{const I=v.has(R.id),w=j.has(R.id);I===w&&(C+=1)});const k=C===t.hotspots.length;b({tone:k?"success":"error",message:k?"Hotspots identified!":"Check the highlighted hotspots and retry."}),r(t.id,{success:k,correctCount:k?t.hotspots.length:C,totalCount:t.hotspots.length,onAdvance:k?()=>{c(!0),n()}:null}),k&&c(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:"activity-hotspot",children:[e.jsx("img",{src:(x=t.image)==null?void 0:x.src,alt:((A=t.image)==null?void 0:A.alt)??""}),t.hotspots.map((v,j)=>{const C=o.includes(v.id),k=(t.correctHotspots??[]).includes(v.id),R=["activity-hotspot__point",C?"is-selected":"",d&&C&&!k?"is-incorrect":""].filter(Boolean).join(" ");return e.jsx("button",{type:"button",className:R,style:{"--hotspot-x":`${v.x}%`,"--hotspot-y":`${v.y}%`},onClick:()=>g(v.id),children:j+1},v.id)})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:S,disabled:d&&!a,children:"Check hotspots"})})]}),u&&e.jsx(Le,{tone:u.tone==="error"?"error":"success",children:u.message})]})}function Bo({segment:t,onComplete:s,onBack:n,plannerValues:r={},onPlannerSave:i,isTeacher:a,attemptStats:o,onAttempt:l}){const d=t.panels??[],[c,u]=h.useState(null),[b,g]=h.useState(()=>d.every(j=>{const C=r[j.id];return typeof C=="string"&&C.trim().length>0})),S=(j,C)=>{i==null||i(j,C),u(null)},x=()=>{const j=d.length||1;g(!0),l==null||l(t.id,{success:!0,correctCount:j,totalCount:j,onAdvance:()=>{s()}})},A=j=>{if(j.preventDefault(),!d.every(k=>{const R=r[k.id];return typeof R=="string"&&R.trim().length>0})){u({tone:"error",message:"Complete every panel before locking the planner."});return}x()},v=()=>{x()};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),t.instructions&&e.jsx("p",{children:t.instructions}),e.jsx(qe,{attemptStats:o})]}),e.jsxs("form",{className:"activity-planner",onSubmit:A,children:[d.map(j=>e.jsxs("label",{className:"activity-planner__panel",children:[e.jsx("span",{children:j.label}),e.jsx("textarea",{value:r[j.id]??"",onChange:C=>S(j.id,C.target.value),rows:4,disabled:b&&!a})]},j.id)),e.jsxs("div",{className:"gamified-segment-nav",children:[n?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:n,children:"Back"}):e.jsx("span",{}),e.jsxs(De,{align:"end",children:[a&&e.jsx("button",{type:"button",className:"btn btn--outline",onClick:v,children:"Mark complete"}),!b&&e.jsx("button",{type:"submit",className:"btn btn--primary",disabled:b&&!a,children:"Lock planner"})]})]}),c&&e.jsx(Le,{tone:c.tone==="error"?"error":"success",children:c.message})]})]})}function Do({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const o=h.useMemo(()=>t.categories??[],[t.categories]),l=h.useMemo(()=>t.tokens??[],[t.tokens]),[d,c]=h.useState(()=>l.reduce((f,p)=>(f[p.id]=null,f),{})),[u,b]=h.useState(null),[g,S]=h.useState(null),[x,A]=h.useState(!1),[v,j]=h.useState(null);h.useEffect(()=>{c(l.reduce((f,p)=>(f[p.id]=null,f),{})),b(null),S(null),A(!1),j(null)},[l,o,t.id]);const C=!x||a,k=h.useMemo(()=>new Set(Object.keys(d).filter(f=>d[f])),[d]),R=l.filter(f=>!k.has(f.id)),I=(f,p)=>{!C||!f||(c(_=>({..._,[f]:p})),b(null),j(null))},w=f=>{c(p=>({...p,[f]:null})),b(null),j(null)},N=()=>{if(x)return;const f=l.length;if(l.some(F=>!d[F.id])){j({tone:"error",message:"Classify every card before checking."});return}let _=0;l.forEach(F=>{d[F.id]===F.answer&&(_+=1)});const O=_===f;j({tone:O?"success":"error",message:O?"Everything is in the right bucket!":"Some cards need to move. Check the highlights."}),r(t.id,{success:O,correctCount:_,totalCount:f,onAdvance:O?()=>{A(!0),n()}:null}),O&&A(!0)},m=h.useMemo(()=>o.reduce((f,p)=>(f[p.id]=l.filter(_=>d[_.id]===p.id),f),{}),[d,o,l]);return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:"activity-classification",children:[e.jsxs("div",{className:"activity-classification__bank","aria-label":"Token bank",children:[R.map(f=>{const p=u===f.id||g===f.id;return e.jsx("button",{type:"button",className:`activity-classification__token${p?" is-selected":""}`,disabled:x&&!a,onClick:()=>{C&&(b(_=>_===f.id?null:f.id),j(null))},draggable:C,onDragStart:_=>{C&&(_.dataTransfer.setData("text/plain",f.id),_.dataTransfer.effectAllowed="move",S(f.id),b(f.id))},onDragEnd:()=>{S(null),b(null)},children:f.label},f.id)}),R.length===0&&e.jsx("span",{className:"activity-classification__bank-empty",children:"All cards placed"})]}),e.jsx("div",{className:"activity-classification__categories",children:o.map(f=>{const p=m[f.id]??[];return e.jsxs("section",{className:"activity-classification__category",onDragOver:_=>{C&&_.preventDefault()},onDrop:_=>{if(!C)return;_.preventDefault();const O=_.dataTransfer.getData("text/plain")||u;I(O,f.id),S(null)},children:[e.jsxs("header",{children:[e.jsx("h4",{children:f.title}),f.description&&e.jsx("p",{className:"muted",children:f.description})]}),e.jsxs("div",{className:"activity-classification__slots",children:[p.map(_=>{const O=x&&_.answer===f.id,F=x&&_.answer!==f.id;return e.jsx("button",{type:"button",className:`activity-classification__chip${O?" is-correct":""}${F?" is-incorrect":""}`,disabled:x&&!a,onClick:()=>{C&&w(_.id)},children:_.label},_.id)}),p.length===0&&e.jsx("span",{className:"activity-classification__placeholder",children:"Drop cards here"})]})]},f.id)})})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:N,disabled:x&&!a,children:"Check categories"})})]}),v&&e.jsx(Le,{tone:v.tone==="error"?"error":"success",children:v.message})]})}const Fo=/\[\[([^[\]]+)\]\]/g;function Uo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const[o,l]=h.useState({}),[d,c]=h.useState(!1),[u,b]=h.useState(null),g=h.useMemo(()=>t.placeholders??[],[t.placeholders]),S=h.useMemo(()=>g.reduce((C,k)=>(C[k.id]=k,C),{}),[g]),x=h.useMemo(()=>{const C=t.code??"",k=[];let R=0;return C.replace(Fo,(I,w,N)=>(N>R&&k.push({type:"code",value:C.slice(R,N)}),k.push({type:"blank",id:w}),R=N+I.length,I)),R<C.length&&k.push({type:"code",value:C.slice(R)}),k},[t.code]);h.useEffect(()=>{l({}),c(!1),b(null)},[t.id,t.code]);const A=!d||a,v=(C,k)=>{if(!k)return!1;const R=k.trimInput===!1?C:C.trim();return k.caseSensitive===!1?R.toLowerCase()===k.answer.toLowerCase():R===k.answer},j=C=>{if(C.preventDefault(),d)return;const k=g.length;if(g.some(N=>{const m=o[N.id];return m==null||m===""})){b({tone:"error",message:"Fill every placeholder before checking."});return}let I=0;g.forEach(N=>{v(o[N.id],N)&&(I+=1)});const w=I===k;b({tone:w?"success":"error",message:w?"Code compiled! Every placeholder is correct.":"Review the highlighted slots and retry."}),r(t.id,{success:w,correctCount:I,totalCount:k,onAdvance:w?()=>{c(!0),n()}:null}),w&&c(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("form",{className:"activity-code",onSubmit:j,children:[t.prompt&&e.jsx("p",{className:"activity-code__prompt",children:t.prompt}),e.jsx("pre",{className:"activity-code__block",children:e.jsx("code",{children:x.map((C,k)=>{if(C.type==="code")return e.jsx(h.Fragment,{children:C.value},`code-${k}`);const R=S[C.id];if(!R)return null;const I=o[R.id]??"",w=d&&v(I,R),N=d&&!v(I,R);return e.jsx("span",{className:`activity-code__blank${w?" is-correct":""}${N?" is-incorrect":""}`,children:e.jsx("input",{type:"text",value:I,disabled:!A,onChange:m=>{const f=m.target.value;l(p=>({...p,[R.id]:f})),b(null)},placeholder:R.placeholder??"â€¦","aria-label":R.label??`Fill placeholder ${R.id}`})},R.id)})})}),g.some(C=>C.hint)&&e.jsx("ul",{className:"activity-code__hints",children:g.map(C=>C.hint&&e.jsxs("li",{children:[e.jsxs("strong",{children:[C.label??C.id,":"]})," ",C.hint]},`${C.id}-hint`))}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"submit",className:"btn btn--primary",disabled:d&&!a,children:"Check code"})})]}),u&&e.jsx(Le,{tone:u.tone==="error"?"error":"success",children:u.message})]})]})}function $o({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){const o=h.useMemo(()=>t.items??[],[t.items]),[l,d]=h.useState(()=>new Set),[c,u]=h.useState(!1),[b,g]=h.useState(null);h.useEffect(()=>{d(new Set),u(!1),g(null)},[t.id]);const S=!c||a,x=h.useMemo(()=>new Set(o.filter(j=>j.isError).map(j=>j.id)),[o]),A=j=>{S&&(d(C=>{const k=new Set(C);return k.has(j)?k.delete(j):k.add(j),k}),g(null))},v=()=>{if(c)return;const j=o.length,C=o.filter(R=>{const I=l.has(R.id),w=!!R.isError;return I===w}).length,k=C===j;g({tone:k?"success":"error",message:k?"Bug hunt complete!":"Some choices are off. Review the highlights and try again."}),r(t.id,{success:k,correctCount:C,totalCount:j,onAdvance:k?()=>{u(!0),n()}:null}),k&&u(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsx("div",{className:"activity-spot",children:o.map((j,C)=>{const k=l.has(j.id),R=x.has(j.id),I=c?R?" is-correct":k?" is-incorrect":"":k?" is-selected":"";return e.jsxs("button",{type:"button",className:`activity-spot__item${I}`,disabled:!S,onClick:()=>A(j.id),children:[e.jsx("span",{className:"activity-spot__badge",children:C+1}),e.jsx("span",{className:"activity-spot__text",children:j.text}),c&&j.explanation&&e.jsx("span",{className:"activity-spot__explanation",children:j.explanation})]},j.id)})}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:v,disabled:c&&!a,children:"Check answers"})})]}),b&&e.jsx(Le,{tone:b.tone==="error"?"error":"success",children:b.message})]})}function Wo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){var m,f;const o=h.useMemo(()=>t.tokens??[],[t.tokens]),l=h.useMemo(()=>t.targets??[],[t.targets]),[d,c]=h.useState(()=>l.reduce((p,_)=>(p[_.id]=null,p),{})),[u,b]=h.useState(null),[g,S]=h.useState(null),[x,A]=h.useState(!1),[v,j]=h.useState(null);h.useEffect(()=>{c(l.reduce((p,_)=>(p[_.id]=null,p),{})),b(null),S(null),A(!1),j(null)},[l,o,t.id]);const C=!x||a,k=h.useMemo(()=>new Set(Object.values(d).filter(Boolean)),[d]),R=o.filter(p=>!k.has(p.id)),I=(p,_)=>{!C||!_||(c(O=>({...O,[p]:_})),b(null),j(null))},w=p=>{c(_=>({..._,[p]:null})),j(null)},N=()=>{if(x)return;const p=l.length;if(l.some(D=>!d[D.id])){j({tone:"error",message:"Label every hotspot before checking."});return}let O=0;l.forEach(D=>{d[D.id]===D.answer&&(O+=1)});const F=O===p;j({tone:F?"success":"error",message:F?"All labels are correct!":"Some labels need adjusting. Review the highlights."}),r(t.id,{success:F,correctCount:O,totalCount:p,onAdvance:F?()=>{A(!0),n()}:null}),F&&A(!0)};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),e.jsx(qe,{attemptStats:i}),t.instructions&&e.jsx("p",{children:t.instructions})]}),e.jsxs("div",{className:"activity-diagram",children:[e.jsxs("div",{className:"activity-diagram__bank","aria-label":"Label tokens",children:[R.map(p=>{const _=u===p.id||g===p.id;return e.jsx("button",{type:"button",className:`activity-diagram__token${_?" is-selected":""}`,disabled:x&&!a,onClick:()=>{C&&(b(O=>O===p.id?null:p.id),j(null))},draggable:C,onDragStart:O=>{C&&(O.dataTransfer.setData("text/plain",p.id),O.dataTransfer.effectAllowed="move",b(p.id),S(p.id))},onDragEnd:()=>{b(null),S(null)},children:p.label},p.id)}),R.length===0&&e.jsx("span",{className:"activity-diagram__placeholder",children:"All labels placed"})]}),e.jsxs("div",{className:"activity-diagram__canvas",children:[e.jsx("img",{src:(m=t.image)==null?void 0:m.src,alt:((f=t.image)==null?void 0:f.alt)??""}),l.map(p=>{const _=d[p.id],O=o.find(E=>E.id===_),F=x&&(O==null?void 0:O.id)===p.answer,D=x&&O&&O.id!==p.answer;return e.jsx("button",{type:"button",className:`activity-diagram__target${F?" is-correct":""}${D?" is-incorrect":""}`,style:{"--target-x":`${p.x}%`,"--target-y":`${p.y}%`},disabled:x&&!a,onClick:()=>{C&&(u?I(p.id,u):_&&w(p.id))},onDragOver:E=>{C&&E.preventDefault()},onDrop:E=>{if(!C)return;E.preventDefault();const U=E.dataTransfer.getData("text/plain")||u;I(p.id,U),S(null)},children:O?O.label:"Drop label"},p.id)})]})]}),e.jsxs("div",{className:"gamified-segment-nav",children:[s?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:s,children:"Back"}):e.jsx("span",{}),e.jsx(De,{align:"end",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:N,disabled:x&&!a,children:"Check labels"})})]}),v&&e.jsx(Le,{tone:v.tone==="error"?"error":"success",children:v.message})]})}function Go(t){const{segment:s}=t;switch(s.activityType){case"matching":return e.jsx(Mo,{...t});case"ordering":return e.jsx(Po,{...t});case"drag-drop":return e.jsx(Eo,{...t});case"gap-fill":return e.jsx(Oo,{...t});case"image-hotspot":return e.jsx(Ro,{...t});case"planner":return e.jsx(Bo,{...t});case"classification":return e.jsx(Do,{...t});case"code-completion":return e.jsx(Uo,{...t});case"spot-error":return e.jsx($o,{...t});case"diagram-label":return e.jsx(Wo,{...t});default:return e.jsxs("article",{className:"gamified-card",children:[e.jsx("header",{children:e.jsx("h3",{children:s.heading})}),e.jsx("p",{children:"This activity type is coming soon."})]})}}function js({onBack:t,onComplete:s,completeLabel:n="Continue",completeDisabled:r=!1}){return e.jsxs("div",{className:"gamified-segment-nav",children:[t?e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:t,children:"Back"}):e.jsx("span",{}),e.jsx("div",{className:"gamified-segment-actions",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:s,disabled:r,children:n})})]})}function Ho(t){var s,n,r,i;switch(t.type){case"content":return e.jsx("div",{className:"gamified-card__body",children:t.body});case"list":return e.jsx("div",{className:"gamified-card__body gamified-card__body--list",children:(s=t.items)==null?void 0:s.map(a=>e.jsxs("div",{className:"gamified-list-item",children:[e.jsx("h4",{children:a.title}),e.jsx("div",{children:a.body})]},a.title))});case"table":return e.jsx("div",{className:"gamified-table-wrapper",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:(n=t.columns)==null?void 0:n.map(a=>e.jsx("th",{children:a},a))})}),e.jsx("tbody",{children:(r=t.rows)==null?void 0:r.map((a,o)=>e.jsx("tr",{children:a.map((l,d)=>e.jsx("td",{children:l},d))},o))})]})});case"accordion":return e.jsx("div",{className:"gamified-accordion",children:(i=t.items)==null?void 0:i.map((a,o)=>e.jsxs("details",{open:o===0,children:[e.jsx("summary",{children:a.title}),e.jsx("div",{children:a.body})]},a.title))});default:return e.jsx("div",{className:"gamified-card__body",children:t.body??e.jsx(h.Fragment,{})})}}function tr({segment:t,onComplete:s,onBack:n}){return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),t.subheading&&e.jsx("p",{className:"muted",children:t.subheading})]}),Ho(t),e.jsx(js,{onBack:n,onComplete:s})]})}function qo({segment:t,onBack:s,onComplete:n}){const r=t.demoComponent;return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),t.description&&e.jsx("p",{children:t.description})]}),e.jsx("div",{className:"gamified-card__body",children:r?e.jsx(r,{}):e.jsx("p",{children:"Demo coming soon."})}),e.jsx(js,{onBack:s,onComplete:n})]})}function Vo(t){var n,r;const s=((n=Gt.builtinFiles)==null?void 0:n.files)??((r=Gt.builtinFiles)==null?void 0:r.files);if(!s||!s[t])throw new Error(`File not found: ${t}`);return s[t]}function Yo(t){const s=[],n=/\{\{([^}]+)\}\}/g;let r=0;const i=t.snippet;return i.replace(n,(a,o,l)=>(l>r&&s.push({type:"text",value:i.slice(r,l)}),s.push({type:"blank",id:o.trim()}),r=l+a.length,a)),r<i.length&&s.push({type:"text",value:i.slice(r)}),s}function zo({segment:t,onBack:s,onComplete:n,onAttempt:r,attemptStats:i,isTeacher:a}){var F;const[o,l]=h.useState(()=>t.starterCode??""),[d,c]=h.useState(""),[u,b]=h.useState("idle"),[g,S]=h.useState(!1),[x,A]=h.useState(!1),v=h.useRef(null),[j,C]=h.useState({}),[k,R]=h.useState(null),[I,w]=h.useState(!1);h.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[d]),h.useEffect(()=>{l(t.starterCode??""),c(""),b("idle"),S(!1),A(!1),C({}),R(null),w(!1)},[t.id,t.starterCode]);const N=h.useMemo(()=>t.fillTasks??[],[t.fillTasks]),m=h.useMemo(()=>N.map(D=>({...D,parts:Yo(D)})),[N]),f=async()=>{S(!0),c(""),b("idle");try{Gt.configure({output:D=>c(E=>E+D),read:Vo,__future__:{print_function:!0,division:!0},python3:!0}),await Gt.misceval.asyncToPromise(()=>Gt.importMainWithBody("<stdin>",!1,o,!0)),b("success"),A(!0)}catch(D){const E=D!=null&&D.toString?D.toString():String(D);c(U=>U+(U.endsWith(`
`)||U.length===0?"":`
`)+E),b("error")}finally{S(!1)}},p=D=>{const E=typeof D=="string"?D:D==null?void 0:D.code;if(!E)return;const U=o.length>0&&!o.endsWith(`
`);l(z=>`${z}${U?`
`:""}${E}`)},_=()=>{l(t.starterCode??""),c(""),b("idle"),S(!1),A(!1)},O=()=>{if(m.some(ne=>ne.parts.filter(Z=>Z.type==="blank").some(Z=>!j[`${ne.id}:${Z.id}`]))){R({tone:"error",message:"Complete every blank in the snippets."});return}let E=0;m.forEach(ne=>{ne.parts.filter(Z=>Z.type==="blank").forEach(Z=>{var L;const P=`${ne.id}:${Z.id}`;j[P]===((L=ne.answers)==null?void 0:L[Z.id])&&(E+=1)})});const U=m.reduce((ne,Z)=>ne+Z.parts.filter(P=>P.type==="blank").length,0),z=E===U;R({tone:z?"success":"error",message:z?"Snippets complete!":"Check the highlights and retry."}),r(t.id,{success:z,correctCount:E,totalCount:U,onAdvance:z?()=>{w(!0),n()}:null}),z&&w(!0)};return e.jsxs("article",{className:"gamified-card gamified-card--python",children:[e.jsxs("header",{children:[e.jsxs("div",{children:[e.jsx("h3",{children:t.heading}),t.prompt&&e.jsx("p",{children:t.prompt})]}),e.jsx(qe,{attemptStats:i})]}),e.jsxs("div",{className:"python-playground",children:[e.jsxs("div",{className:"python-playground__editor",children:[e.jsx("label",{htmlFor:`${t.id}-editor`,className:"python-playground__label",children:"Python editor"}),e.jsx("textarea",{id:`${t.id}-editor`,value:o,onChange:D=>l(D.target.value),spellCheck:!1,className:"python-playground__textarea"}),e.jsx("div",{className:"python-playground__actions",children:e.jsxs(De,{align:"start",children:[e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:_,disabled:g,children:"Reset starter"}),e.jsx("button",{type:"button",className:"btn btn--outline",onClick:f,disabled:g,children:g?"Runningâ€¦":"Run code"})]})}),((F=t.examples)==null?void 0:F.length)>0&&e.jsxs("div",{className:"python-playground__examples",children:[e.jsx("span",{children:"Run example:"}),t.examples.map(D=>e.jsx("button",{type:"button",className:"pill pill--outline",onClick:()=>p(D.code),children:D.label},D.id))]})]}),e.jsxs("div",{className:`python-playground__console python-playground__console--${u}`,children:[e.jsxs("header",{children:[e.jsx("span",{children:"Console"}),u==="success"&&e.jsx("span",{className:"console-status is-success",children:"Ran successfully"}),u==="error"&&e.jsx("span",{className:"console-status is-error",children:"Runtime error"})]}),e.jsx("pre",{ref:v,children:d||"Run the code to see output here."})]})]}),m.length>0&&e.jsxs("div",{className:"python-playground__fill",children:[e.jsx("h4",{children:"Snippet challenge"}),m.map(D=>e.jsx("code",{className:"python-playground__snippet",children:D.parts.map((E,U)=>{var J,ie;if(E.type==="text")return e.jsx("span",{children:E.value},`text-${U}`);const z=((J=D.options)==null?void 0:J[E.id])??[],ne=`${D.id}:${E.id}`,Z=j[ne]??"",P=(ie=D.answers)==null?void 0:ie[E.id],L=I&&Z===P,Q=I&&Z&&Z!==P;return e.jsx("span",{className:`python-playground__blank${L?" is-correct":""}${Q?" is-incorrect":""}`,children:e.jsxs("select",{value:Z,disabled:I&&!a,onChange:G=>{C(ee=>({...ee,[ne]:G.target.value})),R(null)},children:[e.jsx("option",{value:"",children:"?"}),z.map(G=>e.jsx("option",{value:G.id,children:G.label},G.id))]})},ne)})},D.id)),e.jsx("button",{type:"button",className:"btn btn--primary",onClick:O,disabled:I&&!a,children:"Check snippets"}),k&&e.jsx(Le,{tone:k.tone==="error"?"error":"success",children:k.message})]}),e.jsx(js,{onBack:s,onComplete:()=>{N.length?I||a?n():R({tone:"error",message:"Complete the snippet challenge before continuing."}):x||a?n():R({tone:"error",message:"Run the code at least once before continuing."})},completeLabel:!N.length&&!x&&!a?"Run code to continue":"Continue"})]})}const Jo=["Great job!","Well done!","XP unlocked!","Keep the streak going!"],Zo=["Almost there!","Give it another shot!","Check the hints and retry."];function Qo(t){const s=t?Jo:Zo;return s[Math.floor(Math.random()*s.length)]}function Ko({success:t,correctCount:s,totalCount:n,xpAward:r,onClose:i,onContinue:a}){h.useEffect(()=>{const l=d=>{d.key==="Escape"&&(i==null||i()),d.key==="Enter"&&(a==null||a())};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[i,a]);const o=Qo(t);return e.jsxs("div",{className:`results-modal ${t?"is-success":"is-error"}`,children:[e.jsx("button",{type:"button",className:"results-modal__backdrop",onClick:i,"aria-label":"Close results modal",tabIndex:-1}),e.jsxs("div",{className:"results-modal__card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t?"Checkpoint cleared!":"Keep going!"}),e.jsx("p",{children:o})]}),e.jsxs("div",{className:"results-modal__stats",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Score"}),e.jsxs("strong",{children:[s,"/",n]})]}),e.jsxs("div",{children:[e.jsx("span",{children:"XP gained"}),e.jsx("strong",{children:r})]})]}),e.jsxs("div",{className:"results-modal__actions",children:[e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:i,children:"Close"}),e.jsx("button",{type:"button",className:"btn btn--primary",onClick:a,children:"Next"})]})]})]})}function Xo({segment:t,onBack:s,onComplete:n,onSave:r,isTeacher:i,initialValue:a=""}){const[o,l]=h.useState(a??"");h.useEffect(()=>{l(a??"")},[t.id,a]);const d=()=>{r&&r(t.id,o),n()};return e.jsxs("article",{className:"gamified-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.heading}),t.prompt&&e.jsx("p",{children:t.prompt})]}),e.jsx("textarea",{rows:6,value:o,onChange:c=>l(c.target.value),placeholder:"Capture your reflections hereâ€¦"}),e.jsx(js,{onBack:s,onComplete:d,completeLabel:i?"Mark complete":"Save reflection"})]})}const el=4e3;function tl(t){switch((t||"not-started").toLowerCase()){case"completed":return"Completed";case"in-progress":return"In Progress";default:return"Not Started"}}function sl({classId:t,unitId:s,segment:n,stage:r,isLastStage:i,nextStageTitle:a,advanceState:o,advanceError:l,onShowAssessment:d,onAdvancePacing:c}){const{session:u}=Pe(),b=u==null?void 0:u.token,g=n==null?void 0:n.id,[S,x]=h.useState([]),[A,v]=h.useState({completed:0,"in-progress":0,"not-started":0}),[j,C]=h.useState(!0),[k,R]=h.useState(null);h.useEffect(()=>{if(!b||!t||!s||!g){x([]),v({completed:0,"in-progress":0,"not-started":0});return}let _=!1,O;async function F(D=!1){D&&(C(!0),R(null));try{const E=await Rr(b,t,{unitId:s,segmentId:g});if(_)return;x(Array.isArray(E==null?void 0:E.students)?E.students:[]),v((E==null?void 0:E.summary)||{completed:0,"in-progress":0,"not-started":0}),R(null)}catch(E){if(_)return;console.warn("Failed to load live assessment status",E),R((E==null?void 0:E.message)||"Unable to load live progress right now.")}finally{_||C(!1)}}return F(!0),O=setInterval(F,el),()=>{_=!0,O&&clearInterval(O)}},[b,t,s,g]);const I=h.useMemo(()=>{const _=S.length,O=typeof A.completed=="number"?A.completed:S.filter(E=>E.status==="completed").length,F=typeof A["in-progress"]=="number"?A["in-progress"]:S.filter(E=>E.status==="in-progress").length,D=Math.max(_-O-F,0);return{totalStudents:_,completed:O,inProgress:F,notStarted:D}},[S,A]),w=h.useMemo(()=>[...S].sort((_,O)=>{const F=(_.displayName||_.username||"").toLowerCase(),D=(O.displayName||O.username||"").toLowerCase();return F<D?-1:F>D?1:0}),[S]),N=i?"Complete Unit":a?`Unlock ${a}`:"Unlock Next Stage",m=o==="pending",f=(n==null?void 0:n.heading)||(n==null?void 0:n.title)||"Formative Check",p=(r==null?void 0:r.title)||(r==null?void 0:r.id)||"Current Stage";return e.jsxs("div",{className:"live-assessment-dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:p}),e.jsx("p",{className:"dashboard-subtitle",children:f})]}),e.jsxs("div",{className:"summary",children:[e.jsx("span",{children:`Completion: ${I.completed} / ${I.totalStudents}`}),e.jsx("progress",{value:I.totalStudents>0?I.completed:0,max:Math.max(I.totalStudents,1)})]})]}),e.jsxs("div",{className:"dashboard-meta",children:[e.jsxs("span",{className:"meta-pill meta-pill--complete",children:["Completed: ",I.completed]}),e.jsxs("span",{className:"meta-pill meta-pill--progress",children:["In progress: ",I.inProgress]}),e.jsxs("span",{className:"meta-pill meta-pill--idle",children:["Not started: ",I.notStarted]})]}),e.jsxs("div",{className:"dashboard-controls",children:[e.jsx("button",{onClick:d,className:"control-button",children:"Show Assessment View"}),e.jsx("button",{onClick:c,className:"control-button primary",disabled:!c||m,children:m?"Unlocking...":N})]}),(j||k||l)&&e.jsxs("div",{className:"dashboard-alerts",children:[j&&e.jsx("span",{className:"alert-note",children:"Loading live statusâ€¦"}),k&&e.jsx("span",{className:"alert-error",children:k}),!k&&l&&e.jsx("span",{className:"alert-error",children:l})]}),e.jsx("div",{className:"student-grid-container",children:e.jsxs("table",{className:"student-progress-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Student"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Attempts"}),e.jsx("th",{children:"Score"}),e.jsx("th",{children:"Last Updated"})]})}),e.jsx("tbody",{children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"table-empty",children:j?"Waiting for student activityâ€¦":"No student attempts recorded yet."})}):w.map(_=>{const O=`status-${(_.status||"not-started").toLowerCase().replace(/\s+/g,"-")}`,F=typeof _.attempts=="number"?_.attempts:0,D=typeof _.score=="number"?`${_.score}%`:"â€”",E=_.lastUpdated?new Date(_.lastUpdated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"â€”";return e.jsxs("tr",{className:O,children:[e.jsx("td",{children:_.displayName||_.username||"Student"}),e.jsxs("td",{children:[e.jsx("span",{className:"status-indicator"}),tl(_.status)]}),e.jsx("td",{children:F}),e.jsx("td",{children:D}),e.jsx("td",{children:E})]},_.id)})})]})})]})}const ai=h.createContext(),nl=({children:t})=>{const[s,n]=h.useState(!1),[r,i]=h.useState({unitId:null,lessonId:null}),a=()=>{n(l=>!l)},o=h.useMemo(()=>({isPresentationMode:s,togglePresentationMode:a,currentPacing:r,setCurrentPacing:i}),[s,r]);return e.jsx(ai.Provider,{value:o,children:t})},rl=()=>{const t=h.useContext(ai);if(t===void 0)throw new Error("useTeacherMode must be used within a TeacherModeProvider");return t},tn=2,il=2500,ls="__assessment__";function kt(t=null){return!t||typeof t!="object"?{status:"not-started",responses:{},marks:{},teacherNotes:{},updatedAt:null}:{status:t.status??"not-started",responses:t.responses??{},marks:t.marks??{},teacherNotes:t.teacherNotes??{},updatedAt:t.updatedAt??null}}const sr="__autoAttempts";function al(t){if(!t||typeof t!="object")return"all";if(t.audience){const s=String(t.audience).toLowerCase();if(s==="teacher"||s==="student"||s==="all")return s}return t.teacherOnly?"teacher":t.studentOnly?"student":"all"}function ol(t,{isTeacher:s}){if(!t||t.hidden)return!1;const n=al(t);return n==="teacher"?!!s:n==="student"?!s||!!t.allowTeacherPreview:!0}function nr(t,s){var n,r,i;if(!t)return{correct:!1,details:{}};switch(t.type){case"true-false":{const a=!!t.answer,o=!!s;return{correct:a===o,details:{selected:o,answer:a}}}case"mcq":{const a=t.answer??((r=(n=t.options)==null?void 0:n.find(o=>o.isCorrect))==null?void 0:r.id)??null;return{correct:a!=null&&s===a,details:{selected:s,answer:a}}}case"multi-select":{const a=Array.isArray(t.answers)?[...t.answers].sort():((i=t.options)==null?void 0:i.filter(d=>d.isCorrect).map(d=>d.id).sort())??[],o=Array.isArray(s)?[...s].sort():[];return{correct:a.length===o.length&&a.every((d,c)=>d===o[c]),details:{selected:o,answers:a}}}default:return{correct:!1,details:{}}}}function Ls(t,s,n){if(!n)return"idle";if(t.type==="true-false")return s===n.details.selected?n.correct?"correct":"incorrect":n.correct&&s===n.details.answer?"correct":"idle";if(t.type==="mcq")return s===n.details.selected?s===n.details.answer?"correct":"incorrect":s===n.details.answer?"correct":"idle";if(t.type==="multi-select"){const r=n.details.selected??[],i=n.details.answers??[];return r.includes(s)&&i.includes(s)?"correct":r.includes(s)&&!i.includes(s)?"incorrect":!r.includes(s)&&i.includes(s)?"missed":"idle"}return"idle"}function ll({assessment:t,normalizedState:s,onResponseChange:n,onMarkChange:r,onStatusChange:i,isTeacher:a}){const o=t==null?void 0:t.questions,l=h.useMemo(()=>Array.isArray(o)?o:[],[o]),[d,c]=h.useState(null),u=h.useMemo(()=>s.responses??{},[s.responses]),b=h.useMemo(()=>s.marks??{},[s.marks]),g=s.status??"not-started",S=Number(u[sr]??0),x=t==null?void 0:t.instructions,A=h.useMemo(()=>l.reduce((I,w)=>I+Number(w.points??1),0),[l]),v=h.useMemo(()=>l.reduce((I,w)=>{const N=b==null?void 0:b[w.id],m=Number(N);return I+(Number.isFinite(m)?m:0)},0),[b,l]),j=h.useMemo(()=>g!=="completed"?{}:l.reduce((I,w)=>(I[w.id]=nr(w,u[w.id]),I),{}),[g,u,l]),C=h.useMemo(()=>l.every(I=>{const w=u[I.id];return I.type==="multi-select"?Array.isArray(w)&&w.length>0:w!=null&&w!==""}),[u,l]);h.useEffect(()=>{if(g==="completed"){const I=v===A&&A>0;c({tone:I?"success":"info",message:I?"Perfect score! Fantastic work.":`You scored ${v}/${A}. Review the highlights and retry if needed.`})}else c(null)},[g,v,A]);const k=I=>{if(I.preventDefault(),g==="completed"){c({tone:"info",message:"Assessment already submitted. Use Retake to try again."});return}if(!C){c({tone:"error",message:"Answer every question before checking."});return}let w=0;l.forEach(m=>{const f=nr(m,u[m.id]),p=Number(m.points??1),_=f.correct?p:0;w+=_,r(m.id,_)}),n(sr,String(S+1)),i("completed");const N=w===A&&A>0;c({tone:N?"success":"info",message:N?"Perfect score! Fantastic work.":`You scored ${w}/${A}. Review the highlights and retry if needed.`})},R=()=>{l.forEach(I=>{const w=I.type==="multi-select"?[]:null;n(I.id,w),r(I.id,0)}),i("in-progress"),c(null)};return e.jsxs("div",{className:"gamified-assessment__body",children:[e.jsx("div",{className:"gamified-assessment__intro",children:e.jsx("p",{children:x||"Answer the multiple-choice questions below. You can retake the assessment to improve your score."})}),e.jsxs("form",{className:"gamified-micro-quiz",onSubmit:k,children:[l.map(I=>{var f,p;const w=j[I.id],N=g==="completed",m=u[I.id];return e.jsxs("fieldset",{className:`gamified-micro-question ${w?w.correct?"is-correct":"is-incorrect":""}`,disabled:N&&!a,children:[e.jsx("legend",{children:I.prompt}),I.type==="true-false"&&e.jsx("div",{className:"gamified-micro-options",children:[!0,!1].map(_=>e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Ls(I,_,w)}`,children:[e.jsx("input",{type:"radio",name:I.id,value:String(_),checked:!!m===_,onChange:()=>{n(I.id,_),g==="completed"&&i("in-progress")}}),e.jsx("span",{children:_?"True":"False"})]},String(_)))}),I.type==="mcq"&&e.jsx("div",{className:"gamified-micro-options",children:(f=I.options)==null?void 0:f.map(_=>e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Ls(I,_.id,w)}`,children:[e.jsx("input",{type:"radio",name:I.id,value:_.id,checked:m===_.id,onChange:()=>{n(I.id,_.id),g==="completed"&&i("in-progress")}}),e.jsx("span",{children:_.label})]},_.id))}),I.type==="multi-select"&&e.jsx("div",{className:"gamified-micro-options",children:(p=I.options)==null?void 0:p.map(_=>{const O=Array.isArray(m)?m.includes(_.id):!1;return e.jsxs("label",{className:`gamified-micro-option gamified-micro-option--${Ls(I,_.id,w)}`,children:[e.jsx("input",{type:"checkbox",value:_.id,checked:O,onChange:F=>{const D=F.target.checked,E=Array.isArray(m)?m:[],U=D?[...new Set([...E,_.id])]:E.filter(z=>z!==_.id);n(I.id,U),g==="completed"&&i("in-progress")}}),e.jsx("span",{children:_.label})]},_.id)})}),w&&!w.correct&&I.rationale&&e.jsx("p",{className:"gamified-feedback",children:I.rationale})]},I.id)}),e.jsxs("div",{className:"gamified-segment-nav",children:[e.jsx("span",{}),e.jsxs("div",{className:"gamified-segment-actions",children:[e.jsx("button",{type:"submit",className:"btn btn--primary",disabled:g==="completed",children:"Check answers"}),g==="completed"&&e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:R,children:"Retake assessment"})]})]})]}),e.jsxs("aside",{className:"gamified-assessment__teacher gamified-assessment__teacher--hint",children:[e.jsx("h3",{children:"Assessment status"}),e.jsxs("p",{children:["Score: ",v," / ",A]}),e.jsxs("p",{className:"muted",children:["Attempts: ",S]}),d?e.jsx("p",{className:`gamified-feedback ${d.tone==="error"?"is-error":""}`,children:d.message}):e.jsx("p",{className:"muted",children:"Submit your answers to calculate a score."}),a&&e.jsx("p",{className:"small muted",children:"Teachers see aggregated analytics on the dashboard. Students can retry to improve their score until you reset the unit."})]})]})}function rr(t,s){const n={version:tn,stages:{},reflections:{},planner:{},attempts:{},assessment:kt()};if(typeof window>"u")return n;const{data:r}=Kr(t.id,s);return!r||typeof r!="object"?n:{...n,...r,version:tn,assessment:kt(r.assessment)}}function cl(t,s){var n,r,i,a;switch(s.type){case"hydrate":return{...t,...s.payload??{}};case"segment-progress":{const{stageId:o,nextIndex:l,completed:d}=s.payload,c=((n=t.stages)==null?void 0:n[o])??{segmentIndex:0,completed:!1},u={segmentIndex:Math.max(c.segmentIndex,l),completed:d?!0:c.completed};return{...t,stages:{...t.stages,[o]:u}}}case"reflection":{const{id:o,value:l}=s.payload;return{...t,reflections:{...t.reflections,[o]:l}}}case"planner":{const{id:o,value:l}=s.payload;return{...t,planner:{...t.planner,[o]:l}}}case"attempt":{const{segmentId:o,success:l}=s.payload,d=Number(((r=s.payload)==null?void 0:r.correctCount)??0),c=Number(((i=s.payload)==null?void 0:i.totalCount)??0),u=((a=t.attempts)==null?void 0:a[o])??{count:0,correct:0},b={count:u.count+1,correct:u.correct+(l?1:0),lastResult:l?"correct":"incorrect",last:{correct:d,total:c,success:!!l},updatedAt:Date.now()};return{...t,attempts:{...t.attempts,[o]:b}}}case"assessment-response":{const{questionId:o,value:l}=s.payload,d=kt(t.assessment);return{...t,assessment:{...d,responses:{...d.responses,[o]:l},updatedAt:Date.now()}}}case"assessment-mark":{const{questionId:o,value:l}=s.payload,d=kt(t.assessment);return{...t,assessment:{...d,marks:{...d.marks,[o]:l},updatedAt:Date.now()}}}case"assessment-note":{const{questionId:o,value:l}=s.payload,d=kt(t.assessment);return{...t,assessment:{...d,teacherNotes:{...d.teacherNotes,[o]:l},updatedAt:Date.now()}}}case"assessment-status":{const{status:o}=s.payload,l=kt(t.assessment);return{...t,assessment:{...l,status:typeof o=="string"&&o.length>0?o:l.status,updatedAt:Date.now()}}}default:return t}}function oi({unit:t,classId:s}){var at,ft,Ve,$e,Xe,Ye,ot;const{state:n,awardXp:r,resetStreak:i}=xs(),{session:a}=Pe(),{isPresentationMode:o,togglePresentationMode:l,setCurrentPacing:d}=rl(),c=((at=a==null?void 0:a.user)==null?void 0:at.role)==="teacher"||((ft=a==null?void 0:a.user)==null?void 0:ft.role)==="admin",u=(($e=(Ve=a==null?void 0:a.user)==null?void 0:Ve.username)==null?void 0:$e.toLowerCase())||"guest",[b,g]=h.useState({}),[S,x]=h.useState(null),A=c?s:(Xe=a==null?void 0:a.user)==null?void 0:Xe.classId,v=!!t.assessment,j=h.useMemo(()=>{if(!v)return t.stages;const se={id:ls,title:t.assessment.title??"End-of-unit assessment",duration:t.assessment.duration??"45 min",description:t.assessment.summary??`Summative checkpoint worth ${t.assessment.totalMarks??0} marks.`,isAssessment:!0};return[...t.stages,se]},[t,v]),[C,k]=h.useReducer(cl,{unit:t,profileKey:u},({unit:se,profileKey:X})=>rr(se,X)),R=t.programmeLabel??"IB Computer Science";h.useEffect(()=>{if(!A||!(a!=null&&a.token)){x(null);return}let se=!0;const X=async()=>{try{const oe=c?await bn(a.token,A):await ds(a.token,A);if(!se)return;x((oe==null?void 0:oe.pacing)??null)}catch(oe){if(!se)return;c||console.warn("Failed to fetch class pacing",oe)}};if(X(),!c){const oe=setInterval(X,5e3);return()=>{se=!1,clearInterval(oe)}}return()=>{se=!1}},[c,A,a==null?void 0:a.token,t.id]);const I=h.useRef(u),w=h.useRef(t.id);h.useEffect(()=>{if(I.current===u&&w.current===t.id)return;const se=rr(t,u);k({type:"hydrate",payload:se}),I.current=u,w.current=t.id},[u,t]);const[N,m]=h.useState(0),[f,p]=h.useState(null),[_,O]=h.useState(!1),[F,D]=h.useState(!1),[E,U]=h.useState(null),z=h.useRef(null),ne=h.useRef(null),Z=h.useRef(null),P=j[N];h.useEffect(()=>{if(!(typeof window>"u")&&(Ks(t.id,u,{...C,version:tn}),!c))return ne.current&&clearTimeout(ne.current),ne.current=setTimeout(async()=>{try{await la(a.token,{unitId:t.id,progress:C})}catch(se){console.warn("Failed to sync student progress to backend",se)}},il),()=>{ne.current&&clearTimeout(ne.current)}},[C,t.id,u,a==null?void 0:a.token,c]),h.useEffect(()=>{const se=j.findIndex(X=>{var oe,de;return!X.isAssessment&&!((de=(oe=C.stages)==null?void 0:oe[X.id])!=null&&de.completed)});se!==-1&&m(se)},[C.stages,j]);const L=n.xp??0,Q=n.level??1,J=Q*150,ie=(Q-1)*150,G=Math.min(1,Math.max(0,(L-ie)/Math.max(1,J-ie))),ee=h.useMemo(()=>new Intl.NumberFormat,[]),te=h.useMemo(()=>ee.format(Math.max(0,Math.round(L))),[L,ee]),V=h.useMemo(()=>ee.format(Math.max(0,Math.round(J))),[J,ee]);h.useEffect(()=>{z.current===null&&(z.current=Q)},[Q]),h.useEffect(()=>{z.current!==null&&Q>z.current?(U({oldLevel:z.current,newLevel:Q,xp:L}),z.current=Q):z.current===null&&(z.current=Q)},[Q,L]);const y=(se,X,oe)=>{k({type:"segment-progress",payload:{stageId:se,nextIndex:X,completed:oe}})},M=(se,X)=>{k({type:"reflection",payload:{id:se,value:X}})},B=(se,X)=>{k({type:"planner",payload:{id:se,value:X}})},H=(se,X)=>{var Je,Ze,Qe,T;const oe=X&&typeof X=="object"?X:{success:!!X},de=!!oe.success,je=Number(oe.correctCount??(de?oe.totalCount??0:0)),ze=Number(oe.totalCount??oe.correctCount??0),Ce=Number.isFinite(ze)&&ze>0?ze:je,et=(((Ze=(Je=C.attempts)==null?void 0:Je[se])==null?void 0:Ze.count)??0)+1;if(k({type:"attempt",payload:{segmentId:se,success:de,correctCount:je,totalCount:Ce}}),!c&&((Qe=a==null?void 0:a.user)==null?void 0:Qe.role)==="student"&&(a!=null&&a.token)){const $=(T=a.user)==null?void 0:T.classId;if($){const W=de?"completed":"in-progress",K=Ce>0?Math.round(je/Ce*100):de?100:null;Or(a.token,{classId:$,unitId:t.id,segmentId:se,attempts:et,status:W,score:K}).catch(ae=>{console.warn("Failed to update live assessment status",ae)})}}if(de)if(je>0){const $=je*10,W=Math.floor((n.streak+1)/3)*5,K=$+W;r({xpGained:K,correct:je,attempts:Ce||je,spriteUnlocks:oe.spriteUnlocks}),p({...oe,success:!0,xpAward:K,correctCount:je,totalCount:Ce})}else oe.onAdvance&&oe.onAdvance();else i(),p({...oe,success:!1,correctCount:je,totalCount:Ce,xpAward:0})},Y=(se,X)=>{k({type:"assessment-response",payload:{questionId:se,value:X}})},q=(se,X)=>{k({type:"assessment-mark",payload:{questionId:se,value:X}})},re=(se,X)=>{k({type:"assessment-note",payload:{questionId:se,value:X}})},ce=se=>{k({type:"assessment-status",payload:{status:se}})},le=h.useMemo(()=>{const se=t.stages.length,X=Object.values(C.stages??{}).filter(oe=>oe.completed).length;return se>0?Math.round(X/se*100):0},[t.stages.length,C.stages]),fe=h.useMemo(()=>t.stages.every(se=>{var X,oe;return(oe=(X=C.stages)==null?void 0:X[se.id])==null?void 0:oe.completed}),[t.stages,C.stages]),he=h.useMemo(()=>!S||S.unitId&&S.unitId!==t.id||!S.lessonId?null:S,[S,t.id]),ue=h.useMemo(()=>he?j.findIndex(se=>se.id===he.lessonId):-1,[he,j]);h.useEffect(()=>{if(c)return;if(ue<0||ue>=j.length){Z.current=null;return}const se=Z.current;Z.current=ue,se!==ue&&m(ue)},[ue,j.length,c]);const ye=(he==null?void 0:he.lessonId)===ls||!v||fe,Ee=async se=>{if(!c||!A||!(a!=null&&a.token)||!se)return!1;const X=se.id;g(oe=>({...oe,[X]:"setting"}));try{const oe=await Ke(a.token,A,{unitId:t.id,lessonId:X,lessonTitle:se.title});return oe!=null&&oe.pacing?(x(oe.pacing),d({unitId:oe.pacing.unitId,lessonId:oe.pacing.lessonId})):d({unitId:t.id,lessonId:X}),g(de=>{if(!de||de[X]!=="set")return de;const je={...de};return delete je[X],je}),setTimeout(()=>{g(de=>{if(!de||de[X]!=="set")return de;const je={...de};return delete je[X],je})},2e3),!0}catch(oe){return console.warn("Failed to update class pacing",oe),g(de=>{if(!de||de[X]!=="error")return de;const je={...de};return delete je[X],je}),setTimeout(()=>{g(de=>{if(!de||de[X]!=="error")return de;const je={...de};return delete je[X],je})},2e3),!1}},Ue=async se=>{if(!se)return!1;const X=await Ee(se);if(X){const oe=j.findIndex(de=>de.id===se.id);oe!==-1&&m(oe)}return X},it=async()=>{if(!c||!A||!(a!=null&&a.token))return!1;g(se=>({...se,__stop:"setting"}));try{const se=await Ke(a.token,A,{command:"stop"});return se!=null&&se.pacing&&(x(se.pacing),d({unitId:se.pacing.unitId,lessonId:se.pacing.lessonId})),g(X=>{if(!X||X.__stop!=="set")return X;const oe={...X};return delete oe.__stop,oe}),setTimeout(()=>{g(X=>{if(!X||X.__stop!=="set")return X;const oe={...X};return delete oe.__stop,oe})},2e3),!0}catch(se){return console.warn("Failed to save pacing pointer",se),g(X=>{if(!X||X.__stop!=="error")return X;const oe={...X};return delete oe.__stop,oe}),setTimeout(()=>{g(X=>{if(!X||X.__stop!=="error")return X;const oe={...X};return delete oe.__stop,oe})},2e3),!1}};return e.jsxs("div",{className:`gamified-page ${_?"sidebar-collapsed":""} ${F?"header-collapsed":""} ${c&&o?"presentation-mode":""}`,children:[c&&o&&e.jsx("button",{type:"button",className:"presentation-exit-button",onClick:l,children:"Exit presentation"}),e.jsx("header",{className:`gamified-header ${F?"is-collapsed":""}`,children:e.jsxs("div",{className:"gamified-header__main",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"gamified-eyebrow",children:[R," Â· ",t.id]}),e.jsx("h1",{children:t.title}),!F&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.guidingQuestion}),e.jsxs("div",{className:"gamified-meta",children:[((Ye=t.hours)==null?void 0:Ye.sl)&&e.jsx("span",{children:t.hours.sl}),((ot=t.hours)==null?void 0:ot.hl)&&e.jsx("span",{children:t.hours.hl})]})]})]}),c?e.jsx("div",{className:"teacher-controls",children:e.jsx("button",{onClick:l,className:"btn",children:o?"Exit Presentation":"Enter Presentation"})}):e.jsx("div",{className:"gamified-header__stats",children:e.jsx(Mt,{tone:"brand",compact:F,badge:e.jsxs("span",{className:`stat-card__badge ${E?"is-celebrating":""}`,children:["Lv ",Q]}),label:"Your journey",value:`${te} XP`,description:F?null:`Next level at ${V} XP`,progress:F?null:G,progressLabel:F?null:`${Math.round(le)}% unit completion`,actions:e.jsx("button",{type:"button",className:"stat-card__action",onClick:()=>D(!F),"aria-expanded":!F,children:F?"Show stats":"Hide stats"})})})]})}),e.jsxs("main",{className:"gamified-main",children:[e.jsxs("nav",{className:`gamified-stages ${_?"is-collapsed":""}`,"aria-label":"Stage navigation",children:[e.jsx("button",{type:"button",className:"gamified-sidebar-toggle",onClick:()=>O(!_),"aria-label":_?"Expand sidebar":"Collapse sidebar","aria-expanded":!_,children:_?"â–¶":"â—€"}),e.jsx("ul",{children:j.map((se,X)=>{var lt,et,Je,Ze,Qe;const oe=(lt=C.stages)==null?void 0:lt[se.id];let de;c?de=!0:se.id===ls?he?ue===-1?de=X===0:de=X<=ue:de=ye:he?ue===-1?de=X===0||X>0&&((Je=(et=C.stages)==null?void 0:et[j[X-1].id])==null?void 0:Je.completed):de=X<=ue:de=X===0||X>0&&((Qe=(Ze=C.stages)==null?void 0:Ze[j[X-1].id])==null?void 0:Qe.completed);const je=X===N,ze=!!he&&he.lessonId===se.id,Ce=b[se.id];return e.jsxs("li",{className:"gamified-stage-item",children:[e.jsxs("button",{type:"button",className:`gamified-stage-link${je?" is-active":""}${oe!=null&&oe.completed?" is-complete":""}${de?"":" is-locked"}${ze?" is-pointer":""}`,disabled:!de,onClick:()=>de&&m(X),children:[e.jsx("span",{className:"gamified-stage-title",children:se.title}),e.jsx("span",{className:"gamified-stage-duration",children:se.duration})]}),c&&e.jsx("button",{className:`set-pace-btn ${Ce?`set-pace-btn--${Ce}`:""}`,onClick:()=>Ee(se),disabled:Ce==="setting",children:Ce==="setting"?"Setting...":Ce==="set"?"Pace Set!":Ce==="error"?"Error":"Set Pace"})]},se.id)})})]}),e.jsx("section",{className:"gamified-stage-viewer",children:e.jsx(dl,{unit:t,stages:j,stage:P,progress:C,assessment:t.assessment,assessmentState:C.assessment,onAssessmentResponseChange:Y,onAssessmentMarkChange:q,onAssessmentNoteChange:re,onAssessmentStatusChange:ce,assessmentUnlocked:ye,overallCompletion:le,onAdvance:y,onReflectionSave:M,onPlannerSave:B,onAttempt:H,isTeacher:c,classId:A,onAdvanceClassPace:Ue,onStopClassPace:A?it:null,stopStatus:b.__stop??null},P==null?void 0:P.id)})]}),f&&e.jsx(Ko,{...f,onClose:()=>p(null),onContinue:()=>{typeof f.onAdvance=="function"&&f.success&&f.onAdvance(),p(null)}}),E&&e.jsx(hl,{oldLevel:E.oldLevel,newLevel:E.newLevel,xp:E.xp,onClose:()=>U(null)})]})}function dl({unit:t,stages:s,stage:n,progress:r,assessment:i,assessmentState:a,onAssessmentResponseChange:o,onAssessmentMarkChange:l,onAssessmentNoteChange:d,onAssessmentStatusChange:c,assessmentUnlocked:u,overallCompletion:b,onAdvance:g,onReflectionSave:S,onPlannerSave:x,onAttempt:A,isTeacher:v,classId:j,onAdvanceClassPace:C,onStopClassPace:k,stopStatus:R}){var Y;const I=(n==null?void 0:n.id)===ls,w=h.useMemo(()=>I?[]:(Array.isArray(n==null?void 0:n.segments)?n.segments:[]).filter(re=>ol(re,{isTeacher:v})),[n==null?void 0:n.segments,v,I]),N=n==null?void 0:n.id,m=N?((Y=r.stages)==null?void 0:Y[N])??{}:{},f=Math.min(m.segmentIndex??0,Math.max(w.length-1,0)),[p,_]=h.useState(I?0:f),[O,F]=h.useState(!1),[D,E]=h.useState("idle"),[U,z]=h.useState(null),ne=h.useRef(null),Z=h.useRef(null),[P,L]=h.useState("forward"),Q=a==null?void 0:a.status;if(h.useEffect(()=>{F(!1)},[N,p]),h.useEffect(()=>{Z.current&&(clearTimeout(Z.current),Z.current=null),E("idle"),z(null)},[N]),h.useEffect(()=>()=>{Z.current&&clearTimeout(Z.current)},[]),h.useEffect(()=>{_(I?0:f),L("forward")},[f,N,I]),h.useEffect(()=>{var ce,le;if(typeof window>"u")return;const q=ne.current;if(!q)return;const re=(le=(ce=window.matchMedia)==null?void 0:ce.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:le.matches;q.scrollIntoView({behavior:re?"auto":"smooth",block:"start"})},[N,p]),h.useEffect(()=>{!I||!a||!(n!=null&&n.id)||Q==="completed"&&!m.completed&&g(n.id,1,!0)},[I,a,Q,m.completed,n==null?void 0:n.id,g]),!n)return e.jsxs("div",{className:"gamified-stage-complete",children:[e.jsx("h2",{children:"Select a stage"}),e.jsx("p",{children:"Choose a stage from the sidebar to get started."})]});const J=w[p],ie=J&&(J.type==="micro-quiz"||J.type==="activity"),G=(s==null?void 0:s.findIndex(q=>q.id===N))??-1,ee=G>=0?s[G+1]:null,te=R==="setting",V=()=>{const q=Math.min(p+1,w.length),re=q>=w.length;L("forward"),_(ce=>Math.min(ce+1,w.length)),g(n.id,q,re)},y=()=>{L("back"),_(q=>Math.max(q-1,0))},M=async()=>{if(!C||!N)return;const q=ee??n;E("pending"),z(null);try{if(!await C(q,{fromStageId:N,isLastStage:!ee}))throw new Error("Unable to update class pacing");E("success")}catch(re){console.warn("Failed to advance class pacing",re),E("error"),z((re==null?void 0:re.message)||"Unable to unlock next stage right now")}finally{Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{E("idle"),z(null)},2e3)}};if(I&&i)return e.jsx("div",{className:"gamified-stage",ref:ne,children:e.jsx("div",{className:`gamified-stage__panel gamified-stage__panel--${P}`,children:e.jsx(ul,{unit:t,assessmentState:a,onResponseChange:o,onMarkChange:l,onTeacherNoteChange:d,onStatusChange:c,isTeacher:v,isUnlocked:u,completionPercentage:b})})});if(v&&j&&ie&&!O)return e.jsx("div",{className:"gamified-stage",ref:ne,children:e.jsx(sl,{classId:j,unitId:t.id,segment:J,stage:n,isLastStage:!ee,nextStageTitle:(ee==null?void 0:ee.title)??null,advanceState:D,advanceError:U,onShowAssessment:()=>F(!0),onAdvancePacing:M})});if(!J)return e.jsxs("div",{className:"gamified-stage-complete",children:[e.jsx("h2",{children:"Stage complete!"}),e.jsx("p",{children:"Select the next stage from the sidebar or revisit segments to reinforce the concepts."})]});const B=`${N}:${J==null?void 0:J.id}:${P}`,H=`gamified-stage__panel gamified-stage__panel--${P}`;return e.jsxs("div",{className:"gamified-stage",ref:ne,children:[e.jsxs("header",{className:"gamified-stage-header",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"gamified-stage-eyebrow",children:["Stage ",n.id]}),e.jsx("h2",{children:n.title}),e.jsx("p",{children:n.description})]}),e.jsxs("div",{className:"gamified-stage-header__actions",children:[v&&k&&e.jsx("button",{type:"button",className:"btn btn--outline",onClick:k,disabled:te,children:te?"Savingâ€¦":"Stop teaching"}),v&&ie&&O&&e.jsx("button",{onClick:()=>F(!1),className:"btn btn--ghost",children:"Back to Live Dashboard"})]}),e.jsxs("span",{className:"gamified-stage-progress",children:[Math.min(p+1,w.length)," / ",w.length]})]}),R==="error"&&e.jsx("p",{className:"gamified-feedback is-error",children:"Unable to save the teaching pointer. Please try again."}),e.jsx("div",{className:H,children:e.jsx(pl,{unit:t,stage:n,segment:J,onComplete:V,onBack:p>0?y:null,onReflectionSave:S,onPlannerSave:x,onAttempt:A,attempts:r.attempts,reflections:r.reflections,planner:r.planner,isTeacher:v})},B)]})}function ul({unit:t,assessmentState:s,onResponseChange:n,onMarkChange:r,onTeacherNoteChange:i,onStatusChange:a,isTeacher:o,isUnlocked:l,completionPercentage:d}){const c=t.assessment,u=(c==null?void 0:c.questions)??[],[b,g]=h.useState(!0),S=kt(s),x=h.useMemo(()=>Object.values(S.marks??{}).reduce((v,j)=>{const C=Number(j);return v+(Number.isFinite(C)?C:0)},0),[S.marks]),A=()=>{typeof window<"u"&&window.print()};return c?c.format==="auto-mcq"?e.jsx("section",{className:"gamified-assessment",children:e.jsxs("article",{className:"gamified-card gamified-assessment__card",children:[e.jsxs("header",{className:"gamified-assessment__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Summative checkpoint"}),e.jsxs("p",{className:"muted",children:[c.duration," Â· ",c.totalMarks," marks"]})]}),e.jsx("button",{type:"button",className:"btn btn--outline",onClick:()=>g(v=>!v),disabled:!l,children:b?"Hide assessment":"Open assessment"})]}),!l&&e.jsxs("p",{className:"gamified-assessment__lock",children:["Complete all stages to unlock the assessment. You are ",d,"% through the unit."]}),b&&l&&e.jsx(ll,{assessment:c,normalizedState:S,onResponseChange:n,onMarkChange:r,onStatusChange:a,isTeacher:o})]})}):e.jsx("section",{className:"gamified-assessment",children:e.jsxs("article",{className:"gamified-card gamified-assessment__card",children:[e.jsxs("header",{className:"gamified-assessment__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"End-of-unit assessment"}),e.jsxs("p",{className:"muted",children:[c.duration," Â· ",c.totalMarks," marks"]})]}),e.jsx("button",{type:"button",className:"btn btn--outline",onClick:()=>g(v=>!v),disabled:!l,children:b?"Hide assessment":"Open assessment"})]}),!l&&e.jsxs("p",{className:"gamified-assessment__lock",children:["Complete all stages to unlock the assessment. You are ",d,"% through the unit."]}),b&&l&&e.jsxs("div",{className:"gamified-assessment__body",children:[e.jsx("p",{children:"Answer each question in the space provided. Your work saves automatically on this device. Use the download button to export a PDF copy for your teacher."}),e.jsx("ol",{className:"gamified-assessment__questions",children:u.map(v=>{var j;return e.jsxs("li",{children:[e.jsxs("div",{className:"gamified-assessment__prompt",children:[e.jsx("p",{children:v.prompt}),e.jsxs("span",{children:[v.marks," marks"]})]}),e.jsx("textarea",{rows:6,value:((j=S.responses)==null?void 0:j[v.id])??"",onChange:C=>n(v.id,C.target.value)})]},v.id)})}),e.jsx("div",{className:"gamified-assessment__actions",children:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:A,children:"Download as PDF"})}),o?e.jsxs("aside",{className:"gamified-assessment__teacher gamified-assessment__teacher--panel",children:[e.jsxs("div",{className:"gamified-assessment__teacher-header",children:[e.jsx("h3",{children:"Teacher marking workspace"}),e.jsxs("span",{children:["Total awarded: ",x," / ",c.totalMarks]})]}),e.jsx("div",{className:"gamified-assessment__teacher-grid",children:u.map(v=>{var j,C;return e.jsxs("div",{className:"gamified-assessment__teacher-item",children:[e.jsxs("div",{className:"gamified-assessment__teacher-meta",children:[e.jsx("h4",{children:v.prompt}),e.jsxs("span",{children:[v.marks," marks"]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Marks awarded"}),e.jsx("input",{type:"number",min:0,max:v.marks,value:((j=S.marks)==null?void 0:j[v.id])??"",onChange:k=>r(v.id,k.target.value)})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Feedback"}),e.jsx("textarea",{rows:3,value:((C=S.teacherNotes)==null?void 0:C[v.id])??"",onChange:k=>i(v.id,k.target.value)})]})]},v.id)})})]}):e.jsxs("aside",{className:"gamified-assessment__teacher gamified-assessment__teacher--hint",children:[e.jsx("h3",{children:"Teacher view"}),e.jsx("p",{children:"Teachers can record marks and feedback from the dashboard. Export your responses to share a PDF copy when requested."})]})]})]})}):null}function hl({oldLevel:t,newLevel:s,xp:n,onClose:r}){const i=Array.from({length:50}).map((a,o)=>({id:o,delay:`${o*.05}s`,offset:`${(Math.random()-.5)*200}px`}));return e.jsx(Js,{isOpen:!0,onClose:r,size:"md",closeOnBackdropClick:!0,children:e.jsxs("div",{className:"level-up-modal",children:[e.jsx("div",{className:"level-up-modal__confetti",children:i.map(a=>e.jsx("div",{className:"confetti-piece",style:{"--delay":a.delay,"--offset":a.offset}},a.id))}),e.jsxs("div",{className:"level-up-modal__content",children:[e.jsx("div",{className:"level-up-modal__icon",children:"ðŸŽ‰"}),e.jsx("h2",{className:"level-up-modal__title",children:"Level Up!"}),e.jsxs("div",{className:"level-up-modal__levels",children:[e.jsxs("span",{className:"level-up-modal__old-level",children:["Lv ",t]}),e.jsx("span",{className:"level-up-modal__arrow",children:"â†’"}),e.jsxs("span",{className:"level-up-modal__new-level",children:["Lv ",s]})]}),e.jsxs("p",{className:"level-up-modal__message",children:["Congratulations! You've reached Level ",s,"!"]}),e.jsxs("div",{className:"level-up-modal__xp",children:[e.jsxs("strong",{children:[n," XP"]}),e.jsx("span",{children:"Total Experience"})]}),e.jsx("button",{type:"button",className:"level-up-modal__button",onClick:r,children:"Continue Learning"})]})]})})}function pl({unit:t,stage:s,segment:n,onComplete:r,onBack:i,onReflectionSave:a,onPlannerSave:o,onAttempt:l,attempts:d,reflections:c,planner:u,isTeacher:b}){const g=d==null?void 0:d[n.id],S={segment:n,onComplete:r,onBack:i,attemptStats:g,onAttempt:l,isTeacher:b,unit:t,stage:s};switch(n.type){case"content":case"list":case"table":case"accordion":return e.jsx(tr,{...S});case"micro-quiz":return e.jsx(To,{...S});case"activity":return e.jsx(Go,{...S,plannerValues:u,onPlannerSave:o});case"demo":return e.jsx(qo,{...S});case"python-playground":return e.jsx(zo,{...S});case"reflection":return e.jsx(Xo,{...S,onSave:a,initialValue:(c==null?void 0:c[n.id])??""});default:return e.jsx(tr,{...S})}}function ml(){var n;const s=(n=Ct().state)==null?void 0:n.classId;return e.jsx(_n,{children:e.jsx(oi,{unit:_t,classId:s})})}function fl(){var n;const s=(n=Ct().state)==null?void 0:n.classId;return e.jsx(_n,{children:e.jsx(oi,{unit:Nt,classId:s})})}function gl(t){return t?typeof t=="string"?t:typeof t=="object"&&t.slideId?t.slideId:typeof t=="object"&&t.id?t.id:null:null}function Os(t){var o;if(!t)return null;const s=t.pacing??t,n=((o=t.lesson)==null?void 0:o.id)||(s==null?void 0:s.lessonId)||(s==null?void 0:s.slideId)||null,r=n?ys(n):null,i=t.accessibleSlides??(s==null?void 0:s.accessibleSlides)??[],a=new Set(i.map(l=>gl(l)).filter(Boolean));return r!=null&&r.slideId&&a.add(r.slideId),{classDoc:t.class??null,pacing:s,lesson:r,accessible:a,sessionCode:(s==null?void 0:s.sessionCode)??null,sessionStatus:(s==null?void 0:s.sessionStatus)??(r?"live":"idle"),updatedAt:(s==null?void 0:s.updatedAt)??null}}function bl(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s.toLocaleString()}function ir(t){switch((t||"upcoming").toLowerCase()){case"available":return{label:"Ready",className:"is-ready"};case"upcoming":default:return{label:"Coming soon",className:"is-upcoming"}}}function ar(t){switch((t||"upcoming").toLowerCase()){case"live":return"Live";case"idle":default:return"Idle"}}function yl(){var O,F,D;const{session:t,ready:s}=Pe(),n=(t==null?void 0:t.token)??null,r=((O=t==null?void 0:t.user)==null?void 0:O.role)??null,i=r==="teacher",a=r==="student",o=mt(),[l,d]=h.useState(((F=bt[0])==null?void 0:F.id)??""),c=bt.find(E=>E.id===l)??bt[0],[u,b]=h.useState(null),[g,S]=h.useState(""),[x,A]=h.useState(null),[v,j]=h.useState(null),[C,k]=h.useState(null),[R,I]=h.useState(!0),[w,N]=h.useState(null),m=h.useMemo(()=>c!=null&&c.deckId?xn(c.deckId):[],[c==null?void 0:c.deckId]);h.useEffect(()=>{if(!s||!n)return;(async()=>{var U,z,ne;I(!0);try{if(i){const Z=await gn(n);b(Z);const P=(Z.classes||[]).filter(Q=>{const J=String((Q==null?void 0:Q.yearGroup)||"").toLowerCase();return J.includes("year 7")||J.includes("ks3")}),L=((U=P[0])==null?void 0:U.id)||"";S(Q=>Q&&P.some(J=>J.id===Q)?Q:L)}else if(a){const Z=await yn(n);j(Z);const P=((z=Z.class)==null?void 0:z.id)||((ne=Z.student)==null?void 0:ne.classId)||"";if(P){const L=await ds(n,P);k(Os(L))}else k(null)}N(null)}catch(Z){console.error(Z),N(Z)}finally{I(!1)}})()},[s,n,i,a]),h.useEffect(()=>{if(!i||!n||!g){A(null);return}let E=!1;return(async()=>{try{const z=await bn(n,g);E||A(Os(z))}catch(z){console.error(z),E||A(null)}})(),()=>{E=!0}},[i,n,g]),h.useEffect(()=>{var z;if(!a||!n||!((z=v==null?void 0:v.class)!=null&&z.id))return;let E=!1;return(async()=>{try{const ne=await ds(n,v.class.id);E||k(Os(ne))}catch(ne){console.error(ne),E||k(null)}})(),()=>{E=!0}},[a,n,(D=v==null?void 0:v.class)==null?void 0:D.id]);const f=E=>{if(!E.deckId)return;const U=new URLSearchParams;U.set("deckId",E.deckId),g&&U.set("classId",g),o(`/curriculum/year7/live?${U.toString()}`)},p=E=>{E.deckId&&o(`/curriculum/year7/live?deckId=${E.deckId}`)},_=E=>{if(!E.deckId)return;const U=new URLSearchParams;U.set("deckId",E.deckId),o(`/curriculum/year7/live?${U.toString()}`)};return e.jsxs("div",{className:"y7-map-shell",children:[e.jsx("header",{className:"y7-map-hero",children:e.jsxs("div",{children:[e.jsx("span",{className:"y7-map-eyebrow",children:"Key Stage 3 Â· Year 7 Computing"}),e.jsx("h1",{children:"Year 7 Curriculum Map"}),e.jsx("p",{children:"Launch a purposeful computing journey. Start with a teacher-paced introduction, then flow through practical units that blend pedagogy, live facilitation, and student independence."})]})}),w&&e.jsx("div",{className:"y7-map-alert",children:w.message||"Something went wrong."}),e.jsxs("div",{className:"y7-map-layout",children:[e.jsx("section",{className:"y7-map-units",children:bt.map(E=>{const U=ir(E.status),z=E.id===c.id;return e.jsxs("button",{type:"button",className:`y7-unit-card ${z?"is-selected":""}`,onClick:()=>d(E.id),children:[e.jsx("span",{className:"y7-unit-icon","aria-hidden":"true",children:E.icon}),e.jsxs("div",{className:"y7-unit-text",children:[e.jsx("strong",{children:E.title}),e.jsx("p",{children:E.summary})]}),e.jsx("span",{className:`y7-unit-status ${U.className}`,children:U.label})]},E.id)})}),e.jsxs("aside",{className:"y7-map-detail",children:[e.jsxs("div",{className:"y7-map-detail__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:c.title}),e.jsx("p",{children:c.summary})]}),e.jsxs("div",{className:"y7-map-stats",children:[c.estimatedHours&&e.jsxs("div",{children:[e.jsx("span",{children:"Estimated time"}),e.jsx("strong",{children:c.estimatedHours})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Status"}),e.jsx("strong",{children:ir(c.status).label})]})]})]}),e.jsx("div",{className:"y7-map-detail__actions",children:c.deckId?i?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"y7-map-field",children:[e.jsx("span",{children:"Select a class"}),e.jsxs("select",{value:g,onChange:E=>S(E.target.value),children:[e.jsx("option",{value:"",children:"Preview only"}),((u==null?void 0:u.classes)||[]).filter(E=>{const U=String((E==null?void 0:E.yearGroup)||"").toLowerCase();return U.includes("year 7")||U.includes("ks3")}).map(E=>e.jsx("option",{value:E.id,children:E.className},E.id))]})]}),e.jsxs("div",{className:"y7-map-buttons",children:[e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",disabled:!g||R,onClick:()=>f(c),children:"Start teaching"}),e.jsx("button",{type:"button",className:"y7-btn",onClick:()=>p(c),children:"Preview deck"})]})]}):e.jsxs("div",{className:"y7-map-buttons",children:[e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",onClick:()=>_(c),children:"Continue learning"}),e.jsx("button",{type:"button",className:"y7-btn",onClick:()=>p(c),children:"Preview deck"})]}):e.jsx("div",{className:"y7-map-coming-soon",children:e.jsx("p",{children:"We're crafting a live experience for this unit. Teacher notes, formative checkpoints, and pacing tools arrive soon."})})}),e.jsxs("div",{className:"y7-map-live-cards",children:[i&&e.jsxs("div",{className:"y7-live-summary-card",children:[e.jsxs("header",{children:[e.jsx("strong",{children:"Live session status"}),e.jsx("span",{className:`chip ${x?x.sessionStatus:"is-idle"}`,children:ar(x==null?void 0:x.sessionStatus)})]}),x!=null&&x.lesson&&x.lesson.deckId===c.deckId?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Pointer on ",e.jsx("strong",{children:x.lesson.slideTitle}),typeof x.lesson.index=="number"&&m.length?e.jsxs("span",{children:[" ","(slide ",x.lesson.index+1," of ",m.length,")"]}):null]}),x.sessionCode&&e.jsxs("p",{className:"code",children:["Join code: ",x.sessionCode]}),x.updatedAt&&e.jsxs("p",{className:"meta",children:["Updated ",bl(x.updatedAt)]})]}):e.jsx("p",{children:"No active session for this unit yet. Launch it to generate a join code and live pointer."})]}),a&&e.jsxs("div",{className:"y7-live-summary-card",children:[e.jsxs("header",{children:[e.jsx("strong",{children:"Your live pointer"}),e.jsx("span",{className:`chip ${C?C.sessionStatus:"is-idle"}`,children:ar(C==null?void 0:C.sessionStatus)})]}),C!=null&&C.lesson&&C.lesson.deckId===c.deckId?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Current slide: ",e.jsx("strong",{children:C.lesson.slideTitle}),typeof C.lesson.index=="number"&&m.length?e.jsxs("span",{children:[" ","(slide ",C.lesson.index+1," of ",m.length,")"]}):null]}),C.sessionCode&&e.jsxs("p",{className:"code",children:["Join code: ",C.sessionCode]})]}):e.jsx("p",{children:"Your teacher hasn't started a live session for this unit yet. You can still review slides once it begins."})]})]}),e.jsxs("div",{className:"y7-map-note",children:[e.jsx("h3",{children:"Why this unit works"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Teacher-paced slides keep the class together while enabling rapid formative feedback."}),e.jsx("li",{children:"Students revisit previous slides for retrieval practice but can never jump ahead of the pointer."}),e.jsx("li",{children:"Live checkpoints surface to the teacher dashboard, supporting classroom dialogue and responsive teaching."})]})]})]})]})]})}var Qt={};(function t(s,n,r,i){var a=!!(s.Worker&&s.Blob&&s.Promise&&s.OffscreenCanvas&&s.OffscreenCanvasRenderingContext2D&&s.HTMLCanvasElement&&s.HTMLCanvasElement.prototype.transferControlToOffscreen&&s.URL&&s.URL.createObjectURL),o=typeof Path2D=="function"&&typeof DOMMatrix=="function",l=function(){if(!s.OffscreenCanvas)return!1;try{var P=new OffscreenCanvas(1,1),L=P.getContext("2d");L.fillRect(0,0,1,1);var Q=P.transferToImageBitmap();L.createPattern(Q,"no-repeat")}catch{return!1}return!0}();function d(){}function c(P){var L=n.exports.Promise,Q=L!==void 0?L:s.Promise;return typeof Q=="function"?new Q(P):(P(d,d),null)}var u=function(P,L){return{transform:function(Q){if(P)return Q;if(L.has(Q))return L.get(Q);var J=new OffscreenCanvas(Q.width,Q.height),ie=J.getContext("2d");return ie.drawImage(Q,0,0),L.set(Q,J),J},clear:function(){L.clear()}}}(l,new Map),b=function(){var P=Math.floor(16.666666666666668),L,Q,J={},ie=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(L=function(G){var ee=Math.random();return J[ee]=requestAnimationFrame(function te(V){ie===V||ie+P-1<V?(ie=V,delete J[ee],G()):J[ee]=requestAnimationFrame(te)}),ee},Q=function(G){J[G]&&cancelAnimationFrame(J[G])}):(L=function(G){return setTimeout(G,P)},Q=function(G){return clearTimeout(G)}),{frame:L,cancel:Q}}(),g=function(){var P,L,Q={};function J(ie){function G(ee,te){ie.postMessage({options:ee||{},callback:te})}ie.init=function(te){var V=te.transferControlToOffscreen();ie.postMessage({canvas:V},[V])},ie.fire=function(te,V,y){if(L)return G(te,null),L;var M=Math.random().toString(36).slice(2);return L=c(function(B){function H(Y){Y.data.callback===M&&(delete Q[M],ie.removeEventListener("message",H),L=null,u.clear(),y(),B())}ie.addEventListener("message",H),G(te,M),Q[M]=H.bind(null,{data:{callback:M}})}),L},ie.reset=function(){ie.postMessage({reset:!0});for(var te in Q)Q[te](),delete Q[te]}}return function(){if(P)return P;if(!r&&a){var ie=["var CONFETTI, SIZE = {}, module = {};","("+t.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{P=new Worker(URL.createObjectURL(new Blob([ie])))}catch(G){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",G),null}J(P)}return P}}(),S={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function x(P,L){return L?L(P):P}function A(P){return P!=null}function v(P,L,Q){return x(P&&A(P[L])?P[L]:S[L],Q)}function j(P){return P<0?0:Math.floor(P)}function C(P,L){return Math.floor(Math.random()*(L-P))+P}function k(P){return parseInt(P,16)}function R(P){return P.map(I)}function I(P){var L=String(P).replace(/[^0-9a-f]/gi,"");return L.length<6&&(L=L[0]+L[0]+L[1]+L[1]+L[2]+L[2]),{r:k(L.substring(0,2)),g:k(L.substring(2,4)),b:k(L.substring(4,6))}}function w(P){var L=v(P,"origin",Object);return L.x=v(L,"x",Number),L.y=v(L,"y",Number),L}function N(P){P.width=document.documentElement.clientWidth,P.height=document.documentElement.clientHeight}function m(P){var L=P.getBoundingClientRect();P.width=L.width,P.height=L.height}function f(P){var L=document.createElement("canvas");return L.style.position="fixed",L.style.top="0px",L.style.left="0px",L.style.pointerEvents="none",L.style.zIndex=P,L}function p(P,L,Q,J,ie,G,ee,te,V){P.save(),P.translate(L,Q),P.rotate(G),P.scale(J,ie),P.arc(0,0,1,ee,te,V),P.restore()}function _(P){var L=P.angle*(Math.PI/180),Q=P.spread*(Math.PI/180);return{x:P.x,y:P.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:P.startVelocity*.5+Math.random()*P.startVelocity,angle2D:-L+(.5*Q-Math.random()*Q),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:P.color,shape:P.shape,tick:0,totalTicks:P.ticks,decay:P.decay,drift:P.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:P.gravity*3,ovalScalar:.6,scalar:P.scalar,flat:P.flat}}function O(P,L){L.x+=Math.cos(L.angle2D)*L.velocity+L.drift,L.y+=Math.sin(L.angle2D)*L.velocity+L.gravity,L.velocity*=L.decay,L.flat?(L.wobble=0,L.wobbleX=L.x+10*L.scalar,L.wobbleY=L.y+10*L.scalar,L.tiltSin=0,L.tiltCos=0,L.random=1):(L.wobble+=L.wobbleSpeed,L.wobbleX=L.x+10*L.scalar*Math.cos(L.wobble),L.wobbleY=L.y+10*L.scalar*Math.sin(L.wobble),L.tiltAngle+=.1,L.tiltSin=Math.sin(L.tiltAngle),L.tiltCos=Math.cos(L.tiltAngle),L.random=Math.random()+2);var Q=L.tick++/L.totalTicks,J=L.x+L.random*L.tiltCos,ie=L.y+L.random*L.tiltSin,G=L.wobbleX+L.random*L.tiltCos,ee=L.wobbleY+L.random*L.tiltSin;if(P.fillStyle="rgba("+L.color.r+", "+L.color.g+", "+L.color.b+", "+(1-Q)+")",P.beginPath(),o&&L.shape.type==="path"&&typeof L.shape.path=="string"&&Array.isArray(L.shape.matrix))P.fill(z(L.shape.path,L.shape.matrix,L.x,L.y,Math.abs(G-J)*.1,Math.abs(ee-ie)*.1,Math.PI/10*L.wobble));else if(L.shape.type==="bitmap"){var te=Math.PI/10*L.wobble,V=Math.abs(G-J)*.1,y=Math.abs(ee-ie)*.1,M=L.shape.bitmap.width*L.scalar,B=L.shape.bitmap.height*L.scalar,H=new DOMMatrix([Math.cos(te)*V,Math.sin(te)*V,-Math.sin(te)*y,Math.cos(te)*y,L.x,L.y]);H.multiplySelf(new DOMMatrix(L.shape.matrix));var Y=P.createPattern(u.transform(L.shape.bitmap),"no-repeat");Y.setTransform(H),P.globalAlpha=1-Q,P.fillStyle=Y,P.fillRect(L.x-M/2,L.y-B/2,M,B),P.globalAlpha=1}else if(L.shape==="circle")P.ellipse?P.ellipse(L.x,L.y,Math.abs(G-J)*L.ovalScalar,Math.abs(ee-ie)*L.ovalScalar,Math.PI/10*L.wobble,0,2*Math.PI):p(P,L.x,L.y,Math.abs(G-J)*L.ovalScalar,Math.abs(ee-ie)*L.ovalScalar,Math.PI/10*L.wobble,0,2*Math.PI);else if(L.shape==="star")for(var q=Math.PI/2*3,re=4*L.scalar,ce=8*L.scalar,le=L.x,fe=L.y,he=5,ue=Math.PI/he;he--;)le=L.x+Math.cos(q)*ce,fe=L.y+Math.sin(q)*ce,P.lineTo(le,fe),q+=ue,le=L.x+Math.cos(q)*re,fe=L.y+Math.sin(q)*re,P.lineTo(le,fe),q+=ue;else P.moveTo(Math.floor(L.x),Math.floor(L.y)),P.lineTo(Math.floor(L.wobbleX),Math.floor(ie)),P.lineTo(Math.floor(G),Math.floor(ee)),P.lineTo(Math.floor(J),Math.floor(L.wobbleY));return P.closePath(),P.fill(),L.tick<L.totalTicks}function F(P,L,Q,J,ie){var G=L.slice(),ee=P.getContext("2d"),te,V,y=c(function(M){function B(){te=V=null,ee.clearRect(0,0,J.width,J.height),u.clear(),ie(),M()}function H(){r&&!(J.width===i.width&&J.height===i.height)&&(J.width=P.width=i.width,J.height=P.height=i.height),!J.width&&!J.height&&(Q(P),J.width=P.width,J.height=P.height),ee.clearRect(0,0,J.width,J.height),G=G.filter(function(Y){return O(ee,Y)}),G.length?te=b.frame(H):B()}te=b.frame(H),V=B});return{addFettis:function(M){return G=G.concat(M),y},canvas:P,promise:y,reset:function(){te&&b.cancel(te),V&&V()}}}function D(P,L){var Q=!P,J=!!v(L||{},"resize"),ie=!1,G=v(L,"disableForReducedMotion",Boolean),ee=a&&!!v(L||{},"useWorker"),te=ee?g():null,V=Q?N:m,y=P&&te?!!P.__confetti_initialized:!1,M=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,B;function H(q,re,ce){for(var le=v(q,"particleCount",j),fe=v(q,"angle",Number),he=v(q,"spread",Number),ue=v(q,"startVelocity",Number),ve=v(q,"decay",Number),ye=v(q,"gravity",Number),Ee=v(q,"drift",Number),Ue=v(q,"colors",R),it=v(q,"ticks",Number),at=v(q,"shapes"),ft=v(q,"scalar"),Ve=!!v(q,"flat"),$e=w(q),Xe=le,Ye=[],ot=P.width*$e.x,se=P.height*$e.y;Xe--;)Ye.push(_({x:ot,y:se,angle:fe,spread:he,startVelocity:ue,color:Ue[Xe%Ue.length],shape:at[C(0,at.length)],ticks:it,decay:ve,gravity:ye,drift:Ee,scalar:ft,flat:Ve}));return B?B.addFettis(Ye):(B=F(P,Ye,V,re,ce),B.promise)}function Y(q){var re=G||v(q,"disableForReducedMotion",Boolean),ce=v(q,"zIndex",Number);if(re&&M)return c(function(ue){ue()});Q&&B?P=B.canvas:Q&&!P&&(P=f(ce),document.body.appendChild(P)),J&&!y&&V(P);var le={width:P.width,height:P.height};te&&!y&&te.init(P),y=!0,te&&(P.__confetti_initialized=!0);function fe(){if(te){var ue={getBoundingClientRect:function(){if(!Q)return P.getBoundingClientRect()}};V(ue),te.postMessage({resize:{width:ue.width,height:ue.height}});return}le.width=le.height=null}function he(){B=null,J&&(ie=!1,s.removeEventListener("resize",fe)),Q&&P&&(document.body.contains(P)&&document.body.removeChild(P),P=null,y=!1)}return J&&!ie&&(ie=!0,s.addEventListener("resize",fe,!1)),te?te.fire(q,le,he):H(q,le,he)}return Y.reset=function(){te&&te.reset(),B&&B.reset()},Y}var E;function U(){return E||(E=D(null,{useWorker:!0,resize:!0})),E}function z(P,L,Q,J,ie,G,ee){var te=new Path2D(P),V=new Path2D;V.addPath(te,new DOMMatrix(L));var y=new Path2D;return y.addPath(V,new DOMMatrix([Math.cos(ee)*ie,Math.sin(ee)*ie,-Math.sin(ee)*G,Math.cos(ee)*G,Q,J])),y}function ne(P){if(!o)throw new Error("path confetti are not supported in this browser");var L,Q;typeof P=="string"?L=P:(L=P.path,Q=P.matrix);var J=new Path2D(L),ie=document.createElement("canvas"),G=ie.getContext("2d");if(!Q){for(var ee=1e3,te=ee,V=ee,y=0,M=0,B,H,Y=0;Y<ee;Y+=2)for(var q=0;q<ee;q+=2)G.isPointInPath(J,Y,q,"nonzero")&&(te=Math.min(te,Y),V=Math.min(V,q),y=Math.max(y,Y),M=Math.max(M,q));B=y-te,H=M-V;var re=10,ce=Math.min(re/B,re/H);Q=[ce,0,0,ce,-Math.round(B/2+te)*ce,-Math.round(H/2+V)*ce]}return{type:"path",path:L,matrix:Q}}function Z(P){var L,Q=1,J="#000000",ie='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof P=="string"?L=P:(L=P.text,Q="scalar"in P?P.scalar:Q,ie="fontFamily"in P?P.fontFamily:ie,J="color"in P?P.color:J);var G=10*Q,ee=""+G+"px "+ie,te=new OffscreenCanvas(G,G),V=te.getContext("2d");V.font=ee;var y=V.measureText(L),M=Math.ceil(y.actualBoundingBoxRight+y.actualBoundingBoxLeft),B=Math.ceil(y.actualBoundingBoxAscent+y.actualBoundingBoxDescent),H=2,Y=y.actualBoundingBoxLeft+H,q=y.actualBoundingBoxAscent+H;M+=H+H,B+=H+H,te=new OffscreenCanvas(M,B),V=te.getContext("2d"),V.font=ee,V.fillStyle=J,V.fillText(L,Y,q);var re=1/Q;return{type:"bitmap",bitmap:te.transferToImageBitmap(),matrix:[re,0,0,re,-M*re/2,-B*re/2]}}n.exports=function(){return U().apply(this,arguments)},n.exports.reset=function(){U().reset()},n.exports.create=D,n.exports.shapeFromPath=ne,n.exports.shapeFromText=Z})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Qt,!1);const Nn=Qt.exports;Qt.exports.create;function xl({item:t}){const{attributes:s,listeners:n,setNodeRef:r,transform:i,transition:a,isDragging:o}=Yi({id:t.id}),l={"--sortable-transform":i?zi.Transform.toString(i):void 0,"--sortable-transition":a||void 0,"--sortable-opacity":o?.72:1};return e.jsxs(gs.div,{ref:r,layout:!0,className:"formative-card","data-id":t.id,"data-dragging":o?"true":"false",style:l,role:"listitem",...s,...n,children:[e.jsx("span",{className:"formative-card__handle","aria-hidden":"true",children:"â˜°"}),e.jsx("span",{children:t.content||t.label||t.text})]})}function vl({question:t,onSubmit:s,allowRetry:n,disabled:r}){var g;const[i,a]=h.useState(null),[o,l]=h.useState(null),d=()=>{const S=i===t.answer;l({isCorrect:S}),s==null||s({status:"completed",score:S?1:0,attempts:1,details:[{questionId:t.id,isCorrect:S}]}),S&&Nn({particleCount:80,spread:70,origin:{y:.65}})},c=()=>{a(null),l(null)},u=S=>{S.preventDefault(),!(i===null||r)&&d()},b=`${t.id}-prompt`;return e.jsxs("form",{className:"formative formative--choice",onSubmit:u,children:[e.jsx("p",{className:"formative__prompt",id:b,children:t.prompt}),e.jsx("div",{className:"formative__options",role:"radiogroup","aria-labelledby":b,children:(g=t.options)==null?void 0:g.map(S=>e.jsxs("label",{className:rt("formative-option",{"is-selected":i===S.id}),children:[e.jsx("input",{type:"radio",name:t.id,value:S.id,disabled:!!o||r,checked:i===S.id,onChange:()=>a(S.id)}),e.jsx("span",{children:S.label||S.text})]},S.id))}),e.jsxs("footer",{className:"formative__footer",children:[e.jsxs(De,{align:"start",children:[!o&&e.jsx("button",{type:"submit",className:"y7-btn y7-btn--primary",disabled:i===null||r,children:"Check answer"}),o&&n&&e.jsx("button",{type:"button",className:"y7-btn",onClick:c,children:"Try again"})]}),o&&e.jsx(Le,{tone:o.isCorrect?"success":"error",children:o.isCorrect?"Correct":"Try again"})]})]})}function jl({question:t,onComplete:s,disabled:n}){var x;const[r,i]=h.useState(()=>t.items??[]),[a,o]=h.useState(null),[l,d]=h.useState(0),[c,u]=h.useState(null),b=A=>{const{active:v,over:j}=A;!j||v.id===j.id||i(C=>{const k=C.findIndex(I=>I.id===v.id),R=C.findIndex(I=>I.id===j.id);return Vi(C,k,R)})},g=()=>{const A=l+1;d(A);const v=r.map(C=>C.id),j=JSON.stringify(v)===JSON.stringify(t.correctOrder);j&&Nn({particleCount:100,spread:70,origin:{y:.6}}),o({correct:j}),s==null||s(j)},S=()=>{i(t.items),o(null),d(0)};return e.jsxs("section",{className:"formative formative--ordering",children:[e.jsx("p",{className:"formative__prompt",children:t.prompt}),e.jsxs($i,{collisionDetection:Wi,onDragEnd:b,onDragStart:({active:A})=>u(A.id),onDragCancel:()=>u(null),children:[e.jsx(Gi,{items:r,strategy:Hi,children:e.jsx("div",{className:"formative__stack",role:"list",children:r.map(A=>e.jsx(xl,{item:A},A.id))})}),e.jsx(qi,{children:c?e.jsxs(gs.div,{layout:!0,className:"formative-card formative-card--overlay","data-dragging":"true",style:{"--sortable-transform":"translate3d(0, 0, 0)","--sortable-opacity":1},children:[e.jsx("span",{className:"formative-card__handle","aria-hidden":"true",children:"â˜°"}),e.jsx("span",{children:((x=r.find(A=>A.id===c))==null?void 0:x.content)||""})]}):null})]}),e.jsxs("footer",{className:"formative__footer",children:[e.jsxs(De,{align:"start",children:[!a&&e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",onClick:g,disabled:n,children:"Check order"}),a&&t.allowRetry!==!1&&e.jsx("button",{type:"button",className:"y7-btn",onClick:S,children:"Try again"})]}),a&&e.jsx(Le,{tone:a.correct?"success":"error",children:a.correct?"Great work":"One more attempt"})]})]})}function wl({question:t,onComplete:s}){const[n,r]=h.useState({}),[i,a]=h.useState(null),o=()=>{const c=t.items.map(g=>{const x=n[g.id]===g.correct;return{id:g.id,isCorrect:x}}),u=c.filter(g=>g.isCorrect).length,b=c.length?u/c.length:1;a({summary:c,score:b}),b===1&&Nn({particleCount:90,spread:70,origin:{y:.6}}),s==null||s(b===1)},l=()=>{r({}),a(null)},d=c=>{c.preventDefault(),o()};return e.jsxs("form",{className:"formative formative--classification",onSubmit:d,children:[e.jsx("p",{className:"formative__prompt",children:t.prompt}),e.jsx("div",{className:"formative__classification",children:t.items.map(c=>{const u=`${t.id}-${c.id}`,b=i==null?void 0:i.summary.find(g=>g.id===c.id);return e.jsxs("div",{className:rt("formative-classification__row",{"has-feedback":!!b}),children:[e.jsx("label",{className:"formative-classification__label",htmlFor:u,children:c.label}),e.jsxs("select",{id:u,value:n[c.id]||"",onChange:g=>r(S=>({...S,[c.id]:g.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select category"}),t.categories.map(g=>e.jsx("option",{value:g,children:g},g))]}),i&&e.jsx(Le,{tone:b!=null&&b.isCorrect?"success":"error",children:b!=null&&b.isCorrect?"Correct":"Incorrect"})]},c.id)})}),e.jsx("footer",{className:"formative__footer",children:e.jsxs(De,{align:"start",children:[!i&&e.jsx("button",{type:"submit",className:"y7-btn y7-btn--primary",children:"Check answers"}),i&&t.allowRetry!==!1&&e.jsx("button",{type:"button",className:"y7-btn",onClick:l,children:"Try again"})]})})]})}function qt({question:t,variant:s,onComplete:n,allowRetry:r=!0,disabled:i}){const a=h.useMemo(()=>s||(Array.isArray(t==null?void 0:t.options)&&typeof(t==null?void 0:t.answer)<"u"?"multiple-choice":(Array.isArray(t==null?void 0:t.items)&&Array.isArray(t==null?void 0:t.correctOrder),"ordering")),[t,s]);return a==="multiple-choice"?e.jsx(vl,{question:t,allowRetry:r,disabled:i,onSubmit:n}):a==="classification"?e.jsx(wl,{question:t,onComplete:n}):e.jsx(jl,{question:t,onComplete:n,disabled:i})}function _l({levels:t=[],onComplete:s}){const[n,r]=h.useState(0),[i,a]=h.useState(()=>new Array(5).fill(0)),[o,l]=h.useState(0),d=t[n]??null,c=d?d.bulbs:i.length;h.useEffect(()=>{d&&c!==i.length&&a(new Array(c).fill(0))},[d,c,i.length]);const u=S=>{a(x=>{const A=[...x];return A[S]=A[S]===0?1:0,A})},b=i.slice(i.length-c).reduce((S,x,A)=>S+x*Math.pow(2,c-A-1),0),g=()=>{if(!d)return;if(b===d.target){const x=n+1;l(A=>A+50),x>=t.length?s==null||s({score:o+50}):r(x)}};return e.jsxs("div",{className:"binary-light-bulbs",children:[e.jsxs("h3",{children:["Make ",(d==null?void 0:d.target)??0]}),e.jsx("div",{className:"binary-light-bulbs__grid",children:i.slice(i.length-c).map((S,x)=>e.jsx(gs.button,{type:"button",className:`binary-light-bulbs__bulb ${S===1?"is-on":""}`,onClick:()=>u(i.length-c+x),whileTap:{scale:.95},children:S},x))}),e.jsxs("p",{className:"binary-light-bulbs__value",children:["Value: ",b]}),e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",onClick:g,children:"Check"}),e.jsxs("p",{className:"binary-light-bulbs__score",children:["Score: ",o]})]})}function Nl({config:t,onComplete:s}){const[n,r]=h.useState([]),[i,a]=h.useState(!1),[o,l]=h.useState({x:0,y:0}),d=h.useCallback(()=>{for(let S=0;S<t.maze.length;S+=1){const x=t.maze[S].indexOf("S");if(x!==-1)return{x,y:S}}return{x:0,y:0}},[t]);h.useEffect(()=>{l(d())},[t,d]);const c=S=>{switch(S){case"UP":return"RIGHT";case"RIGHT":return"DOWN";case"DOWN":return"LEFT";default:return"UP"}},u=S=>{switch(S){case"UP":return"LEFT";case"LEFT":return"DOWN";case"DOWN":return"RIGHT";default:return"UP"}},b=(S,x)=>{var j;const A={...S};x==="UP"&&(A.y-=1),x==="DOWN"&&(A.y+=1),x==="LEFT"&&(A.x-=1),x==="RIGHT"&&(A.x+=1);const v=(j=t.maze[A.y])==null?void 0:j[A.x];return!v||v==="W"?S:A},g=async()=>{var A;if(n.length===0)return;a(!0);let S=d(),x="RIGHT";for(const v of n)if(await new Promise(C=>setTimeout(C,500)),v==="MOVE_FORWARD"?S=b(S,x):v==="TURN_LEFT"?x=u(x):v==="TURN_RIGHT"&&(x=c(x)),l(S),((A=t.maze[S.y])==null?void 0:A[S.x])==="G"){s==null||s({success:!0});break}a(!1)};return e.jsxs("div",{className:"robot-maze",children:[e.jsx("div",{className:"robot-maze__grid",children:t.maze.map((S,x)=>e.jsx("div",{className:"robot-maze__row",children:S.map((A,v)=>e.jsx("div",{className:`robot-maze__cell robot-maze__cell--${A.toLowerCase()}`,children:o.x===v&&o.y===x?"ðŸ¤–":A==="G"?"ðŸŽ¯":""},`cell-${v}-${x}`))},`row-${x}`))}),e.jsx("div",{className:"robot-maze__controls",children:t.commands.map(S=>e.jsx("button",{type:"button",className:"y7-btn",onClick:()=>r(x=>x.length>=t.maxCommands?x:[...x,S]),disabled:i,children:S.replace("_"," ")},S))}),e.jsx("div",{className:"robot-maze__program",children:n.map((S,x)=>e.jsx("span",{className:"robot-maze__chip",children:S.replace("_"," ")},`${S}-${x}`))}),e.jsxs("div",{className:"robot-maze__actions",children:[e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",onClick:g,disabled:i||n.length===0,children:"Run program"}),e.jsx("button",{type:"button",className:"y7-btn",onClick:()=>r([]),disabled:i,children:"Clear"})]})]})}function kl({initialCode:t,language:s="react"}){return e.jsx(Oi,{template:s,files:{"/App.js":t},options:{showNavigator:!1,showTabs:!0,showLineNumbers:!0,editorHeight:360}})}function Cl({prompt:t,duration:s=180}){const[n,r]=h.useState("think"),[i,a]=h.useState(Math.floor(s/3));h.useEffect(()=>{const l=setInterval(()=>{a(d=>d<=1?n==="think"?(r("pair"),Math.floor(s/3)):n==="pair"?(r("share"),Math.floor(s/3)):(clearInterval(l),0):d-1)},1e3);return()=>clearInterval(l)},[n,s]);const o=[{id:"think",label:"Think",icon:"ðŸ¤”"},{id:"pair",label:"Pair",icon:"ðŸ‘¥"},{id:"share",label:"Share",icon:"ðŸ’¬"}];return e.jsxs("div",{className:"think-pair-share",children:[e.jsx("h3",{children:t}),e.jsx("div",{className:"think-pair-share__phases",children:o.map(l=>e.jsxs("div",{className:`think-pair-share__phase ${n===l.id?"is-active":""}`,children:[e.jsx("span",{className:"think-pair-share__icon","aria-hidden":"true",children:l.icon}),e.jsx("span",{children:l.label})]},l.id))}),e.jsxs("p",{className:"think-pair-share__timer",children:[Math.floor(i/60),":",String(i%60).padStart(2,"0")]})]})}const Sl={ThinkPairShare:Cl,BinaryLightBulbs:_l,RobotMaze:Nl,LiveCodeEditor:kl};function Il({level:t=2,text:s}){const n=`h${Math.min(Math.max(t||2,1),4)}`;return e.jsx(n,{className:"slide-block slide-block--heading",children:s})}function or({text:t}){return e.jsx("p",{className:"slide-block slide-block--paragraph",children:t})}function Al({items:t=[]}){return e.jsx("ul",{className:"slide-block slide-block--list",children:t.map((s,n)=>e.jsx("li",{children:typeof s=="string"?s:s==null?void 0:s.text},n))})}function Tl({objectives:t=[]}){return e.jsxs("div",{className:"slide-panel slide-panel--objectives",children:[e.jsx("h3",{children:"Learning objectives"}),e.jsx("ul",{children:t.map((s,n)=>e.jsx("li",{children:s},n))})]})}function Ml({type:t="info",text:s,title:n}){return e.jsxs("div",{className:`slide-callout slide-callout--${t}`,children:[n&&e.jsx("strong",{children:n}),e.jsx("p",{children:s})]})}function Pl({prompts:t=[],submitTo:s}){return e.jsxs("div",{className:"slide-panel slide-panel--reflection",children:[e.jsx("h3",{children:"Reflection"}),e.jsx("ul",{children:t.map((n,r)=>e.jsx("li",{children:n},r))}),s&&e.jsxs("span",{className:"slide-panel__meta",children:["Responses are sent to ",s]})]})}function El({badge:t}){return t?e.jsxs("div",{className:"slide-panel slide-panel--badge",children:[e.jsx("span",{className:"slide-badge-icon","aria-hidden":"true",children:t.icon||"ðŸ…"}),e.jsxs("div",{children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.description}),typeof t.experiencePoints=="number"&&e.jsxs("span",{children:[t.experiencePoints," XP"]})]})]}):null}function Ll({component:t,props:s}){const n=Sl[t]||null;return n?e.jsx(n,{...s}):e.jsx("div",{className:"slide-panel slide-panel--placeholder",children:e.jsxs("p",{children:["Interactive component â€œ",t,"â€ is not yet supported."]})})}function cs(t,s){if(!t)return null;const{sessionId:n,studentId:r,onAssessmentComplete:i}=s??{},a=o=>{i&&(typeof o=="boolean"?i({status:o?"completed":"in-progress",score:o?1:0}):typeof o=="object"&&i(o))};switch(t.type){case"heading":return e.jsx(Il,{level:t.level,text:t.text});case"paragraph":return e.jsx(or,{text:t.text});case"list":return e.jsx(Al,{items:t.items});case"objectives":return e.jsx(Tl,{objectives:t.objectives});case"callout":return e.jsx(Ml,{type:t.variant||t.calloutType||t.style||"info",title:t.title,text:t.body||t.text});case"interactive":return e.jsx(Ll,{component:t.component,props:{...t,sessionId:n,studentId:r,onComplete:a}});case"interactiveDiagram":return e.jsxs("div",{className:"slide-panel slide-panel--diagram",children:[e.jsx("h3",{children:t.title||"Interactive diagram"}),e.jsx("p",{children:"This diagram can be explored on student devices once unlocked."})]});case"reflectionPrompts":return e.jsx(Pl,{prompts:t.prompts,submitTo:t.submitTo});case"badgeAward":return e.jsx(El,{badge:t.badge});case"experience":return e.jsxs("div",{className:"slide-panel slide-panel--xp",children:[e.jsx("h3",{children:"Earn experience"}),e.jsx("p",{children:t.description||"Complete the activity to gain XP."}),typeof t.xp=="number"&&e.jsxs("span",{children:[t.xp," XP"]})]});case"formative":return e.jsx(qt,{question:t.question,onComplete:a});default:return typeof t.text=="string"?e.jsx(or,{text:t.text}):null}}function Ol({slide:t,context:s}){var i,a,o;const n=((i=t==null?void 0:t.content)==null?void 0:i.layout)||"stack",r=Array.isArray((a=t==null?void 0:t.content)==null?void 0:a.blocks)?t.content.blocks:[];if(n==="split")return e.jsx("div",{className:"slide-layout slide-layout--split",children:r.map((l,d)=>e.jsx("div",{className:"slide-layout__column",children:cs(l,s)},d))});if(n==="gallery"){const l=((o=r[0])==null?void 0:o.items)??[];return e.jsx("div",{className:"slide-gallery",children:l.map(d=>e.jsxs("article",{className:"slide-gallery__card",children:[d.image&&e.jsx("img",{src:d.image,alt:d.title,loading:"lazy"}),e.jsxs("div",{children:[e.jsx("h3",{children:d.title}),e.jsx("p",{children:d.description})]})]},d.title))})}return n==="reflection"?e.jsx("div",{className:"slide-layout slide-layout--stack",children:r.map((l,d)=>e.jsx("div",{className:"slide-layout__item",children:cs(l,s)},d))}):e.jsx("div",{className:"slide-layout slide-layout--stack",children:r.map((l,d)=>e.jsx("div",{className:"slide-layout__item",children:cs(l,s)},d))})}function Rl({slide:t,context:s}){var i,a;const n=(a=(i=t==null?void 0:t.content)==null?void 0:i.blocks)==null?void 0:a[0];if(!n)return null;const r=o=>{s.onAssessmentComplete&&(typeof o=="boolean"?s.onAssessmentComplete({status:o?"completed":"in-progress",score:o?1:0}):typeof o=="object"&&s.onAssessmentComplete(o))};return n.type==="sortingActivity"?e.jsx(qt,{variant:"classification",question:{id:n.assessmentId||t.assessmentId,prompt:n.instruction,items:n.items,categories:n.categories},onComplete:r}):cs(n,s)}function Rs({slide:t,context:s}){const{onAssessmentComplete:n}=s,r=t==null?void 0:t.content,i=a=>{n&&(typeof a=="boolean"?n({status:a?"completed":"in-progress",score:a?1:0}):typeof a=="object"&&n(a))};return(r==null?void 0:r.type)==="multipart"?e.jsxs("div",{className:"slide-assessment slide-assessment--multipart",children:[e.jsx("h3",{children:r.title}),Array.isArray(r.parts)&&r.parts.map((a,o)=>a.type==="sequencing"?e.jsx(qt,{question:{id:`${t.id}-part-${o}`,prompt:a.prompt,items:a.items.map(l=>({id:l.id,content:l.text})),correctOrder:a.correctOrder},onComplete:i},o):a.type==="pattern-recognition"?e.jsx(qt,{variant:"multiple-choice",question:{id:`${t.id}-part-${o}`,prompt:a.prompt,options:a.options.map(l=>({id:l,label:l})),answer:a.correct},onComplete:i},o):null)]}):e.jsx(qt,{question:r,onComplete:i})}function Bl({slideData:t,isTeacher:s,sessionId:n,studentId:r,canProgress:i,onAssessmentComplete:a}){const o=h.useMemo(()=>({initial:{opacity:0,x:60},animate:{opacity:1,x:0},exit:{opacity:0,x:-60}}),[]),l=h.useMemo(()=>({isTeacher:s,sessionId:n,studentId:r,onAssessmentComplete:a}),[s,n,r,a]);if(!t)return e.jsx("div",{className:"slide-container slide-container--empty",children:e.jsx("p",{children:"Select a slide to begin."})});const{type:d}=t;return e.jsx(Ji,{mode:"wait",children:e.jsxs(gs.div,{className:`slide-container slide-container--${d}`,initial:o.initial,animate:o.animate,exit:o.exit,transition:{duration:.3,ease:"easeOut"},children:[d==="content"&&e.jsx(Ol,{slide:t,context:l}),d==="interactive"&&e.jsx(Rl,{slide:t,context:l}),d==="assessment"&&e.jsx(Rs,{slide:t,context:l}),d==="checkpoint"&&e.jsx(Rs,{slide:t,context:l}),d==="summative"&&e.jsx(Rs,{slide:t,context:l}),!s&&i===!1&&e.jsx("div",{className:"slide-lock-overlay",children:e.jsx("div",{children:e.jsx("p",{children:"Waiting for teacher to unlock this contentâ€¦"})})})]},t.id)})}const Dt=(()=>{let t=!1;typeof window<"u"&&typeof window.localStorage<"u"?t=!!window.localStorage.getItem("loggingEnabled"):t=!1;function s(n){return(...r)=>{t&&console[n](...r)}}return{info:s("info"),debug:s("debug"),error:s("error")}})();function ss(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var li={exports:{}};(function(t,s){(function(n){t.exports=n()})(function(){return function n(r,i,a){function o(c,u){if(!i[c]){if(!r[c]){var b=typeof ss=="function"&&ss;if(!u&&b)return b(c,!0);if(l)return l(c,!0);throw new Error("Cannot find module '"+c+"'")}u=i[c]={exports:{}},r[c][0].call(u.exports,function(g){var S=r[c][1][g];return o(S||g)},u,u.exports,n,r,i,a)}return i[c].exports}for(var l=typeof ss=="function"&&ss,d=0;d<a.length;d++)o(a[d]);return o}({1:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){var x=n("crypto");function A(w,N){N=C(w,N);var m;return(m=N.algorithm!=="passthrough"?x.createHash(N.algorithm):new I).write===void 0&&(m.write=m.update,m.end=m.update),R(N,m).dispatch(w),m.update||m.end(""),m.digest?m.digest(N.encoding==="buffer"?void 0:N.encoding):(w=m.read(),N.encoding!=="buffer"?w.toString(N.encoding):w)}(i=r.exports=A).sha1=function(w){return A(w)},i.keys=function(w){return A(w,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(w){return A(w,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(w){return A(w,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var v=x.getHashes?x.getHashes().slice():["sha1","md5"],j=(v.push("passthrough"),["buffer","hex","binary","base64"]);function C(w,N){var m={};if(m.algorithm=(N=N||{}).algorithm||"sha1",m.encoding=N.encoding||"hex",m.excludeValues=!!N.excludeValues,m.algorithm=m.algorithm.toLowerCase(),m.encoding=m.encoding.toLowerCase(),m.ignoreUnknown=N.ignoreUnknown===!0,m.respectType=N.respectType!==!1,m.respectFunctionNames=N.respectFunctionNames!==!1,m.respectFunctionProperties=N.respectFunctionProperties!==!1,m.unorderedArrays=N.unorderedArrays===!0,m.unorderedSets=N.unorderedSets!==!1,m.unorderedObjects=N.unorderedObjects!==!1,m.replacer=N.replacer||void 0,m.excludeKeys=N.excludeKeys||void 0,w===void 0)throw new Error("Object argument required.");for(var f=0;f<v.length;++f)v[f].toLowerCase()===m.algorithm.toLowerCase()&&(m.algorithm=v[f]);if(v.indexOf(m.algorithm)===-1)throw new Error('Algorithm "'+m.algorithm+'"  not supported. supported values: '+v.join(", "));if(j.indexOf(m.encoding)===-1&&m.algorithm!=="passthrough")throw new Error('Encoding "'+m.encoding+'"  not supported. supported values: '+j.join(", "));return m}function k(w){if(typeof w=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(w))!=null}function R(w,N,m){m=m||[];function f(p){return N.update?N.update(p,"utf8"):N.write(p,"utf8")}return{dispatch:function(p){return this["_"+((p=w.replacer?w.replacer(p):p)===null?"null":typeof p)](p)},_object:function(p){var _,O=Object.prototype.toString.call(p),F=/\[object (.*)\]/i.exec(O);if(F=(F=F?F[1]:"unknown:["+O+"]").toLowerCase(),0<=(O=m.indexOf(p)))return this.dispatch("[CIRCULAR:"+O+"]");if(m.push(p),l!==void 0&&l.isBuffer&&l.isBuffer(p))return f("buffer:"),f(p);if(F==="object"||F==="function"||F==="asyncfunction")return O=Object.keys(p),w.unorderedObjects&&(O=O.sort()),w.respectType===!1||k(p)||O.splice(0,0,"prototype","__proto__","constructor"),w.excludeKeys&&(O=O.filter(function(D){return!w.excludeKeys(D)})),f("object:"+O.length+":"),_=this,O.forEach(function(D){_.dispatch(D),f(":"),w.excludeValues||_.dispatch(p[D]),f(",")});if(!this["_"+F]){if(w.ignoreUnknown)return f("["+F+"]");throw new Error('Unknown object type "'+F+'"')}this["_"+F](p)},_array:function(p,D){D=D!==void 0?D:w.unorderedArrays!==!1;var O=this;if(f("array:"+p.length+":"),!D||p.length<=1)return p.forEach(function(E){return O.dispatch(E)});var F=[],D=p.map(function(E){var U=new I,z=m.slice();return R(w,U,z).dispatch(E),F=F.concat(z.slice(m.length)),U.read().toString()});return m=m.concat(F),D.sort(),this._array(D,!1)},_date:function(p){return f("date:"+p.toJSON())},_symbol:function(p){return f("symbol:"+p.toString())},_error:function(p){return f("error:"+p.toString())},_boolean:function(p){return f("bool:"+p.toString())},_string:function(p){f("string:"+p.length+":"),f(p.toString())},_function:function(p){f("fn:"),k(p)?this.dispatch("[native]"):this.dispatch(p.toString()),w.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(p.name)),w.respectFunctionProperties&&this._object(p)},_number:function(p){return f("number:"+p.toString())},_xml:function(p){return f("xml:"+p.toString())},_null:function(){return f("Null")},_undefined:function(){return f("Undefined")},_regexp:function(p){return f("regex:"+p.toString())},_uint8array:function(p){return f("uint8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint8clampedarray:function(p){return f("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(p))},_int8array:function(p){return f("int8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint16array:function(p){return f("uint16array:"),this.dispatch(Array.prototype.slice.call(p))},_int16array:function(p){return f("int16array:"),this.dispatch(Array.prototype.slice.call(p))},_uint32array:function(p){return f("uint32array:"),this.dispatch(Array.prototype.slice.call(p))},_int32array:function(p){return f("int32array:"),this.dispatch(Array.prototype.slice.call(p))},_float32array:function(p){return f("float32array:"),this.dispatch(Array.prototype.slice.call(p))},_float64array:function(p){return f("float64array:"),this.dispatch(Array.prototype.slice.call(p))},_arraybuffer:function(p){return f("arraybuffer:"),this.dispatch(new Uint8Array(p))},_url:function(p){return f("url:"+p.toString())},_map:function(p){return f("map:"),p=Array.from(p),this._array(p,w.unorderedSets!==!1)},_set:function(p){return f("set:"),p=Array.from(p),this._array(p,w.unorderedSets!==!1)},_file:function(p){return f("file:"),this.dispatch([p.name,p.size,p.type,p.lastModfied])},_blob:function(){if(w.ignoreUnknown)return f("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return f("domwindow")},_bigint:function(p){return f("bigint:"+p.toString())},_process:function(){return f("process")},_timer:function(){return f("timer")},_pipe:function(){return f("pipe")},_tcp:function(){return f("tcp")},_udp:function(){return f("udp")},_tty:function(){return f("tty")},_statwatcher:function(){return f("statwatcher")},_securecontext:function(){return f("securecontext")},_connection:function(){return f("connection")},_zlib:function(){return f("zlib")},_context:function(){return f("context")},_nodescript:function(){return f("nodescript")},_httpparser:function(){return f("httpparser")},_dataview:function(){return f("dataview")},_signal:function(){return f("signal")},_fsevent:function(){return f("fsevent")},_tlswrap:function(){return f("tlswrap")}}}function I(){return{buf:"",write:function(w){this.buf+=w},end:function(w){this.buf+=w},read:function(){return this.buf}}}i.writeToStream=function(w,N,m){return m===void 0&&(m=N,N={}),R(N=C(w,N),m).dispatch(w)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){(function(x){var A=typeof Uint8Array<"u"?Uint8Array:Array,v=43,j=47,C=48,k=97,R=65,I=45,w=95;function N(m){return m=m.charCodeAt(0),m===v||m===I?62:m===j||m===w?63:m<C?-1:m<C+10?m-C+26+26:m<R+26?m-R:m<k+26?m-k+26:void 0}x.toByteArray=function(m){var f,p;if(0<m.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var _=m.length,_=m.charAt(_-2)==="="?2:m.charAt(_-1)==="="?1:0,O=new A(3*m.length/4-_),F=0<_?m.length-4:m.length,D=0;function E(U){O[D++]=U}for(f=0;f<F;f+=4,0)E((16711680&(p=N(m.charAt(f))<<18|N(m.charAt(f+1))<<12|N(m.charAt(f+2))<<6|N(m.charAt(f+3))))>>16),E((65280&p)>>8),E(255&p);return _==2?E(255&(p=N(m.charAt(f))<<2|N(m.charAt(f+1))>>4)):_==1&&(E((p=N(m.charAt(f))<<10|N(m.charAt(f+1))<<4|N(m.charAt(f+2))>>2)>>8&255),E(255&p)),O},x.fromByteArray=function(m){var f,p,_,O,F=m.length%3,D="";function E(U){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(U)}for(f=0,_=m.length-F;f<_;f+=3)p=(m[f]<<16)+(m[f+1]<<8)+m[f+2],D+=E((O=p)>>18&63)+E(O>>12&63)+E(O>>6&63)+E(63&O);switch(F){case 1:D=(D+=E((p=m[m.length-1])>>2))+E(p<<4&63)+"==";break;case 2:D=(D=(D+=E((p=(m[m.length-2]<<8)+m[m.length-1])>>10))+E(p>>4&63))+E(p<<2&63)+"="}return D}})(i===void 0?this.base64js={}:i)}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(n,r,i){(function(a,o,v,d,c,u,b,g,S){var x=n("base64-js"),A=n("ieee754");function v(y,M,B){if(!(this instanceof v))return new v(y,M,B);var H,Y,q,re,ce=typeof y;if(M==="base64"&&ce=="string")for(y=(re=y).trim?re.trim():re.replace(/^\s+|\s+$/g,"");y.length%4!=0;)y+="=";if(ce=="number")H=ne(y);else if(ce=="string")H=v.byteLength(y,M);else{if(ce!="object")throw new Error("First argument needs to be a number, array or string.");H=ne(y.length)}if(v._useTypedArrays?Y=v._augment(new Uint8Array(H)):((Y=this).length=H,Y._isBuffer=!0),v._useTypedArrays&&typeof y.byteLength=="number")Y._set(y);else if(Z(re=y)||v.isBuffer(re)||re&&typeof re=="object"&&typeof re.length=="number")for(q=0;q<H;q++)v.isBuffer(y)?Y[q]=y.readUInt8(q):Y[q]=y[q];else if(ce=="string")Y.write(y,0,M);else if(ce=="number"&&!v._useTypedArrays&&!B)for(q=0;q<H;q++)Y[q]=0;return Y}function j(y,M,B,H){return v._charsWritten=J(function(Y){for(var q=[],re=0;re<Y.length;re++)q.push(255&Y.charCodeAt(re));return q}(M),y,B,H)}function C(y,M,B,H){return v._charsWritten=J(function(Y){for(var q,re,ce=[],le=0;le<Y.length;le++)re=Y.charCodeAt(le),q=re>>8,re=re%256,ce.push(re),ce.push(q);return ce}(M),y,B,H)}function k(y,M,B){var H="";B=Math.min(y.length,B);for(var Y=M;Y<B;Y++)H+=String.fromCharCode(y[Y]);return H}function R(y,M,B,q){q||(V(typeof B=="boolean","missing or invalid endian"),V(M!=null,"missing offset"),V(M+1<y.length,"Trying to read beyond buffer length"));var Y,q=y.length;if(!(q<=M))return B?(Y=y[M],M+1<q&&(Y|=y[M+1]<<8)):(Y=y[M]<<8,M+1<q&&(Y|=y[M+1])),Y}function I(y,M,B,q){q||(V(typeof B=="boolean","missing or invalid endian"),V(M!=null,"missing offset"),V(M+3<y.length,"Trying to read beyond buffer length"));var Y,q=y.length;if(!(q<=M))return B?(M+2<q&&(Y=y[M+2]<<16),M+1<q&&(Y|=y[M+1]<<8),Y|=y[M],M+3<q&&(Y+=y[M+3]<<24>>>0)):(M+1<q&&(Y=y[M+1]<<16),M+2<q&&(Y|=y[M+2]<<8),M+3<q&&(Y|=y[M+3]),Y+=y[M]<<24>>>0),Y}function w(y,M,B,H){if(H||(V(typeof B=="boolean","missing or invalid endian"),V(M!=null,"missing offset"),V(M+1<y.length,"Trying to read beyond buffer length")),!(y.length<=M))return H=R(y,M,B,!0),32768&H?-1*(65535-H+1):H}function N(y,M,B,H){if(H||(V(typeof B=="boolean","missing or invalid endian"),V(M!=null,"missing offset"),V(M+3<y.length,"Trying to read beyond buffer length")),!(y.length<=M))return H=I(y,M,B,!0),2147483648&H?-1*(4294967295-H+1):H}function m(y,M,B,H){return H||(V(typeof B=="boolean","missing or invalid endian"),V(M+3<y.length,"Trying to read beyond buffer length")),A.read(y,M,B,23,4)}function f(y,M,B,H){return H||(V(typeof B=="boolean","missing or invalid endian"),V(M+7<y.length,"Trying to read beyond buffer length")),A.read(y,M,B,52,8)}function p(y,M,B,H,Y){if(Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+1<y.length,"trying to write beyond buffer length"),G(M,65535)),Y=y.length,!(Y<=B))for(var q=0,re=Math.min(Y-B,2);q<re;q++)y[B+q]=(M&255<<8*(H?q:1-q))>>>8*(H?q:1-q)}function _(y,M,B,H,Y){if(Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+3<y.length,"trying to write beyond buffer length"),G(M,4294967295)),Y=y.length,!(Y<=B))for(var q=0,re=Math.min(Y-B,4);q<re;q++)y[B+q]=M>>>8*(H?q:3-q)&255}function O(y,M,B,H,Y){Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+1<y.length,"Trying to write beyond buffer length"),ee(M,32767,-32768)),y.length<=B||p(y,0<=M?M:65535+M+1,B,H,Y)}function F(y,M,B,H,Y){Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+3<y.length,"Trying to write beyond buffer length"),ee(M,2147483647,-2147483648)),y.length<=B||_(y,0<=M?M:4294967295+M+1,B,H,Y)}function D(y,M,B,H,Y){Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+3<y.length,"Trying to write beyond buffer length"),te(M,34028234663852886e22,-34028234663852886e22)),y.length<=B||A.write(y,M,B,H,23,4)}function E(y,M,B,H,Y){Y||(V(M!=null,"missing value"),V(typeof H=="boolean","missing or invalid endian"),V(B!=null,"missing offset"),V(B+7<y.length,"Trying to write beyond buffer length"),te(M,17976931348623157e292,-17976931348623157e292)),y.length<=B||A.write(y,M,B,H,52,8)}i.Buffer=v,i.SlowBuffer=v,i.INSPECT_MAX_BYTES=50,v.poolSize=8192,v._useTypedArrays=function(){try{var y=new ArrayBuffer(0),M=new Uint8Array(y);return M.foo=function(){return 42},M.foo()===42&&typeof M.subarray=="function"}catch{return!1}}(),v.isEncoding=function(y){switch(String(y).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.isBuffer=function(y){return!(y==null||!y._isBuffer)},v.byteLength=function(y,M){var B;switch(y+="",M||"utf8"){case"hex":B=y.length/2;break;case"utf8":case"utf-8":B=L(y).length;break;case"ascii":case"binary":case"raw":B=y.length;break;case"base64":B=Q(y).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=2*y.length;break;default:throw new Error("Unknown encoding")}return B},v.concat=function(y,M){if(V(Z(y),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),y.length===0)return new v(0);if(y.length===1)return y[0];if(typeof M!="number")for(Y=M=0;Y<y.length;Y++)M+=y[Y].length;for(var B=new v(M),H=0,Y=0;Y<y.length;Y++){var q=y[Y];q.copy(B,H),H+=q.length}return B},v.prototype.write=function(y,M,B,H){isFinite(M)?isFinite(B)||(H=B,B=void 0):(le=H,H=M,M=B,B=le),M=Number(M)||0;var Y,q,re,ce,le=this.length-M;switch((!B||le<(B=Number(B)))&&(B=le),H=String(H||"utf8").toLowerCase()){case"hex":Y=function(fe,he,ue,ve){ue=Number(ue)||0;var ye=fe.length-ue;(!ve||ye<(ve=Number(ve)))&&(ve=ye),V((ye=he.length)%2==0,"Invalid hex string"),ye/2<ve&&(ve=ye/2);for(var Ee=0;Ee<ve;Ee++){var Ue=parseInt(he.substr(2*Ee,2),16);V(!isNaN(Ue),"Invalid hex string"),fe[ue+Ee]=Ue}return v._charsWritten=2*Ee,Ee}(this,y,M,B);break;case"utf8":case"utf-8":q=this,re=M,ce=B,Y=v._charsWritten=J(L(y),q,re,ce);break;case"ascii":case"binary":Y=j(this,y,M,B);break;case"base64":q=this,re=M,ce=B,Y=v._charsWritten=J(Q(y),q,re,ce);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Y=C(this,y,M,B);break;default:throw new Error("Unknown encoding")}return Y},v.prototype.toString=function(y,M,B){var H,Y,q,re,ce=this;if(y=String(y||"utf8").toLowerCase(),M=Number(M)||0,(B=B!==void 0?Number(B):ce.length)===M)return"";switch(y){case"hex":H=function(le,fe,he){var ue=le.length;(!fe||fe<0)&&(fe=0),(!he||he<0||ue<he)&&(he=ue);for(var ve="",ye=fe;ye<he;ye++)ve+=P(le[ye]);return ve}(ce,M,B);break;case"utf8":case"utf-8":H=function(le,fe,he){var ue="",ve="";he=Math.min(le.length,he);for(var ye=fe;ye<he;ye++)le[ye]<=127?(ue+=ie(ve)+String.fromCharCode(le[ye]),ve=""):ve+="%"+le[ye].toString(16);return ue+ie(ve)}(ce,M,B);break;case"ascii":case"binary":H=k(ce,M,B);break;case"base64":Y=ce,re=B,H=(q=M)===0&&re===Y.length?x.fromByteArray(Y):x.fromByteArray(Y.slice(q,re));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":H=function(le,fe,he){for(var ue=le.slice(fe,he),ve="",ye=0;ye<ue.length;ye+=2)ve+=String.fromCharCode(ue[ye]+256*ue[ye+1]);return ve}(ce,M,B);break;default:throw new Error("Unknown encoding")}return H},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},v.prototype.copy=function(y,M,B,H){if(M=M||0,(H=H||H===0?H:this.length)!==(B=B||0)&&y.length!==0&&this.length!==0){V(B<=H,"sourceEnd < sourceStart"),V(0<=M&&M<y.length,"targetStart out of bounds"),V(0<=B&&B<this.length,"sourceStart out of bounds"),V(0<=H&&H<=this.length,"sourceEnd out of bounds"),H>this.length&&(H=this.length);var Y=(H=y.length-M<H-B?y.length-M+B:H)-B;if(Y<100||!v._useTypedArrays)for(var q=0;q<Y;q++)y[q+M]=this[q+B];else y._set(this.subarray(B,B+Y),M)}},v.prototype.slice=function(y,M){var B=this.length;if(y=z(y,B,0),M=z(M,B,B),v._useTypedArrays)return v._augment(this.subarray(y,M));for(var H=M-y,Y=new v(H,void 0,!0),q=0;q<H;q++)Y[q]=this[q+y];return Y},v.prototype.get=function(y){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(y)},v.prototype.set=function(y,M){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(y,M)},v.prototype.readUInt8=function(y,M){if(M||(V(y!=null,"missing offset"),V(y<this.length,"Trying to read beyond buffer length")),!(y>=this.length))return this[y]},v.prototype.readUInt16LE=function(y,M){return R(this,y,!0,M)},v.prototype.readUInt16BE=function(y,M){return R(this,y,!1,M)},v.prototype.readUInt32LE=function(y,M){return I(this,y,!0,M)},v.prototype.readUInt32BE=function(y,M){return I(this,y,!1,M)},v.prototype.readInt8=function(y,M){if(M||(V(y!=null,"missing offset"),V(y<this.length,"Trying to read beyond buffer length")),!(y>=this.length))return 128&this[y]?-1*(255-this[y]+1):this[y]},v.prototype.readInt16LE=function(y,M){return w(this,y,!0,M)},v.prototype.readInt16BE=function(y,M){return w(this,y,!1,M)},v.prototype.readInt32LE=function(y,M){return N(this,y,!0,M)},v.prototype.readInt32BE=function(y,M){return N(this,y,!1,M)},v.prototype.readFloatLE=function(y,M){return m(this,y,!0,M)},v.prototype.readFloatBE=function(y,M){return m(this,y,!1,M)},v.prototype.readDoubleLE=function(y,M){return f(this,y,!0,M)},v.prototype.readDoubleBE=function(y,M){return f(this,y,!1,M)},v.prototype.writeUInt8=function(y,M,B){B||(V(y!=null,"missing value"),V(M!=null,"missing offset"),V(M<this.length,"trying to write beyond buffer length"),G(y,255)),M>=this.length||(this[M]=y)},v.prototype.writeUInt16LE=function(y,M,B){p(this,y,M,!0,B)},v.prototype.writeUInt16BE=function(y,M,B){p(this,y,M,!1,B)},v.prototype.writeUInt32LE=function(y,M,B){_(this,y,M,!0,B)},v.prototype.writeUInt32BE=function(y,M,B){_(this,y,M,!1,B)},v.prototype.writeInt8=function(y,M,B){B||(V(y!=null,"missing value"),V(M!=null,"missing offset"),V(M<this.length,"Trying to write beyond buffer length"),ee(y,127,-128)),M>=this.length||(0<=y?this.writeUInt8(y,M,B):this.writeUInt8(255+y+1,M,B))},v.prototype.writeInt16LE=function(y,M,B){O(this,y,M,!0,B)},v.prototype.writeInt16BE=function(y,M,B){O(this,y,M,!1,B)},v.prototype.writeInt32LE=function(y,M,B){F(this,y,M,!0,B)},v.prototype.writeInt32BE=function(y,M,B){F(this,y,M,!1,B)},v.prototype.writeFloatLE=function(y,M,B){D(this,y,M,!0,B)},v.prototype.writeFloatBE=function(y,M,B){D(this,y,M,!1,B)},v.prototype.writeDoubleLE=function(y,M,B){E(this,y,M,!0,B)},v.prototype.writeDoubleBE=function(y,M,B){E(this,y,M,!1,B)},v.prototype.fill=function(y,M,B){if(M=M||0,B=B||this.length,V(typeof(y=typeof(y=y||0)=="string"?y.charCodeAt(0):y)=="number"&&!isNaN(y),"value is not a number"),V(M<=B,"end < start"),B!==M&&this.length!==0){V(0<=M&&M<this.length,"start out of bounds"),V(0<=B&&B<=this.length,"end out of bounds");for(var H=M;H<B;H++)this[H]=y}},v.prototype.inspect=function(){for(var y=[],M=this.length,B=0;B<M;B++)if(y[B]=P(this[B]),B===i.INSPECT_MAX_BYTES){y[B+1]="...";break}return"<Buffer "+y.join(" ")+">"},v.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(v._useTypedArrays)return new v(this).buffer;for(var y=new Uint8Array(this.length),M=0,B=y.length;M<B;M+=1)y[M]=this[M];return y.buffer};var U=v.prototype;function z(y,M,B){return typeof y!="number"?B:M<=(y=~~y)?M:0<=y||0<=(y+=M)?y:0}function ne(y){return(y=~~Math.ceil(+y))<0?0:y}function Z(y){return(Array.isArray||function(M){return Object.prototype.toString.call(M)==="[object Array]"})(y)}function P(y){return y<16?"0"+y.toString(16):y.toString(16)}function L(y){for(var M=[],B=0;B<y.length;B++){var H=y.charCodeAt(B);if(H<=127)M.push(y.charCodeAt(B));else for(var Y=B,q=(55296<=H&&H<=57343&&B++,encodeURIComponent(y.slice(Y,B+1)).substr(1).split("%")),re=0;re<q.length;re++)M.push(parseInt(q[re],16))}return M}function Q(y){return x.toByteArray(y)}function J(y,M,B,H){for(var Y=0;Y<H&&!(Y+B>=M.length||Y>=y.length);Y++)M[Y+B]=y[Y];return Y}function ie(y){try{return decodeURIComponent(y)}catch{return"ï¿½"}}function G(y,M){V(typeof y=="number","cannot write a non-number as a number"),V(0<=y,"specified a negative value for writing an unsigned value"),V(y<=M,"value is larger than maximum value for type"),V(Math.floor(y)===y,"value has a fractional component")}function ee(y,M,B){V(typeof y=="number","cannot write a non-number as a number"),V(y<=M,"value larger than maximum allowed value"),V(B<=y,"value smaller than minimum allowed value"),V(Math.floor(y)===y,"value has a fractional component")}function te(y,M,B){V(typeof y=="number","cannot write a non-number as a number"),V(y<=M,"value larger than maximum allowed value"),V(B<=y,"value smaller than minimum allowed value")}function V(y,M){if(!y)throw new Error(M||"Failed assertion")}v._augment=function(y){return y._isBuffer=!0,y._get=y.get,y._set=y.set,y.get=U.get,y.set=U.set,y.write=U.write,y.toString=U.toString,y.toLocaleString=U.toString,y.toJSON=U.toJSON,y.copy=U.copy,y.slice=U.slice,y.readUInt8=U.readUInt8,y.readUInt16LE=U.readUInt16LE,y.readUInt16BE=U.readUInt16BE,y.readUInt32LE=U.readUInt32LE,y.readUInt32BE=U.readUInt32BE,y.readInt8=U.readInt8,y.readInt16LE=U.readInt16LE,y.readInt16BE=U.readInt16BE,y.readInt32LE=U.readInt32LE,y.readInt32BE=U.readInt32BE,y.readFloatLE=U.readFloatLE,y.readFloatBE=U.readFloatBE,y.readDoubleLE=U.readDoubleLE,y.readDoubleBE=U.readDoubleBE,y.writeUInt8=U.writeUInt8,y.writeUInt16LE=U.writeUInt16LE,y.writeUInt16BE=U.writeUInt16BE,y.writeUInt32LE=U.writeUInt32LE,y.writeUInt32BE=U.writeUInt32BE,y.writeInt8=U.writeInt8,y.writeInt16LE=U.writeInt16LE,y.writeInt16BE=U.writeInt16BE,y.writeInt32LE=U.writeInt32LE,y.writeInt32BE=U.writeInt32BE,y.writeFloatLE=U.writeFloatLE,y.writeFloatBE=U.writeFloatBE,y.writeDoubleLE=U.writeDoubleLE,y.writeDoubleBE=U.writeDoubleBE,y.fill=U.fill,y.inspect=U.inspect,y.toArrayBuffer=U.toArrayBuffer,y}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(n,r,i){(function(a,o,x,d,c,u,b,g,S){var x=n("buffer").Buffer,A=4,v=new x(A);v.fill(0),r.exports={hash:function(j,C,k,R){for(var I=C(function(p,_){p.length%A!=0&&(O=p.length+(A-p.length%A),p=x.concat([p,v],O));for(var O,F=[],D=_?p.readInt32BE:p.readInt32LE,E=0;E<p.length;E+=A)F.push(D.call(p,E));return F}(j=x.isBuffer(j)?j:new x(j),R),8*j.length),C=R,w=new x(k),N=C?w.writeInt32BE:w.writeInt32LE,m=0;m<I.length;m++)N.call(w,I[m],4*m,!0);return w}}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(n,r,i){(function(a,o,x,d,c,u,b,g,S){var x=n("buffer").Buffer,A=n("./sha"),v=n("./sha256"),j=n("./rng"),C={sha1:A,sha256:v,md5:n("./md5")},k=64,R=new x(k);function I(p,_){var O=C[p=p||"sha1"],F=[];return O||w("algorithm:",p,"is not yet supported"),{update:function(D){return x.isBuffer(D)||(D=new x(D)),F.push(D),D.length,this},digest:function(D){var E=x.concat(F),E=_?function(U,z,ne){x.isBuffer(z)||(z=new x(z)),x.isBuffer(ne)||(ne=new x(ne)),z.length>k?z=U(z):z.length<k&&(z=x.concat([z,R],k));for(var Z=new x(k),P=new x(k),L=0;L<k;L++)Z[L]=54^z[L],P[L]=92^z[L];return ne=U(x.concat([Z,ne])),U(x.concat([P,ne]))}(O,_,E):O(E);return F=null,D?E.toString(D):E}}}function w(){var p=[].slice.call(arguments).join(" ");throw new Error([p,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}R.fill(0),i.createHash=function(p){return I(p)},i.createHmac=I,i.randomBytes=function(p,_){if(!_||!_.call)return new x(j(p));try{_.call(this,void 0,new x(j(p)))}catch(O){_(O)}};var N,m=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],f=function(p){i[p]=function(){w("sorry,",p,"is not implemented yet")}};for(N in m)f(m[N])}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){var x=n("./helpers");function A(w,N){w[N>>5]|=128<<N%32,w[14+(N+64>>>9<<4)]=N;for(var m=1732584193,f=-271733879,p=-1732584194,_=271733878,O=0;O<w.length;O+=16){var F=m,D=f,E=p,U=_,m=j(m,f,p,_,w[O+0],7,-680876936),_=j(_,m,f,p,w[O+1],12,-389564586),p=j(p,_,m,f,w[O+2],17,606105819),f=j(f,p,_,m,w[O+3],22,-1044525330);m=j(m,f,p,_,w[O+4],7,-176418897),_=j(_,m,f,p,w[O+5],12,1200080426),p=j(p,_,m,f,w[O+6],17,-1473231341),f=j(f,p,_,m,w[O+7],22,-45705983),m=j(m,f,p,_,w[O+8],7,1770035416),_=j(_,m,f,p,w[O+9],12,-1958414417),p=j(p,_,m,f,w[O+10],17,-42063),f=j(f,p,_,m,w[O+11],22,-1990404162),m=j(m,f,p,_,w[O+12],7,1804603682),_=j(_,m,f,p,w[O+13],12,-40341101),p=j(p,_,m,f,w[O+14],17,-1502002290),m=C(m,f=j(f,p,_,m,w[O+15],22,1236535329),p,_,w[O+1],5,-165796510),_=C(_,m,f,p,w[O+6],9,-1069501632),p=C(p,_,m,f,w[O+11],14,643717713),f=C(f,p,_,m,w[O+0],20,-373897302),m=C(m,f,p,_,w[O+5],5,-701558691),_=C(_,m,f,p,w[O+10],9,38016083),p=C(p,_,m,f,w[O+15],14,-660478335),f=C(f,p,_,m,w[O+4],20,-405537848),m=C(m,f,p,_,w[O+9],5,568446438),_=C(_,m,f,p,w[O+14],9,-1019803690),p=C(p,_,m,f,w[O+3],14,-187363961),f=C(f,p,_,m,w[O+8],20,1163531501),m=C(m,f,p,_,w[O+13],5,-1444681467),_=C(_,m,f,p,w[O+2],9,-51403784),p=C(p,_,m,f,w[O+7],14,1735328473),m=k(m,f=C(f,p,_,m,w[O+12],20,-1926607734),p,_,w[O+5],4,-378558),_=k(_,m,f,p,w[O+8],11,-2022574463),p=k(p,_,m,f,w[O+11],16,1839030562),f=k(f,p,_,m,w[O+14],23,-35309556),m=k(m,f,p,_,w[O+1],4,-1530992060),_=k(_,m,f,p,w[O+4],11,1272893353),p=k(p,_,m,f,w[O+7],16,-155497632),f=k(f,p,_,m,w[O+10],23,-1094730640),m=k(m,f,p,_,w[O+13],4,681279174),_=k(_,m,f,p,w[O+0],11,-358537222),p=k(p,_,m,f,w[O+3],16,-722521979),f=k(f,p,_,m,w[O+6],23,76029189),m=k(m,f,p,_,w[O+9],4,-640364487),_=k(_,m,f,p,w[O+12],11,-421815835),p=k(p,_,m,f,w[O+15],16,530742520),m=R(m,f=k(f,p,_,m,w[O+2],23,-995338651),p,_,w[O+0],6,-198630844),_=R(_,m,f,p,w[O+7],10,1126891415),p=R(p,_,m,f,w[O+14],15,-1416354905),f=R(f,p,_,m,w[O+5],21,-57434055),m=R(m,f,p,_,w[O+12],6,1700485571),_=R(_,m,f,p,w[O+3],10,-1894986606),p=R(p,_,m,f,w[O+10],15,-1051523),f=R(f,p,_,m,w[O+1],21,-2054922799),m=R(m,f,p,_,w[O+8],6,1873313359),_=R(_,m,f,p,w[O+15],10,-30611744),p=R(p,_,m,f,w[O+6],15,-1560198380),f=R(f,p,_,m,w[O+13],21,1309151649),m=R(m,f,p,_,w[O+4],6,-145523070),_=R(_,m,f,p,w[O+11],10,-1120210379),p=R(p,_,m,f,w[O+2],15,718787259),f=R(f,p,_,m,w[O+9],21,-343485551),m=I(m,F),f=I(f,D),p=I(p,E),_=I(_,U)}return Array(m,f,p,_)}function v(w,N,m,f,p,_){return I((N=I(I(N,w),I(f,_)))<<p|N>>>32-p,m)}function j(w,N,m,f,p,_,O){return v(N&m|~N&f,w,N,p,_,O)}function C(w,N,m,f,p,_,O){return v(N&f|m&~f,w,N,p,_,O)}function k(w,N,m,f,p,_,O){return v(N^m^f,w,N,p,_,O)}function R(w,N,m,f,p,_,O){return v(m^(N|~f),w,N,p,_,O)}function I(w,N){var m=(65535&w)+(65535&N);return(w>>16)+(N>>16)+(m>>16)<<16|65535&m}r.exports=function(w){return x.hash(w,A,16)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){r.exports=function(x){for(var A,v=new Array(x),j=0;j<x;j++)!(3&j)&&(A=4294967296*Math.random()),v[j]=A>>>((3&j)<<3)&255;return v}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){var x=n("./helpers");function A(C,k){C[k>>5]|=128<<24-k%32,C[15+(k+64>>9<<4)]=k;for(var R,I,w,N=Array(80),m=1732584193,f=-271733879,p=-1732584194,_=271733878,O=-1009589776,F=0;F<C.length;F+=16){for(var D=m,E=f,U=p,z=_,ne=O,Z=0;Z<80;Z++){N[Z]=Z<16?C[F+Z]:j(N[Z-3]^N[Z-8]^N[Z-14]^N[Z-16],1);var P=v(v(j(m,5),(P=f,I=p,w=_,(R=Z)<20?P&I|~P&w:!(R<40)&&R<60?P&I|P&w|I&w:P^I^w)),v(v(O,N[Z]),(R=Z)<20?1518500249:R<40?1859775393:R<60?-1894007588:-899497514)),O=_,_=p,p=j(f,30),f=m,m=P}m=v(m,D),f=v(f,E),p=v(p,U),_=v(_,z),O=v(O,ne)}return Array(m,f,p,_,O)}function v(C,k){var R=(65535&C)+(65535&k);return(C>>16)+(k>>16)+(R>>16)<<16|65535&R}function j(C,k){return C<<k|C>>>32-k}r.exports=function(C){return x.hash(C,A,20,!0)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){function x(k,R){var I=(65535&k)+(65535&R);return(k>>16)+(R>>16)+(I>>16)<<16|65535&I}function A(k,R){var I,w=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),N=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),m=new Array(64);k[R>>5]|=128<<24-R%32,k[15+(R+64>>9<<4)]=R;for(var f,p,_=0;_<k.length;_+=16){for(var O=N[0],F=N[1],D=N[2],E=N[3],U=N[4],z=N[5],ne=N[6],Z=N[7],P=0;P<64;P++)m[P]=P<16?k[P+_]:x(x(x((p=m[P-2],j(p,17)^j(p,19)^C(p,10)),m[P-7]),(p=m[P-15],j(p,7)^j(p,18)^C(p,3))),m[P-16]),I=x(x(x(x(Z,j(p=U,6)^j(p,11)^j(p,25)),U&z^~U&ne),w[P]),m[P]),f=x(j(f=O,2)^j(f,13)^j(f,22),O&F^O&D^F&D),Z=ne,ne=z,z=U,U=x(E,I),E=D,D=F,F=O,O=x(I,f);N[0]=x(O,N[0]),N[1]=x(F,N[1]),N[2]=x(D,N[2]),N[3]=x(E,N[3]),N[4]=x(U,N[4]),N[5]=x(z,N[5]),N[6]=x(ne,N[6]),N[7]=x(Z,N[7])}return N}var v=n("./helpers"),j=function(k,R){return k>>>R|k<<32-R},C=function(k,R){return k>>>R};r.exports=function(k){return v.hash(k,A,32,!0)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){i.read=function(x,A,v,j,_){var k,R,I=8*_-j-1,w=(1<<I)-1,N=w>>1,m=-7,f=v?_-1:0,p=v?-1:1,_=x[A+f];for(f+=p,k=_&(1<<-m)-1,_>>=-m,m+=I;0<m;k=256*k+x[A+f],f+=p,m-=8);for(R=k&(1<<-m)-1,k>>=-m,m+=j;0<m;R=256*R+x[A+f],f+=p,m-=8);if(k===0)k=1-N;else{if(k===w)return R?NaN:1/0*(_?-1:1);R+=Math.pow(2,j),k-=N}return(_?-1:1)*R*Math.pow(2,k-j)},i.write=function(x,A,v,j,C,O){var R,I,w=8*O-C-1,N=(1<<w)-1,m=N>>1,f=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=j?0:O-1,_=j?1:-1,O=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(I=isNaN(A)?1:0,R=N):(R=Math.floor(Math.log(A)/Math.LN2),A*(j=Math.pow(2,-R))<1&&(R--,j*=2),2<=(A+=1<=R+m?f/j:f*Math.pow(2,1-m))*j&&(R++,j/=2),N<=R+m?(I=0,R=N):1<=R+m?(I=(A*j-1)*Math.pow(2,C),R+=m):(I=A*Math.pow(2,m-1)*Math.pow(2,C),R=0));8<=C;x[v+p]=255&I,p+=_,I/=256,C-=8);for(R=R<<C|I,w+=C;0<w;x[v+p]=255&R,p+=_,R/=256,w-=8);x[v+p-_]|=128*O}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(n,r,i){(function(a,o,l,d,c,u,b,g,S){var x,A,v;function j(){}(a=r.exports={}).nextTick=(A=typeof window<"u"&&window.setImmediate,v=typeof window<"u"&&window.postMessage&&window.addEventListener,A?function(C){return window.setImmediate(C)}:v?(x=[],window.addEventListener("message",function(C){var k=C.source;k!==window&&k!==null||C.data!=="process-tick"||(C.stopPropagation(),0<x.length&&x.shift()())},!0),function(C){x.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),a.title="browser",a.browser=!0,a.env={},a.argv=[],a.on=j,a.addListener=j,a.once=j,a.off=j,a.removeListener=j,a.removeAllListeners=j,a.emit=j,a.binding=function(C){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(li);var Dl=li.exports;const It=Dl.MD5;function Ge(t){for(var s=arguments.length,n=Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Pt(t){return!!t&&!!t[xe]}function ht(t){return!!t&&(function(s){if(!s||typeof s!="object")return!1;var n=Object.getPrototypeOf(s);if(n===null)return!0;var r=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===zl}(t)||Array.isArray(t)||!!t[mr]||!!t.constructor[mr]||kn(t)||Cn(t))}function Et(t,s,n){n===void 0&&(n=!1),Lt(t)===0?(n?Object.keys:Mn)(t).forEach(function(r){n&&typeof r=="symbol"||s(r,t[r],t)}):t.forEach(function(r,i){return s(i,r,t)})}function Lt(t){var s=t[xe];return s?s.i>3?s.i-4:s.i:Array.isArray(t)?1:kn(t)?2:Cn(t)?3:0}function sn(t,s){return Lt(t)===2?t.has(s):Object.prototype.hasOwnProperty.call(t,s)}function Fl(t,s){return Lt(t)===2?t.get(s):t[s]}function ci(t,s,n){var r=Lt(t);r===2?t.set(s,n):r===3?(t.delete(s),t.add(n)):t[s]=n}function Ul(t,s){return t===s?t!==0||1/t==1/s:t!=t&&s!=s}function kn(t){return Vl&&t instanceof Map}function Cn(t){return Yl&&t instanceof Set}function Ie(t){return t.o||t.t}function Sn(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var s=Jl(t);delete s[xe];for(var n=Mn(s),r=0;r<n.length;r++){var i=n[r],a=s[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),s)}function In(t,s){return s===void 0&&(s=!1),An(t)||Pt(t)||!ht(t)||(Lt(t)>1&&(t.set=t.add=t.clear=t.delete=$l),Object.freeze(t),s&&Et(t,function(n,r){return In(r,!0)},!0)),t}function $l(){Ge(2)}function An(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function nt(t){var s=rn[t];return s||Ge(18,t),s}function Wl(t,s){rn[t]||(rn[t]=s)}function us(){return Jt}function Bs(t,s){s&&(nt("Patches"),t.u=[],t.s=[],t.v=s)}function hs(t){nn(t),t.p.forEach(Gl),t.p=null}function nn(t){t===Jt&&(Jt=t.l)}function lr(t){return Jt={p:[],l:Jt,h:t,m:!0,_:0}}function Gl(t){var s=t[xe];s.i===0||s.i===1?s.j():s.O=!0}function Ds(t,s){s._=s.p.length;var n=s.p[0],r=t!==void 0&&t!==n;return s.h.g||nt("ES5").S(s,t,r),r?(n[xe].P&&(hs(s),Ge(4)),ht(t)&&(t=ps(s,t),s.l||ms(s,t)),s.u&&nt("Patches").M(n[xe].t,t,s.u,s.s)):t=ps(s,n,[]),hs(s),s.u&&s.v(s.u,s.s),t!==di?t:void 0}function ps(t,s,n){if(An(s))return s;var r=s[xe];if(!r)return Et(s,function(a,o){return cr(t,r,s,a,o,n)},!0),s;if(r.A!==t)return s;if(!r.P)return ms(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=Sn(r.k):r.o;Et(r.i===3?new Set(i):i,function(a,o){return cr(t,r,i,a,o,n)}),ms(t,i,!1),n&&t.u&&nt("Patches").R(r,n,t.u,t.s)}return r.o}function cr(t,s,n,r,i,a){if(Pt(i)){var o=ps(t,i,a&&s&&s.i!==3&&!sn(s.D,r)?a.concat(r):void 0);if(ci(n,r,o),!Pt(o))return;t.m=!1}if(ht(i)&&!An(i)){if(!t.h.F&&t._<1)return;ps(t,i),s&&s.A.l||ms(t,i)}}function ms(t,s,n){n===void 0&&(n=!1),t.h.F&&t.m&&In(s,n)}function Fs(t,s){var n=t[xe];return(n?Ie(n):t)[s]}function dr(t,s){if(s in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,s);if(r)return r;n=Object.getPrototypeOf(n)}}function ct(t){t.P||(t.P=!0,t.l&&ct(t.l))}function Us(t){t.o||(t.o=Sn(t.t))}function zt(t,s,n){var r=kn(s)?nt("MapSet").N(s,n):Cn(s)?nt("MapSet").T(s,n):t.g?function(i,a){var o=Array.isArray(i),l={i:o?1:0,A:a?a.A:us(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},d=l,c=an;o&&(d=[l],c=Wt);var u=Proxy.revocable(d,c),b=u.revoke,g=u.proxy;return l.k=g,l.j=b,g}(s,n):nt("ES5").J(s,n);return(n?n.A:us()).p.push(r),r}function Hl(t){return Pt(t)||Ge(22,t),function s(n){if(!ht(n))return n;var r,i=n[xe],a=Lt(n);if(i){if(!i.P&&(i.i<4||!nt("ES5").K(i)))return i.t;i.I=!0,r=ur(n,a),i.I=!1}else r=ur(n,a);return Et(r,function(o,l){i&&Fl(i.t,o)===l||ci(r,o,s(l))}),a===3?new Set(r):r}(t)}function ur(t,s){switch(s){case 2:return new Map(t);case 3:return Array.from(t)}return Sn(t)}function ql(){function t(l,d){function c(){this.constructor=l}i(l,d),l.prototype=(c.prototype=d.prototype,new c)}function s(l){l.o||(l.D=new Map,l.o=new Map(l.t))}function n(l){l.o||(l.o=new Set,l.t.forEach(function(d){if(ht(d)){var c=zt(l.A.h,d,l);l.p.set(d,c),l.o.add(c)}else l.o.add(d)}))}function r(l){l.O&&Ge(3,JSON.stringify(Ie(l)))}var i=function(l,d){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var b in u)u.hasOwnProperty(b)&&(c[b]=u[b])})(l,d)},a=function(){function l(c,u){return this[xe]={i:2,l:u,A:u?u.A:us(),P:!1,I:!1,o:void 0,D:void 0,t:c,k:this,C:!1,O:!1},this}t(l,Map);var d=l.prototype;return Object.defineProperty(d,"size",{get:function(){return Ie(this[xe]).size}}),d.has=function(c){return Ie(this[xe]).has(c)},d.set=function(c,u){var b=this[xe];return r(b),Ie(b).has(c)&&Ie(b).get(c)===u||(s(b),ct(b),b.D.set(c,!0),b.o.set(c,u),b.D.set(c,!0)),this},d.delete=function(c){if(!this.has(c))return!1;var u=this[xe];return r(u),s(u),ct(u),u.t.has(c)?u.D.set(c,!1):u.D.delete(c),u.o.delete(c),!0},d.clear=function(){var c=this[xe];r(c),Ie(c).size&&(s(c),ct(c),c.D=new Map,Et(c.t,function(u){c.D.set(u,!1)}),c.o.clear())},d.forEach=function(c,u){var b=this;Ie(this[xe]).forEach(function(g,S){c.call(u,b.get(S),S,b)})},d.get=function(c){var u=this[xe];r(u);var b=Ie(u).get(c);if(u.I||!ht(b)||b!==u.t.get(c))return b;var g=zt(u.A.h,b,u);return s(u),u.o.set(c,g),g},d.keys=function(){return Ie(this[xe]).keys()},d.values=function(){var c,u=this,b=this.keys();return(c={})[ns]=function(){return u.values()},c.next=function(){var g=b.next();return g.done?g:{done:!1,value:u.get(g.value)}},c},d.entries=function(){var c,u=this,b=this.keys();return(c={})[ns]=function(){return u.entries()},c.next=function(){var g=b.next();if(g.done)return g;var S=u.get(g.value);return{done:!1,value:[g.value,S]}},c},d[ns]=function(){return this.entries()},l}(),o=function(){function l(c,u){return this[xe]={i:3,l:u,A:u?u.A:us(),P:!1,I:!1,o:void 0,t:c,k:this,p:new Map,O:!1,C:!1},this}t(l,Set);var d=l.prototype;return Object.defineProperty(d,"size",{get:function(){return Ie(this[xe]).size}}),d.has=function(c){var u=this[xe];return r(u),u.o?!!u.o.has(c)||!(!u.p.has(c)||!u.o.has(u.p.get(c))):u.t.has(c)},d.add=function(c){var u=this[xe];return r(u),this.has(c)||(n(u),ct(u),u.o.add(c)),this},d.delete=function(c){if(!this.has(c))return!1;var u=this[xe];return r(u),n(u),ct(u),u.o.delete(c)||!!u.p.has(c)&&u.o.delete(u.p.get(c))},d.clear=function(){var c=this[xe];r(c),Ie(c).size&&(n(c),ct(c),c.o.clear())},d.values=function(){var c=this[xe];return r(c),n(c),c.o.values()},d.entries=function(){var c=this[xe];return r(c),n(c),c.o.entries()},d.keys=function(){return this.values()},d[ns]=function(){return this.values()},d.forEach=function(c,u){for(var b=this.values(),g=b.next();!g.done;)c.call(u,g.value,g.value,this),g=b.next()},l}();Wl("MapSet",{N:function(l,d){return new a(l,d)},T:function(l,d){return new o(l,d)}})}var hr,Jt,Tn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Vl=typeof Map<"u",Yl=typeof Set<"u",pr=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",di=Tn?Symbol.for("immer-nothing"):((hr={})["immer-nothing"]=!0,hr),mr=Tn?Symbol.for("immer-draftable"):"__$immer_draftable",xe=Tn?Symbol.for("immer-state"):"__$immer_state",ns=typeof Symbol<"u"&&Symbol.iterator||"@@iterator",zl=""+Object.prototype.constructor,Mn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Jl=Object.getOwnPropertyDescriptors||function(t){var s={};return Mn(t).forEach(function(n){s[n]=Object.getOwnPropertyDescriptor(t,n)}),s},rn={},an={get:function(t,s){if(s===xe)return t;var n=Ie(t);if(!sn(n,s))return function(i,a,o){var l,d=dr(a,o);return d?"value"in d?d.value:(l=d.get)===null||l===void 0?void 0:l.call(i.k):void 0}(t,n,s);var r=n[s];return t.I||!ht(r)?r:r===Fs(t.t,s)?(Us(t),t.o[s]=zt(t.A.h,r,t)):r},has:function(t,s){return s in Ie(t)},ownKeys:function(t){return Reflect.ownKeys(Ie(t))},set:function(t,s,n){var r=dr(Ie(t),s);if(r!=null&&r.set)return r.set.call(t.k,n),!0;if(!t.P){var i=Fs(Ie(t),s),a=i==null?void 0:i[xe];if(a&&a.t===n)return t.o[s]=n,t.D[s]=!1,!0;if(Ul(n,i)&&(n!==void 0||sn(t.t,s)))return!0;Us(t),ct(t)}return t.o[s]===n&&typeof n!="number"&&(n!==void 0||s in t.o)||(t.o[s]=n,t.D[s]=!0,!0)},deleteProperty:function(t,s){return Fs(t.t,s)!==void 0||s in t.t?(t.D[s]=!1,Us(t),ct(t)):delete t.D[s],t.o&&delete t.o[s],!0},getOwnPropertyDescriptor:function(t,s){var n=Ie(t),r=Reflect.getOwnPropertyDescriptor(n,s);return r&&{writable:!0,configurable:t.i!==1||s!=="length",enumerable:r.enumerable,value:n[s]}},defineProperty:function(){Ge(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){Ge(12)}},Wt={};Et(an,function(t,s){Wt[t]=function(){return arguments[0]=arguments[0][0],s.apply(this,arguments)}}),Wt.deleteProperty=function(t,s){return Wt.set.call(this,t,s,void 0)},Wt.set=function(t,s,n){return an.set.call(this,t[0],s,n,t[0])};var Zl=function(){function t(n){var r=this;this.g=pr,this.F=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var l=a;a=i;var d=r;return function(A){var v=this;A===void 0&&(A=l);for(var j=arguments.length,C=Array(j>1?j-1:0),k=1;k<j;k++)C[k-1]=arguments[k];return d.produce(A,function(R){var I;return(I=a).call.apply(I,[v,R].concat(C))})}}var c;if(typeof a!="function"&&Ge(6),o!==void 0&&typeof o!="function"&&Ge(7),ht(i)){var u=lr(r),b=zt(r,i,void 0),g=!0;try{c=a(b),g=!1}finally{g?hs(u):nn(u)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(A){return Bs(u,o),Ds(A,u)},function(A){throw hs(u),A}):(Bs(u,o),Ds(c,u))}if(!i||typeof i!="object"){if((c=a(i))===void 0&&(c=i),c===di&&(c=void 0),r.F&&In(c,!0),o){var S=[],x=[];nt("Patches").M(i,c,S,x),o(S,x)}return c}Ge(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(c){for(var u=arguments.length,b=Array(u>1?u-1:0),g=1;g<u;g++)b[g-1]=arguments[g];return r.produceWithPatches(c,function(S){return i.apply(void 0,[S].concat(b))})};var o,l,d=r.produce(i,a,function(c,u){o=c,l=u});return typeof Promise<"u"&&d instanceof Promise?d.then(function(c){return[c,o,l]}):[d,o,l]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var s=t.prototype;return s.createDraft=function(n){ht(n)||Ge(8),Pt(n)&&(n=Hl(n));var r=lr(this),i=zt(this,n,void 0);return i[xe].C=!0,nn(r),i},s.finishDraft=function(n,r){var i=n&&n[xe],a=i.A;return Bs(a,r),Ds(void 0,a)},s.setAutoFreeze=function(n){this.F=n},s.setUseProxies=function(n){n&&!pr&&Ge(20),this.g=n},s.applyPatches=function(n,r){var i;for(i=r.length-1;i>=0;i--){var a=r[i];if(a.path.length===0&&a.op==="replace"){n=a.value;break}}i>-1&&(r=r.slice(i+1));var o=nt("Patches").$;return Pt(n)?o(n,r):this.produce(n,function(l){return o(l,r)})},t}(),Fe=new Zl,Ql=Fe.produce;Fe.produceWithPatches.bind(Fe);Fe.setAutoFreeze.bind(Fe);Fe.setUseProxies.bind(Fe);Fe.applyPatches.bind(Fe);Fe.createDraft.bind(Fe);Fe.finishDraft.bind(Fe);function ui(t,s){const n=Object.keys(t),r=Object.keys(s);return n.length===r.length&&Object.keys(t).every(i=>s.hasOwnProperty(i))}function fr(t,s){return Object.keys(t).length===Object.keys(s).length&&Object.keys(t).every(n=>s.hasOwnProperty(n)&&t[n]===s[n])}function hi(t,s){return typeof t!="object"||typeof s!="object"||t===null||s===null?t===s:ui(t,s)?Object.keys(t).every(n=>hi(t[n],s[n])):!1}function pi(t,s){if(!Tt(t)||!Tt(s))return s;const n={};for(const r of Object.keys(t))n[r]=t[r];for(const r of Object.keys(s)){if(s[r]===null)continue;const i=Tt(t[r])&&Tt(s[r]);n[r]=i?pi(t[r],s[r]):s[r]}return n}function mi(t,s,n){if(!Tt(t))return t;const r={};for(const[i,a]of Object.entries(t))r[i]=Tt(a)?mi(a,s,n):a===s?n:a;return r}function Tt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}ql();function Kl(t){return t.cardinality==="one"}function Pn(t){return t["value-type"]==="ref"}function Xl(t){return t["value-type"]==="blob"}function ws(t,s){return t[s]}function fi(t,s){return s.reduce((n,r)=>n&&n.get(r),t)}function dt(t,s){if(s.length===0)throw new Error("path must have at least one element");if(s.length===1){t.delete(s[0]);return}const[n,...r]=s;t.has(n)&&dt(t.get(n),r)}function st(t,s,n){if(s.length===0)throw new Error("path must have at least one element");if(s.length===1){t.set(s[0],n);return}const[r,...i]=s;let a=t.get(r);a||(a=new Map,t.set(r,a)),st(a,i,n)}function gi(t,s){const n=new Map,r=new Map,i=new Map;for(const a of s){const[o,l,d,c]=a,u=ws(t,l);if(!u){console.warn("no such attr",o,t);continue}Pn(u)&&st(i,[d,l,o],a),st(n,[o,l,d],a),st(r,[l,o,d],a)}return{eav:n,aev:r,vae:i}}function gr(t,s){const n=gi(t,s);return n.attrs=t,n}function _s(t,s){var n,r;let i;if(Array.isArray(s[0])){const[o,l]=s[0],d=t.aev.get(o);if(!d)return null;i=(n=xt(d,2).find(u=>u[2]===l))===null||n===void 0?void 0:n[0]}else i=s[0];if(!i)return null;const a=s[2];if(Array.isArray(a)&&a.length===2&&t.aev.get(a[0])){const[o,l]=a,d=t.aev.get(o);if(!d)return null;const u=(r=xt(d,2).find(A=>A[2]===l))===null||r===void 0?void 0:r[0];if(!u)return null;const[b,g,S,...x]=s;return[i,g,u,...x]}else{const[o,...l]=s;return[i,...l]}}function ec(t,s){const n=_s(t,s);if(!n)return;const[r,i,a]=n,o=ws(t.attrs,i);o&&(dt(t.eav,[r,i,a]),dt(t.aev,[i,r,a]),Pn(o)&&dt(t.vae,[a,i,r]))}let tc=0;function bi(t,s,n){const[r,i,a]=n;let o;const l=fi(t.ea,[r,i,a]);return l&&(o=l[3]),o||Date.now()*10+tc++}function sc(t,s){const n=_s(t,s);if(!n)return;const[r,i,a]=n,o=ws(t.attrs,i);if(!o)return;const l=[...n,bi(t,o,n)];Kl(o)?(st(t.eav,[r,i],new Map([[a,l]])),st(t.aev,[i,r],new Map([[a,l]]))):(st(t.eav,[r,i,a],l),st(t.aev,[i,r,a],l)),Pn(o)&&st(t.vae,[a,i,r],l)}function nc(t,s){var n;const r=_s(t,s);if(!r)return;const[i,a,o]=r,l=ws(t.attrs,a);if(!l)return;if(!Xl(l))throw new Error("merge operation is not supported for links");const d=fi(t.eav,[i,a]);if(!d)return;const c=(n=d.values().next())===null||n===void 0?void 0:n.value;if(!c)return;const u=c[2],b=pi(u,o),g=[i,a,b,bi(t,l,c)];st(t.eav,[i,a],new Map([[b,g]]))}function rc(t,s){const n=_s(t,s);if(!n)return;const[r]=n,i=t.eav.get(r);if(i)for(const o of i.keys())dt(t.aev,[o,r]);dt(t.eav,[r]);const a=t.vae.get(r)&&xt(t.vae.get(r),2);a&&a.forEach(o=>{const[l,d,c]=o;dt(t.eav,[l,d,c]),dt(t.aev,[d,l,c])}),dt(t.vae,[r])}function yi(t,s){const n=gi(t.attrs,s);Object.keys(n).forEach(r=>{t[r]=n[r]})}function ic(t,[s]){t.attrs[s.id]=s}function xi(t){return xt(t.eav,3)}function ac(t,[s]){if(!t.attrs[s])return;const n=xi(t).filter(([r,i])=>i!==s);delete t.attrs[s],yi(t,n)}function oc(t,[s]){const n=t.attrs[s.id];n&&(t.attrs[s.id]=Object.assign(Object.assign({},n),s),yi(t,xi(t)))}function lc(t,s){const[n,...r]=s;switch(n){case"add-triple":sc(t,r);break;case"deep-merge-triple":nc(t,r);break;case"retract-triple":ec(t,r);break;case"delete-entity":rc(t,r);break;case"add-attr":ic(t,r);break;case"delete-attr":ac(t,r);break;case"update-attr":oc(t,r);break;default:throw new Error(`unhandled transaction action: ${n}`)}}function xt(t,s,n=[]){if(!t||s===0)return n;if(s===1){for(const r of t.values())n.push(r);return n}for(const r of t.values())xt(r,s-1,n);return n}function rs(t,s){const n=[],r=s.in?s.in:[s];for(const i of r){const a=t.get(i);a&&n.push(a)}return n}function cc(t,s,n){let r="";return t!==void 0&&(r+="e"),s!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function dc(t,[s,n,r]){var i,a;switch(cc(s,n,r)){case"e":{const l=t.eav.get(s);return xt(l,2)}case"ea":{const l=(i=t.eav.get(s))===null||i===void 0?void 0:i.get(n);return xt(l,1)}case"eav":{const l=(a=t.eav.get(s))===null||a===void 0?void 0:a.get(n);return l?rs(l,r):[]}case"ev":{const l=t.eav.get(s);if(!l)return[];const d=[];for(const c of l.values())d.push(...rs(c,r));return d}case"av":{const l=t.aev.get(n);if(!l)return[];const d=[];for(const c of l.values())d.push(...rs(c,r));return d}case"v":{const l=[];for(const d of t.eav.values())for(const c of d.values())l.push(...rs(c,r))}default:return xt(t.eav,3)}}function uc(t,s){return Ql(t,n=>{s.forEach(r=>{lc(n,r)})})}function hc(t){return typeof t=="string"&&t.startsWith("?")}function pc(t,s,n){if(n.hasOwnProperty(t)){const r=n[t];return vi(r,s,n)}return Object.assign(Object.assign({},n),{[t]:s})}function br(t,s,n){return t===s?n:null}function mc(t,s,n){const{in:r}=t;return r&&r.includes(s)?n:null}function fc(t){switch(typeof t){case"string":return t.startsWith("?")?pc:br;case"object":return mc;default:return br}}function vi(t,s,n){return n?fc(t)(t,s,n):null}function gc(t,s,n){return t.reduce((r,i,a)=>{const o=s[a];return vi(i,o,r)},n)}function bc(t,s,n){return vc(t,s,n).map(r=>gc(s,r,n)).filter(r=>r)}function yc(t,s,n){return s.or?s.or.patterns.flatMap(r=>on(t,r,n)):s.and?s.and.patterns.reduce((r,i)=>on(t,i,r),n):n.flatMap(r=>bc(t,s,r))}function on(t,s,n=[{}]){return s.reduce((r,i)=>yc(t,i,r),n)}function En(t,s){return Array.isArray(s)?s.map(n=>En(t,n)):hc(s)?t[s]:s}function xc(t,{find:s,where:n}){return on(t,n).map(i=>En(i,s))}function vc(t,s,n){return dc(t,En(n,s))}let is;const jc=new Uint8Array(16);function wc(){if(!is&&(is=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!is))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return is(jc)}const Me=[];for(let t=0;t<256;++t)Me.push((t+256).toString(16).slice(1));function _c(t,s=0){return Me[t[s+0]]+Me[t[s+1]]+Me[t[s+2]]+Me[t[s+3]]+"-"+Me[t[s+4]]+Me[t[s+5]]+"-"+Me[t[s+6]]+Me[t[s+7]]+"-"+Me[t[s+8]]+Me[t[s+9]]+"-"+Me[t[s+10]]+Me[t[s+11]]+Me[t[s+12]]+Me[t[s+13]]+Me[t[s+14]]+Me[t[s+15]]}const Nc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yr={randomUUID:Nc};function Ae(t,s,n){if(yr.randomUUID&&!t)return yr.randomUUID();t=t||{};const r=t.random||(t.rng||wc)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,_c(r)}function xr(t){const s=t.replace(/-/g,""),n=[];for(let r=0;r<s.length;r+=2)n.push(parseInt(s.substring(r,r+2),16));return n}function kc(t,s){for(let n=0;n<t.length;n++){if(t[n]<s[n])return-1;if(t[n]>s[n])return 1}return 0}function vr(t,s){return kc(xr(t),xr(s))}function Ln(t,s,n){return Object.values(t).find(r=>{const[i,a,o]=r["forward-identity"];return a===s&&o===n})}function Cc(t,s,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[a,o,l]=i;return o===s&&l===n})}let Sc=0;function fs(t){return Ns(`_${t}`,Sc++)}function Ns(t,s){return`?${t}-${s}`}class Kt extends Error{constructor(s){super(s),this.name="AttrNotFoundError"}}function Ic(t,s){const n=Object.values(t.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===s});return n||Ln(t.attrs,s,"id")}function Ac(t,s){const n=Ic(t,s);if(!n)throw new Kt(`Could not find id attr for ${s}`);return n}function jr(t,s,n,r){return[Tc(t,s,n,r),Mc(t,n,r)]}function Tc(t,s,n,r){return[t(n,r),Ac(s,n).id,t(n,r),fs("time")]}function Mc(t,s,n){return[t(s,n),t("attr",n),t("val",n),t("time",n)]}function Pc(t,s,n){return t.map(r=>r===s?n:r)}function ji(t,s,n,r,i){const a=Ln(s.attrs,n,i),o=Cc(s.attrs,n,i),l=a||o;if(!l)throw new Kt(`Could not find attr for ${[n,i]}`);if(l["value-type"]!=="ref")throw new Error(`Attr ${l.id} is not a ref`);const[d,c]=l["forward-identity"],[u,b]=l["reverse-identity"],g=r+1,S=a?[t(c,r),l.id,t(b,g),fs("time")]:[t(c,g),l.id,t(b,r),fs("time")];return[a?b:c,g,S]}function Ec(t,s,n,r,i,a){const o=Ln(s.attrs,n,i);if(!o)throw new Kt(`No attr for etype = ${n} label = ${i} value-label`);return[t(n,r),o.id,a,fs("time")]}function Lc(t,s,n,r,i){const[a,o,l]=i.reduce((d,c)=>{const[u,b,g]=d,[S,x,A]=ji(t,s,u,b,c);return[S,x,[...g,A]]},[n,r,[]]);return[a,o,l]}function Oc(t,s,n,r,i,a){const o=i.slice(0,i.length-1),l=i[i.length-1],[d,c,u]=Lc(t,s,n,r,o),b=Ec(t,s,d,c,l,a);return u.concat([b])}function Rc(t,s){return s?[s].concat(t):t}function Bc([t,s]){return t==="or"&&Array.isArray(s)}function Dc([t,s]){return t==="and"&&Array.isArray(s)}function Fc(t,s,n){return(r,i)=>r==s?t(r,i):`${t(r,i)}-${n}`}function wr(t,s,n,r,i,a){const o=a.map((d,c)=>{const u=Fc(t,r,c);return wi(u,n,r,i,d)}),l=t(r,i);return{[s]:{patterns:o,joinSym:l}}}function wi(t,s,n,r,i){return Object.entries(i).flatMap(([a,o])=>{if(Bc([a,o]))return wr(t,"or",s,n,r,o);if(Dc([a,o]))return wr(t,"and",s,n,r,o);const l=a.split(".");return Oc(t,s,n,r,l,o)})}function Uc(t,s,n,r){const i=Ns;return r?wi(i,t,s,n,r).concat(jr(i,t,s,n)):jr(i,t,s,n)}function $c(t,s,n){return[t(s,n),t("attr",n),t("val",n),t("time",n)]}function Wc(t,s,n,r,i,a){const[o,l,d]=ji(t,s,n,r,i),c=Pc(d,t(n,r),a);return[o,l,c]}function Gc(t,s,{etype:n,level:r,form:i},a){const o=Object.keys(i).filter(l=>l!=="$");return o.length?Object.entries(a).map(([l,d])=>o.map(u=>{try{const[b,g,S]=Wc(t,s,n,r,u,l),x=_i(s,{etype:b,level:g,form:i[u],join:S});return{[u]:x}}catch(b){if(b instanceof Kt)return{[u]:[]};throw b}}).reduce((u,b)=>Object.assign(Object.assign({},u),b),d)):Object.values(a)}function Hc(t,s){const n=t[s];return n["value-type"]==="ref"&&n["forward-identity"][2]!=="id"}function _r(t,s){switch(t){case"asc":switch(s){case"number":return(n,r)=>n<r;case"uuid":return(n,r)=>vr(n,r)===-1}case"desc":switch(s){case"number":return(n,r)=>n>r;case"uuid":return(n,r)=>vr(n,r)===1}}}function qc(t,s,[n,r,i,a]){return _r(s,"number")(a,t[3])||a===t[3]&&_r(s,"uuid")(n,t[0])}function Vc(t,s,n,r,i){const a=r==null?void 0:r["start-cursor"],o=[],l=xc(t,i).sort((d,c)=>{const u=d[3],b=c[3];return n==="desc"?b-u:u-b}).reduce((d,c)=>{const[u,b,g]=c;if(Hc(t.attrs,b))return d;const S=t.attrs[b],[x,A,v]=S["forward-identity"];return A!==s||(a&&b===a[1]&&qc(a,n,c)&&o.push(u),d[u]=d[u]||{},d[u][v]=g),d},{});for(const d of o)delete l[d];return l}function Yc(t){var s;const n=(s=t.$)===null||s===void 0?void 0:s.order;return n&&n[Object.keys(n)[0]]||"asc"}function zc(t,{etype:s,level:n,form:r,join:i,pageInfo:a}){var o,l,d,c,u,b,g;const S=((o=r.$)===null||o===void 0?void 0:o.limit)||((l=r.$)===null||l===void 0?void 0:l.first)||((d=r.$)===null||d===void 0?void 0:d.last),x=(c=r.$)===null||c===void 0?void 0:c.offset,A=(u=r.$)===null||u===void 0?void 0:u.before,v=(b=r.$)===null||b===void 0?void 0:b.after;if((x||A||v)&&(!a||!a["start-cursor"]))return[];const j=Rc(Uc(t,s,n,(g=r.$)===null||g===void 0?void 0:g.where),i),C=$c(Ns,s,n),k=Vc(t,s,Yc(r),a,{where:j,find:C});if(S!=null){const R=Object.entries(k);return R.length<=S?k:Object.fromEntries(R.slice(0,S))}return k}function Jc(t,s){try{return zc(t,s)}catch(n){if(n instanceof Kt)return{};throw n}}function _i(t,s){const n=Jc(t,s);return Gc(Ns,t,s,n)}function Zc(t){const s={};for(const[n,r]of Object.entries(t))s[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"]};return s}function Qc({store:t,pageInfo:s,aggregate:n},r){const a={data:Object.keys(r).reduce((o,l)=>(n!=null&&n[l]||(o[l]=_i(t,{etype:l,form:r[l],level:0,pageInfo:s==null?void 0:s[l]})),o),{})};return s&&(a.pageInfo=Zc(s)),n&&(a.aggregate=n),a}function ln(t,s,n){return new Proxy({},{get:(r,i)=>i==="__ops"?n:a=>ln(t,s,[...n,[i,t,s,a]])})}function cn(t){return t.startsWith("lookup__")}function Ni(t){const[s,n,...r]=t.split("__");return[n,JSON.parse(r.join("__"))]}function Kc(t){return new Proxy({},{get(s,n){return cn(n)?ln(t,Ni(n),[]):ln(t,n,[])}})}function Xc(){return new Proxy({},{get(t,s){return Kc(s)}})}const dn=Xc();function ed(t){return t.__ops}function pt(t,s,n){return Object.values(t).find(r=>{const[i,a,o]=r["forward-identity"];return a===s&&o===n})}function On(t,s,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[a,o,l]=i;return o===s&&l===n})}function td(t){if(Array.isArray(t))return t;const s=Object.entries(t);if(s.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return s[0]}function He(t,s,n){if(typeof n=="string"&&!cn(n))return n;const[r,i]=typeof n=="string"&&cn(n)?Ni(n):td(n),a=pt(t,s,r);if(!a||!a["unique?"])throw new Error(`${r} is not a unique attribute.`);return[a.id,i]}function sd(t,[s,n,r]){return Object.entries(r).flatMap(([a,o])=>{const l=Array.isArray(o)?o:[o],d=pt(t,s,a),c=On(t,s,a);return l.map(u=>d?["add-triple",He(t,s,n),d.id,He(t,d["reverse-identity"][1],u)]:["add-triple",He(t,c["forward-identity"][1],u),c.id,He(t,s,n)])})}function nd(t,[s,n,r]){return Object.entries(r).flatMap(([a,o])=>{const l=Array.isArray(o)?o:[o],d=pt(t,s,a),c=On(t,s,a);return l.map(u=>d?["retract-triple",He(t,s,n),d.id,He(t,d["reverse-identity"][1],u)]:["retract-triple",He(t,c["forward-identity"][1],u),c.id,He(t,s,n)])})}function rd(t,[s,n,r]){const i=He(t,s,n);return Object.entries(r).concat([["id",He(t,s,n)]]).map(([o,l])=>{const d=pt(t,s,o);return["add-triple",i,d.id,l]})}function id(t,[s,n]){return[["delete-entity",He(t,s,n)]]}function ad(t,[s,n,r]){const i=He(t,s,n),a=Object.entries(r).map(([l,d])=>{const c=pt(t,s,l),u=mi(d,void 0,null);return["deep-merge-triple",i,c.id,u]}),o=["add-triple",i,pt(t,s,"id").id,i];return a.concat([o])}function od(t,[s,...n]){switch(s){case"merge":return ad(t,n);case"update":return rd(t,n);case"link":return sd(t,n);case"unlink":return nd(t,n);case"delete":return id(t,n);default:throw new Error(`unsupported action ${s}`)}}function ki([t,s,n,r]){return[...new Set(Object.keys(r).concat("id"))].map(o=>[s,o])}function ld([t,s]){const n=Ae(),i=[Ae(),t,s];return{id:n,"forward-identity":i,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1}}function cd([t,s]){const n=Ae(),r=Ae(),i=Ae();return{id:n,"forward-identity":[r,t,s],"reverse-identity":[i,s,t],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1}}function Ci(t){const s=new Set,n=[];return t.forEach(r=>{const[i,a]=r,o=`${i}:${a}`;s.has(o)||(s.add(o),n.push(r))}),n}function dd(t,s){const n=s.filter(([d])=>d==="update"||d==="merge"),a=Ci(n.flatMap(ki)).filter(([d,c])=>!pt(t,d,c)).map(ld),o=a.reduce((d,c)=>(d[c.id]=c,d),Object.assign({},t)),l=a.map(d=>["add-attr",d]);return[o,l]}function ud(t,s){const n=s.filter(([d])=>d==="link"||d==="unlink"),a=Ci(n.flatMap(ki)).filter(([d,c])=>!pt(t,d,c)&&!On(t,d,c)).map(cd),o=a.reduce((d,c)=>(d[c.id]=c,d),Object.assign({},t)),l=a.map(d=>["add-attr",d]);return[o,l]}function hd(t,s){const r=(Array.isArray(s)?s:[s]).flatMap(c=>ed(c)),[i,a]=dd(t,r),[o,l]=ud(i,r),d=r.flatMap(c=>od(o,c));return[...a,...l,...d]}var Nr=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};class Si{constructor(s){this.dbName=s,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((s,n)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{n(i)},r.onsuccess=i=>{s(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(s){return Nr(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const l=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(s);l.onerror=d=>{i(d)},l.onsuccess=d=>{l.result?r(l.result):r(null)}})})}setItem(s,n){return Nr(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,a)=>{const d=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,s);d.onerror=c=>{a(c)},d.onsuccess=c=>{i()}})})}}var pd=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};class Ii{static getIsOnline(){return pd(this,void 0,void 0,function*(){return window.navigator.onLine})}static listen(s){const n=()=>{s(!0)},r=()=>{s(!1)};return window.addEventListener("online",n),window.addEventListener("offline",r),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}}var md=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};function St(t,s){return md(this,void 0,void 0,function*(){const n=yield fetch(t,s),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject({status:n.status,body:r})})}var ks=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};function fd({apiURI:t,appId:s,email:n}){return St(`${t}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":s,email:n})})}function gd(t){return ks(this,arguments,void 0,function*({apiURI:s,appId:n,email:r,code:i}){return yield St(`${s}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,email:r,code:i})})})}function bd(t){return ks(this,arguments,void 0,function*({apiURI:s,appId:n,refreshToken:r}){return yield St(`${s}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function kr(t){return ks(this,arguments,void 0,function*({apiURI:s,appId:n,code:r,codeVerifier:i}){return yield St(`${s}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i})})})}function yd(t){return ks(this,arguments,void 0,function*({apiURI:s,appId:n,nonce:r,idToken:i,clientName:a}){return yield St(`${s}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:a})})})}var Rn=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};function xd(t){return Rn(this,arguments,void 0,function*({apiURI:s,appId:n,fileName:r,refreshToken:i,metadata:a={}}){const{data:o}=yield St(`${s}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return o})}function vd(t,s){return Rn(this,void 0,void 0,function*(){return(yield fetch(t,{method:"PUT",body:s,headers:{"Content-Type":s.type}})).ok})}function jd(t){return Rn(this,arguments,void 0,function*({apiURI:s,appId:n,path:r,refreshToken:i}){const{data:a}=yield St(`${s}/storage/signed-download-url?app_id=${n}&filename=${r}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return a})}function Cr(t,s){if(!s)return t;const n={};return s.forEach(r=>{n[r]=t[r]}),n}function wd(t,s){var n,r;const i={peers:{}};if(s&&"user"in s?s.user:!0){const o=Cr((n=t.user)!==null&&n!==void 0?n:{},s==null?void 0:s.keys);i.user=o}for(const o of Object.keys((r=t.peers)!==null&&r!==void 0?r:{})){const l=(s==null?void 0:s.peers)===void 0,d=Array.isArray(s==null?void 0:s.peers)&&(s==null?void 0:s.peers.includes(o));if(l||d){const c=Cr(t.peers[o],s==null?void 0:s.keys);i.peers[o]=c}}return i}function _d(t,s){if(t.isLoading!==s.isLoading||t.error!==s.error||(t.user||s.user)&&(!t.user||!s.user||!fr(t.user,s.user))||!ui(t.peers,s.peers))return!0;for(const r of Object.keys(t.peers))if(!fr(t.peers[r],s.peers[r]))return!0;return!1}class Nd{constructor(){this.promise=new Promise((s,n)=>{this._resolve=s,this._reject=n})}resolve(s){this._resolve(s)}reject(s){this._reject(s)}}var Sr=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};class Ir{constructor(s,n,r,i,a=l=>JSON.stringify(l),o=l=>JSON.parse(l)){this._persister=s,this._key=n,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=a,this.fromJSON=o,this._load()}_load(){return Sr(this,void 0,void 0,function*(){const s=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(s,this.currentValue);for(const n of this._loadedCbs)n()})}waitForLoaded(){return Sr(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(n=>{this._loadedCbs.push(n)})})}set(s,n){this.currentValue=s(this.currentValue),this._isLoading||setTimeout(()=>{this._persister.setItem(this._key,this.toJSON(this.currentValue)),n&&n()},0)}}function Ai(t,s=[]){t.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":a}=i;for(const o of a)for(const l of o)s.push(l);Ai(n["child-nodes"],s)})}function Ar(t){const s=[];return Ai(t,s),s}function kd(t,s){return s instanceof Map?{__type:"m",entries:[...s.entries()]}:s}function Cd(t,s){return s&&typeof s=="object"&&s.__type==="m"?new Map(s.entries):s}function Sd(t){return JSON.stringify(t,kd)}function Id(t){return JSON.parse(t,Cd)}var Re=function(t,s,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(u){try{c(r.next(u))}catch(b){o(b)}}function d(u){try{c(r.throw(u))}catch(b){o(b)}}function c(u){u.done?a(u.value):i(u.value).then(l,d)}c((r=r.apply(t,s||[])).next())})};const jt={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},Ad=1,Td={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},$s="_instant_oauth_redirect",Ws="currentUser";class Md{constructor(s,n=Si,r=Ii){this._isOnline=!0,this._isShutdown=!1,this.status=jt.CONNECTING,this.queryCbs={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._presence={},this._broadcastSubs={},this._onMergeQuerySubs=(i,a)=>{const o=i||{},l=Object.assign({},a);Object.entries(a).forEach(([c,u])=>{var b;const g=(b=o==null?void 0:o[c])===null||b===void 0?void 0:b.result,S=u.result;g&&!S&&(l[c].result=g)}),Object.keys(o).filter(c=>!a[c]).slice(0,10).forEach(c=>{l[c]=o[c]}),this.querySubs.set(c=>l),this.notifyAll()},this._onMergePendingMutations=(i,a)=>{const o=new Map([...i.entries(),...a.entries()]);this.pendingMutations.set(d=>o),this._rewriteMutations(this.attrs,i).forEach((d,c)=>{!a.has(c)&&!d["tx-id"]&&this._sendMutation(c,d)})},this.notifyOne=i=>{const a=this.queryCbs[i]||[];if(!a)return;const o=this._errorMessage;if(o){a.forEach(b=>b({error:o}));return}const{q:l,result:d,iqlResult:c}=this.querySubs.currentValue[i]||{};if(!d)return;const u=this.dataForResult(l,d);hi(u.data,c)||(this.querySubs.currentValue[i].iqlResult=d.data,a.forEach(b=>b(u)))},this.notifyQueryError=(i,a)=>{(this.queryCbs[i]||[]).forEach(l=>l({error:a}))},this.pushTx=i=>{const a=hd(this.optimisticAttrs(),i);return this.pushOps(a)},this.pushOps=i=>{const a=Ae(),o={op:"transact","tx-steps":i};this.pendingMutations.set(d=>(d.set(a,o),d));const l=new Nd;return this.mutationDeferredStore.set(a,l),this._sendMutation(a,o),this.notifyAll(),l.promise},this._wsOnOpen=()=>{Dt.info("[socket] connected"),this._setStatus(jt.OPENED),this.getCurrentUser().then(i=>{var a;this._trySend(Ae(),{op:"init","app-id":this.config.appId,"refresh-token":(a=i.user)===null||a===void 0?void 0:a.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{Dt.error("[socket] error: ",i)},this._wsOnClose=()=>{if(this._setStatus(jt.CLOSED),this._isShutdown){Dt.info("[socket-close] socket has been shut down and will not reconnect");return}Dt.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){Dt.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},Td),s),!(typeof window>"u")&&("BroadcastChannel"in window&&typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>Re(this,void 0,void 0,function*(){var a;if(((a=i.data)===null||a===void 0?void 0:a.type)==="auth"){const o=yield this.getCurrentUser();this.updateUser(o.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(n),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(a=>{a!==this._isOnline&&(this._isOnline=a,this._isOnline&&this._startSocket())})}))}_initStorage(s){this._persister=new s(`instant_${this.config.appId}_4`),this.querySubs=new Ir(this._persister,"querySubs",{},this._onMergeQuerySubs,Sd,Id),this.pendingMutations=new Ir(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,n=>JSON.stringify([...n.entries()]),n=>new Map(JSON.parse(n)))}_finishTransaction(s,n,r,i){const a=this.mutationDeferredStore.get(r);this.mutationDeferredStore.delete(r),!a&&!s&&console.error("Mutation failed",Object.assign({status:n,clientId:r},i)),a&&(s?a.resolve({status:n,clientId:r}):a.reject(Object.assign({status:n,clientId:r},i)))}_setStatus(s,n){this.status=s,this._errorMessage=n}_cleanPendingMutations(s){this.pendingMutations.set(n=>{const r=new Map(n);return[...n.entries()].forEach(([i,a])=>{a["tx-id"]<=s&&r.delete(i)}),r})}_handleReceive(s){var n,r,i,a;switch(s.op){case"init-ok":this._setStatus(jt.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(s.attrs),this._flushPendingMessages(),this._sessionId=s["session-id"];break;case"add-query-ok":const{q:o,result:l,"processed-tx-id":d}=s;this._cleanPendingMutations(d);const c=It(o),u=(r=(n=l==null?void 0:l[0])===null||n===void 0?void 0:n.data)===null||r===void 0?void 0:r["page-info"],b=(a=(i=l==null?void 0:l[0])===null||i===void 0?void 0:i.data)===null||a===void 0?void 0:a.aggregate,g=Ar(l),S=gr(this.attrs,g);this.querySubs.set(E=>(E[c].result={store:S,pageInfo:u,aggregate:b},E)),this.notifyOne(c);break;case"refresh-ok":const{computations:x,attrs:A,"processed-tx-id":v}=s;this._cleanPendingMutations(v),this._setAttrs(A);const j=x.map(E=>{var U,z,ne,Z;const P=E["instaql-query"],L=E["instaql-result"],Q=It(P),J=Ar(L),ie=gr(this.attrs,J),G=(z=(U=L==null?void 0:L[0])===null||U===void 0?void 0:U.data)===null||z===void 0?void 0:z["page-info"],ee=(Z=(ne=L==null?void 0:L[0])===null||ne===void 0?void 0:ne.data)===null||Z===void 0?void 0:Z.aggregate;return{hash:Q,store:ie,pageInfo:G,aggregate:ee}});j.forEach(({hash:E,store:U,pageInfo:z,aggregate:ne})=>{this.querySubs.set(Z=>(Z[E].result={store:U,pageInfo:z,aggregate:ne},Z))}),j.forEach(({hash:E})=>{this.notifyOne(E)});break;case"transact-ok":const{"client-event-id":C,"tx-id":k}=s,I=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(C);if(!I)break;const w=Object.assign(Object.assign({},I),{"tx-id":k});this.pendingMutations.set(E=>(E.set(C,w),E)),this._finishTransaction(!0,"synced",C);const N=I["tx-steps"].filter(([E,...U])=>E==="add-attr").map(([E,U])=>U).concat(Object.values(this.attrs));this._setAttrs(N);break;case"refresh-presence":const m=s["room-id"];this._setPresencePeers(m,s.data),this._notifyPresenceSubs(m);break;case"server-broadcast":const f=s["room-id"],p=s.topic;this._notifyBroadcastSubs(f,p,s);break;case"join-room-ok":const _=s["room-id"],O=this._presence[_];O&&(O.isLoading=!1),this._notifyPresenceSubs(_);break;case"join-room-error":const F=s["room-id"],D=this._presence[F];D&&(D.error=s.error),this._notifyPresenceSubs(F);break;case"error":this._handleReceiveError(s);break}}_handleReceiveError(s){var n,r;const i=s["client-event-id"];if(this.pendingMutations.currentValue.get(i)){this.pendingMutations.set(u=>(u.delete(i),u)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(s);const c={message:s.message,hint:s.hint};this._finishTransaction(!1,"error",i,c);return}const o=s.q||((n=s["original-event"])===null||n===void 0?void 0:n.q);if(o){this.querySubs.set(c=>{const u=It(o);return delete c[u],c}),this.notifyQueryError(It(o),{message:s.message||"Uh-oh, something went wrong. Ping Joe & Stopa."});return}if(((r=s["original-event"])===null||r===void 0?void 0:r.op)==="init"){const c={message:s.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};this._setStatus(jt.ERRORED,c),this.notifyAll();return}const d=Object.assign({},s);delete d.message,delete d.hint,console.error(s.message,d),s.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,s.hint)}_setAttrs(s){this.attrs=s.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}subscribeQuery(s,n){var r,i;const a=Ae(),o=It(s);this.queryCbs[o]=this.queryCbs[o]||[],this.queryCbs[o].push(n),this.querySubs.set(c=>(c[o]=c[o]||{q:s,result:null,eventId:a},c)),this._trySendAuthed(a,{op:"add-query",q:s});const l=this._errorMessage,d=(i=(r=this.querySubs.currentValue)===null||r===void 0?void 0:r[o])===null||i===void 0?void 0:i.result;return l?n({error:l}):d&&n(this.dataForResult(s,d)),()=>{this.queryCbs[o]=this.queryCbs[o].filter(c=>c!==n)}}_rewriteMutations(s,n){if(!s)return n;const r=([d,c])=>{if(d!=="add-attr")return;const[u,b,g]=c["forward-identity"];return pt(s,b,g)},i=(d,c)=>c.reduce(([u,b],g)=>{const S=r(g);if(S){const[k,R]=g;return u[R.id]=S.id,[u,b]}const[x,A,v,...j]=g,C=u[v]?[x,A,u[v],...j]:g;return b.push(C),[u,b]},[d,[]]),[a,o,l]=[...n.entries()].reduce(([d,c,u],[b,g])=>{const[S,x]=i(c,g["tx-steps"]);return u.set(b,Object.assign(Object.assign({},g),{"tx-steps":x})),[d,S,u]},[s,{},new Map]);return l}optimisticAttrs(){var s;const n=[...this.pendingMutations.currentValue.values()].flatMap(l=>l["tx-steps"]),r=new Set(n.filter(([l,d])=>l==="delete-attr").map(([l,d])=>d)),i=[];for(const[l,d]of n)if(l==="add-attr")i.push(d);else if(l==="update-attr"&&d.id&&(!((s=this.attrs)===null||s===void 0)&&s[d.id])){const c=Object.assign(Object.assign({},this.attrs[d.id]),d);i.push(c)}const a=[...Object.values(this.attrs||{}),...i].filter(l=>!r.has(l.id));return Object.fromEntries(a.map(l=>[l.id,l]))}dataForResult(s,{store:n,pageInfo:r,aggregate:i}){const o=[...this._rewriteMutations(n.attrs,this.pendingMutations.currentValue).values()].flatMap(c=>c["tx-steps"]),l=uc(n,o);return Qc({store:l,pageInfo:r,aggregate:i},s)}notifyAll(){Object.keys(this.queryCbs).forEach(s=>{this.notifyOne(s)})}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(s,n){if(this.status!==jt.AUTHENTICATED){this._finishTransaction(!0,"enqueued",s);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(s,n),window.setTimeout(()=>{this._finishTransaction(!0,"pending",s)},3e3),window.setTimeout(()=>{if(!this._isOnline)return;const i=this.pendingMutations.currentValue.get(s);i&&!i["tx-id"]&&(this.pendingMutations.set(a=>(a.delete(s),a)),this._finishTransaction(!1,"timeout",s),console.error("mutation timed out",i))},r)):this._finishTransaction(!0,"enqueued",s)}_flushPendingMessages(){Object.keys(this.queryCbs).map(o=>this.querySubs.currentValue[o]).filter(o=>o).forEach(({eventId:o,q:l})=>{this._trySendAuthed(o,{op:"add-query",q:l})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((o,l)=>{o["tx-id"]||this._sendMutation(l,o)}),Object.keys(this._presence).forEach(o=>{this._trySendAuthed(Ae(),{op:"join-room","room-id":o})}),Object.entries(this._presence).forEach(([o,{result:l}])=>{const d=l==null?void 0:l.user;d&&this._trySendAuthed(Ae(),{op:"set-presence","room-id":o,data:d})})}_trySendAuthed(s,n){this.status===jt.AUTHENTICATED&&this._trySend(s,n)}_trySend(s,n){this._ws.readyState===Ad&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":s},n)))}_startSocket(){this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(s){return Re(this,void 0,void 0,function*(){const n=`localToken_${s}`,r=yield this._persister.getItem(n);if(r)return r;if(this._localIdPromises[n])return this._localIdPromises[n];const i=Ae();return this._localIdPromises[n]=this._persister.setItem(n,i).then(()=>i),this._localIdPromises[n]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const s=new URL(window.location.href);if(s.searchParams.get($s)){const n=s.toString();s.searchParams.delete($s),s.searchParams.delete("code"),s.searchParams.delete("error");const r=s.pathname+(s.searchParams.size?"?"+s.searchParams:"")+s.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const a=o=>{var l;i||(i=!0,navigation.removeEventListener("navigate",a),!o.userInitiated&&o.navigationType==="replace"&&((l=o.destination)===null||l===void 0?void 0:l.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",a)}}}_oauthLoginInit(){return Re(this,void 0,void 0,function*(){var s,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const a=new URLSearchParams(window.location.search);if(!a.get($s))return null;const o=a.get("error");if(o)return this._replaceUrlAfterOAuth(),{error:{message:o}};const l=a.get("code");if(!l)return null;this._replaceUrlAfterOAuth();try{const{user:d}=yield kr({apiURI:this.config.apiURI,appId:this.config.appId,code:l});return this.setCurrentUser(d),null}catch(d){return((s=d==null?void 0:d.body)===null||s===void 0?void 0:s.type)==="record-not-found"&&((r=(n=d==null?void 0:d.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=d==null?void 0:d.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return Re(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(s){return this.mutationErrorCbs.push(s),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==s)}}subscribeAuth(s){this.authCbs.push(s);let n=!1;return this.getCurrentUser().then(r=>{n||s(r)}),()=>{n=!0,this.authCbs=this.authCbs.filter(r=>r!==s)}}subscribeAttrs(s){return this.attrsCbs.push(s),this.attrs&&s(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==s)}}notifyAuthSubs(s){this.authCbs.forEach(n=>n(s))}notifyMutationErrorSubs(s){this.mutationErrorCbs.forEach(n=>n(s))}notifyAttrsSubs(){if(!this.attrs)return;const s=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(s))}setCurrentUser(s){return Re(this,void 0,void 0,function*(){yield this._persister.setItem(Ws,JSON.stringify(s))})}getCurrentUser(){return Re(this,void 0,void 0,function*(){const s=yield this._waitForOAuthCallbackResponse();if(s!=null&&s.error)return{error:s.error};const n=yield this._persister.getItem(Ws);return{user:JSON.parse(n)}})}_hasCurrentUser(){return Re(this,void 0,void 0,function*(){const s=yield this._persister.getItem(Ws);return JSON.parse(s)!=null})}changeCurrentUser(s){return Re(this,void 0,void 0,function*(){var n;yield this.setCurrentUser(s),this.updateUser(s);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(r){console.error("Error posting message to broadcast channel",r)}})}updateUser(s){this.querySubs.set(n=>(Object.keys(n).forEach(r=>{delete n[r].result}),n)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs({user:s})}sendMagicCode({email:s}){return fd({apiURI:this.config.apiURI,appId:this.config.appId,email:s})}signInWithMagicCode(s){return Re(this,arguments,void 0,function*({email:n,code:r}){const i=yield gd({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(s){return Re(this,void 0,void 0,function*(){const n=yield bd({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:s});this.changeCurrentUser(n.user)})}signOut(){this.changeCurrentUser(null)}createAuthorizationURL({clientName:s,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${s}&redirect_uri=${n}`}exchangeCodeForToken(s){return Re(this,arguments,void 0,function*({code:n,codeVerifier:r}){const i=yield kr({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:s,appId:n}=this.config;return`${s}/runtime/${n}`}signInWithIdToken(s){return Re(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){const a=yield yd({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i});return this.changeCurrentUser(a.user),a})}joinRoom(s){return this._trySendAuthed(Ae(),{op:"join-room","room-id":s}),()=>{this._cleanupRoom(s)}}_cleanupRoom(s){var n,r,i;!(!((r=(n=this._presence[s])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[s])!==null&&i!==void 0?i:{}).length&&(delete this._presence[s],delete this._broadcastSubs[s],this._trySendAuthed(Ae(),{op:"leave-room","room-id":s}))}getPresence(s,n,r={}){const i=this._presence[n];return!i||!i.result?null:Object.assign(Object.assign({},wd(i.result,r)),{isLoading:i.isLoading,error:i.error})}publishPresence(s,n,r){var i,a;const o=Object.assign(Object.assign({},(a=(i=this._presence[n])===null||i===void 0?void 0:i.result)===null||a===void 0?void 0:a.user),r);this._trySendAuthed(Ae(),{op:"set-presence","room-id":n,data:o}),this._presence[n]=this._presence[n]||{},this._presence[n].result=this._presence[n].result||{},this._presence[n].result.user=o,this._notifyPresenceSubs(n)}subscribePresence(s,n,r,i){const a=this.joinRoom(n),o=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].isLoading=!0,this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(o),this._notifyPresenceSub(n,o),()=>{var l,d,c;this._presence[n].handlers=(c=(d=(l=this._presence[n])===null||l===void 0?void 0:l.handlers)===null||d===void 0?void 0:d.filter(u=>u!==o))!==null&&c!==void 0?c:[],a()}}_notifyPresenceSubs(s){var n,r;(r=(n=this._presence[s])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(s,i)})}_notifyPresenceSub(s,n){const r=this.getPresence("",s,n);r&&(n.prev&&!_d(r,n.prev)||(n.prev=r,n.cb(r)))}_setPresencePeers(s,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([a,o])=>[a,o.data]));this._presence[s]=this._presence[s]||{},this._presence[s].result=this._presence[s].result||{},this._presence[s].result.peers=i}publishTopic({roomType:s,roomId:n,topic:r,data:i}){this._trySendAuthed(Ae(),{op:"client-broadcast","room-id":n,roomType:s,topic:r,data:i})}subscribeTopic(s,n,r){const i=this.joinRoom(s);return this._broadcastSubs[s]=this._broadcastSubs[s]||{},this._broadcastSubs[s][n]=this._broadcastSubs[s][n]||[],this._broadcastSubs[s][n].push(r),this._presence[s]=this._presence[s]||{},()=>{this._broadcastSubs[s][n]=this._broadcastSubs[s][n].filter(a=>a!==r),this._broadcastSubs[s][n].length||delete this._broadcastSubs[s][n],i()}}_notifyBroadcastSubs(s,n,r){var i,a,o;(o=(a=(i=this._broadcastSubs)===null||i===void 0?void 0:i[s])===null||a===void 0?void 0:a[n])===null||o===void 0||o.forEach(l=>{var d,c,u,b,g,S;const x=(d=r.data)===null||d===void 0?void 0:d.data,A=r.data["peer-id"]===this._sessionId?(u=(c=this._presence[s])===null||c===void 0?void 0:c.result)===null||u===void 0?void 0:u.user:(S=(g=(b=this._presence[s])===null||b===void 0?void 0:b.result)===null||g===void 0?void 0:g.peers)===null||S===void 0?void 0:S[r.data["peer-id"]];return l(x,A)})}upload(s,n){return Re(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),a=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,o=s||n.name,l=yield xd({apiURI:this.config.apiURI,appId:this.config.appId,fileName:o,refreshToken:a});return yield vd(l,n),this.getDownloadUrl(o)})}getDownloadUrl(s){return Re(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield jd({apiURI:this.config.apiURI,appId:this.config.appId,path:s,refreshToken:i})})}}let as;function Pd(t){as==null||as.dispose();const s=Rd(),n=Od(o),r=Ld(Ed(t));function i(c){var u;c.source===r.element.contentWindow&&((u=c.data)===null||u===void 0?void 0:u.type)==="close"&&s.isVisible()&&o()}function a(c){const u=c.shiftKey&&c.ctrlKey&&c.key==="0",b=c.key==="Escape"||c.key==="Esc";(u||b)&&o()}function o(){s.isVisible()?s.element.style.display="none":(s.element.style.display="block",s.element.contains(r.element)||s.element.appendChild(r.element))}function l(){s.element.remove(),n.element.remove(),removeEventListener("keydown",a),removeEventListener("message",i)}function d(){document.body.appendChild(s.element),document.body.appendChild(n.element),addEventListener("keydown",a),addEventListener("message",i),as={dispose:l}}return d()}function Ed(t){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${t}`}function Ld(t){const s=document.createElement("iframe");return s.src=t,Object.assign(s.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white"}),{element:s}}function Od(t){const s=document.createElement("button");return s.innerText="Î»",Object.assign(s.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",backgroundColor:"#444",fontSize:"16px",fontFamily:"sans-serif",fontStyle:"normal",border:"1px white solid",borderRadius:"8px",zIndex:"999991"}),s.addEventListener("click",t),{element:s}}function Rd(){const t=document.createElement("div");Object.assign(t.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),t.style.display="none";function s(){return t.style.display!=="none"}return{element:t,isVisible:s}}const Bd=!1,Dd={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function Fd(){var t;return typeof window<"u"?(window.__instantDbStore=(t=window.__instantDbStore)!==null&&t!==void 0?t:{},window.__instantDbStore):{}}const un=Fd();function Ud(t,s,n){const r=un[t.appId];if(r)return r;const i=new Md(Object.assign(Object.assign({},Dd),t),s||Si,n||Ii),a=new $d(i);return un[t.appId]=a,typeof window<"u"&&("devtool"in t?t.devtool:Bd)&&location.hostname==="localhost"&&!globalThis._nodevtool&&Pd(t.appId),a}class $d{constructor(s){this._reactor=s,this.auth=new Wd(this._reactor),this.storage=new Gd(this._reactor)}transact(s){return this._reactor.pushTx(s)}getLocalId(s){return this._reactor.getLocalId(s)}subscribeQuery(s,n){return this._reactor.subscribeQuery(s,n)}subscribeAuth(s){return this._reactor.subscribeAuth(s)}joinRoom(s="_defaultRoomType",n="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(n),subscribeTopic:(i,a)=>this._reactor.subscribeTopic(n,i,a),subscribePresence:(i,a)=>this._reactor.subscribePresence(s,n,i,a),publishTopic:(i,a)=>this._reactor.publishTopic({roomType:s,roomId:n,topic:i,data:a}),publishPresence:i=>this._reactor.publishPresence(s,n,i),getPresence:i=>this._reactor.getPresence(s,n,i)}}shutdown(){delete un[this._reactor.config.appId],this._reactor.shutdown()}}class Wd{constructor(s){this.db=s,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>{this.db.signOut()}}}class Gd{constructor(s){this.db=s,this.put=(n,r)=>this.db.upload(n,r),this.getDownloadUrl=n=>this.db.getDownloadUrl(n)}}function Hd(t){return JSON.parse(JSON.stringify(t))}function qd(t,s){const n=Hd(s),[r,i]=h.useState({isLoading:!0,data:void 0,pageInfo:void 0,error:void 0});return h.useEffect(()=>(i({isLoading:!0,data:void 0,error:void 0,pageInfo:void 0}),t.subscribeQuery(n,o=>{i(Object.assign({isLoading:!1},o))})),[It(n)]),{state:r,query:n}}function Vd(){const t=h.useRef(null);h.useEffect(()=>{n()},[]);function s(r,i){clearTimeout(t.current),t.current=setTimeout(i,r)}function n(){clearTimeout(t.current)}return{set:s,clear:n}}const Yd=1e3;class zd{constructor(s,n,r){this.useTopicEffect=(i,a)=>{h.useEffect(()=>this._core._reactor.subscribeTopic(this.id,i,(l,d)=>{a(l,d)}),[this.id,i])},this.usePublishTopic=i=>(h.useEffect(()=>this._core._reactor.joinRoom(this.id),[this.id]),h.useCallback(o=>{this._core._reactor.publishTopic({roomType:this.type,roomId:this.id,topic:i,data:o})},[this.id,i])),this.usePresence=(i={})=>{var a,o;const[l,d]=h.useState(()=>{var c;return(c=this._core._reactor.getPresence(this.type,this.id,i))!==null&&c!==void 0?c:{peers:{},isLoading:!0}});return h.useEffect(()=>this._core._reactor.subscribePresence(this.type,this.id,i,u=>{d(u)}),[this.id,i.user,(a=i.peers)===null||a===void 0?void 0:a.join(),(o=i.keys)===null||o===void 0?void 0:o.join()]),Object.assign(Object.assign({},l),{publishPresence:c=>{this._core._reactor.publishPresence(this.type,this.id,c)}})},this.useSyncPresence=(i,a)=>{h.useEffect(()=>this._core._reactor.publishPresence(this.type,this.id,i),[this.type,this.id,a??JSON.stringify(i)])},this.useTypingIndicator=(i,a={})=>{const o=Vd(),l=this.usePresence({keys:[i]}),d=h.useMemo(()=>{var u;const b=this._core._reactor.getPresence(this.type,this.id);return a!=null&&a.writeOnly?[]:Object.values((u=b==null?void 0:b.peers)!==null&&u!==void 0?u:{}).filter(g=>g[i]===!0)},[a==null?void 0:a.writeOnly,l]),c=u=>{var b;this._core._reactor.publishPresence(this.type,this.id,{[i]:u}),u&&((a==null?void 0:a.timeout)===null||(a==null?void 0:a.timeout)===0||o.set((b=a==null?void 0:a.timeout)!==null&&b!==void 0?b:Yd,()=>{this._core._reactor.publishPresence(this.type,this.id,{[i]:null})}))};return{active:d,setActive:u=>{c(u)},inputProps:{onKeyDown:u=>{const g=!((a==null?void 0:a.stopOnEnter)&&u.key==="Enter");c(g)},onBlur:()=>{c(!1)}}}},this._core=s,this.type=n,this.id=r}}class Jd{constructor(s){this.getLocalId=n=>this._core.getLocalId(n),this.transact=n=>this._core.transact(n),this.useQuery=n=>qd(this._core,n).state,this.useAuth=()=>{const[n,r]=h.useState({isLoading:!0,user:void 0,error:void 0});return h.useEffect(()=>this._core._reactor.subscribeAuth(a=>{r(Object.assign({isLoading:!1},a))}),[]),n},this._core=Ud(s,this.constructor.Storage,this.constructor.NetworkListener),this.auth=this._core.auth,this.storage=this._core.storage}room(s="_defaultRoomType",n="_defaultRoomId"){return new zd(this._core,s,n)}}class Zd extends Jd{}function Qd(t){return new Zd(t)}const Gs={};var Kd={};const Tr=typeof globalThis<"u"&&globalThis.process?Kd??{}:{},Mr=(Gs==null?void 0:Gs.VITE_INSTANTDB_APP_ID)??Tr.NEXT_PUBLIC_INSTANTDB_APP_ID??Tr.VITE_INSTANTDB_APP_ID,Oe=Mr?Qd({appId:Mr,schema:{liveSessions:{classId:{type:"string",indexed:!0},lessonId:{type:"string",indexed:!0},lessonKey:{type:"string"},deckId:{type:"string",indexed:!0},status:{type:"string"},pointer:{currentSlideId:{type:"string"},currentIndex:{type:"number"},maxUnlockedIndex:{type:"number"},timestamp:{type:"number"}},slideHistory:{type:"array"},activeAssessments:{type:"array"},startedAt:{type:"number"},attendance:{type:"object"}},studentStates:{sessionId:{type:"string",indexed:!0},studentId:{type:"string",indexed:!0},classId:{type:"string",indexed:!0},currentPosition:{type:"number"},currentSlideId:{type:"string"},viewedSlides:{type:"array"},timePerSlide:{type:"object"},isActive:{type:"boolean"},isBehind:{type:"boolean"},lastHeartbeat:{type:"number"}},assessmentResponses:{sessionId:{type:"string",indexed:!0},studentId:{type:"string",indexed:!0},assessmentId:{type:"string",indexed:!0},attempts:{type:"array"},isComplete:{type:"boolean"},score:{type:"number"},lastUpdated:{type:"number"}},analytics:{type:{type:"string",indexed:!0},sessionId:{type:"string",indexed:!0},classId:{type:"string",indexed:!0},studentId:{type:"string",indexed:!0},slideId:{type:"string"},timestamp:{type:"number"},payload:{type:"object"}},slideMetrics:{slideId:{type:"string",indexed:!0},averageViewTime:{type:"number"},totalViews:{type:"number"}}}}):null;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var hn=function(t,s){return hn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},hn(t,s)};function Xd(t,s){hn(t,s);function n(){this.constructor=t}t.prototype=s===null?Object.create(s):(n.prototype=s.prototype,new n)}var eu=100,tu=100,Pr=50,pn=50,mn=50;function Er(t){var s=t.className,n=t.counterClockwise,r=t.dashRatio,i=t.pathRadius,a=t.strokeWidth,o=t.style;return h.createElement("path",{className:s,style:Object.assign({},o,nu({pathRadius:i,dashRatio:r,counterClockwise:n})),d:su({pathRadius:i,counterClockwise:n}),strokeWidth:a,fillOpacity:0})}function su(t){var s=t.pathRadius,n=t.counterClockwise,r=s,i=n?1:0;return`
      M `+pn+","+mn+`
      m 0,-`+r+`
      a `+r+","+r+" "+i+" 1 1 0,"+2*r+`
      a `+r+","+r+" "+i+" 1 1 0,-"+2*r+`
    `}function nu(t){var s=t.counterClockwise,n=t.dashRatio,r=t.pathRadius,i=Math.PI*2*r,a=(1-n)*i;return{strokeDasharray:i+"px "+i+"px",strokeDashoffset:(s?-a:a)+"px"}}var ru=function(t){Xd(s,t);function s(){return t!==null&&t.apply(this,arguments)||this}return s.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},s.prototype.getPathRadius=function(){return Pr-this.props.strokeWidth/2-this.getBackgroundPadding()},s.prototype.getPathRatio=function(){var n=this.props,r=n.value,i=n.minValue,a=n.maxValue,o=Math.min(Math.max(r,i),a);return(o-i)/(a-i)},s.prototype.render=function(){var n=this.props,r=n.circleRatio,i=n.className,a=n.classes,o=n.counterClockwise,l=n.styles,d=n.strokeWidth,c=n.text,u=this.getPathRadius(),b=this.getPathRatio();return h.createElement("svg",{className:a.root+" "+i,style:l.root,viewBox:"0 0 "+eu+" "+tu,"data-test-id":"CircularProgressbar"},this.props.background?h.createElement("circle",{className:a.background,style:l.background,cx:pn,cy:mn,r:Pr}):null,h.createElement(Er,{className:a.trail,counterClockwise:o,dashRatio:r,pathRadius:u,strokeWidth:d,style:l.trail}),h.createElement(Er,{className:a.path,counterClockwise:o,dashRatio:b*r,pathRadius:u,strokeWidth:d,style:l.path}),c?h.createElement("text",{className:a.text,style:l.text,x:pn,y:mn},c):null)},s.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},s}(h.Component);function iu(t){var s=t.rotation,n=t.strokeLinecap,r=t.textColor,i=t.textSize,a=t.pathColor,o=t.pathTransition,l=t.pathTransitionDuration,d=t.trailColor,c=t.backgroundColor,u=s==null?void 0:"rotate("+s+"turn)",b=s==null?void 0:"center center";return{root:{},path:os({stroke:a,strokeLinecap:n,transform:u,transformOrigin:b,transition:o,transitionDuration:l==null?void 0:l+"s"}),trail:os({stroke:d,strokeLinecap:n,transform:u,transformOrigin:b}),text:os({fill:r,fontSize:i}),background:os({fill:c})}}function os(t){return Object.keys(t).forEach(function(s){t[s]==null&&delete t[s]}),t}function au(t){return t!=null&&t.isActive?t.isBehind?"live-dashboard__tile--behind":"live-dashboard__tile--on-time":"live-dashboard__tile--idle"}function ou({sessionId:t,classSize:s=0}){const[n,r]=h.useState([]),[i,a]=h.useState({}),o=h.useMemo(()=>{if(n.length===0)return 0;const l=n.filter(c=>c.isActive).length,d=n.filter(c=>!c.isBehind).length;return Math.round((l+d)/(n.length*2)*100)},[n]);return h.useEffect(()=>{if(!t||!Oe)return;const l=Oe.subscribeQuery(Oe.studentStates.where("sessionId",t),c=>{r(c)}),d=Oe.subscribeQuery(Oe.assessmentResponses.where("sessionId",t),c=>{const u={};c.forEach(b=>{u[b.assessmentId]||(u[b.assessmentId]={completed:0,inProgress:0,notStarted:s}),b.isComplete?(u[b.assessmentId].completed+=1,u[b.assessmentId].notStarted-=1):(u[b.assessmentId].inProgress+=1,u[b.assessmentId].notStarted-=1)}),a(u)});return()=>{l==null||l(),d==null||d()}},[t,s]),e.jsxs("div",{className:"live-dashboard",children:[e.jsxs("header",{className:"live-dashboard__header",children:[e.jsx("h2",{children:"Live class dashboard"}),e.jsx("p",{children:"Monitor engagement and assessment progress in real time."})]}),e.jsxs("div",{className:"live-dashboard__metrics",children:[e.jsxs("div",{className:"live-dashboard__card",children:[e.jsx("h3",{children:"Class engagement"}),e.jsx("div",{className:"live-dashboard__gauge",children:e.jsx(ru,{value:o,text:`${o}%`,styles:iu({pathColor:o>70?"#10b981":o>40?"#f59e0b":"#ef4444",textColor:"#0f172a",trailColor:"#e2e8f0"})})})]}),e.jsxs("div",{className:"live-dashboard__card",children:[e.jsx("h3",{children:"Active students"}),e.jsxs("p",{className:"live-dashboard__value",children:[n.filter(l=>l.isActive).length," / ",s]}),e.jsxs("p",{className:"live-dashboard__note",children:[n.filter(l=>l.isBehind).length," behind pointer"]})]}),e.jsxs("div",{className:"live-dashboard__card",children:[e.jsx("h3",{children:"Assessment status"}),Object.keys(i).length===0?e.jsx("p",{className:"live-dashboard__note",children:"No active assessments"}):e.jsx("ul",{className:"live-dashboard__assessment-list",children:Object.entries(i).map(([l,d])=>e.jsxs("li",{children:[e.jsxs("div",{className:"live-dashboard__assessment-row",children:[e.jsxs("span",{className:"live-dashboard__chip live-dashboard__chip--success",children:["âœ“ ",d.completed]}),e.jsxs("span",{className:"live-dashboard__chip live-dashboard__chip--warning",children:["âŸ³ ",d.inProgress]}),e.jsxs("span",{className:"live-dashboard__chip live-dashboard__chip--muted",children:["â—‹ ",d.notStarted]})]}),e.jsx("div",{className:"live-dashboard__progress",children:e.jsx(ei,{className:"live-dashboard__progress-bar",value:d.completed,max:s||1,tone:"success",size:"xs",ariaLabel:`Assessment ${l} completion`})})]},l))})]})]}),e.jsxs("section",{className:"live-dashboard__grid",children:[e.jsx("header",{children:e.jsx("h3",{children:"Student status"})}),e.jsx("div",{className:"live-dashboard__grid-body",children:n.length===0?e.jsx("p",{className:"live-dashboard__note",children:"Waiting for students to joinâ€¦"}):n.map(l=>{var d;return e.jsxs("div",{className:rt("live-dashboard__tile",au(l)),children:[e.jsx("span",{children:(d=l.studentId)==null?void 0:d.slice(-4)}),e.jsxs("strong",{children:["Slide ",l.currentPosition??0]})]},l.studentId)})})]})]})}function lu(t,s=0){return typeof t=="number"&&Number.isFinite(t)?t:s}class cu{constructor(){this.enabled=!!Oe}isEnabled(){return this.enabled&&!!Oe}async trackEvent(s,n={}){if(!this.isEnabled()||!s)return null;const r=Date.now(),i={type:s,timestamp:r,...n};try{const a=Ae();return await Oe.transact([dn.analytics[a].update({...i,payload:i.payload??null})]),this.processForMetrics({id:a,...i}),a}catch(a){return console.warn("Analytics event failed",s,a),null}}async processForMetrics(s){if(s!=null&&s.type)switch(s.type){case"slide_view":await this.updateSlideMetrics(s);break}}async updateSlideMetrics(s){var n;if(!(!this.isEnabled()||!(s!=null&&s.slideId)))try{const r=await Oe.analytics.where("type","slide_view").where("slideId",s.slideId).get();if(!Array.isArray(r)||r.length===0)return;const i=r.length,a=r.reduce((u,b)=>{var g;return u+lu((g=b.payload)==null?void 0:g.durationMs,0)},0),o=i===0?0:Math.round(a/i),l=Ae(),d=await Oe.slideMetrics.where("slideId",s.slideId).get(),c=((n=d==null?void 0:d[0])==null?void 0:n.id)??l;await Oe.transact([dn.slideMetrics[c].update({slideId:s.slideId,averageViewTime:o,totalViews:i})])}catch(r){console.warn("Failed to update slide metrics",r)}}}const Hs=new cu;function wt(t,s=0){return typeof t=="number"&&Number.isFinite(t)?t:s}class du{constructor(){this.enabled=!!Oe,this.experienceTable={slide_complete:5,assessment_attempt:10,assessment_perfect:35,interactive_complete:25}}isEnabled(){return this.enabled&&!!Oe}calculateLevel(s){const n=wt(s,0);return Math.max(1,Math.floor(n/150)+1)}async fetchStudentRecord(s){if(!this.isEnabled()||!s)return null;try{const n=await Oe.studentGamification.where("studentId",s).get();return(n==null?void 0:n[0])??null}catch(n){return console.warn("Failed to fetch gamification record",n),null}}async awardExperience(s,n,r={}){if(!this.isEnabled()||!s)return{awarded:0,total:null,level:null,achievements:[]};let a=wt(this.experienceTable[n],0);if(r.correct&&n!=="assessment_perfect"&&(a+=5),r.firstAttempt&&n==="assessment_perfect"&&(a+=10),a<=0)return{awarded:0,total:null,level:null,achievements:[]};try{const o=await this.fetchStudentRecord(s),l=(o==null?void 0:o.id)??Ae(),d=wt(o==null?void 0:o.xp,0),c=wt(o==null?void 0:o.totalCorrect,0),u=wt(o==null?void 0:o.totalAttempts,0),b=wt(o==null?void 0:o.streak,0),g=d+a,S=this.calculateLevel(g),x=r.correct?1:0,A=r.attempts?wt(r.attempts,1):1,v=r.correct?b+1:0;return await Oe.transact([dn.studentGamification[l].update({studentId:s,xp:g,level:S,streak:v,totalCorrect:c+x,totalAttempts:u+A,lastUpdated:new Date().toISOString()})]),{awarded:a,total:g,level:S,achievements:[]}}catch(o){return console.warn("Gamification award failed",o),{awarded:0,total:null,level:null,achievements:[]}}}}const uu=new du,hu=4e3;function pu(t){return t?typeof t=="string"?t:typeof t=="object"&&t.slideId?t.slideId:typeof t=="object"&&t.id?t.id:null:null}function mu(t){var o;if(!t)return null;const s=t.pacing??t,n=((o=t.lesson)==null?void 0:o.id)||(s==null?void 0:s.lessonId)||(s==null?void 0:s.slideId)||null,r=n?ys(n):null,i=t.accessibleSlides??(s==null?void 0:s.accessibleSlides)??[],a=new Set(i.map(l=>pu(l)).filter(Boolean));return r!=null&&r.slideId&&a.add(r.slideId),{classDoc:t.class??null,pacing:s,lesson:r,accessible:a,sessionCode:(s==null?void 0:s.sessionCode)??null,sessionStatus:(s==null?void 0:s.sessionStatus)??(r?"live":"idle"),updatedAt:(s==null?void 0:s.updatedAt)??null}}function Ti(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s.toLocaleString()}function qs(){var t,s;return((t=Wr[0])==null?void 0:t.id)??((s=bt.find(n=>n.deckId))==null?void 0:s.deckId)??null}function fu(t){return bt.find(s=>s.deckId===t)??bt[0]}function Mi(t){switch((t||"idle").toLowerCase()){case"live":return"Live";case"paused":return"Paused";case"idle":default:return"Not started"}}function gu(t){h.useEffect(()=>{const s=n=>{var r,i;n.defaultPrevented||n.target&&["INPUT","TEXTAREA"].includes(n.target.tagName)||(n.key==="ArrowRight"&&((r=t.onNext)==null||r.call(t)),n.key==="ArrowLeft"&&((i=t.onPrev)==null||i.call(t)))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t])}function bu({slides:t,pointerId:s,activeId:n,accessibleSet:r,onSelect:i,disableFuture:a,label:o}){const l={content:"Content",checkpoint:"Checkpoint",assessment:"Assessment",summative:"Summative",interactive:"Interactive"};return e.jsx("div",{className:"y7-live-timeline","aria-label":o,children:t.map(d=>{const c=s===d.id?"current":r.has(d.id)?"available":"locked",u=n===d.id,b=a&&c==="locked";return e.jsxs("button",{type:"button",className:`y7-live-timeline__item y7-live-timeline__item--${c} ${u?"is-active":""}`,onClick:()=>i(d.id,c),disabled:b,children:[e.jsx("span",{className:"y7-live-timeline__order",children:d.order}),e.jsxs("div",{className:"y7-live-timeline__text",children:[e.jsx("strong",{children:d.title}),e.jsx("span",{children:l[d.type]||"Slide"})]})]},d.id)})})}function yu({classes:t,selectedClassId:s,onSelectClass:n,onStart:r,onAdvance:i,onPause:a,onReset:o,onRefresh:l,deckSummary:d,liveState:c,controlBusy:u}){const b=(t==null?void 0:t.filter(j=>!j.archivedAt))??[],g=c==null?void 0:c.lesson,S=Mi(c==null?void 0:c.sessionStatus),x=(c==null?void 0:c.sessionStatus)==="live"?"brand":void 0,A=[c!=null&&c.sessionCode?`Join code ${c.sessionCode}`:null,c!=null&&c.updatedAt?`Updated ${Ti(c.updatedAt)}`:null].filter(Boolean).join(" â€¢ ")||null,v=u||!s;return e.jsxs("section",{className:"y7-live-panel",children:[e.jsxs("header",{className:"y7-live-panel__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Class controls"}),e.jsx("p",{children:"Launch and pace the live deck for your Year 7 class."})]}),e.jsx("button",{type:"button",className:"y7-btn y7-btn--ghost",onClick:l,children:"Refresh"})]}),e.jsxs("label",{className:"y7-live-field",children:[e.jsx("span",{children:"Choose a class"}),e.jsxs("select",{value:s,onChange:j=>n(j.target.value),children:[e.jsx("option",{value:"",children:"Preview without a class"}),b.map(j=>e.jsx("option",{value:j.id,children:j.className},j.id))]})]}),e.jsx(Mt,{tone:x,label:"Session status",value:S,meta:A,compact:!0}),e.jsxs("div",{className:"y7-live-actions",children:[e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",disabled:v,onClick:r,children:"Start / resume"}),e.jsx("button",{type:"button",className:"y7-btn",disabled:v,onClick:i,children:"Advance"}),e.jsx("button",{type:"button",className:"y7-btn",disabled:v,onClick:a,children:"Pause"}),e.jsx("button",{type:"button",className:"y7-btn y7-btn--ghost",disabled:v,onClick:o,children:"Reset to slide 1"})]}),e.jsx("footer",{className:"y7-live-panel__footer",children:g?e.jsx(e.Fragment,{children:e.jsxs("p",{children:["Live on ",e.jsx("strong",{children:g.slideTitle}),typeof g.index=="number"&&(d!=null&&d.slideCount)?e.jsxs("span",{children:[" ","(slide ",g.index+1," of ",d.slideCount,")"]}):null]})}):e.jsx("p",{children:"No active pointer yet. Start the session to project the first slide."})})]})}function xu({deckSummary:t,liveState:s,onReturnToLive:n,canReturn:r,onJoinByCode:i,joinMessage:a,joinCodeInput:o,setJoinCodeInput:l}){const d=s==null?void 0:s.lesson,c=Mi(s==null?void 0:s.sessionStatus),u=(s==null?void 0:s.sessionStatus)==="live"?"brand":void 0,b=[s!=null&&s.sessionCode?`Join code ${s.sessionCode}`:null,s!=null&&s.updatedAt?`Updated ${Ti(s.updatedAt)}`:null].filter(Boolean).join(" â€¢ ")||null;return e.jsxs("section",{className:"y7-live-panel",children:[e.jsx("header",{className:"y7-live-panel__header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Lesson navigation"}),e.jsx("p",{children:"Stay in sync with your teacher and revisit earlier slides."})]})}),e.jsx(Mt,{tone:u,label:"Session status",value:c,meta:b,compact:!0}),e.jsxs("div",{className:"y7-live-panel__body",children:[d?e.jsxs("p",{children:["Live pointer: ",e.jsx("strong",{children:d.slideTitle}),typeof d.index=="number"&&(t!=null&&t.slideCount)?e.jsxs("span",{children:[" ","(slide ",d.index+1," of ",t.slideCount,")"]}):null]}):e.jsx("p",{children:"Your teacher hasnâ€™t started the live deck yet. You can still review previous slides once the session begins."}),r&&e.jsx("button",{type:"button",className:"y7-btn y7-btn--primary",onClick:n,children:"Jump to live slide"})]}),e.jsxs("form",{className:"y7-live-join",onSubmit:g=>{g.preventDefault(),i==null||i()},children:[e.jsxs("label",{className:"y7-live-field",children:[e.jsx("span",{children:"Join with a code"}),e.jsx("input",{type:"text",value:o,placeholder:"e.g. H4X8Q",onChange:g=>l(g.target.value.toUpperCase()),maxLength:8})]}),e.jsx("button",{type:"submit",className:"y7-btn",children:"Join session"}),a&&e.jsx("p",{className:`y7-live-join__status y7-live-join__status--${a.kind}`,children:a.text})]})]})}function vu({assessment:t,isVisible:s}){if(!s)return null;const n=(t==null?void 0:t.students)??[],r=(t==null?void 0:t.summary)??{};return e.jsxs("section",{className:"y7-live-panel",children:[e.jsx("header",{className:"y7-live-panel__header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Checkpoint dashboard"}),e.jsx("p",{children:"Monitor progress as students complete the formative task."})]})}),e.jsxs("div",{className:"y7-live-summary",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Completed"}),e.jsx("strong",{children:r.completed??0})]}),e.jsxs("div",{children:[e.jsx("span",{children:"In progress"}),e.jsx("strong",{children:r["in-progress"]??0})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Not started"}),e.jsx("strong",{children:r["not-started"]??0})]})]}),e.jsx("div",{className:"y7-live-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Student"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Attempts"}),e.jsx("th",{children:"Score"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Waiting for students to beginâ€¦"})}):n.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.displayName||i.username||"â€”"}),e.jsx("td",{className:`status status--${i.status}`,children:i.status.replace("-"," ")}),e.jsx("td",{children:i.attempts??0}),e.jsx("td",{children:typeof i.score=="number"?`${Math.round(i.score*100)}%`:"â€”"})]},i.id))})]})})]})}function ju(){var Xe,Ye,ot,se,X,oe,de,je,ze,Ce,lt,et,Je,Ze,Qe;const{session:t,ready:s}=Pe(),n=(t==null?void 0:t.token)??null,r=((Xe=t==null?void 0:t.user)==null?void 0:Xe.role)??null,i=r==="teacher",a=r==="student",[o]=Di(),{awardXp:l,resetStreak:d}=xs(),c=o.get("deckId")||qs(),[u,b]=h.useState(c),g=h.useMemo(()=>u?Na(u):null,[u]),S=h.useMemo(()=>xn((g==null?void 0:g.id)??qs()),[g==null?void 0:g.id]),x=h.useMemo(()=>g?fu(g.id):bt[0],[g]),[A,v]=h.useState(null),[j,C]=h.useState(()=>o.get("classId")||""),[k,R]=h.useState(null),[I,w]=h.useState(null),[N,m]=h.useState(null),[f,p]=h.useState(null),[_,O]=h.useState(!1),[F,D]=h.useState({summary:null,students:[]}),[E,U]=h.useState(null),[z,ne]=h.useState(""),[Z,P]=h.useState(null),[L,Q]=h.useState(!0),J=h.useMemo(()=>{var T,$,W;return i?((T=k==null?void 0:k.pacing)==null?void 0:T.sessionId)||(k==null?void 0:k.sessionId)||j||null:(($=N==null?void 0:N.pacing)==null?void 0:$.sessionId)||(N==null?void 0:N.sessionId)||((W=I==null?void 0:I.class)==null?void 0:W.id)||null},[i,(Ye=k==null?void 0:k.pacing)==null?void 0:Ye.sessionId,k==null?void 0:k.sessionId,j,(ot=N==null?void 0:N.pacing)==null?void 0:ot.sessionId,N==null?void 0:N.sessionId,(se=I==null?void 0:I.class)==null?void 0:se.id]),ie=h.useMemo(()=>{var T,$;return i?j||null:((T=I==null?void 0:I.class)==null?void 0:T.id)||(($=N==null?void 0:N.classDoc)==null?void 0:$.id)||null},[i,j,(X=I==null?void 0:I.class)==null?void 0:X.id,(oe=N==null?void 0:N.classDoc)==null?void 0:oe.id]),G=h.useMemo(()=>{var T;return a&&((T=I==null?void 0:I.student)==null?void 0:T.id)||null},[a,(de=I==null?void 0:I.student)==null?void 0:de.id]),ee=h.useRef(null),te=h.useRef(Date.now()),V=h.useRef(null),y=h.useCallback((T,$)=>{!a||!T||Hs.trackEvent("slide_view",{sessionId:J,classId:ie,studentId:G,slideId:T,payload:{durationMs:Math.max(0,$??0)}})},[a,J,ie,G]),M=h.useMemo(()=>!(A!=null&&A.students)||!j?[]:A.students.filter(T=>T.classId===j),[A==null?void 0:A.students,j]),B=i?k:N,H=((je=B==null?void 0:B.lesson)==null?void 0:je.slideId)||((ze=B==null?void 0:B.lesson)==null?void 0:ze.id)||null,Y=(B==null?void 0:B.accessible)??new Set(H?[H]:[]),q=H?Ft(H):null,re=h.useMemo(()=>f?Ft(f):H?Ft(H):S[0]?Ft(S[0].id):null,[f,H,S]),ce=a&&H&&f&&H!==f;h.useEffect(()=>{const T=o.get("deckId")||qs();T!==u&&(b(T),p(null))},[o,u]);const le=h.useCallback((T,{forceActive:$}={})=>{var ae,ge;const W=mu(T);if(!W)return;i?R(W):m(W);const K=((ae=W.lesson)==null?void 0:ae.slideId)||null;$||!f?p(K||((ge=S[0])==null?void 0:ge.id)||null):f&&!W.accessible.has(f)&&p(K||f)},[i,f,S]),fe=h.useCallback(async T=>{if(!n||!T){R(null);return}try{const $=await bn(n,T);le($,{forceActive:!f})}catch($){console.error("Failed to load class pacing",$),R(null)}},[n,le,f]),he=h.useCallback(async T=>{if(!n||!T){m(null);return}try{const $=await ds(n,T);le($,{forceActive:!f})}catch($){console.error("Failed to load student pacing",$),m(null)}},[n,le,f]);h.useEffect(()=>{if(!s||!n)return;(async()=>{var $,W,K;Q(!0);try{if(i){const ae=await gn(n);v(ae);const ge=(ae.classes||[]).filter(me=>{const pe=String((me==null?void 0:me.yearGroup)||"").toLowerCase();return pe.includes("year 7")||pe.includes("ks3")}),we=j&&ge.some(me=>me.id===j)?j:(($=ge[0])==null?void 0:$.id)||"";C(we),we&&await fe(we)}else if(a){const ae=await yn(n);w(ae);const ge=((W=ae.class)==null?void 0:W.id)||((K=ae.student)==null?void 0:K.classId)||"";ge&&await he(ge)}P(null)}catch(ae){console.error(ae),P(ae)}finally{Q(!1)}})()},[s,n,i,a,j,fe,he]),h.useEffect(()=>{!f&&S[0]&&p(H||S[0].id)},[S,H,f]),h.useEffect(()=>{if(!a||!f)return;const T=Date.now(),$=ee.current;$&&$!==f&&y($,T-te.current),ee.current=f,te.current=T},[a,f,y]),h.useEffect(()=>()=>{if(!a)return;const T=ee.current;if(T){const $=Date.now()-te.current;y(T,$)}},[a,y]),h.useEffect(()=>{if(!i||!H){V.current=null;return}V.current!==H&&(V.current=H,Hs.trackEvent("pointer_update",{sessionId:J,classId:ie,slideId:H,payload:{role:"teacher"}}))},[i,H,J,ie]),h.useEffect(()=>{var K;if(!i||!j||!n||!H||((K=q==null?void 0:q.slide)==null?void 0:K.type)!=="checkpoint"){D({summary:null,students:[]});return}let T=!1;const $=async()=>{try{const ae=await Rr(n,j,{unitId:g==null?void 0:g.id,segmentId:H});T||D({summary:ae.summary??null,students:ae.students??[]})}catch(ae){T||console.error("Failed to fetch live assessment status",ae)}};$();const W=setInterval($,hu);return()=>{T=!0,clearInterval(W)}},[i,j,n,H,(Ce=q==null?void 0:q.slide)==null?void 0:Ce.type,g==null?void 0:g.id]);const ue=h.useCallback(async()=>{const T=S.findIndex(W=>W.id===(i?H:f)),$=S[T+1];if($)if(i&&j){O(!0);try{const W=await Ke(n,j,{command:"advance"});le(W,{forceActive:!0})}catch(W){console.error(W)}finally{O(!1)}}else p($.id)},[S,i,H,f,j,n,le]),ve=h.useCallback(async()=>{const T=S.findIndex(W=>W.id===(i?H:f)),$=S[T-1];if($)if(i&&j){O(!0);try{const W=await Ke(n,j,{lessonId:$.id,unitId:g==null?void 0:g.id});le(W,{forceActive:!0})}catch(W){console.error(W)}finally{O(!1)}}else p($.id)},[S,i,H,f,j,n,g==null?void 0:g.id,le]);gu({onNext:ue,onPrev:ve});const ye=h.useCallback(async(T,$)=>{if(i&&j){O(!0);try{const W=await Ke(n,j,{lessonId:T,unitId:g==null?void 0:g.id});le(W,{forceActive:!0})}catch(W){console.error(W)}finally{O(!1)}}else $!=="locked"&&p(T)},[i,j,n,g==null?void 0:g.id,le]),Ee=h.useCallback(async()=>{if(!(!i||!j)){O(!0);try{const T=await Ke(n,j,{command:"start",unitId:g==null?void 0:g.id,resume:!0});le(T,{forceActive:!0})}catch(T){console.error(T)}finally{O(!1)}}},[i,j,n,g==null?void 0:g.id,le]),Ue=h.useCallback(async()=>{if(!(!i||!j)){O(!0);try{const T=await Ke(n,j,{command:"stop"});le(T,{forceActive:!0})}catch(T){console.error(T)}finally{O(!1)}}},[i,j,n,le]),it=h.useCallback(async()=>{if(!(!i||!j)){O(!0);try{const T=await Ke(n,j,{command:"reset",unitId:g==null?void 0:g.id,resetHistory:!0});le(T,{forceActive:!0})}catch(T){console.error(T)}finally{O(!1)}}},[i,j,n,g==null?void 0:g.id,le]),at=h.useCallback(async T=>{if(!a||!ie||!n||!f)return;const $=typeof T=="object"&&T!==null&&Number.isFinite(T.attempts)?Number(T.attempts):1,W=Math.max(1,$),K=(()=>{if(typeof T=="boolean")return T;if(T&&typeof T=="object"){if(typeof T.success=="boolean")return T.success;if(typeof T.status=="string")return T.status==="completed";if(typeof T.score=="number")return T.score>0}return!1})(),ae=typeof T=="object"&&T!==null&&Number.isFinite(T.score)?Number(T.score):null,ge=ae===null?K?1:null:ae<=1?Math.max(0,ae):1,we={status:K?"completed":"in-progress",score:ge,attempts:W};let me=!1;try{await Or(n,{classId:ie,unitId:g==null?void 0:g.id,segmentId:f,status:we.status,score:we.score,attempts:we.attempts}),me=!0}catch(pe){console.error("Failed to sync checkpoint status",pe)}if(me)if(Hs.trackEvent("assessment_complete",{sessionId:J,classId:ie,studentId:G,slideId:f,payload:{score:we.score,attempts:we.attempts,success:K}}),K){const pe=we.score===1?"assessment_perfect":"assessment_attempt";try{const _e=await uu.awardExperience(G,pe,{firstAttempt:W===1,correct:K,attempts:W});(_e==null?void 0:_e.awarded)>0&&typeof l=="function"&&l({xpGained:_e.awarded,correct:1,attempts:W,spriteUnlocks:[]})}catch(_e){console.warn("Failed to award experience",_e)}}else typeof d=="function"&&d()},[a,ie,n,f,g==null?void 0:g.id,J,G,l,d]),ft=h.useCallback(async()=>{if(!(!a||!z||!n)){U({kind:"info",text:"Joiningâ€¦"});try{const T=await ra(n,z.trim());le(T,{forceActive:!0}),U({kind:"success",text:"Joined the live session"})}catch(T){console.error(T),U({kind:"error",text:T.message||"Unable to join. Check the code and try again."})}}},[a,z,n,le]),Ve=h.useCallback(T=>{C(T),T?fe(T):R(null)},[fe]),$e=(g==null?void 0:g.title)||"Live deck";return e.jsxs("div",{className:"y7-live-shell",children:[e.jsxs("header",{className:"y7-live-header",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"y7-live-eyebrow",children:["Year 7 Â· ",(x==null?void 0:x.title)||"Live deck"]}),e.jsx("h1",{children:$e}),e.jsx("p",{children:(x==null?void 0:x.summary)||"Teacher-paced live lesson with checkpoints and classroom guidance."})]}),e.jsxs("dl",{className:"y7-live-meta",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Focus"}),e.jsx("dd",{children:(x==null?void 0:x.focus)||"Live deck"})]}),(x==null?void 0:x.estimatedHours)&&e.jsxs("div",{children:[e.jsx("dt",{children:"Estimated time"}),e.jsx("dd",{children:x.estimatedHours})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Slides"}),e.jsx("dd",{children:S.length})]})]})]}),Z&&e.jsx("div",{className:"y7-live-alert",children:Z.message||"Something went wrong."}),e.jsxs("div",{className:"y7-live-layout",children:[e.jsx("main",{className:"y7-live-stage",children:L?e.jsxs("div",{className:"y7-live-loading",children:[e.jsx("span",{className:"y7-live-spinner","aria-hidden":"true"}),e.jsx("p",{children:"Loading live sessionâ€¦"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"y7-live-stage__card",children:e.jsx(Bl,{slideData:(re==null?void 0:re.slide)??re,isTeacher:i,sessionId:((lt=k==null?void 0:k.pacing)==null?void 0:lt.sessionId)||(k==null?void 0:k.sessionId)||j||null,studentId:((et=I==null?void 0:I.student)==null?void 0:et.id)||((Je=N==null?void 0:N.student)==null?void 0:Je.id)||null,canProgress:i||Y.has(f),onAssessmentComplete:a?at:void 0})}),e.jsxs("div",{className:"y7-live-controls",children:[e.jsx("button",{type:"button",className:"y7-btn",onClick:ve,disabled:_||S.length===0,children:"Previous"}),e.jsxs("div",{className:"y7-live-controls__middle",children:[e.jsxs("span",{children:["Slide ",S.findIndex(T=>T.id===f)+1," of ",S.length]}),H&&H!==f&&!i&&e.jsx("button",{type:"button",className:"y7-btn y7-btn--ghost",onClick:()=>p(H),children:"Jump to live"})]}),e.jsx("button",{type:"button",className:"y7-btn",onClick:ue,disabled:_||S.length===0,children:"Next"})]}),e.jsx(bu,{slides:S,pointerId:H,activeId:f,accessibleSet:Y,onSelect:ye,disableFuture:!i,label:"Live deck timeline"})]})}),e.jsxs("aside",{className:"y7-live-sidebar",children:[i?e.jsxs(e.Fragment,{children:[e.jsx(yu,{classes:(A==null?void 0:A.classes)||[],selectedClassId:j,onSelectClass:Ve,onStart:Ee,onAdvance:ue,onPause:Ue,onReset:it,onRefresh:()=>fe(j),deckSummary:{...g,slideCount:S.length},liveState:k,controlBusy:_}),e.jsx(ou,{sessionId:((Ze=k==null?void 0:k.pacing)==null?void 0:Ze.sessionId)||(k==null?void 0:k.sessionId)||j||null,classSize:M.length})]}):e.jsx(xu,{deckSummary:{...g,slideCount:S.length},liveState:N,onReturnToLive:()=>p(H),canReturn:ce,onJoinByCode:ft,joinMessage:E,joinCodeInput:z,setJoinCodeInput:ne}),e.jsx(vu,{assessment:F,isVisible:i&&["checkpoint","assessment"].includes((Qe=q==null?void 0:q.slide)==null?void 0:Qe.type)&&!!j})]})]})]})}function Pi(t){return t==="teacher"?"/dashboard":t==="student"?"/student":t==="admin"?"/admin":null}function wu(){var i;const{session:t,ready:s}=Pe();if(!s)return null;const n=((i=t==null?void 0:t.user)==null?void 0:i.role)??null,r=Pi(n);return r?e.jsx(Vt,{to:r,replace:!0}):e.jsx(ma,{})}function Be({children:t,roles:s}){var o;const{session:n,ready:r}=Pe(),i=Ct();if(!r)return null;const a=((o=n==null?void 0:n.user)==null?void 0:o.role)??null;if(!a)return e.jsx(Vt,{to:"/",replace:!0,state:{from:i.pathname}});if(Array.isArray(s)&&s.length>0&&!s.includes(a)){const l=Pi(a)??"/";return e.jsx(Vt,{to:l,replace:!0})}return t}function _u(){return e.jsx(Io,{children:e.jsx(nl,{children:e.jsxs(Fi,{children:[e.jsx(Te,{path:"/",element:e.jsx(wu,{})}),e.jsx(Te,{path:"/dashboard",element:e.jsx(Be,{roles:["teacher"],children:e.jsx(La,{})})}),e.jsx(Te,{path:"/dashboard/student/:studentId",element:e.jsx(Be,{roles:["teacher"],children:e.jsx(po,{})})}),e.jsx(Te,{path:"/teacher",element:e.jsx(Vt,{to:"/dashboard",replace:!0})}),e.jsx(Te,{path:"/student",element:e.jsx(Be,{roles:["student"],children:e.jsx(so,{})})}),e.jsx(Te,{path:"/admin",element:e.jsx(Be,{roles:["admin"],children:e.jsx(Co,{})})}),e.jsx(Te,{path:"/admin/dashboard",element:e.jsx(Vt,{to:"/admin",replace:!0})}),e.jsx(Te,{path:"/account",element:e.jsx(Be,{children:e.jsx(So,{})})}),e.jsx(Te,{path:"/curriculum",element:e.jsx(Be,{children:e.jsx(mo,{})})}),e.jsx(Te,{path:"/curriculum/ib",element:e.jsx(Be,{children:e.jsx(yo,{})})}),e.jsx(Te,{path:"/curriculum/igcse",element:e.jsx(Be,{children:e.jsx(wo,{})})}),e.jsx(Te,{path:"/curriculum/year7",element:e.jsx(Be,{children:e.jsx(yl,{})})}),e.jsx(Te,{path:"/curriculum/year7/live",element:e.jsx(Be,{children:e.jsx(ju,{})})}),e.jsx(Te,{path:"/curriculum/ib/b1",element:e.jsx(Be,{children:e.jsx(ml,{})})}),e.jsx(Te,{path:"/curriculum/ib/b2",element:e.jsx(Be,{children:e.jsx(fl,{})})}),e.jsx(Te,{path:"/topic/:id",element:e.jsx(Be,{children:e.jsx(_o,{})})}),e.jsx(Te,{path:"/lesson/:lessonId",element:e.jsx(Be,{children:e.jsx(ko,{})})})]})})})}const Nu="/ibcs-app/".replace(/\/$/,"")||"";function ku({children:t}){var a,o,l;const{session:s}=Pe(),n=((o=(a=s==null?void 0:s.user)==null?void 0:a.username)==null?void 0:o.toLowerCase())||"anonymous",r=((l=s==null?void 0:s.user)==null?void 0:l.role)==="student",i=(s==null?void 0:s.token)||null;return e.jsx(_n,{profileKey:n,syncToken:i,isStudent:r,children:t})}Vs.createRoot(document.getElementById("root")).render(e.jsx(Bi.StrictMode,{children:e.jsx(pa,{children:e.jsx(ku,{children:e.jsx(Ui,{basename:Nu,children:e.jsx(_u,{})})})})}))});export default Cu();
//# sourceMappingURL=index-BBnsendR.js.map
